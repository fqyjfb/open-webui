{"version":3,"mappings":"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","names":["PENDING","THEN","await_block","node","get_input","pending_fn","then_fn","catch_fn","hydrating","hydrate_next","runes","is_runes","v","UNINITIALIZED","value","source","mutable_source","error","branches","BranchManager","block","input","destroyed","mismatch","is_promise","HYDRATION_START_ELSE","set_hydrate_node","skip_nodes","set_hydrating","restore","capture","resolved","resolve","fn","unset_context","is_flushing_sync","flushSync","internal_set","target","e","queue_micro_task","dispatch","createEventDispatcher","chatId","tags","$.mutable_source","getTags","getTagsById","addTag","tagName","addTagById","toast","$.set","updateChatById","$.get","_tags","getAllTags","deleteTag","deleteTagById","onMount","$_tags","createParser","onParse","isFirstChunk","buffer","startingPosition","startingFieldLength","eventId","eventName","data","reset","feed","chunk","hasBom","BOM","length","position","discardTrailingNewline","lineLength","fieldLength","character","index","parseEventStreamLine","lineBuffer","noValue","field","step","valueLength","retry","charCode","EventSourceParserStream","parser","controller","event","createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","done","parsedData","_c","_b","_a","textStreamUpdate","content","chunkSize","sleep","ms","className","strokeWidth","AudioQueue","audioElement","newId","rate","url","API_KEY","CLIENT_ID","getCredentials","response","config","SCOPE","validateCredentials","oauthToken","initialized","loadGoogleDriveApi","reject","script","loadGoogleAuthApi","getAuthToken","initialize","createPicker","token","doc","fileId","fileName","fileUrl","mimeType","downloadUrl","exportFormat","errorText","blob","result","_OneDriveConfig","__publicField","authorityType","_d","authorityEndpoint","clientId","msalParams","PublicClientApplication","__vitePreload","sharePointBaseUrl","OneDriveConfig","getToken","resource","authParams","accessToken","msalInstance","resp","popupError","getPickerParams","channelId","uuidv4","params","downloadOneDriveFile","fileInfo","fileInfoUrl","downloadResponse","openOneDrivePicker","pickerWindow","channelPort","baseUrl","handleWindowMessage","message","handlePortMessage","portEvent","portData","command","newToken","cleanup","authToken","queryString","form","err","pickAndDownloadFile","pickerResult","selectedFile","i18n","getContext","onSelect","$.prop","$$props","loaded","items","selectedIdx","page","itemsLoading","allItemsLoaded","loadMoreItems","getItemsPage","res","getChatList","item","$chatId","dayjs","tick","$i18n","$.each","node_2","idx","decodeString","$.untrack","$.set_class","button","$.set_attribute","$.event","$$render","consequent_1","consequent","alternate","consequent_2","alternate_1","getNoteList","note","selectedItem","selectedFileItemsPage","selectedFileItems","selectedFileItemsTotal","selectedFileItemsLoading","selectedFileAllItemsLoaded","initSelectedFileItems","getSelectedFileItemsPage","loadMoreSelectedFileItems","searchKnowledgeFilesById","pageItems","init","getKnowledgeBases","button_1","node_11","file","button_2","consequent_4","consequent_3","alternate_2","div_2","consequent_6","alternate_3","consequent_7","alternate_4","files","selectedModels","fileUploadCapableModels","screenCaptureHandler","uploadFilesHandler","inputFilesHandler","uploadGoogleDriveHandler","uploadOneDriveHandler","onUpload","onClose","show","tab","showAttachWebpageModal","fileUploadEnabled","detectMobile","userAgent","handleFileChange","inputFiles","$user","$$value","flyAndScale","cameraInputElement","$config","$chats","button_3","_f","_e","$.transition","div_1","fly","button_4","div_18","button_5","div_21","button_6","div_24","button_7","div_27","consequent_11","consequent_8","consequent_5","selectedToolIds","selectedTools","$tools","tool","$toolServers","div_6","$.template_effect","$.set_text","text_3","div_14","toolServer","tool_spec","toggleFilters","selectedFilterIds","showWebSearchButton","webSearchEnabled","showImageGenerationButton","imageGenerationEnabled","showCodeInterpreterButton","codeInterpreterEnabled","onShowValves","tools","$_tools","_tools","getTools","a","i","arr","serverIdx","server","id","b","filter","node_26","toolId","button_8","state","parts","serverId","authUrl","getOAuthClientAuthorizationUrl","div_28","inputContent","autocomplete","generateAutoCompletion","onChange","inputElement","$settings","duration","relativeTime","createMessagePair","stopResponse","autoScroll","generating","atSelectedModel","selectedModelIds","history","taskIds","prompt","showInputVariablesModal","inputVariablesModalCallback","variableValues","inputVariables","inputVariableValues","showValvesModal","selectedValvesType","selectedValvesItemId","integrationsMenuCloseOnOutsideClick","inputVariableHandler","text","extractInputVariables","replaceVariables","textVariableHandler","clipboardText","clipboardItems","type","location","getUserPosition","sessionUser","getSessionUser","name","bio","gender","birthDate","age","getAge","language","date","getFormattedDate","time","getFormattedTime","dateTime","getCurrentDateTime","timezone","getUserTimezone","weekday","getWeekday","variables","chatInputElement","setText","cb","getCommand","chatInput","word","replaceCommandWithText","insertTextAtCursor","chatInputContainer","words","extractCurlyBraceWords","showCommands","suggestions","showTools","recording","isComposing","compositionEndedAt","isSafari","inOrNearComposition","filesInputElement","showInputModal","dragged","shiftKey","placeholder","visionCapableModels","webSearchCapableModels","imageGenerationCapableModels","codeInterpreterCapableModels","showToolsButton","scrollToBottom","element","mediaStream","video","canvas","track","imageUrl","uploadFileHandler","process","itemData","$_user","tempItemId","fileItem","$temporaryChatEnabled","extractContentFromFile","metadata","_g","_j","_i","_h","uploadedFile","uploadFile","_k","_l","_m","compressImageHandler","settings","settingsCompression","configWidth","configHeight","width","height","compressImage","compressedFile","convertHeicToJpeg","createNote","createNoteHandler","goto","onDragOver","onDragLeave","onDrop","onKeyDown","onKeyUp","onFocus","onBlur","getSuggestionRenderer","CommandSuggestionList","f","dropzoneElement","onDestroy","model","$models","m","acc","filters","f1","f2","$0","$.derived_safe_equal","$.bind_this","filename","WEBUI_API_BASE_URL","div_15","fileIdx","$mobile","createMessagesList","isCtrlPressed","suggestionsContainerElement","userMessageElement","editButton","clipboardData","PASTED_TEXT_CHARACTER_LIMIT","fileData","node_29","filterId","$.preventDefault","consequent_12","button_9","consequent_13","button_10","consequent_14","button_11","button_12","button_13","stream","button_14","$TTSWorker","TTSWorker","KokoroWorker","showCallOverlay","showControls","DOMPurify","marked","$.bind_files","_inputFiles","$.mutate","consequent_20","disabled","showSetDefault","saveDefaultModel","it","updateUserSettings","pinModelHandler","modelId","pinnedModels","_selectedModels","div","selectedModel","selectedModelIdx","saveAs","fileSaver","shareHandler","moveChatHandler","archiveChatHandler","chat","showFullMessages","getChatAsText","downloadTxt","chatText","downloadPdf","jsPDF","html2canvas","containerElement","isDarkMode","virtualWidth","clonedElement","r","pdf","pageWidthMM","pageHeightMM","pxPerMM","pxPerPDFMM","pagePixelHeight","offsetY","sliceHeight","pageCanvas","imgData","imgHeightMM","left","top","right","bottom","pageWidth","pageHeight","usableWidth","fontSize","lineHeight","paragraphs","y","paragraph","lines","line","downloadJSONExport","chatObj","getChatById","showOverview","showArtifacts","showEmbeds","$artifactContents","copyToClipboard","$folders","folder","initNewChat","shareEnabled","showModelSelector","onSaveTempChat","closedBannerIds","showShareChatModal","$showSidebar","showSidebar","temporaryChatEnabled","$showControls","showArchivedChats","consequent_9","$banners","banner","bannerId","selectedId","loading","valvesSpec","valves","debounceTimer","debounceSubmitHandler","submitHandler","getUserValves","getToolUserValvesById","getToolUserValvesSpecById","getFunctionUserValvesById","getFunctionUserValvesSpecById","property","updateToolUserValvesById","updateFunctionUserValvesById","$functions","functions","getFunctions","node_4","func","$.bind_select_value","select","select_1","chatFiles","showValves","div_4","$.bind_value","textarea","devices","device","eventTarget","submitPrompt","wakeLock","confirmed","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","rmsLevel","hasStartedSpeaking","mediaRecorder","audioStream","audioChunks","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","takeScreenshot","context","dataURL","stopCamera","MIN_DECIBELS","transcribeHandler","audioBlob","blobToFile","transcribeAudio","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","startRecording","analyseAudio","stopAudioStream","calculateRMS","sumSquares","normalizedValue","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","lastSoundTime","processFrame","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","getVoiceId","_p","_o","_n","speakSpeechSynthesisHandler","voices","getVoicesLoop","voiceId","voice","playAudio","audio","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","messages","monitorAndPlayAudio","signal","chatStartHandler","chatEventHandler","chatFinishHandler","setWakeLock","alternate_5","alternate_6","alternate_7","overlay","contents","selectedContentIdx","copied","iframeElement","navigateContent","direction","iframeLoadHandler","showFullScreen","downloadArtifact","artifactCode","codeIdx","artifactContents","iframe","getSrcUrl","messageId","sourceId","parsed","hasQuery","$embed","embed","models","showMessage","pane","mediaQuery","largeScreen","minSize","openPane","container","size","handleMediaQuery","onMouseDown","onMouseUp","entries","entry","percentage","closeHandler","$$anchor","$$source","Overview","$showOverview","$showArtifacts","$showEmbeds","consequent_10","alternate_8","localizedFormat","chats","chatListLoading","allChatsLoaded","loadHandler","chatList","getTimeRange","orderBy","setSortKey","key","node_9","div_5","a_1","loadChats","newChatList","getChatListByFolderId","setChatList","onUpdate","folderId","onDelete","showFolderModal","showDeleteConfirm","deleteFolderContents","updateHandler","meta","currentName","updateFolderById","_folder","getFolderById","selectedFolder","updateIconHandler","iconName","deleteHandler","deleteFolderById","exportHandler","getChatsByFolderId","$.bind_checked","messageInput","toolServers","$_models","$selectedFolder","$currentChatPage","currentChatPage","modelIdx","tag","sanitizeResponseContent","fade","div_7","div_9","div_13","chatIdProp","controlPane","controlPaneComponent","messagesContainerElement","navbarElement","showEventConfirmation","eventConfirmationTitle","eventConfirmationMessage","eventConfirmationInput","eventConfirmationInputPlaceholder","eventConfirmationInputValue","eventCallback","chatIdUnsubscriber","generationController","navigateHandler","storageChatInput","loadChat","setDefaults","saveSessionSelectedModels","selectedModelsString","oldSelectedModelIds","onSelectedModelIdsChange","resetInput","t","_q","ignoreSettings","_chatId","_messageId","messageChildrenIds","messageElement","saveChatHandler","chatCompletionEventHandler","responseMessage","chatTitle","allTags","existingCodeExecutionIndex","execution","toastType","toastContent","onMessageHandler","savedModelIds","pageSubscribe","showControlsSubscribe","selectedFolderSubscribe","stopAudio","$audioQueue","$socket","audioQueue","p","uploadGoogleDriveFile","fetchOptions","fileResponse","contentType","fileBlob","uploadWeb","urls","fileItems","isYoutubeUrl","processYoutubeVideo","processWeb","getContents","codeBlocks","htmlContent","cssContent","jsContent","getCodeBlockContents","renderedContent","availableModels","defaultModels","$page","urlModels","modelSelectorButton","modelSelectorInput","_r","_s","_t","q","chatContent","convertMessagesToHistory","taskRes","getTaskIdsByChatId","behavior","chatCompletedHandler","responseMessageId","chatCompleted","chatActionHandler","actionId","chatAction","getChatEventEmitter","userPrompt","parentMessage","userMessageId","userMessage","initChatHandler","addMessages","parentId","currentParentId","choices","sources","selected_model_id","usage","handleOpenAIError","messageContentParts","getMessageContentParts","removeAllDetails","lastMessageContentPart","_raw","lastMessage","_files","array","sendMessage","_history","newChat","responseMessageIds","_modelIdx","chatEventEmitter","sendMessageSocket","getFeatures","features","currentModels","_v","_u","_w","_x","_messages","chatMessageFiles","messageFile","userLocation","getAndUpdateUserLocation","processDetails","imageFiles","toolIds","toolServerIds","generateOpenAIChatCompletion","str","getPromptVariables","_z","_y","WEBUI_BASE_URL","errorMessage","innerError","status","taskId","stopTask","submitMessage","regenerateResponse","suggestionPrompt","continueResponse","mergeResponses","responses","mergedResponse","generateMoACompletion","textStream","update","createNewChat","MAX_DRAFT_LENGTH","saveDraftTimeout","saveDraft","draft","clearDraft","updateChatFolderIdById","pinnedChats","getPinnedChatList","$chatTitle","$WEBUI_NAME","title","savedChat"],"ignoreList":[0,2,3],"sources":["../../../../../../node_modules/svelte/src/internal/client/dom/blocks/await.js","../../../../../../src/lib/components/chat/Tags.svelte","../../../../../../node_modules/eventsource-parser/dist/index.js","../../../../../../node_modules/eventsource-parser/dist/stream.js","../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/icons/Cube.svelte","../../../../../../src/lib/utils/audio.ts","../../../../../../src/lib/utils/google-drive-picker.ts","../../../../../../src/lib/utils/onedrive-file-picker.ts","../../../../../../src/lib/components/icons/ClockRotateRight.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Chats.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Notes.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu/Knowledge.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/chat/ToolServersModal.svelte","../../../../../../src/lib/components/icons/Photo.svelte","../../../../../../src/lib/components/icons/Wrench.svelte","../../../../../../src/lib/components/icons/Voice.svelte","../../../../../../src/lib/components/icons/Terminal.svelte","../../../../../../src/lib/components/icons/Knobs.svelte","../../../../../../src/lib/components/chat/MessageInput/IntegrationsMenu.svelte","../../../../../../src/lib/components/icons/Component.svelte","../../../../../../src/lib/components/icons/PlusAlt.svelte","../../../../../../src/lib/components/common/InputModal.svelte","../../../../../../src/lib/components/icons/Expand.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/icons/AdjustmentsHorizontal.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/icons/ChatBubbleDotted.svelte","../../../../../../src/lib/components/icons/ChatBubbleDottedChecked.svelte","../../../../../../src/lib/components/icons/ChatPlus.svelte","../../../../../../src/lib/components/icons/ChatCheck.svelte","../../../../../../src/lib/components/chat/Navbar.svelte","../../../../../../src/lib/components/chat/Controls/Valves.svelte","../../../../../../src/lib/components/chat/Controls/Controls.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/icons/ArrowsPointingOut.svelte","../../../../../../src/lib/components/chat/Artifacts.svelte","../../../../../../src/lib/components/chat/ChatControls/Embeds.svelte","../../../../../../src/lib/components/chat/ChatControls.svelte","../../../../../../src/lib/components/chat/Placeholder/ChatList.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderPlaceholder.svelte","../../../../../../src/lib/components/chat/Placeholder/FolderTitle.svelte","../../../../../../src/lib/components/chat/Placeholder.svelte","../../../../../../src/lib/components/chat/Chat.svelte"],"sourcesContent":["/** @import { Source, TemplateNode } from '#client' */\nimport { is_promise } from '../../../shared/utils.js';\nimport { block } from '../../reactivity/effects.js';\nimport { internal_set, mutable_source, source } from '../../reactivity/sources.js';\nimport {\n\thydrate_next,\n\thydrating,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport { queue_micro_task } from '../task.js';\nimport { HYDRATION_START_ELSE, UNINITIALIZED } from '../../../../constants.js';\nimport { is_runes } from '../../context.js';\nimport { flushSync, is_flushing_sync } from '../../reactivity/batch.js';\nimport { BranchManager } from './branches.js';\nimport { capture, unset_context } from '../../reactivity/async.js';\n\nconst PENDING = 0;\nconst THEN = 1;\nconst CATCH = 2;\n\n/** @typedef {typeof PENDING | typeof THEN | typeof CATCH} AwaitState */\n\n/**\n * @template V\n * @param {TemplateNode} node\n * @param {(() => any)} get_input\n * @param {null | ((anchor: Node) => void)} pending_fn\n * @param {null | ((anchor: Node, value: Source<V>) => void)} then_fn\n * @param {null | ((anchor: Node, error: unknown) => void)} catch_fn\n * @returns {void}\n */\nexport function await_block(node, get_input, pending_fn, then_fn, catch_fn) {\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\tvar runes = is_runes();\n\n\tvar v = /** @type {V} */ (UNINITIALIZED);\n\tvar value = runes ? source(v) : mutable_source(v, false, false);\n\tvar error = runes ? source(v) : mutable_source(v, false, false);\n\n\tvar branches = new BranchManager(node);\n\n\tblock(() => {\n\t\tvar input = get_input();\n\t\tvar destroyed = false;\n\n\t\t/** Whether or not there was a hydration mismatch. Needs to be a `let` or else it isn't treeshaken out */\n\t\t// @ts-ignore coercing `node` to a `Comment` causes TypeScript and Prettier to fight\n\t\tlet mismatch = hydrating && is_promise(input) === (node.data === HYDRATION_START_ELSE);\n\n\t\tif (mismatch) {\n\t\t\t// Hydration mismatch: remove everything inside the anchor and start fresh\n\t\t\tset_hydrate_node(skip_nodes());\n\t\t\tset_hydrating(false);\n\t\t}\n\n\t\tif (is_promise(input)) {\n\t\t\tvar restore = capture();\n\t\t\tvar resolved = false;\n\n\t\t\t/**\n\t\t\t * @param {() => void} fn\n\t\t\t */\n\t\t\tconst resolve = (fn) => {\n\t\t\t\tif (destroyed) return;\n\n\t\t\t\tresolved = true;\n\t\t\t\trestore();\n\n\t\t\t\tif (hydrating) {\n\t\t\t\t\t// `restore()` could set `hydrating` to `true`, which we very much\n\t\t\t\t\t// don't want  we want to restore everything _except_ this\n\t\t\t\t\tset_hydrating(false);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tfn();\n\t\t\t\t} finally {\n\t\t\t\t\tunset_context();\n\n\t\t\t\t\t// without this, the DOM does not update until two ticks after the promise\n\t\t\t\t\t// resolves, which is unexpected behaviour (and somewhat irksome to test)\n\t\t\t\t\tif (!is_flushing_sync) flushSync();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tinput.then(\n\t\t\t\t(v) => {\n\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\tinternal_set(value, v);\n\t\t\t\t\t\tbranches.ensure(THEN, then_fn && ((target) => then_fn(target, value)));\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(e) => {\n\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\tinternal_set(error, e);\n\t\t\t\t\t\tbranches.ensure(THEN, catch_fn && ((target) => catch_fn(target, error)));\n\n\t\t\t\t\t\tif (!catch_fn) {\n\t\t\t\t\t\t\t// Rethrow the error if no catch block exists\n\t\t\t\t\t\t\tthrow error.v;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (hydrating) {\n\t\t\t\tbranches.ensure(PENDING, pending_fn);\n\t\t\t} else {\n\t\t\t\t// Wait a microtask before checking if we should show the pending state as\n\t\t\t\t// the promise might have resolved by then\n\t\t\t\tqueue_micro_task(() => {\n\t\t\t\t\tif (!resolved) {\n\t\t\t\t\t\tresolve(() => {\n\t\t\t\t\t\t\tbranches.ensure(PENDING, pending_fn);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tinternal_set(value, input);\n\t\t\tbranches.ensure(THEN, then_fn && ((target) => then_fn(target, value)));\n\t\t}\n\n\t\tif (mismatch) {\n\t\t\t// continue in hydration mode\n\t\t\tset_hydrating(true);\n\t\t}\n\n\t\treturn () => {\n\t\t\tdestroyed = true;\n\t\t};\n\t});\n}\n","<script>\n\timport {\n\t\taddTagById,\n\t\tdeleteTagById,\n\t\tgetAllTags,\n\t\tgetChatList,\n\t\tgetChatListByTagName,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport {\n\t\ttags as _tags,\n\t\tchats,\n\t\tpinnedChats,\n\t\tcurrentChatPage,\n\t\tscrollPaginationEnabled\n\t} from '$lib/stores';\n\timport { createEventDispatcher, onMount } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport Tags from '../common/Tags.svelte';\n\timport { toast } from 'svelte-sonner';\n\n\texport let chatId = '';\n\tlet tags = [];\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n\n\tconst addTag = async (tagName) => {\n\t\tconst res = await addTagById(localStorage.token, chatId, tagName).catch(async (error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!res) {\n\t\t\treturn;\n\t\t}\n\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('add', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tconst deleteTag = async (tagName) => {\n\t\tconst res = await deleteTagById(localStorage.token, chatId, tagName);\n\t\ttags = await getTags();\n\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\ttags: tags\n\t\t});\n\n\t\tawait _tags.set(await getAllTags(localStorage.token));\n\t\tdispatch('delete', {\n\t\t\tname: tagName\n\t\t});\n\t};\n\n\tonMount(async () => {\n\t\tif (chatId) {\n\t\t\ttags = await getTags();\n\t\t}\n\t});\n</script>\n\n<Tags\n\t{tags}\n\tsuggestionTags={$_tags ?? []}\n\ton:delete={(e) => {\n\t\tdeleteTag(e.detail);\n\t}}\n\ton:add={(e) => {\n\t\taddTag(e.detail);\n\t}}\n/>\n","function createParser(onParse) {\n  let isFirstChunk;\n  let buffer;\n  let startingPosition;\n  let startingFieldLength;\n  let eventId;\n  let eventName;\n  let data;\n  reset();\n  return {\n    feed,\n    reset\n  };\n  function reset() {\n    isFirstChunk = true;\n    buffer = \"\";\n    startingPosition = 0;\n    startingFieldLength = -1;\n    eventId = void 0;\n    eventName = void 0;\n    data = \"\";\n  }\n  function feed(chunk) {\n    buffer = buffer ? buffer + chunk : chunk;\n    if (isFirstChunk && hasBom(buffer)) {\n      buffer = buffer.slice(BOM.length);\n    }\n    isFirstChunk = false;\n    const length = buffer.length;\n    let position = 0;\n    let discardTrailingNewline = false;\n    while (position < length) {\n      if (discardTrailingNewline) {\n        if (buffer[position] === \"\\n\") {\n          ++position;\n        }\n        discardTrailingNewline = false;\n      }\n      let lineLength = -1;\n      let fieldLength = startingFieldLength;\n      let character;\n      for (let index = startingPosition; lineLength < 0 && index < length; ++index) {\n        character = buffer[index];\n        if (character === \":\" && fieldLength < 0) {\n          fieldLength = index - position;\n        } else if (character === \"\\r\") {\n          discardTrailingNewline = true;\n          lineLength = index - position;\n        } else if (character === \"\\n\") {\n          lineLength = index - position;\n        }\n      }\n      if (lineLength < 0) {\n        startingPosition = length - position;\n        startingFieldLength = fieldLength;\n        break;\n      } else {\n        startingPosition = 0;\n        startingFieldLength = -1;\n      }\n      parseEventStreamLine(buffer, position, fieldLength, lineLength);\n      position += lineLength + 1;\n    }\n    if (position === length) {\n      buffer = \"\";\n    } else if (position > 0) {\n      buffer = buffer.slice(position);\n    }\n  }\n  function parseEventStreamLine(lineBuffer, index, fieldLength, lineLength) {\n    if (lineLength === 0) {\n      if (data.length > 0) {\n        onParse({\n          type: \"event\",\n          id: eventId,\n          event: eventName || void 0,\n          data: data.slice(0, -1)\n          // remove trailing newline\n        });\n\n        data = \"\";\n        eventId = void 0;\n      }\n      eventName = void 0;\n      return;\n    }\n    const noValue = fieldLength < 0;\n    const field = lineBuffer.slice(index, index + (noValue ? lineLength : fieldLength));\n    let step = 0;\n    if (noValue) {\n      step = lineLength;\n    } else if (lineBuffer[index + fieldLength + 1] === \" \") {\n      step = fieldLength + 2;\n    } else {\n      step = fieldLength + 1;\n    }\n    const position = index + step;\n    const valueLength = lineLength - step;\n    const value = lineBuffer.slice(position, position + valueLength).toString();\n    if (field === \"data\") {\n      data += value ? \"\".concat(value, \"\\n\") : \"\\n\";\n    } else if (field === \"event\") {\n      eventName = value;\n    } else if (field === \"id\" && !value.includes(\"\\0\")) {\n      eventId = value;\n    } else if (field === \"retry\") {\n      const retry = parseInt(value, 10);\n      if (!Number.isNaN(retry)) {\n        onParse({\n          type: \"reconnect-interval\",\n          value: retry\n        });\n      }\n    }\n  }\n}\nconst BOM = [239, 187, 191];\nfunction hasBom(buffer) {\n  return BOM.every((charCode, index) => buffer.charCodeAt(index) === charCode);\n}\nexport { createParser };\n//# sourceMappingURL=index.js.map\n","import { createParser } from './index.js';\nclass EventSourceParserStream extends TransformStream {\n  constructor() {\n    let parser;\n    super({\n      start(controller) {\n        parser = createParser(event => {\n          if (event.type === \"event\") {\n            controller.enqueue(event);\n          }\n        });\n      },\n      transform(chunk) {\n        parser.feed(chunk);\n      }\n    });\n  }\n}\nexport { EventSourceParserStream };\n//# sourceMappingURL=stream.js.map\n","import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tsources?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tselectedModelId?: any;\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n\t/** Any other fields that aren't part of the base OpenAI spec */\n\t[other: string]: unknown;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.sources) {\n\t\t\t\tyield { done: false, value: '', sources: parsedData.sources };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.selected_model_id) {\n\t\t\t\tyield { done: false, value: '', selectedModelId: parsedData.selected_model_id };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parsedData.usage) {\n\t\t\t\tyield { done: false, value: '', usage: parsedData.usage };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? ''\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\n\t\tif (textStreamUpdate.error) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.sources) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.selectedModelId) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tif (textStreamUpdate.usage) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9\"\n\t/>\n</svg>\n","export class AudioQueue {\n\tconstructor(audioElement) {\n\t\tthis.audio = audioElement;\n\t\tthis.queue = [];\n\t\tthis.current = null;\n\t\tthis.id = null;\n\n\t\tthis._onEnded = () => this.next();\n\t\tthis.audio.addEventListener('ended', this._onEnded);\n\n\t\tthis.onStopped = null; // optional callback\n\t}\n\n\tsetId(newId) {\n\t\tconsole.log('Setting audio queue ID to:', newId);\n\t\tif (this.id !== newId) {\n\t\t\tthis.stop();\n\t\t\tthis.id = newId;\n\t\t\tif (this.onStopped) this.onStopped({ event: 'id-change', id: newId });\n\t\t}\n\t}\n\n\tsetPlaybackRate(rate) {\n\t\tconsole.log('Setting audio playback rate to:', rate);\n\t\tthis.audio.playbackRate = rate;\n\t}\n\n\tenqueue(url) {\n\t\tconsole.log('Enqueuing audio URL:', url);\n\t\tthis.queue.push(url);\n\n\t\t// Auto-play if nothing is currently playing or loaded\n\t\tif (this.audio.paused && !this.current) {\n\t\t\tthis.next();\n\t\t}\n\t}\n\n\tplay() {\n\t\tif (!this.current && this.queue.length > 0) {\n\t\t\tthis.next();\n\t\t} else {\n\t\t\tthis.audio.play();\n\t\t}\n\t}\n\n\tnext() {\n\t\tthis.current = this.queue.shift();\n\t\tif (this.current) {\n\t\t\tthis.audio.src = this.current;\n\t\t\tthis.audio.play();\n\t\t\tconsole.log('Playing audio URL:', this.current);\n\t\t} else {\n\t\t\tthis.stop();\n\t\t\tif (this.onStopped) this.onStopped({ event: 'empty-queue', id: this.id });\n\t\t}\n\t}\n\n\tstop() {\n\t\tthis.audio.pause();\n\t\tthis.audio.currentTime = 0;\n\t\tthis.audio.src = '';\n\t\tthis.queue = [];\n\t\tthis.current = null;\n\t\tif (this.onStopped) this.onStopped({ event: 'stop', id: this.id });\n\t}\n\n\tdestroy() {\n\t\tthis.audio.removeEventListener('ended', this._onEnded);\n\t\tthis.stop();\n\t\tthis.onStopped = null;\n\t\tthis.audio = null;\n\t}\n}\n","// Google Drive Picker API configuration\nlet API_KEY = '';\nlet CLIENT_ID = '';\n\n// Function to fetch credentials from backend config\nasync function getCredentials() {\n\tconst response = await fetch('/api/config');\n\tif (!response.ok) {\n\t\tthrow new Error('Failed to fetch Google Drive credentials');\n\t}\n\tconst config = await response.json();\n\tAPI_KEY = config.google_drive?.api_key;\n\tCLIENT_ID = config.google_drive?.client_id;\n\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n}\nconst SCOPE = [\n\t'https://www.googleapis.com/auth/drive.readonly',\n\t'https://www.googleapis.com/auth/drive.file'\n];\n\n// Validate required credentials\nconst validateCredentials = () => {\n\tif (!API_KEY || !CLIENT_ID) {\n\t\tthrow new Error('Google Drive API credentials not configured');\n\t}\n\tif (API_KEY === '' || CLIENT_ID === '') {\n\t\tthrow new Error('Please configure valid Google Drive API credentials');\n\t}\n};\n\nlet pickerApiLoaded = false;\nlet oauthToken: string | null = null;\nlet initialized = false;\n\nexport const loadGoogleDriveApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof gapi === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://apis.google.com/js/api.js';\n\t\t\tscript.onload = () => {\n\t\t\t\tgapi.load('picker', () => {\n\t\t\t\t\tpickerApiLoaded = true;\n\t\t\t\t\tresolve(true);\n\t\t\t\t});\n\t\t\t};\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tgapi.load('picker', () => {\n\t\t\t\tpickerApiLoaded = true;\n\t\t\t\tresolve(true);\n\t\t\t});\n\t\t}\n\t});\n};\n\nexport const loadGoogleAuthApi = () => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof google === 'undefined') {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.src = 'https://accounts.google.com/gsi/client';\n\t\t\tscript.onload = resolve;\n\t\t\tscript.onerror = reject;\n\t\t\tdocument.body.appendChild(script);\n\t\t} else {\n\t\t\tresolve(true);\n\t\t}\n\t});\n};\n\nexport const getAuthToken = async () => {\n\tif (!oauthToken) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst tokenClient = google.accounts.oauth2.initTokenClient({\n\t\t\t\tclient_id: CLIENT_ID,\n\t\t\t\tscope: SCOPE.join(' '),\n\t\t\t\tcallback: (response: any) => {\n\t\t\t\t\tif (response.access_token) {\n\t\t\t\t\t\toauthToken = response.access_token;\n\t\t\t\t\t\tresolve(oauthToken);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Failed to get access token'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror_callback: (error: any) => {\n\t\t\t\t\treject(new Error(error.message || 'OAuth error occurred'));\n\t\t\t\t}\n\t\t\t});\n\t\t\ttokenClient.requestAccessToken();\n\t\t});\n\t}\n\treturn oauthToken;\n};\n\nconst initialize = async () => {\n\tif (!initialized) {\n\t\tawait getCredentials();\n\t\tvalidateCredentials();\n\t\tawait Promise.all([loadGoogleDriveApi(), loadGoogleAuthApi()]);\n\t\tinitialized = true;\n\t}\n};\n\nexport const createPicker = () => {\n\treturn new Promise(async (resolve, reject) => {\n\t\ttry {\n\t\t\tconsole.log('Initializing Google Drive Picker...');\n\t\t\tawait initialize();\n\t\t\tconsole.log('Getting auth token...');\n\t\t\tconst token = await getAuthToken();\n\t\t\tif (!token) {\n\t\t\t\tconsole.error('Failed to get OAuth token');\n\t\t\t\tthrow new Error('Unable to get OAuth token');\n\t\t\t}\n\t\t\tconsole.log('Auth token obtained successfully');\n\n\t\t\tconst picker = new google.picker.PickerBuilder()\n\t\t\t\t.enableFeature(google.picker.Feature.NAV_HIDDEN)\n\t\t\t\t.enableFeature(google.picker.Feature.MULTISELECT_ENABLED)\n\t\t\t\t.addView(\n\t\t\t\t\tnew google.picker.DocsView()\n\t\t\t\t\t\t.setIncludeFolders(false)\n\t\t\t\t\t\t.setSelectFolderEnabled(false)\n\t\t\t\t\t\t.setMimeTypes(\n\t\t\t\t\t\t\t'application/pdf,text/plain,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.google-apps.document,application/vnd.google-apps.spreadsheet,application/vnd.google-apps.presentation'\n\t\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.setOAuthToken(token)\n\t\t\t\t.setDeveloperKey(API_KEY)\n\t\t\t\t// Remove app ID setting as it's not needed and can cause 404 errors\n\t\t\t\t.setCallback(async (data: any) => {\n\t\t\t\t\tif (data[google.picker.Response.ACTION] === google.picker.Action.PICKED) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst doc = data[google.picker.Response.DOCUMENTS][0];\n\t\t\t\t\t\t\tconst fileId = doc[google.picker.Document.ID];\n\t\t\t\t\t\t\tconst fileName = doc[google.picker.Document.NAME];\n\t\t\t\t\t\t\tconst fileUrl = doc[google.picker.Document.URL];\n\n\t\t\t\t\t\t\tif (!fileId || !fileName) {\n\t\t\t\t\t\t\t\tthrow new Error('Required file details missing');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Construct download URL based on MIME type\n\t\t\t\t\t\t\tconst mimeType = doc[google.picker.Document.MIME_TYPE];\n\n\t\t\t\t\t\t\tlet downloadUrl;\n\t\t\t\t\t\t\tlet exportFormat;\n\n\t\t\t\t\t\t\tif (mimeType.includes('google-apps')) {\n\t\t\t\t\t\t\t\t// Handle Google Workspace files\n\t\t\t\t\t\t\t\tif (mimeType.includes('document')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('spreadsheet')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/csv';\n\t\t\t\t\t\t\t\t} else if (mimeType.includes('presentation')) {\n\t\t\t\t\t\t\t\t\texportFormat = 'text/plain';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\texportFormat = 'application/pdf';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}/export?mimeType=${encodeURIComponent(exportFormat)}`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Regular files use direct download URL\n\t\t\t\t\t\t\t\tdownloadUrl = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Create a Blob from the file download\n\t\t\t\t\t\t\tconst response = await fetch(downloadUrl, {\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\t\tconsole.error('Download failed:', {\n\t\t\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t\t\t\terror: errorText\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthrow new Error(`Failed to download file (${response.status}): ${errorText}`);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst blob = await response.blob();\n\t\t\t\t\t\t\tconst result = {\n\t\t\t\t\t\t\t\tid: fileId,\n\t\t\t\t\t\t\t\tname: fileName,\n\t\t\t\t\t\t\t\turl: downloadUrl,\n\t\t\t\t\t\t\t\tblob: blob,\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tAuthorization: `Bearer ${token}`,\n\t\t\t\t\t\t\t\t\tAccept: '*/*'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (data[google.picker.Response.ACTION] === google.picker.Action.CANCEL) {\n\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.build();\n\t\t\tpicker.setVisible(true);\n\t\t} catch (error) {\n\t\t\tconsole.error('Google Drive Picker error:', error);\n\t\t\treject(error);\n\t\t}\n\t});\n};\n","import type { PopupRequest, PublicClientApplication } from '@azure/msal-browser';\nimport { v4 as uuidv4 } from 'uuid';\n\nclass OneDriveConfig {\n\tprivate static instance: OneDriveConfig;\n\tprivate clientIdPersonal: string = '';\n\tprivate clientIdBusiness: string = '';\n\tprivate sharepointUrl: string = '';\n\tprivate sharepointTenantId: string = '';\n\tprivate msalInstance: PublicClientApplication | null = null;\n\tprivate currentAuthorityType: 'personal' | 'organizations' = 'personal';\n\n\tprivate constructor() {}\n\n\tpublic static getInstance(): OneDriveConfig {\n\t\tif (!OneDriveConfig.instance) {\n\t\t\tOneDriveConfig.instance = new OneDriveConfig();\n\t\t}\n\t\treturn OneDriveConfig.instance;\n\t}\n\n\tpublic async initialize(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tif (authorityType && this.currentAuthorityType !== authorityType) {\n\t\t\tthis.currentAuthorityType = authorityType;\n\t\t\tthis.msalInstance = null;\n\t\t}\n\t\tawait this.getCredentials();\n\t}\n\n\tpublic async ensureInitialized(authorityType?: 'personal' | 'organizations'): Promise<void> {\n\t\tawait this.initialize(authorityType);\n\t}\n\n\tprivate async getCredentials(): Promise<void> {\n\t\tconst response = await fetch('/api/config', {\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t},\n\t\t\tcredentials: 'include'\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error('Failed to fetch OneDrive credentials');\n\t\t}\n\n\t\tconst config = await response.json();\n\n\t\tthis.clientIdPersonal = config.onedrive?.client_id_personal;\n\t\tthis.clientIdBusiness = config.onedrive?.client_id_business;\n\t\tthis.sharepointUrl = config.onedrive?.sharepoint_url;\n\t\tthis.sharepointTenantId = config.onedrive?.sharepoint_tenant_id;\n\n\t\tif (!this.clientIdPersonal && !this.clientIdBusiness) {\n\t\t\tthrow new Error('OneDrive personal or business client ID not configured');\n\t\t}\n\t}\n\n\tpublic async getMsalInstance(\n\t\tauthorityType?: 'personal' | 'organizations'\n\t): Promise<PublicClientApplication> {\n\t\tawait this.ensureInitialized(authorityType);\n\n\t\tif (!this.msalInstance) {\n\t\t\tconst authorityEndpoint =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.sharepointTenantId || 'common'\n\t\t\t\t\t: 'consumers';\n\n\t\t\tconst clientId =\n\t\t\t\tthis.currentAuthorityType === 'organizations'\n\t\t\t\t\t? this.clientIdBusiness\n\t\t\t\t\t: this.clientIdPersonal;\n\n\t\t\tif (!clientId) {\n\t\t\t\tthrow new Error('OneDrive client ID not configured');\n\t\t\t}\n\n\t\t\tconst msalParams = {\n\t\t\t\tauth: {\n\t\t\t\t\tauthority: `https://login.microsoftonline.com/${authorityEndpoint}`,\n\t\t\t\t\tclientId: clientId\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst { PublicClientApplication } = await import('@azure/msal-browser');\n\t\t\tthis.msalInstance = new PublicClientApplication(msalParams);\n\t\t\tif (this.msalInstance.initialize) {\n\t\t\t\tawait this.msalInstance.initialize();\n\t\t\t}\n\t\t}\n\n\t\treturn this.msalInstance;\n\t}\n\n\tpublic getAuthorityType(): 'personal' | 'organizations' {\n\t\treturn this.currentAuthorityType;\n\t}\n\n\tpublic getSharepointUrl(): string {\n\t\treturn this.sharepointUrl;\n\t}\n\n\tpublic getSharepointTenantId(): string {\n\t\treturn this.sharepointTenantId;\n\t}\n\n\tpublic getBaseUrl(): string {\n\t\tif (this.currentAuthorityType === 'organizations') {\n\t\t\tif (!this.sharepointUrl || this.sharepointUrl === '') {\n\t\t\t\tthrow new Error('Sharepoint URL not configured');\n\t\t\t}\n\n\t\t\tlet sharePointBaseUrl = this.sharepointUrl.replace(/^https?:\\/\\//, '');\n\t\t\tsharePointBaseUrl = sharePointBaseUrl.replace(/\\/$/, '');\n\n\t\t\treturn `https://${sharePointBaseUrl}`;\n\t\t} else {\n\t\t\treturn 'https://onedrive.live.com/picker';\n\t\t}\n\t}\n}\n\n// Retrieve OneDrive access token\nasync function getToken(\n\tresource?: string,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<string> {\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.ensureInitialized(authorityType);\n\n\tconst currentAuthorityType = config.getAuthorityType();\n\n\tconst scopes =\n\t\tcurrentAuthorityType === 'organizations'\n\t\t\t? [`${resource || config.getBaseUrl()}/.default`]\n\t\t\t: ['OneDrive.ReadWrite'];\n\n\tconst authParams: PopupRequest = { scopes };\n\tlet accessToken = '';\n\n\ttry {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\tconst resp = await msalInstance.acquireTokenSilent(authParams);\n\t\taccessToken = resp.accessToken;\n\t} catch {\n\t\tconst msalInstance = await config.getMsalInstance(authorityType);\n\t\ttry {\n\t\t\tconst resp = await msalInstance.loginPopup(authParams);\n\t\t\tmsalInstance.setActiveAccount(resp.account);\n\t\t\tif (resp.idToken) {\n\t\t\t\tconst resp2 = await msalInstance.acquireTokenSilent(authParams);\n\t\t\t\taccessToken = resp2.accessToken;\n\t\t\t}\n\t\t} catch (popupError) {\n\t\t\tthrow new Error(\n\t\t\t\t'Failed to login: ' +\n\t\t\t\t\t(popupError instanceof Error ? popupError.message : String(popupError))\n\t\t\t);\n\t\t}\n\t}\n\n\tif (!accessToken) {\n\t\tthrow new Error('Failed to acquire access token');\n\t}\n\n\treturn accessToken;\n}\n\ninterface PickerParams {\n\tsdk: string;\n\tentry: {\n\t\toneDrive: Record<string, unknown>;\n\t};\n\tauthentication: Record<string, unknown>;\n\tmessaging: {\n\t\torigin: string;\n\t\tchannelId: string;\n\t};\n\tsearch: {\n\t\tenabled: boolean;\n\t};\n\ttypesAndSources: {\n\t\tmode: string;\n\t\tpivots: Record<string, boolean>;\n\t};\n}\n\ninterface PickerResult {\n\tcommand?: string;\n\titems?: OneDriveFileInfo[];\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Get picker parameters based on account type\nfunction getPickerParams(): PickerParams {\n\tconst channelId = uuidv4();\n\tconst config = OneDriveConfig.getInstance();\n\n\tconst params: PickerParams = {\n\t\tsdk: '8.0',\n\t\tentry: {\n\t\t\toneDrive: {}\n\t\t},\n\t\tauthentication: {},\n\t\tmessaging: {\n\t\t\torigin: window?.location?.origin || '',\n\t\t\tchannelId\n\t\t},\n\t\tsearch: {\n\t\t\tenabled: true\n\t\t},\n\t\ttypesAndSources: {\n\t\t\tmode: 'files',\n\t\t\tpivots: {\n\t\t\t\toneDrive: true,\n\t\t\t\trecent: true,\n\t\t\t\tmyOrganization: config.getAuthorityType() === 'organizations'\n\t\t\t}\n\t\t}\n\t};\n\n\t// For personal accounts, set files object in oneDrive\n\tif (config.getAuthorityType() !== 'organizations') {\n\t\tparams.entry.oneDrive = { files: {} };\n\t}\n\n\treturn params;\n}\n\ninterface OneDriveFileInfo {\n\tid: string;\n\tname: string;\n\tparentReference: {\n\t\tdriveId: string;\n\t};\n\t'@sharePoint.endpoint': string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t[key: string]: any;\n}\n\n// Download file from OneDrive\nasync function downloadOneDriveFile(\n\tfileInfo: OneDriveFileInfo,\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<Blob> {\n\tconst accessToken = await getToken(undefined, authorityType);\n\tif (!accessToken) {\n\t\tthrow new Error('Unable to retrieve OneDrive access token.');\n\t}\n\n\t// The endpoint URL is provided in the file info\n\tconst fileInfoUrl = `${fileInfo['@sharePoint.endpoint']}/drives/${fileInfo.parentReference.driveId}/items/${fileInfo.id}`;\n\n\tconst response = await fetch(fileInfoUrl, {\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${accessToken}`\n\t\t}\n\t});\n\n\tif (!response.ok) {\n\t\tthrow new Error(`Failed to fetch file information: ${response.status} ${response.statusText}`);\n\t}\n\n\tconst fileData = await response.json();\n\tconst downloadUrl = fileData['@content.downloadUrl'];\n\n\tif (!downloadUrl) {\n\t\tthrow new Error('Download URL not found in file data');\n\t}\n\n\tconst downloadResponse = await fetch(downloadUrl);\n\n\tif (!downloadResponse.ok) {\n\t\tthrow new Error(\n\t\t\t`Failed to download file: ${downloadResponse.status} ${downloadResponse.statusText}`\n\t\t);\n\t}\n\n\treturn await downloadResponse.blob();\n}\n\n// Open OneDrive file picker and return selected file metadata\nexport async function openOneDrivePicker(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<PickerResult | null> {\n\tif (typeof window === 'undefined') {\n\t\tthrow new Error('Not in browser environment');\n\t}\n\n\t// Initialize OneDrive config with the specified authority type\n\tconst config = OneDriveConfig.getInstance();\n\tawait config.initialize(authorityType);\n\n\treturn new Promise((resolve, reject) => {\n\t\tlet pickerWindow: Window | null = null;\n\t\tlet channelPort: MessagePort | null = null;\n\t\tconst params = getPickerParams();\n\t\tconst baseUrl = config.getBaseUrl();\n\n\t\tconst handleWindowMessage = (event: MessageEvent) => {\n\t\t\tif (event.source !== pickerWindow) return;\n\t\t\tconst message = event.data;\n\t\t\tif (message?.type === 'initialize' && message?.channelId === params.messaging.channelId) {\n\t\t\t\tchannelPort = event.ports?.[0];\n\t\t\t\tif (!channelPort) return;\n\t\t\t\tchannelPort.addEventListener('message', handlePortMessage);\n\t\t\t\tchannelPort.start();\n\t\t\t\tchannelPort.postMessage({ type: 'activate' });\n\t\t\t}\n\t\t};\n\n\t\tconst handlePortMessage = async (portEvent: MessageEvent) => {\n\t\t\tconst portData = portEvent.data;\n\t\t\tswitch (portData.type) {\n\t\t\t\tcase 'notification':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'command': {\n\t\t\t\t\tchannelPort?.postMessage({ type: 'acknowledge', id: portData.id });\n\t\t\t\t\tconst command = portData.data;\n\t\t\t\t\tswitch (command.command) {\n\t\t\t\t\t\tcase 'authenticate': {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t// Pass the resource from the command for org accounts\n\t\t\t\t\t\t\t\tconst resource =\n\t\t\t\t\t\t\t\t\tconfig.getAuthorityType() === 'organizations' ? command.resource : undefined;\n\t\t\t\t\t\t\t\tconst newToken = await getToken(resource, authorityType);\n\t\t\t\t\t\t\t\tif (newToken) {\n\t\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\t\tdata: { result: 'token', token: newToken }\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new Error('Could not retrieve auth token');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\t\t\terror: { code: 'tokenError', message: 'Failed to get token' }\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'close': {\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase 'pick': {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\ttype: 'result',\n\t\t\t\t\t\t\t\tid: portData.id,\n\t\t\t\t\t\t\t\tdata: { result: 'success' }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tcleanup();\n\t\t\t\t\t\t\tresolve(command);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tchannelPort?.postMessage({\n\t\t\t\t\t\t\t\tresult: 'error',\n\t\t\t\t\t\t\t\terror: { code: 'unsupportedCommand', message: command.command },\n\t\t\t\t\t\t\t\tisExpected: true\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfunction cleanup() {\n\t\t\twindow.removeEventListener('message', handleWindowMessage);\n\t\t\tif (channelPort) {\n\t\t\t\tchannelPort.removeEventListener('message', handlePortMessage);\n\t\t\t}\n\t\t\tif (pickerWindow) {\n\t\t\t\tpickerWindow.close();\n\t\t\t\tpickerWindow = null;\n\t\t\t}\n\t\t}\n\n\t\tconst initializePicker = async () => {\n\t\t\ttry {\n\t\t\t\tconst authToken = await getToken(undefined, authorityType);\n\t\t\t\tif (!authToken) {\n\t\t\t\t\treturn reject(new Error('Failed to acquire access token'));\n\t\t\t\t}\n\n\t\t\t\tpickerWindow = window.open('', 'OneDrivePicker', 'width=800,height=600');\n\t\t\t\tif (!pickerWindow) {\n\t\t\t\t\treturn reject(new Error('Failed to open OneDrive picker window'));\n\t\t\t\t}\n\n\t\t\t\tconst queryString = new URLSearchParams({\n\t\t\t\t\tfilePicker: JSON.stringify(params)\n\t\t\t\t});\n\n\t\t\t\tlet url = '';\n\t\t\t\tif (config.getAuthorityType() === 'organizations') {\n\t\t\t\t\turl = baseUrl + `/_layouts/15/FilePicker.aspx?${queryString}`;\n\t\t\t\t} else {\n\t\t\t\t\turl = baseUrl + `?${queryString}`;\n\t\t\t\t}\n\n\t\t\t\tconst form = pickerWindow.document.createElement('form');\n\t\t\t\tform.setAttribute('action', url);\n\t\t\t\tform.setAttribute('method', 'POST');\n\t\t\t\tconst input = pickerWindow.document.createElement('input');\n\t\t\t\tinput.setAttribute('type', 'hidden');\n\t\t\t\tinput.setAttribute('name', 'access_token');\n\t\t\t\tinput.setAttribute('value', authToken);\n\t\t\t\tform.appendChild(input);\n\n\t\t\t\tpickerWindow.document.body.appendChild(form);\n\t\t\t\tform.submit();\n\n\t\t\t\twindow.addEventListener('message', handleWindowMessage);\n\t\t\t} catch (err) {\n\t\t\t\tif (pickerWindow) {\n\t\t\t\t\tpickerWindow.close();\n\t\t\t\t}\n\t\t\t\treject(err);\n\t\t\t}\n\t\t};\n\n\t\tinitializePicker();\n\t});\n}\n\n// Pick and download file from OneDrive\nexport async function pickAndDownloadFile(\n\tauthorityType?: 'personal' | 'organizations'\n): Promise<{ blob: Blob; name: string } | null> {\n\tconst pickerResult = await openOneDrivePicker(authorityType);\n\n\tif (!pickerResult || !pickerResult.items || pickerResult.items.length === 0) {\n\t\treturn null;\n\t}\n\n\tconst selectedFile = pickerResult.items[0];\n\tconst blob = await downloadOneDriveFile(selectedFile, authorityType);\n\n\treturn { blob, name: selectedFile.name };\n}\n\nexport { downloadOneDriveFile };\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\tclass={className}\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\t><path d=\"M12 6L12 12L18 12\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M21.8883 10.5C21.1645 5.68874 17.013 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C16.1006 22 19.6248 19.5318 21.1679 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M17 16H21.4C21.7314 16 22 16.2686 22 16.6V21\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getChatList } from '$lib/apis/chats';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport { chatId } from '$lib/stores';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getChatList(localStorage.token, page, true, true).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res\n\t\t\t\t.filter((item) => item?.id !== $chatId)\n\t\t\t\t.map((item) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\ttype: 'chat',\n\t\t\t\t\t\tname: item.title,\n\t\t\t\t\t\tdescription: dayjs(item.updated_at * 1000).fromNow()\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No chats found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { getNoteList } from '$lib/apis/notes';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\n\tlet items = [];\n\tlet selectedIdx = 0;\n\n\tlet page = 1;\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tlet res = await getNoteList(localStorage.token, page).catch(() => {\n\t\t\treturn [];\n\t\t});\n\n\t\tif ((res ?? []).length === 0) {\n\t\t\tallItemsLoaded = true;\n\t\t} else {\n\t\t\tallItemsLoaded = false;\n\t\t}\n\n\t\titems = [\n\t\t\t...items,\n\t\t\t...res.map((note) => {\n\t\t\t\treturn {\n\t\t\t\t\t...note,\n\t\t\t\t\ttype: 'note',\n\t\t\t\t\tname: note.title,\n\t\t\t\t\tdescription: dayjs(note.updated_at / 1000000).fromNow()\n\t\t\t\t};\n\t\t\t})\n\t\t];\n\n\t\titemsLoading = false;\n\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait getItemsPage();\n\t\tawait tick();\n\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded}\n\t{#if items.length === 0}\n\t\t<div class=\"text-center text-xs text-gray-500 py-3\">{$i18n.t('No notes found')}</div>\n\t{:else}\n\t\t<div class=\"flex flex-col gap-0.5\">\n\t\t\t{#each items as item, idx}\n\t\t\t\t<button\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSelect(item);\n\t\t\t\t\t}}\n\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t}}\n\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-black dark:text-gray-100 flex items-center gap-1.5\">\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Note')} placement=\"top\">\n\t\t\t\t\t\t\t<PageEdit className=\"size-4\" />\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1\">\n\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport { decodeString } from '$lib/utils';\n\timport { knowledge } from '$lib/stores';\n\n\timport { getKnowledgeBases, searchKnowledgeFilesById } from '$lib/apis/knowledge';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport DocumentPage from '$lib/components/icons/DocumentPage.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onSelect = (e) => {};\n\n\tlet loaded = false;\n\tlet selectedIdx = 0;\n\n\tlet selectedItem = null;\n\n\tlet selectedFileItemsPage = 1;\n\n\tlet selectedFileItems = null;\n\tlet selectedFileItemsTotal = null;\n\n\tlet selectedFileItemsLoading = false;\n\tlet selectedFileAllItemsLoaded = false;\n\n\t$: if (selectedItem) {\n\t\tinitSelectedFileItems();\n\t}\n\n\tconst initSelectedFileItems = async () => {\n\t\tselectedFileItemsPage = 1;\n\t\tselectedFileItems = null;\n\t\tselectedFileItemsTotal = null;\n\t\tselectedFileAllItemsLoaded = false;\n\t\tselectedFileItemsLoading = false;\n\t\tawait tick();\n\t\tawait getSelectedFileItemsPage();\n\t};\n\n\tconst loadMoreSelectedFileItems = async () => {\n\t\tif (selectedFileAllItemsLoaded) return;\n\t\tselectedFileItemsPage += 1;\n\t\tawait getSelectedFileItemsPage();\n\t};\n\n\tconst getSelectedFileItemsPage = async () => {\n\t\tif (!selectedItem) return;\n\t\tselectedFileItemsLoading = true;\n\n\t\tconst res = await searchKnowledgeFilesById(\n\t\t\tlocalStorage.token,\n\t\t\tselectedItem.id,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tnull,\n\t\t\tselectedFileItemsPage\n\t\t).catch(() => {\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tselectedFileItemsTotal = res.total;\n\t\t\tconst pageItems = res.items;\n\n\t\t\tif ((pageItems ?? []).length === 0) {\n\t\t\t\tselectedFileAllItemsLoaded = true;\n\t\t\t} else {\n\t\t\t\tselectedFileAllItemsLoaded = false;\n\t\t\t}\n\n\t\t\tif (selectedFileItems) {\n\t\t\t\tselectedFileItems = [...selectedFileItems, ...pageItems];\n\t\t\t} else {\n\t\t\t\tselectedFileItems = pageItems;\n\t\t\t}\n\t\t}\n\n\t\tselectedFileItemsLoading = false;\n\t\treturn res;\n\t};\n\n\tlet page = 1;\n\tlet items = null;\n\tlet total = null;\n\n\tlet itemsLoading = false;\n\tlet allItemsLoaded = false;\n\n\t$: if (loaded) {\n\t\tinit();\n\t}\n\n\tconst init = async () => {\n\t\treset();\n\t\tawait tick();\n\t\tawait getItemsPage();\n\t};\n\n\tconst reset = () => {\n\t\tpage = 1;\n\t\titems = null;\n\t\ttotal = null;\n\t\tallItemsLoaded = false;\n\t\titemsLoading = false;\n\t};\n\n\tconst loadMoreItems = async () => {\n\t\tif (allItemsLoaded) return;\n\t\tpage += 1;\n\t\tawait getItemsPage();\n\t};\n\n\tconst getItemsPage = async () => {\n\t\titemsLoading = true;\n\t\tconst res = await getKnowledgeBases(localStorage.token, page).catch(() => {\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res);\n\t\t\ttotal = res.total;\n\t\t\tconst pageItems = res.items;\n\n\t\t\tif ((pageItems ?? []).length === 0) {\n\t\t\t\tallItemsLoaded = true;\n\t\t\t} else {\n\t\t\t\tallItemsLoaded = false;\n\t\t\t}\n\n\t\t\tif (items) {\n\t\t\t\titems = [...items, ...pageItems];\n\t\t\t} else {\n\t\t\t\titems = pageItems;\n\t\t\t}\n\t\t}\n\n\t\titemsLoading = false;\n\t\treturn res;\n\t};\n\n\tonMount(async () => {\n\t\tawait tick();\n\t\tloaded = true;\n\t});\n</script>\n\n{#if loaded && items !== null}\n\t<div class=\"flex flex-col gap-0.5\">\n\t\t{#if items.length === 0}\n\t\t\t<div class=\"py-4 text-center text-sm text-gray-500 dark:text-gray-400\">\n\t\t\t\t{$i18n.t('No knowledge bases found.')}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t{#each items as item, idx (item.id)}\n\t\t\t\t<div\n\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm {idx ===\n\t\t\t\t\tselectedIdx\n\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-800 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t: ''}\"\n\t\t\t\t>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"w-full flex-1\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonSelect({\n\t\t\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\t\t\t...item\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\tselectedIdx = idx;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:mouseleave={() => {\n\t\t\t\t\t\t\tif (idx === 0) {\n\t\t\t\t\t\t\t\tselectedIdx = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdata-selected={idx === selectedIdx}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"  text-black dark:text-gray-100 flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Collection')} placement=\"top\">\n\t\t\t\t\t\t\t\t<Database className=\"size-4\" />\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t<Tooltip content={item.description || decodeString(item?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1 text-sm\">\n\t\t\t\t\t\t\t\t\t{decodeString(item?.name)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Tooltip content={$i18n.t('Show Files')} placement=\"top\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\" ml-2 opacity-50 hover:opacity-100 transition\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (selectedItem && selectedItem.id === item.id) {\n\t\t\t\t\t\t\t\t\tselectedItem = null;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tselectedItem = item;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if selectedItem && selectedItem.id === item.id}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-3\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronRight className=\"size-3\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\n\t\t\t\t{#if selectedItem && selectedItem.id === item.id}\n\t\t\t\t\t<div class=\"pl-3 mb-1 flex flex-col gap-0.5\">\n\t\t\t\t\t\t{#if selectedFileItems === null && selectedFileItemsTotal === null}\n\t\t\t\t\t\t\t<div class=\" py-1 flex justify-center\">\n\t\t\t\t\t\t\t\t<Spinner className=\"size-3\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if selectedFileItemsTotal === 0}\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 dark:text-gray-400 italic py-0.5 px-2\">\n\t\t\t\t\t\t\t\t{$i18n.t('No files in this knowledge base.')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{#each selectedFileItems as file, fileIdx (file.id)}\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" px-2.5 py-1 rounded-xl w-full text-left flex justify-between items-center text-sm hover:bg-gray-50 hover:dark:bg-gray-800 hover:dark:text-gray-100\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\tonSelect({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'file',\n\t\t\t\t\t\t\t\t\t\t\tname: file?.meta?.name,\n\t\t\t\t\t\t\t\t\t\t\t...file\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Collection')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t<DocumentPage className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={decodeString(file?.meta?.name)} placement=\"top-start\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"line-clamp-1 flex-1 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t{decodeString(file?.meta?.name)}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t{#if !selectedFileAllItemsLoaded && !selectedFileItemsLoading}\n\t\t\t\t\t\t\t\t<Loader\n\t\t\t\t\t\t\t\t\ton:visible={async (e) => {\n\t\t\t\t\t\t\t\t\t\tif (!selectedFileItemsLoading) {\n\t\t\t\t\t\t\t\t\t\t\tawait loadMoreSelectedFileItems();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Spinner className=\" size-3\" />\n\t\t\t\t\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</Loader>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/each}\n\n\t\t\t{#if !allItemsLoaded}\n\t\t\t\t<Loader\n\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\tif (!itemsLoading) {\n\t\t\t\t\t\t\tloadMoreItems();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"w-full flex justify-center py-4 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Loader>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n{:else}\n\t<div class=\"py-4.5\">\n\t\t<Spinner />\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, knowledge, chats } from '$lib/stores';\n\timport { getKnowledgeBases } from '$lib/apis/knowledge';\n\n\timport { createPicker } from '$lib/utils/google-drive-picker';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUp from '$lib/components/icons/DocumentArrowUp.svelte';\n\timport Camera from '$lib/components/icons/Camera.svelte';\n\timport Note from '$lib/components/icons/Note.svelte';\n\timport Clip from '$lib/components/icons/Clip.svelte';\n\timport ChatBubbleOval from '$lib/components/icons/ChatBubbleOval.svelte';\n\timport Refresh from '$lib/components/icons/Refresh.svelte';\n\timport Agile from '$lib/components/icons/Agile.svelte';\n\timport ClockRotateRight from '$lib/components/icons/ClockRotateRight.svelte';\n\timport Database from '$lib/components/icons/Database.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\timport PageEdit from '$lib/components/icons/PageEdit.svelte';\n\timport Chats from './InputMenu/Chats.svelte';\n\timport Notes from './InputMenu/Notes.svelte';\n\timport Knowledge from './InputMenu/Knowledge.svelte';\n\timport AttachWebpageModal from './AttachWebpageModal.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let screenCaptureHandler: Function;\n\texport let uploadFilesHandler: Function;\n\texport let inputFilesHandler: Function;\n\n\texport let uploadGoogleDriveHandler: Function;\n\texport let uploadOneDriveHandler: Function;\n\n\texport let onUpload: Function;\n\texport let onClose: Function;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet showAttachWebpageModal = false;\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\t$: if (!fileUploadEnabled && files.length > 0) {\n\t\tfiles = [];\n\t}\n\n\tconst detectMobile = () => {\n\t\tconst userAgent = navigator.userAgent || navigator.vendor || window.opera;\n\t\treturn /android|iphone|ipad|ipod|windows phone/i.test(userAgent);\n\t};\n\n\tconst handleFileChange = (event) => {\n\t\tconst inputFiles = Array.from(event.target?.files);\n\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\tconsole.log(inputFiles);\n\t\t\tinputFilesHandler(inputFiles);\n\t\t}\n\t};\n\n\tconst onSelect = (item) => {\n\t\tif (files.find((f) => f.id === item.id)) {\n\t\t\treturn;\n\t\t}\n\t\tfiles = [\n\t\t\t...files,\n\t\t\t{\n\t\t\t\t...item,\n\t\t\t\tstatus: 'processed'\n\t\t\t}\n\t\t];\n\n\t\tshow = false;\n\t};\n</script>\n\n<AttachWebpageModal\n\tbind:show={showAttachWebpageModal}\n\tonSubmit={(e) => {\n\t\tonUpload(e);\n\t}}\n/>\n\n<!-- Hidden file input used to open the camera on mobile -->\n<input\n\tid=\"camera-input\"\n\ttype=\"file\"\n\taccept=\"image/*\"\n\tcapture=\"environment\"\n\ton:change={handleFileChange}\n\tstyle=\"display: none;\"\n/>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin transition\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Clip />\n\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50  rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tif (!detectMobile()) {\n\t\t\t\t\t\t\t\t\t\tscreenCaptureHandler();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconst cameraInputElement = document.getElementById('camera-input');\n\n\t\t\t\t\t\t\t\t\t\tif (cameraInputElement) {\n\t\t\t\t\t\t\t\t\t\t\tcameraInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Camera />\n\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Capture')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (fileUploadEnabled) {\n\t\t\t\t\t\t\t\t\tshowAttachWebpageModal = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Attach Webpage')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{#if $config?.features?.enable_notes ?? false}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'notes';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<PageEdit />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Notes')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<Tooltip\n\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\ttab = 'knowledge';\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Database />\n\n\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Attach Knowledge')}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t{#if ($chats ?? []).length > 0}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={fileUploadCapableModels.length !== selectedModels.length\n\t\t\t\t\t\t\t\t? $i18n.t('Model(s) do not support file upload')\n\t\t\t\t\t\t\t\t: !fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('You do not have permission to upload files.')\n\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'chats';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ClockRotateRight />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Reference Chats')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if fileUploadEnabled}\n\t\t\t\t\t\t{#if $config?.features?.enable_google_drive_integration}\n\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 87.3 78\" class=\"w-4\">\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#0066da\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00ac47\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ea4335\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#00832d\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#2684fc\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\td=\"m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z\"\n\t\t\t\t\t\t\t\t\t\tfill=\"#ffba00\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Google Drive')}</div>\n\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if $config?.features?.enable_onedrive_integration && ($config?.features?.enable_onedrive_personal || $config?.features?.enable_onedrive_business)}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex gap-2 w-full items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl {!fileUploadEnabled\n\t\t\t\t\t\t\t\t\t? 'opacity-50'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'microsoft_onedrive';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 32 32\"\n\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<mask\n\t\t\t\t\t\t\t\t\t\tid=\"mask0_87_7796\"\n\t\t\t\t\t\t\t\t\t\tstyle=\"mask-type:alpha\"\n\t\t\t\t\t\t\t\t\t\tmaskUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\tx=\"0\"\n\t\t\t\t\t\t\t\t\t\ty=\"6\"\n\t\t\t\t\t\t\t\t\t\twidth=\"32\"\n\t\t\t\t\t\t\t\t\t\theight=\"20\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.82979 26C3.50549 26 0 22.5675 0 18.3333C0 14.1921 3.35322 10.8179 7.54613 10.6716C9.27535 7.87166 12.4144 6 16 6C20.6308 6 24.5169 9.12183 25.5829 13.3335C29.1316 13.3603 32 16.1855 32 19.6667C32 23.0527 29 26 25.8723 25.9914L7.82979 26Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"#C4C4C4\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</mask>\n\t\t\t\t\t\t\t\t\t<g mask=\"url(#mask0_87_7796)\">\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.83017 26.0001C5.37824 26.0001 3.18957 24.8966 1.75391 23.1691L18.0429 16.3335L30.7089 23.4647C29.5926 24.9211 27.9066 26.0001 26.0004 25.9915C23.1254 26.0001 12.0629 26.0001 7.83017 26.0001Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint0_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M25.5785 13.3149L18.043 16.3334L30.709 23.4647C31.5199 22.4065 32.0004 21.0916 32.0004 19.6669C32.0004 16.1857 29.1321 13.3605 25.5833 13.3337C25.5817 13.3274 25.5801 13.3212 25.5785 13.3149Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint1_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M7.06445 10.7028L18.0423 16.3333L25.5779 13.3148C24.5051 9.11261 20.6237 6 15.9997 6C12.4141 6 9.27508 7.87166 7.54586 10.6716C7.3841 10.6773 7.22358 10.6877 7.06445 10.7028Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint2_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M1.7535 23.1687L18.0425 16.3331L7.06471 10.7026C3.09947 11.0792 0 14.3517 0 18.3331C0 20.1665 0.657197 21.8495 1.7535 23.1687Z\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"url(#paint3_linear_87_7796)\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint0_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"4.42591\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"24.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"27.2309\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"23.2764\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#2086B8\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#46D3F6\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint1_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"23.8302\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.6668\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"30.2108\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.2082\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#1694DB\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#62C3FE\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint2_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"8.51037\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"7.33333\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"23.3335\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"15.9348\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#0D3D78\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#063B83\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t\t<linearGradient\n\t\t\t\t\t\t\t\t\t\t\tid=\"paint3_linear_87_7796\"\n\t\t\t\t\t\t\t\t\t\t\tx1=\"-0.340429\"\n\t\t\t\t\t\t\t\t\t\t\ty1=\"19.9998\"\n\t\t\t\t\t\t\t\t\t\t\tx2=\"14.5634\"\n\t\t\t\t\t\t\t\t\t\t\ty2=\"14.4649\"\n\t\t\t\t\t\t\t\t\t\t\tgradientUnits=\"userSpaceOnUse\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<stop stop-color=\"#16589B\" />\n\t\t\t\t\t\t\t\t\t\t\t<stop offset=\"1\" stop-color=\"#1464B7\" />\n\t\t\t\t\t\t\t\t\t\t</linearGradient>\n\t\t\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'knowledge'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Knowledge')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Knowledge {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'notes'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Notes')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Notes {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'chats'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Chats')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<Chats {onSelect} />\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'microsoft_onedrive'}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_personal}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('personal');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">{$i18n.t('Microsoft OneDrive (personal)')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $config?.features?.enable_onedrive_business}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-xl text-left\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tuploadOneDriveHandler('organizations');\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Microsoft OneDrive (work/school)')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Includes SharePoint')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport { models, config, toolServers, tools } from '$lib/stores';\n\n\timport { toast } from 'svelte-sonner';\n\timport { deleteSharedChatById, getChatById, shareChatById } from '$lib/apis/chats';\n\timport { copyToClipboard } from '$lib/utils';\n\n\timport Modal from '../common/Modal.svelte';\n\timport Link from '../icons/Link.svelte';\n\timport Collapsible from '../common/Collapsible.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let show = false;\n\texport let selectedToolIds = [];\n\n\tlet selectedTools = [];\n\n\t$: selectedTools = ($tools ?? []).filter((tool) => selectedToolIds.includes(tool.id));\n\n\tconst i18n = getContext('i18n');\n</script>\n\n<Modal bind:show size=\"md\">\n\t<div>\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pt-4 pb-0.5\">\n\t\t\t<div class=\" text-lg font-medium self-center\">{$i18n.t('Available Tools')}</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className={'size-5'} />\n\t\t\t</button>\n\t\t</div>\n\n\t\t{#if selectedTools.length > 0}\n\t\t\t{#if $toolServers.length > 0}\n\t\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-1\">\n\t\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tools')}</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"px-5 pb-3 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each selectedTools as tool}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full mb-0.5\">\n\t\t\t\t\t\t\t<div class=\"truncate\">\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800 truncate\">\n\t\t\t\t\t\t\t\t\t{tool?.name}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t{#if tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t{tool?.meta?.description}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<!-- <div slot=\"content\">\n\t\t\t\t\t\t\t{JSON.stringify(tool, null, 2)}\n\t\t\t\t\t\t</div> -->\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if $toolServers.length > 0}\n\t\t\t<div class=\" flex justify-between dark:text-gray-300 px-5 pb-0.5\">\n\t\t\t\t<div class=\" text-base font-medium self-center\">{$i18n.t('Tool Servers')}</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"px-5 pb-5 w-full flex flex-col justify-center\">\n\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-300 mb-2\">\n\t\t\t\t\t{$i18n.t('Open WebUI can use tools provided by any OpenAPI server.')} <br /><a\n\t\t\t\t\t\tclass=\"underline\"\n\t\t\t\t\t\thref=\"https://github.com/open-webui/openapi-servers\"\n\t\t\t\t\t\ttarget=\"_blank\">{$i18n.t('Learn more about OpenAPI tool servers.')}</a\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t\t<div class=\" text-sm dark:text-gray-300 mb-1\">\n\t\t\t\t\t{#each $toolServers as toolServer}\n\t\t\t\t\t\t<Collapsible buttonClassName=\"w-full\" chevron>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-100 text-gray-800\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.title} - v{toolServer?.openapi?.info?.version}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.openapi?.info?.description}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t{toolServer?.url}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div slot=\"content\">\n\t\t\t\t\t\t\t\t{#each toolServer?.specs ?? [] as tool_spec}\n\t\t\t\t\t\t\t\t\t<div class=\"my-1\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"font-medium text-gray-800 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{tool_spec?.description}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Collapsible>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path\n\t\td=\"M21 7.6V20.4C21 20.7314 20.7314 21 20.4 21H7.6C7.26863 21 7 20.7314 7 20.4V7.6C7 7.26863 7.26863 7 7.6 7H20.4C20.7314 7 21 7.26863 21 7.6Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M18 4H4.6C4.26863 4 4 4.26863 4 4.6V18\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M7 16.8L12.4444 15L21 18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M16.5 13C15.6716 13 15 12.3284 15 11.5C15 10.6716 15.6716 10 16.5 10C17.3284 10 18 10.6716 18 11.5C18 12.3284 17.3284 13 16.5 13Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\taria-hidden=\"true\"\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M21.75 6.75a4.5 4.5 0 0 1-4.884 4.484c-1.076-.091-2.264.071-2.95.904l-7.152 8.684a2.548 2.548 0 1 1-3.586-3.586l8.684-7.152c.833-.686.995-1.874.904-2.95a4.5 4.5 0 0 1 6.336-4.486l-3.276 3.276a3.004 3.004 0 0 0 2.25 2.25l3.276-3.276c.256.565.398 1.192.398 1.852Z\"\n\t/>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M4.867 19.125h.008v.008h-.008v-.008Z\" />\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M12 4L12 20\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M8 9L8 15\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M20 10L20 14\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M4 10L4 14\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M16 7L16 17\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\taria-hidden=\"true\"\n\t><path d=\"M13 16H18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M6 8L10 12L6 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M2 18V6C2 4.89543 2.89543 4 4 4H20C21.1046 4 22 4.89543 22 6V18C22 19.1046 21.1046 20 20 20H4C2.89543 20 2 19.1046 2 18Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tclass={className}\n\taria-hidden=\"true\"\n\tstroke-width={strokeWidth}\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { fly } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport { config, user, tools as _tools, mobile, settings, toolServers } from '$lib/stores';\n\n\timport { getOAuthClientAuthorizationUrl } from '$lib/apis/configs';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport Knobs from '$lib/components/icons/Knobs.svelte';\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Wrench from '$lib/components/icons/Wrench.svelte';\n\timport Sparkles from '$lib/components/icons/Sparkles.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\timport Photo from '$lib/components/icons/Photo.svelte';\n\timport Terminal from '$lib/components/icons/Terminal.svelte';\n\timport ChevronRight from '$lib/components/icons/ChevronRight.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedToolIds: string[] = [];\n\n\texport let selectedModels: string[] = [];\n\texport let fileUploadCapableModels: string[] = [];\n\n\texport let toggleFilters: { id: string; name: string; description?: string; icon?: string }[] =\n\t\t[];\n\texport let selectedFilterIds: string[] = [];\n\n\texport let showWebSearchButton = false;\n\texport let webSearchEnabled = false;\n\texport let showImageGenerationButton = false;\n\texport let imageGenerationEnabled = false;\n\texport let showCodeInterpreterButton = false;\n\texport let codeInterpreterEnabled = false;\n\n\texport let onShowValves: Function;\n\texport let onClose: Function;\n\texport let closeOnOutsideClick = true;\n\n\tlet show = false;\n\tlet tab = '';\n\n\tlet tools = null;\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tlet fileUploadEnabled = true;\n\t$: fileUploadEnabled =\n\t\tfileUploadCapableModels.length === selectedModels.length &&\n\t\t($user?.role === 'admin' || $user?.permissions?.chat?.file_upload);\n\n\tconst init = async () => {\n\t\tif ($_tools === null) {\n\t\t\tawait _tools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tif ($_tools) {\n\t\t\ttools = $_tools.reduce((a, tool, i, arr) => {\n\t\t\t\ta[tool.id] = {\n\t\t\t\t\tname: tool.name,\n\t\t\t\t\tdescription: tool.meta.description,\n\t\t\t\t\tenabled: selectedToolIds.includes(tool.id),\n\t\t\t\t\t...tool\n\t\t\t\t};\n\t\t\t\treturn a;\n\t\t\t}, {});\n\t\t}\n\n\t\tif ($toolServers) {\n\t\t\tfor (const serverIdx in $toolServers) {\n\t\t\t\tconst server = $toolServers[serverIdx];\n\t\t\t\tif (server.info) {\n\t\t\t\t\ttools[`direct_server:${serverIdx}`] = {\n\t\t\t\t\t\tname: server?.info?.title ?? server.url,\n\t\t\t\t\t\tdescription: server.info.description ?? '',\n\t\t\t\t\t\tenabled: selectedToolIds.includes(`direct_server:${serverIdx}`)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedToolIds = selectedToolIds.filter((id) => Object.keys(tools).includes(id));\n\t};\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('Integrations')} placement=\"top\">\n\t\t<slot />\n\t</Tooltip>\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-70 rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg max-h-72 overflow-y-auto overflow-x-hidden scrollbar-thin\"\n\t\t\tsideOffset={4}\n\t\t\talignOffset={-6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if tab === ''}\n\t\t\t\t<div in:fly={{ x: -20, duration: 150 }}>\n\t\t\t\t\t{#if tools}\n\t\t\t\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\ttab = 'tools';\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Wrench />\n\n\t\t\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<ChevronRight />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\"py-4\">\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if toggleFilters && toggleFilters.length > 0}\n\t\t\t\t\t\t{#each toggleFilters.sort( (a, b) => a.name.localeCompare( b.name, undefined, { sensitivity: 'base' } ) ) as filter, filterIdx (filter.id)}\n\t\t\t\t\t\t\t<Tooltip content={filter?.description} placement=\"top-start\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tif (selectedFilterIds.includes(filter.id)) {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter((id) => id !== filter.id);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [...selectedFilterIds, filter.id];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{filter?.name}</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#if filter?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'function',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: filter.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\tstate={selectedFilterIds.includes(filter.id)}\n\t\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showWebSearchButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Search the internet')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\twebSearchEnabled = !webSearchEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showImageGenerationButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Generate an image')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\timageGenerationEnabled = !imageGenerationEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Image')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if showCodeInterpreterButton}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Execute code for analysis')} placement=\"top-start\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = !codeInterpreterEnabled;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{$i18n.t('Code Interpreter')}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tstate={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\tconst state = e.detail;\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else if tab === 'tools' && tools}\n\t\t\t\t<div in:fly={{ x: 20, duration: 150 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\ttab = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ChevronLeft />\n\n\t\t\t\t\t\t<div class=\"flex items-center w-full justify-between\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{$i18n.t('Tools')}\n\t\t\t\t\t\t\t\t<span class=\"ml-0.5 text-gray-500\">{Object.keys(tools).length}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"relative flex w-full justify-between gap-2 items-center px-3 py-1.5 text-sm cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\ton:click={async (e) => {\n\t\t\t\t\t\t\t\tif (!(tools[toolId]?.authenticated ?? true)) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\tlet parts = toolId.split(':');\n\t\t\t\t\t\t\t\t\tlet serverId = parts?.at(-1) ?? toolId;\n\n\t\t\t\t\t\t\t\t\tconst authUrl = getOAuthClientAuthorizationUrl(serverId, 'mcp');\n\t\t\t\t\t\t\t\t\twindow.open(authUrl, '_self', 'noopener');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttools[toolId].enabled = !tools[toolId].enabled;\n\n\t\t\t\t\t\t\t\t\tconst state = tools[toolId].enabled;\n\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = [...selectedToolIds, toolId];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tselectedToolIds = selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if !(tools[toolId]?.authenticated ?? true)}\n\t\t\t\t\t\t\t\t<!-- make it slighly darker and not clickable -->\n\t\t\t\t\t\t\t\t<div class=\"absolute inset-0 opacity-50 rounded-xl cursor-pointer z-10\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t<div class=\"flex-1 truncate\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-1 gap-2 items-center\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.name ?? ''} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t<Wrench />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} placement=\"top-start\">\n\t\t\t\t\t\t\t\t\t\t<div class=\" truncate\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if tools[toolId]?.has_user_valves}\n\t\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')}>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"self-center w-fit text-sm text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\tonShowValves({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'tool',\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: toolId\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Knobs />\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t\t\t\t<Switch state={tools[toolId].enabled} />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path\n\t\td=\"M5.21173 15.1113L2.52473 12.4243C2.29041 12.1899 2.29041 11.8101 2.52473 11.5757L5.21173 8.88873C5.44605 8.65442 5.82595 8.65442 6.06026 8.88873L8.74727 11.5757C8.98158 11.8101 8.98158 12.1899 8.74727 12.4243L6.06026 15.1113C5.82595 15.3456 5.44605 15.3456 5.21173 15.1113Z\"\n\t></path><path\n\t\td=\"M11.5757 21.475L8.88874 18.788C8.65443 18.5537 8.65443 18.1738 8.88874 17.9395L11.5757 15.2525C11.8101 15.0182 12.19 15.0182 12.4243 15.2525L15.1113 17.9395C15.3456 18.1738 15.3456 18.5537 15.1113 18.788L12.4243 21.475C12.19 21.7094 11.8101 21.7094 11.5757 21.475Z\"\n\t></path><path\n\t\td=\"M11.5757 8.7475L8.88874 6.06049C8.65443 5.82618 8.65443 5.44628 8.88874 5.21197L11.5757 2.52496C11.8101 2.29065 12.19 2.29065 12.4243 2.52496L15.1113 5.21197C15.3456 5.44628 15.3456 5.82618 15.1113 6.06049L12.4243 8.7475C12.19 8.98181 11.8101 8.98181 11.5757 8.7475Z\"\n\t></path><path\n\t\td=\"M17.9396 15.1113L15.2526 12.4243C15.0183 12.1899 15.0183 11.8101 15.2526 11.5757L17.9396 8.88873C18.174 8.65442 18.5539 8.65442 18.7882 8.88873L21.4752 11.5757C21.7095 11.8101 21.7095 12.1899 21.4752 12.4243L18.7882 15.1113C18.5539 15.3456 18.174 15.3456 17.9396 15.1113Z\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M6 12H12M18 12H12M12 12V6M12 12V18\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport { onMount, getContext } from 'svelte';\n\timport { settings } from '$lib/stores';\n\n\timport Drawer from './Drawer.svelte';\n\timport RichTextInput from './RichTextInput.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let id = 'input-modal';\n\n\texport let show = false;\n\texport let value = null;\n\texport let inputContent = null;\n\n\texport let autocomplete = false;\n\texport let generateAutoCompletion = null;\n\n\texport let onChange = () => {};\n\texport let onClose = () => {};\n\n\tlet inputElement;\n</script>\n\n<Drawer bind:show>\n\t<div class=\"flex h-full min-h-screen flex-col\">\n\t\t<div\n\t\t\tclass=\" sticky top-0 z-30 flex justify-between bg-white px-4.5 pt-3 pb-3 dark:bg-gray-900 dark:text-gray-100\"\n\t\t>\n\t\t\t<div class=\" font-primary self-center text-lg\">\n\t\t\t\t{$i18n.t('Input')}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\taria-label=\"Close\"\n\t\t\t\tonclick={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t\tonClose();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"h-5 w-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex w-full px-4 dark:text-gray-200 min-h-full flex-1\">\n\t\t\t<div class=\"flex-1 w-full min-h-full\">\n\t\t\t\t<RichTextInput\n\t\t\t\t\tbind:this={inputElement}\n\t\t\t\t\t{id}\n\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\tvalue = content.md;\n\t\t\t\t\t\tinputContent = content;\n\n\t\t\t\t\t\tonChange(content);\n\t\t\t\t\t}}\n\t\t\t\t\tjson={true}\n\t\t\t\t\tvalue={inputContent?.json}\n\t\t\t\t\thtml={inputContent?.html}\n\t\t\t\t\trichText={$settings?.richTextInput ?? true}\n\t\t\t\t\tmessageInput={true}\n\t\t\t\t\tshowFormattingToolbar={$settings?.showFormattingToolbar ?? false}\n\t\t\t\t\tfloatingMenuPlacement={'top-start'}\n\t\t\t\t\tinsertPromptAsRichText={$settings?.insertPromptAsRichText ?? false}\n\t\t\t\t\t{autocomplete}\n\t\t\t\t\t{generateAutoCompletion}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Drawer>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\tclass={className}\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tstroke-width={strokeWidth}\n\tfill=\"none\"\n\tstroke=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\t><path d=\"M9 9L4 4M4 4V8M4 4H8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M15 9L20 4M20 4V8M20 4H16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M9 15L4 20M4 20V16M4 20H8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path d=\"M15 15L20 20M20 20V16M20 20H16\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport DOMPurify from 'dompurify';\n\timport { toast } from 'svelte-sonner';\n\n\timport { marked } from 'marked';\n\timport { v4 as uuidv4 } from 'uuid';\n\timport dayjs from '$lib/dayjs';\n\timport duration from 'dayjs/plugin/duration';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\n\tdayjs.extend(duration);\n\tdayjs.extend(relativeTime);\n\n\timport { onMount, tick, getContext, createEventDispatcher, onDestroy } from 'svelte';\n\n\timport { createPicker, getAuthToken } from '$lib/utils/google-drive-picker';\n\timport { pickAndDownloadFile } from '$lib/utils/onedrive-file-picker';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\ttoolServers,\n\t\tuser as _user,\n\t\tshowControls,\n\t\tTTSWorker,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\n\timport {\n\t\tconvertHeicToJpeg,\n\t\tcompressImage,\n\t\tcreateMessagesList,\n\t\textractContentFromFile,\n\t\textractCurlyBraceWords,\n\t\textractInputVariables,\n\t\tgetAge,\n\t\tgetCurrentDateTime,\n\t\tgetFormattedDate,\n\t\tgetFormattedTime,\n\t\tgetUserPosition,\n\t\tgetUserTimezone,\n\t\tgetWeekday\n\t} from '$lib/utils';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { generateAutoCompletion } from '$lib/apis';\n\timport { deleteFileById } from '$lib/apis/files';\n\timport { getSessionUser } from '$lib/apis/auths';\n\timport { getTools } from '$lib/apis/tools';\n\n\timport { WEBUI_BASE_URL, WEBUI_API_BASE_URL, PASTED_TEXT_CHARACTER_LIMIT } from '$lib/constants';\n\n\timport { createNoteHandler } from '../notes/utils';\n\timport { getSuggestionRenderer } from '../common/RichTextInput/suggestions';\n\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport FilesOverlay from './MessageInput/FilesOverlay.svelte';\n\timport ToolServersModal from './ToolServersModal.svelte';\n\n\timport RichTextInput from '../common/RichTextInput.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport Image from '../common/Image.svelte';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport GlobeAlt from '../icons/GlobeAlt.svelte';\n\timport Photo from '../icons/Photo.svelte';\n\timport Wrench from '../icons/Wrench.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\n\timport InputVariablesModal from './MessageInput/InputVariablesModal.svelte';\n\timport Voice from '../icons/Voice.svelte';\n\timport Terminal from '../icons/Terminal.svelte';\n\timport IntegrationsMenu from './MessageInput/IntegrationsMenu.svelte';\n\timport Component from '../icons/Component.svelte';\n\timport PlusAlt from '../icons/PlusAlt.svelte';\n\n\timport CommandSuggestionList from './MessageInput/CommandSuggestionList.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\timport ValvesModal from '../workspace/common/ValvesModal.svelte';\n\timport PageEdit from '../icons/PageEdit.svelte';\n\timport { goto } from '$app/navigation';\n\timport InputModal from '../common/InputModal.svelte';\n\timport Expand from '../icons/Expand.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onUpload: Function = (e) => {};\n\texport let onChange: Function = () => {};\n\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\texport let generating = false;\n\n\texport let atSelectedModel: Model | undefined = undefined;\n\texport let selectedModels: [''];\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\texport let history;\n\texport let taskIds = null;\n\n\texport let prompt = '';\n\texport let files = [];\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let imageGenerationEnabled = false;\n\texport let webSearchEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\n\tlet inputContent = null;\n\n\tlet showInputVariablesModal = false;\n\tlet inputVariablesModalCallback = (variableValues) => {};\n\tlet inputVariables = {};\n\tlet inputVariableValues = {};\n\n\tlet showValvesModal = false;\n\tlet selectedValvesType = 'tool'; // 'tool' or 'function'\n\tlet selectedValvesItemId = null;\n\tlet integrationsMenuCloseOnOutsideClick = true;\n\n\t$: if (!showValvesModal) {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}\n\n\t$: onChange({\n\t\tprompt,\n\t\tfiles: files\n\t\t\t.filter((file) => file.type !== 'image')\n\t\t\t.map((file) => {\n\t\t\t\treturn {\n\t\t\t\t\t...file,\n\t\t\t\t\tuser: undefined,\n\t\t\t\t\taccess_control: undefined\n\t\t\t\t};\n\t\t\t}),\n\t\tselectedToolIds,\n\t\tselectedFilterIds,\n\t\timageGenerationEnabled,\n\t\twebSearchEnabled,\n\t\tcodeInterpreterEnabled\n\t});\n\n\tconst inputVariableHandler = async (text: string): Promise<string> => {\n\t\tinputVariables = extractInputVariables(text);\n\n\t\t// No variables? return the original text immediately.\n\t\tif (Object.keys(inputVariables).length === 0) {\n\t\t\treturn text;\n\t\t}\n\n\t\t// Show modal and wait for the user's input.\n\t\tshowInputVariablesModal = true;\n\t\treturn await new Promise<string>((resolve) => {\n\t\t\tinputVariablesModalCallback = (variableValues) => {\n\t\t\t\tinputVariableValues = { ...inputVariableValues, ...variableValues };\n\t\t\t\treplaceVariables(inputVariableValues);\n\t\t\t\tshowInputVariablesModal = false;\n\t\t\t\tresolve(text);\n\t\t\t};\n\t\t});\n\t};\n\n\tconst textVariableHandler = async (text: string) => {\n\t\tif (text.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read().catch((err) => {\n\t\t\t\tconsole.error('Failed to read clipboard items:', err);\n\t\t\t\treturn [];\n\t\t\t});\n\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\tconst file = new File([blob], `clipboard-image.${type.split('/')[1]}`, {\n\t\t\t\t\t\t\ttype: type\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tinputFilesHandler([file]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttext = text.replaceAll('{{CLIPBOARD}}', clipboardText.replaceAll('\\r\\n', '\\n'));\n\t\t}\n\n\t\tif (text.includes('{{USER_LOCATION}}')) {\n\t\t\tlet location;\n\t\t\ttry {\n\t\t\t\tlocation = await getUserPosition();\n\t\t\t} catch (error) {\n\t\t\t\ttoast.error($i18n.t('Location access not allowed'));\n\t\t\t\tlocation = 'LOCATION_UNKNOWN';\n\t\t\t}\n\t\t\ttext = text.replaceAll('{{USER_LOCATION}}', String(location));\n\t\t}\n\n\t\tconst sessionUser = await getSessionUser(localStorage.token);\n\n\t\tif (text.includes('{{USER_NAME}}')) {\n\t\t\tconst name = sessionUser?.name || 'User';\n\t\t\ttext = text.replaceAll('{{USER_NAME}}', name);\n\t\t}\n\n\t\tif (text.includes('{{USER_BIO}}')) {\n\t\t\tconst bio = sessionUser?.bio || '';\n\n\t\t\tif (bio) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIO}}', bio);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_GENDER}}')) {\n\t\t\tconst gender = sessionUser?.gender || '';\n\n\t\t\tif (gender) {\n\t\t\t\ttext = text.replaceAll('{{USER_GENDER}}', gender);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_BIRTH_DATE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\ttext = text.replaceAll('{{USER_BIRTH_DATE}}', birthDate);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_AGE}}')) {\n\t\t\tconst birthDate = sessionUser?.date_of_birth || '';\n\n\t\t\tif (birthDate) {\n\t\t\t\t// calculate age using date\n\t\t\t\tconst age = getAge(birthDate);\n\t\t\t\ttext = text.replaceAll('{{USER_AGE}}', age);\n\t\t\t}\n\t\t}\n\n\t\tif (text.includes('{{USER_LANGUAGE}}')) {\n\t\t\tconst language = localStorage.getItem('locale') || 'en-US';\n\t\t\ttext = text.replaceAll('{{USER_LANGUAGE}}', language);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATE}}')) {\n\t\t\tconst date = getFormattedDate();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATE}}', date);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIME}}')) {\n\t\t\tconst time = getFormattedTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIME}}', time);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_DATETIME}}')) {\n\t\t\tconst dateTime = getCurrentDateTime();\n\t\t\ttext = text.replaceAll('{{CURRENT_DATETIME}}', dateTime);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_TIMEZONE}}')) {\n\t\t\tconst timezone = getUserTimezone();\n\t\t\ttext = text.replaceAll('{{CURRENT_TIMEZONE}}', timezone);\n\t\t}\n\n\t\tif (text.includes('{{CURRENT_WEEKDAY}}')) {\n\t\t\tconst weekday = getWeekday();\n\t\t\ttext = text.replaceAll('{{CURRENT_WEEKDAY}}', weekday);\n\t\t}\n\n\t\treturn text;\n\t};\n\n\tconst replaceVariables = (variables: Record<string, any>) => {\n\t\tconsole.log('Replacing variables:', variables);\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tchatInputElement.replaceVariables(variables);\n\t\t\tchatInputElement.focus();\n\t\t}\n\t};\n\n\texport const setText = async (text?: string, cb?: (text: string) => void) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\n\t\tif (chatInput) {\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await textVariableHandler(text || '');\n\t\t\t}\n\n\t\t\tchatInputElement?.setText(text);\n\t\t\tchatInputElement?.focus();\n\n\t\t\tif (text !== '') {\n\t\t\t\ttext = await inputVariableHandler(text);\n\t\t\t}\n\n\t\t\tawait tick();\n\t\t\tif (cb) await cb(text);\n\t\t}\n\t};\n\n\tconst getCommand = () => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tlet word = '';\n\n\t\tif (chatInput) {\n\t\t\tword = chatInputElement?.getWordAtDocPos();\n\t\t}\n\n\t\treturn word;\n\t};\n\n\tconst replaceCommandWithText = (text) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\tchatInputElement?.replaceCommandWithText(text);\n\t};\n\n\tconst insertTextAtCursor = async (text: string) => {\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tif (!chatInput) return;\n\n\t\ttext = await textVariableHandler(text);\n\n\t\tif (command) {\n\t\t\treplaceCommandWithText(text);\n\t\t} else {\n\t\t\tchatInputElement?.insertContent(text);\n\t\t}\n\n\t\tawait tick();\n\t\ttext = await inputVariableHandler(text);\n\t\tawait tick();\n\n\t\tconst chatInputContainer = document.getElementById('chat-input-container');\n\t\tif (chatInputContainer) {\n\t\t\tchatInputContainer.scrollTop = chatInputContainer.scrollHeight;\n\t\t}\n\n\t\tawait tick();\n\t\tif (chatInput) {\n\t\t\tchatInput.focus();\n\t\t\tchatInput.dispatchEvent(new Event('input'));\n\n\t\t\tconst words = extractCurlyBraceWords(prompt);\n\n\t\t\tif (words.length > 0) {\n\t\t\t\tconst word = words.at(0);\n\t\t\t\tawait tick();\n\t\t\t} else {\n\t\t\t\tchatInput.scrollTop = chatInput.scrollHeight;\n\t\t\t}\n\t\t}\n\t};\n\n\tlet command = '';\n\texport let showCommands = false;\n\t$: showCommands = ['/', '#', '@'].includes(command?.charAt(0)) || '\\\\#' === command?.slice(0, 2);\n\tlet suggestions = null;\n\n\tlet showTools = false;\n\n\tlet loaded = false;\n\tlet recording = false;\n\n\tlet isComposing = false;\n\t// Safari has a bug where compositionend is not triggered correctly #16615\n\t// when using the virtual keyboard on iOS.\n\tlet compositionEndedAt = -2e8;\n\tconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n\tfunction inOrNearComposition(event: Event) {\n\t\tif (isComposing) {\n\t\t\treturn true;\n\t\t}\n\t\t// See https://www.stum.de/2016/06/24/handling-ime-events-in-javascript/.\n\t\t// On Japanese input method editors (IMEs), the Enter key is used to confirm character\n\t\t// selection. On Safari, when Enter is pressed, compositionend and keydown events are\n\t\t// emitted. The keydown event triggers newline insertion, which we don't want.\n\t\t// This method returns true if the keydown event should be ignored.\n\t\t// We only ignore it once, as pressing Enter a second time *should* insert a newline.\n\t\t// Furthermore, the keydown event timestamp must be close to the compositionEndedAt timestamp.\n\t\t// This guards against the case where compositionend is triggered without the keyboard\n\t\t// (e.g. character confirmation may be done with the mouse), and keydown is triggered\n\t\t// afterwards- we wouldn't want to ignore the keydown event in this case.\n\t\tif (isSafari && Math.abs(event.timeStamp - compositionEndedAt) < 500) {\n\t\t\tcompositionEndedAt = -2e8;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tlet chatInputContainerElement;\n\tlet chatInputElement;\n\n\tlet filesInputElement;\n\tlet commandsElement;\n\n\tlet inputFiles;\n\n\tlet showInputModal = false;\n\n\tlet dragged = false;\n\tlet shiftKey = false;\n\n\tlet user = null;\n\texport let placeholder = '';\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\tlet fileUploadCapableModels = [];\n\t$: fileUploadCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.file_upload ?? true\n\t);\n\n\tlet webSearchCapableModels = [];\n\t$: webSearchCapableModels = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t);\n\n\tlet imageGenerationCapableModels = [];\n\t$: imageGenerationCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.image_generation ?? true\n\t);\n\n\tlet codeInterpreterCapableModels = [];\n\t$: codeInterpreterCapableModels = (\n\t\tatSelectedModel?.id ? [atSelectedModel.id] : selectedModels\n\t).filter(\n\t\t(model) =>\n\t\t\t$models.find((m) => m.id === model)?.info?.meta?.capabilities?.code_interpreter ?? true\n\t);\n\n\tlet toggleFilters = [];\n\t$: toggleFilters = (atSelectedModel?.id ? [atSelectedModel.id] : selectedModels)\n\t\t.map((id) => ($models.find((model) => model.id === id) || {})?.filters ?? [])\n\t\t.reduce((acc, filters) => acc.filter((f1) => filters.some((f2) => f2.id === f1.id)));\n\n\tlet showToolsButton = false;\n\t$: showToolsButton = ($tools ?? []).length > 0 || ($toolServers ?? []).length > 0;\n\n\tlet showWebSearchButton = false;\n\t$: showWebSearchButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\twebSearchCapableModels.length &&\n\t\t$config?.features?.enable_web_search &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.web_search);\n\n\tlet showImageGenerationButton = false;\n\t$: showImageGenerationButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\timageGenerationCapableModels.length &&\n\t\t$config?.features?.enable_image_generation &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.image_generation);\n\n\tlet showCodeInterpreterButton = false;\n\t$: showCodeInterpreterButton =\n\t\t(atSelectedModel?.id ? [atSelectedModel.id] : selectedModels).length ===\n\t\t\tcodeInterpreterCapableModels.length &&\n\t\t$config?.features?.enable_code_interpreter &&\n\t\t($_user.role === 'admin' || $_user?.permissions?.features?.code_interpreter);\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTo({\n\t\t\ttop: element.scrollHeight,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t};\n\n\tconst screenCaptureHandler = async () => {\n\t\ttry {\n\t\t\t// Request screen media\n\t\t\tconst mediaStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\tvideo: { cursor: 'never' },\n\t\t\t\taudio: false\n\t\t\t});\n\t\t\t// Once the user selects a screen, temporarily create a video element\n\t\t\tconst video = document.createElement('video');\n\t\t\tvideo.srcObject = mediaStream;\n\t\t\t// Ensure the video loads without affecting user experience or tab switching\n\t\t\tawait video.play();\n\t\t\t// Set up the canvas to match the video dimensions\n\t\t\tconst canvas = document.createElement('canvas');\n\t\t\tcanvas.width = video.videoWidth;\n\t\t\tcanvas.height = video.videoHeight;\n\t\t\t// Grab a single frame from the video stream using the canvas\n\t\t\tconst context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(video, 0, 0, canvas.width, canvas.height);\n\t\t\t// Stop all video tracks (stop screen sharing) after capturing the image\n\t\t\tmediaStream.getTracks().forEach((track) => track.stop());\n\n\t\t\t// bring back focus to this current tab, so that the user can see the screen capture\n\t\t\twindow.focus();\n\n\t\t\t// Convert the canvas to a Base64 image URL\n\t\t\tconst imageUrl = canvas.toDataURL('image/png');\n\t\t\tconst blob = await (await fetch(imageUrl)).blob();\n\t\t\tconst file = new File([blob], `screen-capture-${Date.now()}.png`, { type: 'image/png' });\n\t\t\tinputFilesHandler([file]);\n\t\t\t// Clean memory: Clear video srcObject\n\t\t\tvideo.srcObject = null;\n\t\t} catch (error) {\n\t\t\t// Handle any errors (e.g., user cancels screen sharing)\n\t\t\tconsole.error('Error capturing screen:', error);\n\t\t}\n\t};\n\n\tconst uploadFileHandler = async (file, process = true, itemData = {}) => {\n\t\tif ($_user?.role !== 'admin' && !($_user?.permissions?.chat?.file_upload ?? true)) {\n\t\t\ttoast.error($i18n.t('You do not have permission to upload files.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tif (fileUploadCapableModels.length !== selectedModels.length) {\n\t\t\ttoast.error($i18n.t('Model(s) do not support file upload'));\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tsize: file.size,\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\t...itemData\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tfiles = [...files, fileItem];\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\ttry {\n\t\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\t\tlet metadata = null;\n\t\t\t\tif (\n\t\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t\t) {\n\t\t\t\t\tmetadata = {\n\t\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// During the file upload, file content is automatically extracted.\n\t\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata, process);\n\n\t\t\t\tif (uploadedFile) {\n\t\t\t\t\tconsole.log('File upload completed:', {\n\t\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\t\tname: fileItem.name,\n\t\t\t\t\t\tcollection: uploadedFile?.meta?.collection_name\n\t\t\t\t\t});\n\n\t\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t\t}\n\n\t\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\t\tfileItem.collection_name =\n\t\t\t\t\t\tuploadedFile?.meta?.collection_name || uploadedFile?.collection_name;\n\t\t\t\t\tfileItem.content_type = uploadedFile.meta?.content_type || uploadedFile.content_type;\n\t\t\t\t\tfileItem.url = `${uploadedFile.id}`;\n\n\t\t\t\t\tfiles = files;\n\t\t\t\t} else {\n\t\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t}\n\t\t} else {\n\t\t\t// If temporary chat is enabled, we just add the file to the list without uploading it.\n\n\t\t\tconst content = await extractContentFromFile(file).catch((error) => {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t('Failed to extract content from the file: {{error}}', { error: error })\n\t\t\t\t);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (content === null) {\n\t\t\t\ttoast.error($i18n.t('Failed to extract content from the file.'));\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t\treturn null;\n\t\t\t} else {\n\t\t\t\tconsole.log('Extracted content from file:', {\n\t\t\t\t\tname: file.name,\n\t\t\t\t\tsize: file.size,\n\t\t\t\t\tcontent: content\n\t\t\t\t});\n\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.type = 'text';\n\t\t\t\tfileItem.content = content;\n\t\t\t\tfileItem.id = uuidv4(); // Temporary ID for the file\n\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tconsole.log('Input files handler called with:', inputFiles);\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + inputFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tinputFiles.forEach(async (file) => {\n\t\t\tconsole.log('Processing file:', {\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t\tsize: file.size,\n\t\t\t\textension: file.name.split('.').at(-1)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\t\tfileSize: file.size,\n\t\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t\t});\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file['type'].startsWith('image/')) {\n\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst compressImageHandler = async (imageUrl, settings = {}, config = {}) => {\n\t\t\t\t\t// Quick shortcut so we dont do unnecessary work.\n\t\t\t\t\tconst settingsCompression = settings?.imageCompression ?? false;\n\t\t\t\t\tconst configWidth = config?.file?.image_compression?.width ?? null;\n\t\t\t\t\tconst configHeight = config?.file?.image_compression?.height ?? null;\n\n\t\t\t\t\t// If neither settings nor config wants compression, return original URL.\n\t\t\t\t\tif (!settingsCompression && !configWidth && !configHeight) {\n\t\t\t\t\t\treturn imageUrl;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Default to null (no compression unless set)\n\t\t\t\t\tlet width = null;\n\t\t\t\t\tlet height = null;\n\n\t\t\t\t\t// If user/settings want compression, pick their preferred size.\n\t\t\t\t\tif (settingsCompression) {\n\t\t\t\t\t\twidth = settings?.imageCompressionSize?.width ?? null;\n\t\t\t\t\t\theight = settings?.imageCompressionSize?.height ?? null;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply config limits as an upper bound if any\n\t\t\t\t\tif (configWidth && (width === null || width > configWidth)) {\n\t\t\t\t\t\twidth = configWidth;\n\t\t\t\t\t}\n\t\t\t\t\tif (configHeight && (height === null || height > configHeight)) {\n\t\t\t\t\t\theight = configHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Do the compression if required\n\t\t\t\t\tif (width || height) {\n\t\t\t\t\t\treturn await compressImage(imageUrl, width, height);\n\t\t\t\t\t}\n\t\t\t\t\treturn imageUrl;\n\t\t\t\t};\n\n\t\t\t\tlet reader = new FileReader();\n\n\t\t\t\treader.onload = async (event) => {\n\t\t\t\t\tlet imageUrl = event.target.result;\n\n\t\t\t\t\t// Compress the image if settings or config require it\n\t\t\t\t\tif ($settings?.imageCompression && $settings?.imageCompressionInChannels) {\n\t\t\t\t\t\timageUrl = await compressImageHandler(imageUrl, $settings, $config);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst blob = await (await fetch(imageUrl)).blob();\n\t\t\t\t\t\tconst compressedFile = new File([blob], file.name, { type: file.type });\n\n\t\t\t\t\t\tuploadFileHandler(compressedFile, false);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\treader.readAsDataURL(file['type'] === 'image/heic' ? await convertHeicToJpeg(file) : file);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tconst createNote = async () => {\n\t\tif (inputContent?.md.trim() === '' && inputContent?.html.trim() === '') {\n\t\t\ttoast.error($i18n.t('Cannot create an empty note.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst res = await createNoteHandler(\n\t\t\tdayjs().format('YYYY-MM-DD'),\n\t\t\tinputContent?.md,\n\t\t\tinputContent?.html\n\t\t);\n\n\t\tif (res) {\n\t\t\t// Clear the input content saved in session storage.\n\t\t\tsessionStorage.removeItem('chat-input');\n\t\t\tgoto(`/notes/${res.id}`);\n\t\t}\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being dragged.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tconsole.log(e);\n\n\t\tif (e.dataTransfer?.files) {\n\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\tconsole.log(inputFiles);\n\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t}\n\t\t}\n\n\t\tdragged = false;\n\t};\n\n\tconst onKeyDown = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = true;\n\t\t}\n\n\t\tif (e.key === 'Escape') {\n\t\t\tconsole.log('Escape');\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onKeyUp = (e) => {\n\t\tif (e.key === 'Shift') {\n\t\t\tshiftKey = false;\n\t\t}\n\t};\n\n\tconst onFocus = () => {};\n\n\tconst onBlur = () => {\n\t\tshiftKey = false;\n\t};\n\n\tonMount(async () => {\n\t\tsuggestions = [\n\t\t\t{\n\t\t\t\tchar: '@',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '/',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\t\t\t{\n\t\t\t\tchar: '#',\n\t\t\t\trender: getSuggestionRenderer(CommandSuggestionList, {\n\t\t\t\t\ti18n,\n\t\t\t\t\tonSelect: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'model') {\n\t\t\t\t\t\t\tatSelectedModel = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t},\n\n\t\t\t\t\tinsertTextHandler: insertTextAtCursor,\n\t\t\t\t\tonUpload: (e) => {\n\t\t\t\t\t\tconst { type, data } = e;\n\n\t\t\t\t\t\tif (type === 'file') {\n\t\t\t\t\t\t\tif (files.find((f) => f.id === data.id)) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...data,\n\t\t\t\t\t\t\t\t\tstatus: 'processed'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tonUpload(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t];\n\t\tloaded = true;\n\n\t\twindow.setTimeout(() => {\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t}, 0);\n\n\t\twindow.addEventListener('keydown', onKeyDown);\n\t\twindow.addEventListener('keyup', onKeyUp);\n\n\t\twindow.addEventListener('focus', onFocus);\n\t\twindow.addEventListener('blur', onBlur);\n\n\t\tawait tick();\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tdropzoneElement?.addEventListener('dragover', onDragOver);\n\t\tdropzoneElement?.addEventListener('drop', onDrop);\n\t\tdropzoneElement?.addEventListener('dragleave', onDragLeave);\n\n\t\tawait tools.set(await getTools(localStorage.token));\n\t});\n\n\tonDestroy(() => {\n\t\tconsole.log('destroy');\n\t\twindow.removeEventListener('keydown', onKeyDown);\n\t\twindow.removeEventListener('keyup', onKeyUp);\n\n\t\twindow.removeEventListener('focus', onFocus);\n\t\twindow.removeEventListener('blur', onBlur);\n\n\t\tconst dropzoneElement = document.getElementById('chat-container');\n\n\t\tif (dropzoneElement) {\n\t\t\tdropzoneElement?.removeEventListener('dragover', onDragOver);\n\t\t\tdropzoneElement?.removeEventListener('drop', onDrop);\n\t\t\tdropzoneElement?.removeEventListener('dragleave', onDragLeave);\n\t\t}\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n<ToolServersModal bind:show={showTools} {selectedToolIds} />\n\n<InputVariablesModal\n\tbind:show={showInputVariablesModal}\n\tvariables={inputVariables}\n\tonSave={inputVariablesModalCallback}\n/>\n\n<ValvesModal\n\tbind:show={showValvesModal}\n\tuserValves={true}\n\ttype={selectedValvesType}\n\tid={selectedValvesItemId ?? null}\n\ton:save={async () => {\n\t\tawait tick();\n\t}}\n\ton:close={() => {\n\t\tintegrationsMenuCloseOnOutsideClick = true;\n\t}}\n/>\n\n<InputModal\n\tbind:show={showInputModal}\n\tbind:value={prompt}\n\tbind:inputContent\n\tonChange={(content) => {\n\t\tconsole.log(content);\n\t\tchatInputElement?.setContent(content?.json ?? null);\n\t}}\n\tonClose={async () => {\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t}}\n/>\n\n{#if loaded}\n\t<div class=\"w-full font-primary\">\n\t\t<div class=\" mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col px-3 {($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} w-full\"\n\t\t\t>\n\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t{#if autoScroll === false && history?.currentId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" absolute -top-12 left-0 right-0 flex justify-center z-30 pointer-events-none\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full pointer-events-auto\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"bg-transparent\">\n\t\t\t<div\n\t\t\t\tclass=\"{($settings?.widescreenMode ?? null)\n\t\t\t\t\t? 'max-w-full'\n\t\t\t\t\t: 'max-w-6xl'} px-2.5 mx-auto inset-x-0\"\n\t\t\t>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\thidden\n\t\t\t\t\t\tmultiple\n\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\t\tinputFilesHandler(_inputFiles);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class={recording ? '' : 'hidden'}>\n\t\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\t\tonCancel={async () => {\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonConfirm={async (data) => {\n\t\t\t\t\t\t\t\tconst { text, filename } = data;\n\n\t\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tawait insertTextAtCursor(`${text}`);\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\n\t\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\"w-full flex flex-col gap-1.5 {recording ? 'hidden' : ''}\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tid=\"generate-message-pair-button\"\n\t\t\t\t\t\t\tclass=\"hidden\"\n\t\t\t\t\t\t\ton:click={() => createMessagePair(prompt)}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid=\"message-input-container\"\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full shadow-lg rounded-3xl border {$temporaryChatEnabled\n\t\t\t\t\t\t\t\t? 'border-dashed border-gray-100 dark:border-gray-800 hover:border-gray-200 focus-within:border-gray-200 hover:dark:border-gray-700 focus-within:dark:border-gray-700'\n\t\t\t\t\t\t\t\t: ' border-gray-100/30 dark:border-gray-850/30 hover:border-gray-200 focus-within:border-gray-100 hover:dark:border-gray-800 focus-within:dark:border-gray-800'}  transition px-1 bg-white/5 dark:bg-gray-500/5 backdrop-blur-sm dark:text-gray-100\"\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t\t\t\t<div class=\"px-3 pt-3 text-left w-full flex flex-col z-10\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex items-center justify-between w-full\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"pl-[1px] flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${$models.find((model) => model.id === atSelectedModel.id).id}&lang=${$i18n.language}`}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"translate-y-[0.5px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex items-center dark:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mx-2 mt-2.5 pb-1.5 flex items-center flex-wrap gap-2\"\n\t\t\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image' || (file?.content_type ?? '').startsWith('image/')}\n\t\t\t\t\t\t\t\t\t\t\t{@const fileUrl =\n\t\t\t\t\t\t\t\t\t\t\t\tfile.url.startsWith('data') || file.url.startsWith('http')\n\t\t\t\t\t\t\t\t\t\t\t\t\t? file.url\n\t\t\t\t\t\t\t\t\t\t\t\t\t: `${WEBUI_API_BASE_URL}/files/${file.url}${file?.content_type ? '/content' : ''}`}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={fileUrl}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\timageClassName=\" size-10 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-white text-black border border-white rounded-full {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'outline-hidden focus:outline-hidden group-hover:visible invisible transition'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Remove file')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\t\t\t\t\tmodal={['file', 'collection'].includes(file?.type)}\n\t\t\t\t\t\t\t\t\t\t\t\ton:dismiss={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Remove from UI state\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\"px-2.5\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden rtl:text-right ltr:text-left bg-transparent dark:text-gray-100 outline-hidden w-full pb-1 px-1 resize-none h-fit max-h-96 overflow-auto {files.length ===\n\t\t\t\t\t\t\t\t\t0\n\t\t\t\t\t\t\t\t\t\t? atSelectedModel !== undefined\n\t\t\t\t\t\t\t\t\t\t\t? 'pt-1.5'\n\t\t\t\t\t\t\t\t\t\t\t: 'pt-2.5'\n\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\tid=\"chat-input-container\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{#if prompt.split('\\n').length > 2}\n\t\t\t\t\t\t\t\t\t\t<div class=\"fixed top-0 right-0 z-20\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"mt-2.5 mr-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"p-1 rounded-lg hover:bg-gray-100/50 dark:hover:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Expand input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowInputModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Expand />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if suggestions}\n\t\t\t\t\t\t\t\t\t\t{#key $settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t{#key $settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t<RichTextInput\n\t\t\t\t\t\t\t\t\t\t\t\t\tbind:this={chatInputElement}\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"chat-input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\teditable={!showInputModal}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprompt = content.md;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tinputContent = content;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommand = getCommand();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\tjson={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\trichText={$settings?.richTextInput ?? true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessageInput={true}\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowFormattingToolbar={$settings?.showFormattingToolbar ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloatingMenuPlacement={'top-start'}\n\t\t\t\t\t\t\t\t\t\t\t\t\tinsertPromptAsRichText={$settings?.insertPromptAsRichText ?? false}\n\t\t\t\t\t\t\t\t\t\t\t\t\tshiftEnter={!($settings?.ctrlEnterToSend ?? false) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder={placeholder ? placeholder : $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\t\t\t\t\tlargeTextAsFile={($settings?.largeTextAsFile ?? false) && !shiftKey}\n\t\t\t\t\t\t\t\t\t\t\t\t\tautocomplete={$config?.features?.enable_autocomplete_generation &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.promptAutocomplete ?? false)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tgenerateAutoCompletion={async (text) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModelIds.length === 0 || !selectedModelIds.at(0)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Please select a model first.'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst res = await generateAutoCompletion(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedModelIds.at(0),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttext,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistory?.currentId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? createMessagesList(history, history.currentId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(error);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{suggestions}\n\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionstart={() => (isComposing = true)}\n\t\t\t\t\t\t\t\t\t\t\t\t\toncompositionend={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcompositionEndedAt = e.timeStamp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisComposing = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst suggestionsContainerElement =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('suggestions-container');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (userMessageElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!suggestionsContainerElement) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (inOrNearComposition(e)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Uses keyCode '13' for Enter key for chinese/japanese keyboards.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Depending on the user's settings, it will send the message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// either when Enter is pressed or when Ctrl+Enter is pressed.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst enterPressed =\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.ctrlEnterToSend ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? (e.key === 'Enter' || e.keyCode === 13) && isCtrlPressed\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (e.key === 'Enter' || e.keyCode === 13) && !e.shiftKey;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (enterPressed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('submit', prompt);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedToolIds = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = [];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twebSearchEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timageGenerationEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcodeInterpreterEnabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:paste={async (e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te = e.detail.event;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (item.type === 'text/plain') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (($settings?.largeTextAsFile ?? false) && !shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst text = clipboardData.getData('text/plain');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (text.length > PASTED_TEXT_CHARACTER_LIMIT) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = new Blob([text], { type: 'text/plain' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[blob],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Pasted_Text_${Date.now()}.txt`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text/plain'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file, true, { context: 'full' });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait inputFilesHandler([file]);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" flex justify-between mt-0.5 mb-2.5 mx-0.5 max-w-full\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t<div class=\"ml-1 self-end flex items-center flex-1 max-w-[80%]\">\n\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t{fileUploadCapableModels}\n\t\t\t\t\t\t\t\t\t\t{screenCaptureHandler}\n\t\t\t\t\t\t\t\t\t\t{inputFilesHandler}\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tuploadGoogleDriveHandler={async () => {\n\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await createPicker();\n\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from Google Drive');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('Google Drive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Error accessing Google Drive: {{error}}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: error.message\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tuploadOneDriveHandler={async (authorityType) => {\n\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\tconst fileData = await pickAndDownloadFile(authorityType);\n\t\t\t\t\t\t\t\t\t\t\t\tif (fileData) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = new File([fileData.blob], fileData.name, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: fileData.blob.type || 'application/octet-stream'\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait uploadFileHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log('No file was selected from OneDrive');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error('OneDrive Error:', error);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tid=\"input-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<PlusAlt className=\"size-5.5\" />\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</InputMenu>\n\n\t\t\t\t\t\t\t\t\t{#if showWebSearchButton || showImageGenerationButton || showCodeInterpreterButton || showToolsButton || (toggleFilters && toggleFilters.length > 0)}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"flex self-center w-[1px] h-4 mx-1 bg-gray-200/50 dark:bg-gray-800/50\"\n\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t<IntegrationsMenu\n\t\t\t\t\t\t\t\t\t\t\tselectedModels={atSelectedModel ? [atSelectedModel.id] : selectedModels}\n\t\t\t\t\t\t\t\t\t\t\t{toggleFilters}\n\t\t\t\t\t\t\t\t\t\t\t{showWebSearchButton}\n\t\t\t\t\t\t\t\t\t\t\t{showImageGenerationButton}\n\t\t\t\t\t\t\t\t\t\t\t{showCodeInterpreterButton}\n\t\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\tcloseOnOutsideClick={integrationsMenuCloseOnOutsideClick}\n\t\t\t\t\t\t\t\t\t\t\tonShowValves={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tconst { type, id } = e;\n\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = type;\n\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = id;\n\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\tintegrationsMenuCloseOnOutsideClick = false;\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\t\t\t\t\t\t\t\t\t\tchatInput?.focus();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"integration-menu-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Component className=\"size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</IntegrationsMenu>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if selectedModelIds.length === 1 && $models.find((m) => m.id === selectedModelIds[0])?.has_user_valves}\n\t\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Valves')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"model-valves-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent hover:bg-gray-100 text-gray-700 dark:text-white dark:hover:bg-gray-800 rounded-full size-8 flex justify-center items-center outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesType = 'function';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedValvesItemId = selectedModelIds[0]?.split('.')[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowValvesModal = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Knobs className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<div class=\"ml-1 flex gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t{#if (selectedToolIds ?? []).length > 0}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{COUNT}} Available Tools', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tCOUNT: selectedToolIds.length\n\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"translate-y-[0.5px] px-1 flex gap-1 items-center text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 rounded-lg self-center transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Available Tools\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowTools = !showTools;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Wrench className=\"size-4\" strokeWidth=\"1.75\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{selectedToolIds.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#each selectedFilterIds as filterId}\n\t\t\t\t\t\t\t\t\t\t\t{@const filter = toggleFilters.find((f) => f.id === filterId)}\n\t\t\t\t\t\t\t\t\t\t\t{#if filter}\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={filter?.name} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFilterIds = selectedFilterIds.filter((id) => id !== filterId);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {selectedFilterIds.includes(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfilterId\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} capitalize\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if filter?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4 items-center flex justify-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={filter.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5 {filter.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={filter.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t{/each}\n\n\t\t\t\t\t\t\t\t\t\t{#if webSearchEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Web Search')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() => (webSearchEnabled = !webSearchEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {webSearchEnabled ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t($settings?.webSearch ?? false) === 'always'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-600/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<GlobeAlt className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if imageGenerationEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Image')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(imageGenerationEnabled = !imageGenerationEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"group p-[7px] flex gap-1.5 items-center text-sm rounded-full transition-colors duration-300 focus:outline-hidden max-w-full overflow-hidden {imageGenerationEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Photo className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Code Interpreter')} placement=\"top\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? $i18n.t('Disable Code Interpreter')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: $i18n.t('Enable Code Interpreter')}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-pressed={codeInterpreterEnabled}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click|preventDefault={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(codeInterpreterEnabled = !codeInterpreterEnabled)}\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" group p-[7px] flex gap-1.5 items-center text-sm transition-colors duration-300 max-w-full overflow-hidden {codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? ' text-sky-500 dark:text-sky-300 bg-sky-50 hover:bg-sky-100 dark:bg-sky-400/10 dark:hover:bg-sky-700/10 border border-sky-200/40 dark:border-sky-500/20'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 '} {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'm-1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'focus:outline-hidden rounded-full'}\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Terminal className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"hidden group-hover:block\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<XMark className=\"size-4\" strokeWidth=\"1.75\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\"self-end flex space-x-1 mr-1 shrink-0 gap-[0.5px]\">\n\t\t\t\t\t\t\t\t\t{#if (taskIds && taskIds.length > 0) || (history.currentId && history.messages[history.currentId]?.done != true) || generating}\n\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Stop')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{#if prompt !== '' && !history?.currentId && ($config?.features?.enable_notes ?? false) && ($_user?.role === 'admin' || ($_user?.permissions?.features?.notes ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Create Note')}  -->\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Create note')} className=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === '' && files.length === 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreateNote();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<PageEdit className=\"size-4.5 translate-y-[0.5px]\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if (!history?.currentId || history.messages[history.currentId]?.done == true) && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.stt ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Record voice')} -->\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Dictate')}>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:text-gray-700 dark:hover:text-gray-200 transition rounded-full p-1.5 self-center mr-0.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label=\"Voice Input\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t{#if prompt === '' && files.length === 0 && ($_user?.role === 'admin' || ($_user?.permissions?.chat?.call ?? true))}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('Call')} -->\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Voice mode')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taudio: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstream = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user has not initialized the TTS worker, initialize it\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!$TTSWorker) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait TTSWorker.set(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnew KokoroWorker({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdtype: $settings.audio?.tts?.engineConfig?.dtype ?? 'fp32'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait $TTSWorker.init();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowControls.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Permission denied when accessing media devices')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Voice mode')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Voice className=\"size-5\" strokeWidth=\"2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{!(prompt === '' && files.length === 0)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === '' && files.length === 0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if $config?.license_metadata?.input_footer}\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-500 text-center line-clamp-1 marked\">\n\t\t\t\t\t\t\t\t{@html DOMPurify.sanitize(marked($config?.license_metadata?.input_footer))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"mb-1\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile, config } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { updateUserSettings } from '$lib/apis/users';\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\tconst pinModelHandler = async (modelId) => {\n\t\tlet pinnedModels = $settings?.pinnedModels ?? [];\n\n\t\tif (pinnedModels.includes(modelId)) {\n\t\t\tpinnedModels = pinnedModels.filter((id) => id !== modelId);\n\t\t} else {\n\t\t\tpinnedModels = [...new Set([...pinnedModels, modelId])];\n\t\t}\n\n\t\tsettings.set({ ...$settings, pinnedModels: pinnedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tconst _selectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\n\t\tif (JSON.stringify(_selectedModels) !== JSON.stringify(selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"max-w-full {($settings?.highContrastMode ?? false) ? 'm-1' : 'mr-1'}\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tid={`${selectedModelIdx}`}\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\t{pinModelHandler}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true)}\n\t\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Add Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  self-center mx-1 disabled:text-gray-600 disabled:hover:text-gray-600 -translate-y-[0.5px]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Remove Model\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault}\n\t<div\n\t\tclass=\"relative text-left mt-[1px] ml-1 text-[0.7rem] text-gray-600 dark:text-gray-400 font-primary\"\n\t>\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tviewBox=\"0 0 24 24\"\n\tstroke=\"currentColor\"\n\tfill=\"currentColor\"\n\tclass={className}\n\tstroke-width={strokeWidth}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, tick } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport {\n\t\tshowOverview,\n\t\tshowControls,\n\t\tshowArtifacts,\n\t\tmobile,\n\t\ttemporaryChatEnabled,\n\t\ttheme,\n\t\tuser,\n\t\tsettings,\n\t\tfolders,\n\t\tshowEmbeds,\n\t\tartifactContents\n\t} from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getChatById } from '$lib/apis/chats';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\timport Map from '$lib/components/icons/Map.svelte';\n\timport Clipboard from '$lib/components/icons/Clipboard.svelte';\n\timport AdjustmentsHorizontal from '$lib/components/icons/AdjustmentsHorizontal.svelte';\n\timport Cube from '$lib/components/icons/Cube.svelte';\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport Share from '$lib/components/icons/Share.svelte';\n\timport ArchiveBox from '$lib/components/icons/ArchiveBox.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Download from '$lib/components/icons/Download.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\n\texport let shareHandler: Function;\n\texport let moveChatHandler: Function;\n\n\texport let archiveChatHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tlet showFullMessages = false;\n\n\tconst getChatAsText = async () => {\n\t\tconst history = chat.chat.history;\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst chatText = messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\treturn chatText.trim();\n\t};\n\n\tconst downloadTxt = async () => {\n\t\tconst chatText = await getChatAsText();\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${chat.chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst [{ default: jsPDF }, { default: html2canvas }] = await Promise.all([\n\t\t\timport('jspdf'),\n\t\t\timport('html2canvas-pro')\n\t\t]);\n\n\t\tif ($settings?.stylizedPdfExport ?? true) {\n\t\t\tshowFullMessages = true;\n\t\t\tawait tick();\n\n\t\t\tconst containerElement = document.getElementById('full-messages-container');\n\t\t\tif (containerElement) {\n\t\t\t\ttry {\n\t\t\t\t\tconst isDarkMode = document.documentElement.classList.contains('dark');\n\t\t\t\t\tconst virtualWidth = 800; // px, fixed width for cloned element\n\n\t\t\t\t\t// Clone and style\n\t\t\t\t\tconst clonedElement = containerElement.cloneNode(true);\n\t\t\t\t\tclonedElement.classList.add('text-black');\n\t\t\t\t\tclonedElement.classList.add('dark:text-white');\n\t\t\t\t\tclonedElement.style.width = `${virtualWidth}px`;\n\t\t\t\t\tclonedElement.style.position = 'absolute';\n\t\t\t\t\tclonedElement.style.left = '-9999px';\n\t\t\t\t\tclonedElement.style.height = 'auto';\n\t\t\t\t\tdocument.body.appendChild(clonedElement);\n\n\t\t\t\t\t// Wait for DOM update/layout\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\n\t\t\t\t\t// Render entire content once\n\t\t\t\t\tconst canvas = await html2canvas(clonedElement, {\n\t\t\t\t\t\tbackgroundColor: isDarkMode ? '#000' : '#fff',\n\t\t\t\t\t\tuseCORS: true,\n\t\t\t\t\t\tscale: 2, // increase resolution\n\t\t\t\t\t\twidth: virtualWidth\n\t\t\t\t\t});\n\n\t\t\t\t\tdocument.body.removeChild(clonedElement);\n\n\t\t\t\t\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\t\t\t\t\tconst pageWidthMM = 210;\n\t\t\t\t\tconst pageHeightMM = 297;\n\n\t\t\t\t\t// Convert page height in mm to px on canvas scale for cropping\n\t\t\t\t\t// Get canvas DPI scale:\n\t\t\t\t\tconst pxPerMM = canvas.width / virtualWidth; // width in px / width in px?\n\t\t\t\t\t// Since 1 page width is 210 mm, but canvas width is 800 px at scale 2\n\t\t\t\t\t// Assume 1 mm = px / (pageWidthMM scaled)\n\t\t\t\t\t// Actually better: Calculate scale factor from px/mm:\n\t\t\t\t\t// virtualWidth px corresponds directly to 210mm in PDF, so pxPerMM:\n\t\t\t\t\tconst pxPerPDFMM = canvas.width / pageWidthMM; // canvas px per PDF mm\n\n\t\t\t\t\t// Height in px for one page slice:\n\t\t\t\t\tconst pagePixelHeight = Math.floor(pxPerPDFMM * pageHeightMM);\n\n\t\t\t\t\tlet offsetY = 0;\n\t\t\t\t\tlet page = 0;\n\n\t\t\t\t\twhile (offsetY < canvas.height) {\n\t\t\t\t\t\t// Height of slice\n\t\t\t\t\t\tconst sliceHeight = Math.min(pagePixelHeight, canvas.height - offsetY);\n\n\t\t\t\t\t\t// Create temp canvas for slice\n\t\t\t\t\t\tconst pageCanvas = document.createElement('canvas');\n\t\t\t\t\t\tpageCanvas.width = canvas.width;\n\t\t\t\t\t\tpageCanvas.height = sliceHeight;\n\n\t\t\t\t\t\tconst ctx = pageCanvas.getContext('2d');\n\n\t\t\t\t\t\t// Draw the slice of original canvas onto pageCanvas\n\t\t\t\t\t\tctx.drawImage(\n\t\t\t\t\t\t\tcanvas,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\toffsetY,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\tcanvas.width,\n\t\t\t\t\t\t\tsliceHeight\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst imgData = pageCanvas.toDataURL('image/jpeg', 0.7);\n\n\t\t\t\t\t\t// Calculate image height in PDF units keeping aspect ratio\n\t\t\t\t\t\tconst imgHeightMM = (sliceHeight * pageWidthMM) / canvas.width;\n\n\t\t\t\t\t\tif (page > 0) pdf.addPage();\n\n\t\t\t\t\t\tif (isDarkMode) {\n\t\t\t\t\t\t\tpdf.setFillColor(0, 0, 0);\n\t\t\t\t\t\t\tpdf.rect(0, 0, pageWidthMM, pageHeightMM, 'F'); // black bg\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpdf.addImage(imgData, 'JPEG', 0, 0, pageWidthMM, imgHeightMM);\n\n\t\t\t\t\t\toffsetY += sliceHeight;\n\t\t\t\t\t\tpage++;\n\t\t\t\t\t}\n\n\t\t\t\t\tpdf.save(`chat-${chat.chat.title}.pdf`);\n\n\t\t\t\t\tshowFullMessages = false;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Error generating PDF', error);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.log('Downloading PDF');\n\n\t\t\tconst chatText = await getChatAsText();\n\n\t\t\tconst doc = new jsPDF();\n\n\t\t\t// Margins\n\t\t\tconst left = 15;\n\t\t\tconst top = 20;\n\t\t\tconst right = 15;\n\t\t\tconst bottom = 20;\n\n\t\t\tconst pageWidth = doc.internal.pageSize.getWidth();\n\t\t\tconst pageHeight = doc.internal.pageSize.getHeight();\n\t\t\tconst usableWidth = pageWidth - left - right;\n\t\t\tconst usableHeight = pageHeight - top - bottom;\n\n\t\t\t// Font size and line height\n\t\t\tconst fontSize = 8;\n\t\t\tdoc.setFontSize(fontSize);\n\t\t\tconst lineHeight = fontSize * 1; // adjust if needed\n\n\t\t\t// Split the markdown into lines (handles \\n)\n\t\t\tconst paragraphs = chatText.split('\\n');\n\n\t\t\tlet y = top;\n\n\t\t\tfor (let paragraph of paragraphs) {\n\t\t\t\t// Wrap each paragraph to fit the width\n\t\t\t\tconst lines = doc.splitTextToSize(paragraph, usableWidth);\n\n\t\t\t\tfor (let line of lines) {\n\t\t\t\t\t// If the line would overflow the bottom, add a new page\n\t\t\t\t\tif (y + lineHeight > pageHeight - bottom) {\n\t\t\t\t\t\tdoc.addPage();\n\t\t\t\t\t\ty = top;\n\t\t\t\t\t}\n\t\t\t\t\tdoc.text(line, left, y);\n\t\t\t\t\ty += lineHeight * 0.5;\n\t\t\t\t}\n\t\t\t\t// Add empty line at paragraph breaks\n\t\t\t\ty += lineHeight * 0.1;\n\t\t\t}\n\n\t\t\tdoc.save(`chat-${chat.chat.title}.pdf`);\n\t\t}\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tif (chat.id) {\n\t\t\tlet chatObj = null;\n\n\t\t\tif ((chat?.id ?? '').startsWith('local') || $temporaryChatEnabled) {\n\t\t\t\tchatObj = chat;\n\t\t\t} else {\n\t\t\t\tchatObj = await getChatById(localStorage.token, chat.id);\n\t\t\t}\n\n\t\t\tlet blob = new Blob([JSON.stringify([chatObj])], {\n\t\t\t\ttype: 'application/json'\n\t\t\t});\n\t\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t\t}\n\t};\n</script>\n\n{#if showFullMessages}\n\t<div class=\"hidden w-full h-full flex-col\">\n\t\t<div id=\"full-messages-container\">\n\t\t\t<Messages\n\t\t\t\tclassName=\"h-full flex pt-4 pb-8 w-full\"\n\t\t\t\tchatId={`chat-preview-${chat?.id ?? ''}`}\n\t\t\t\tuser={$user}\n\t\t\t\treadOnly={true}\n\t\t\t\thistory={chat.chat.history}\n\t\t\t\tmessages={chat.chat.messages}\n\t\t\t\tautoScroll={true}\n\t\t\t\tsendMessage={() => {}}\n\t\t\t\tcontinueResponse={() => {}}\n\t\t\t\tregenerateResponse={() => {}}\n\t\t\t\tmessagesCount={null}\n\t\t\t\teditCodeBlock={false}\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t{#if $mobile && ($user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true))}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-controls-button\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<AdjustmentsHorizontal className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Controls')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\tawait showOverview.set(true);\n\t\t\t\t\tawait showArtifacts.set(false);\n\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Map className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Overview')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t{#if ($artifactContents ?? []).length > 0}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-overview-button\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait showControls.set(true);\n\t\t\t\t\t\tawait showArtifacts.set(true);\n\t\t\t\t\t\tawait showOverview.set(false);\n\t\t\t\t\t\tawait showEmbeds.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Cube className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Artifacts')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t{#if !$temporaryChatEnabled && ($user?.role === 'admin' || ($user.permissions?.chat?.share ?? true))}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\tid=\"chat-share-button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshareHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<Share strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t>\n\t\t\t\t\t<Download strokeWidth=\"1.5\" />\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user.permissions?.chat?.export ?? true)}\n\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\tid=\"chat-copy-button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tconst res = await copyToClipboard(await getChatAsText()).catch((e) => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\ttoast.success($i18n.t('Copied to clipboard'));\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Clipboard className=\" size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Copy')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t{#if !$temporaryChatEnabled && chat?.id}\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t\t{#if $folders.length > 0}\n\t\t\t\t\t<DropdownMenu.Sub>\n\t\t\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl select-none w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Move')}</div>\n\t\t\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\t\t\tclass=\"w-full rounded-2xl p-1 z-50 bg-white dark:bg-gray-850 dark:text-white border border-gray-100  dark:border-gray-800 shadow-lg max-h-52 overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\t\t\tsideOffset={8}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each $folders.sort((a, b) => b.updated_at - a.updated_at) as folder}\n\t\t\t\t\t\t\t\t{#if folder?.id}\n\t\t\t\t\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tmoveChatHandler(chat.id, folder.id);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Folder strokeWidth=\"1.5\" />\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center\">{folder.name ?? 'Folder'}</div>\n\t\t\t\t\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t\t\t</DropdownMenu.Sub>\n\t\t\t\t{/if}\n\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tarchiveChatHandler();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ArchiveBox className=\"size-4\" strokeWidth=\"1.5\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Archive')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1\" />\n\n\t\t\t\t<div class=\"flex p-1\">\n\t\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n\t<path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\tstroke-dasharray=\"2.5 3.5\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M9 12H12M15 12H12M12 12V9M12 12V15\" stroke-linecap=\"round\" stroke-linejoin=\"round\"\n\t></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M8 12L11 15L16 10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 13.8214 2.48697 15.5291 3.33782 17L2.5 21.5L7 20.6622C8.47087 21.513 10.1786 22 12 22Z\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tchatId,\n\t\tconfig,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowControls,\n\t\tshowSidebar,\n\t\ttemporaryChatEnabled,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from '$lib/components/layout/Navbar/Menu.svelte';\n\timport UserMenu from '$lib/components/layout/Sidebar/UserMenu.svelte';\n\timport AdjustmentsHorizontal from '../icons/AdjustmentsHorizontal.svelte';\n\n\timport PencilSquare from '../icons/PencilSquare.svelte';\n\timport Banner from '../common/Banner.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\n\timport ChatBubbleDotted from '../icons/ChatBubbleDotted.svelte';\n\timport ChatBubbleDottedChecked from '../icons/ChatBubbleDottedChecked.svelte';\n\n\timport EllipsisHorizontal from '../icons/EllipsisHorizontal.svelte';\n\timport ChatPlus from '../icons/ChatPlus.svelte';\n\timport ChatCheck from '../icons/ChatCheck.svelte';\n\timport Knobs from '../icons/Knobs.svelte';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let shareEnabled: boolean = false;\n\texport let scrollTop = 0;\n\n\texport let chat;\n\texport let history;\n\texport let selectedModels;\n\texport let showModelSelector = true;\n\n\texport let onSaveTempChat: () => {};\n\texport let archiveChatHandler: (id: string) => void;\n\texport let moveChatHandler: (id: string, folderId: string) => void;\n\n\tlet closedBannerIds = [];\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n\n<button\n\tid=\"new-chat-button\"\n\tclass=\"hidden\"\n\ton:click={() => {\n\t\tinitNewChat();\n\t}}\n\taria-label=\"New Chat\"\n/>\n\n<nav\n\tclass=\"sticky top-0 z-30 w-full {chat?.id\n\t\t? 'pt-0.5 pb-1'\n\t\t: 'pt-1 pb-1'} -mb-12 flex flex-col items-center drag-region\"\n>\n\t<div class=\"flex items-center w-full pl-1.5 pr-1\">\n\t\t<div\n\t\t\tid=\"navbar-bg-gradient-to-b\"\n\t\t\tclass=\"{chat?.id\n\t\t\t\t? 'visible'\n\t\t\t\t: 'invisible'} bg-linear-to-b via-40% to-97% from-white/90 via-white/50 to-transparent dark:from-gray-900/90 dark:via-gray-900/50 dark:to-transparent pointer-events-none absolute inset-0 -bottom-10 z-[-1]\"\n\t\t></div>\n\n\t\t<div class=\" flex max-w-full w-full mx-auto px-1.5 md:px-2 pt-0.5 bg-transparent\">\n\t\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t\t{#if $mobile && !$showSidebar}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"-translate-x-0.5 mr-1 mt-1 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={$showSidebar ? $i18n.t('Close Sidebar') : $i18n.t('Open Sidebar')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" cursor-pointer flex rounded-lg hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center p-1.5\">\n\t\t\t\t\t\t\t\t\t<Sidebar />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex-1 overflow-hidden max-w-full py-0.5\n\t\t\t{$showSidebar ? 'ml-1' : ''}\n\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t\t{#if $user?.role === 'user' ? ($user?.permissions?.chat?.temporary ?? true) && !($user?.permissions?.chat?.temporary_enforced ?? false) : true}\n\t\t\t\t\t\t{#if !chat?.id}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Temporary Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tif (($settings?.temporaryChatByDefault ?? false) && $temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\t// for proper initNewChat handling\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(null);\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tawait temporaryChatEnabled.set(!$temporaryChatEnabled);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tawait goto('/');\n\n\t\t\t\t\t\t\t\t\t\t// add 'temporary-chat=true' to the URL\n\t\t\t\t\t\t\t\t\t\tif ($temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', '?temporary-chat=true');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\twindow.history.replaceState(null, '', location.pathname);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t{#if $temporaryChatEnabled}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDottedChecked className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<ChatBubbleDotted className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else if $temporaryChatEnabled}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t(`Save Chat`)}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\t\tid=\"save-temporary-chat-button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tonSaveTempChat();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t\t<ChatCheck className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $mobile && !$temporaryChatEnabled && chat && chat.id}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"New Chat\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<ChatPlus className=\" size-4.5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if shareEnabled && chat && (chat.id || $temporaryChatEnabled)}\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tarchiveChatHandler={() => {\n\t\t\t\t\t\t\t\tarchiveChatHandler(chat.id);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<EllipsisHorizontal className=\" size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Controls')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\tawait showControls.set(!$showControls);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\taria-label=\"Controls\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t\t<Knobs className=\" size-5\" strokeWidth=\"1\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $user !== undefined && $user !== null}\n\t\t\t\t\t\t<UserMenu\n\t\t\t\t\t\t\tclassName=\"max-w-[240px]\"\n\t\t\t\t\t\t\trole={$user?.role}\n\t\t\t\t\t\t\thelp={true}\n\t\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-50 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t\t<span class=\"sr-only\">{$i18n.t('User menu')}</span>\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/users/${$user?.id}/profile/image`}\n\t\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</UserMenu>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $temporaryChatEnabled && ($chatId ?? '').startsWith('local:')}\n\t\t<div class=\" w-full z-30 text-center\">\n\t\t\t<div class=\"text-xs text-gray-500\">{$i18n.t('Temporary Chat')}</div>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"absolute top-[100%] left-0 right-0 h-fit\">\n\t\t{#if !history.currentId && !$chatId && ($banners.length > 0 || ($config?.license_metadata?.type ?? null) === 'trial' || (($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats))}\n\t\t\t<div class=\" w-full z-30\">\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#if ($config?.license_metadata?.type ?? null) === 'trial'}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'info',\n\t\t\t\t\t\t\t\ttitle: 'Trial License',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'You are currently using a trial license. Please contact support to upgrade your license.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if ($config?.license_metadata?.seats ?? null) !== null && $config?.user_count > $config?.license_metadata?.seats}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\tbanner={{\n\t\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\t\ttitle: 'License Error',\n\t\t\t\t\t\t\t\tcontent: $i18n.t(\n\t\t\t\t\t\t\t\t\t'Exceeded the number of seats in your license. Please contact support to increase the number of seats.'\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#each $banners.filter((b) => ![...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]'), ...closedBannerIds].includes(b.id)) as banner (banner.id)}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tif (banner.dismissible) {\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tclosedBannerIds = [...closedBannerIds, bannerId];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { config, functions, models, settings, tools, user } from '$lib/stores';\n\timport { createEventDispatcher, onMount, getContext, tick } from 'svelte';\n\n\timport {\n\t\tgetUserValvesSpecById as getToolUserValvesSpecById,\n\t\tgetUserValvesById as getToolUserValvesById,\n\t\tupdateUserValvesById as updateToolUserValvesById,\n\t\tgetTools\n\t} from '$lib/apis/tools';\n\timport {\n\t\tgetUserValvesSpecById as getFunctionUserValvesSpecById,\n\t\tgetUserValvesById as getFunctionUserValvesById,\n\t\tupdateUserValvesById as updateFunctionUserValvesById,\n\t\tgetFunctions\n\t} from '$lib/apis/functions';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Valves from '$lib/components/common/Valves.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\n\tlet tab = 'tools';\n\tlet selectedId = '';\n\n\tlet loading = false;\n\n\tlet valvesSpec = null;\n\tlet valves = {};\n\n\tlet debounceTimer;\n\n\tconst debounceSubmitHandler = async () => {\n\t\tif (debounceTimer) {\n\t\t\tclearTimeout(debounceTimer);\n\t\t}\n\n\t\t// Set a new timer\n\t\tdebounceTimer = setTimeout(() => {\n\t\t\tsubmitHandler();\n\t\t}, 500); // 0.5 second debounce\n\t};\n\n\tconst getUserValves = async () => {\n\t\tloading = true;\n\t\tif (tab === 'tools') {\n\t\t\tvalves = await getToolUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getToolUserValvesSpecById(localStorage.token, selectedId);\n\t\t} else if (tab === 'functions') {\n\t\t\tvalves = await getFunctionUserValvesById(localStorage.token, selectedId);\n\t\t\tvalvesSpec = await getFunctionUserValvesSpecById(localStorage.token, selectedId);\n\t\t}\n\n\t\tif (valvesSpec) {\n\t\t\t// Convert array to string\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? []).join(',');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (valvesSpec) {\n\t\t\t// Convert string to array\n\t\t\tfor (const property in valvesSpec.properties) {\n\t\t\t\tif (valvesSpec.properties[property]?.type === 'array') {\n\t\t\t\t\tvalves[property] = (valves[property] ?? '').split(',').map((v) => v.trim());\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tab === 'tools') {\n\t\t\t\tconst res = await updateToolUserValvesById(localStorage.token, selectedId, valves).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t} else if (tab === 'functions') {\n\t\t\t\tconst res = await updateFunctionUserValvesById(\n\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\tselectedId,\n\t\t\t\t\tvalves\n\t\t\t\t).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\ttoast.success($i18n.t('Valves updated'));\n\t\t\t\t\tvalves = res;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$: if (tab) {\n\t\tselectedId = '';\n\t}\n\n\t$: if (selectedId) {\n\t\tgetUserValves();\n\t}\n\n\t$: if (show) {\n\t\tinit();\n\t}\n\n\tconst init = async () => {\n\t\tloading = true;\n\n\t\tif ($functions === null) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif ($tools === null) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\n\t\tloading = false;\n\t};\n</script>\n\n{#if show && !loading}\n\t<form\n\t\tclass=\"flex flex-col h-full justify-between space-y-3 text-sm\"\n\t\ton:submit|preventDefault={() => {\n\t\t\tsubmitHandler();\n\t\t\tdispatch('save');\n\t\t}}\n\t>\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div class=\"space-y-1\">\n\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"  w-full rounded-sm text-xs py-2 px-1 bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={tab}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Select')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"tools\" class=\"bg-gray-100 dark:bg-gray-800\">{$i18n.t('Tools')}</option>\n\t\t\t\t\t\t\t<option value=\"functions\" class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t>{$i18n.t('Functions')}</option\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"w-full rounded-sm py-2 px-1 text-xs bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={selectedId}\n\t\t\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if tab === 'tools'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a tool')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $tools.filter((tool) => !tool?.id?.startsWith('server:')) as tool, toolIdx}\n\t\t\t\t\t\t\t\t\t<option value={tool.id} class=\"bg-gray-100 dark:bg-gray-800\">{tool.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{:else if tab === 'functions'}\n\t\t\t\t\t\t\t\t<option value=\"\" selected disabled class=\"bg-gray-100 dark:bg-gray-800\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t('Select a function')}</option\n\t\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t\t{#each $functions as func, funcIdx}\n\t\t\t\t\t\t\t\t\t<option value={func.id} class=\"bg-gray-100 dark:bg-gray-800\">{func.name}</option>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedId}\n\t\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1 w-full\" />\n\n\t\t\t\t<div class=\"my-2 text-xs\">\n\t\t\t\t\t{#if !loading}\n\t\t\t\t\t\t<Valves\n\t\t\t\t\t\t\t{valvesSpec}\n\t\t\t\t\t\t\tbind:valves\n\t\t\t\t\t\t\ton:change={() => {\n\t\t\t\t\t\t\t\tdebounceSubmitHandler();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</form>\n{:else}\n\t<Spinner className=\"size-4\" />\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport AdvancedParams from '../Settings/Advanced/AdvancedParams.svelte';\n\timport Valves from '$lib/components/chat/Controls/Valves.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\timport { user, settings } from '$lib/stores';\n\texport let models = [];\n\texport let chatFiles = [];\n\texport let params = {};\n\n\tlet showValves = false;\n</script>\n\n<div class=\" dark:text-white\">\n\t<div class=\" flex items-center justify-between dark:text-gray-100 mb-2\">\n\t\t<div class=\" text-lg font-medium self-center font-primary\">{$i18n.t('Chat Controls')}</div>\n\t\t<button\n\t\t\tclass=\"self-center\"\n\t\t\ton:click={() => {\n\t\t\t\tdispatch('close');\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-3.5\" />\n\t\t</button>\n\t</div>\n\n\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.controls ?? true)}\n\t\t<div class=\" dark:text-gray-200 text-sm font-primary py-0.5 px-0.5\">\n\t\t\t{#if chatFiles.length > 0}\n\t\t\t\t<Collapsible title={$i18n.t('Files')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"flex flex-col gap-1 mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t{#each chatFiles as file, fileIdx}\n\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\turl={file?.url ? file.url : null}\n\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t// Remove the file from the chatFiles array\n\n\t\t\t\t\t\t\t\t\tchatFiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\tchatFiles = chatFiles;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.valves ?? true)}\n\t\t\t\t<Collapsible bind:open={showValves} title={$i18n.t('Valves')} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm\" slot=\"content\">\n\t\t\t\t\t\t<Valves show={showValves} />\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.system_prompt ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('System Prompt')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"\" slot=\"content\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tbind:value={params.system}\n\t\t\t\t\t\t\tclass=\"w-full text-xs outline-hidden resize-vertical {$settings.highContrastMode\n\t\t\t\t\t\t\t\t? 'border-2 border-gray-300 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800 p-2.5'\n\t\t\t\t\t\t\t\t: 'py-1.5 bg-transparent'}\"\n\t\t\t\t\t\t\trows=\"4\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Enter system prompt')}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\n\t\t\t\t<hr class=\"my-2 border-gray-50 dark:border-gray-700/10\" />\n\t\t\t{/if}\n\n\t\t\t{#if $user?.role === 'admin' || ($user?.permissions.chat?.params ?? true)}\n\t\t\t\t<Collapsible title={$i18n.t('Advanced Params')} open={true} buttonClassName=\"w-full\">\n\t\t\t\t\t<div class=\"text-sm mt-1.5\" slot=\"content\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<AdvancedParams admin={$user?.role === 'admin'} custom={true} bind:params />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Collapsible>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg p-1 border border-gray-100  dark:border-gray-800 z-9999 bg-white dark:bg-gray-900 dark:text-white shadow-xs\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, models, settings, showCallOverlay, TTSWorker } from '$lib/stores';\n\timport { onMount, tick, getContext, onDestroy, createEventDispatcher } from 'svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { blobToFile } from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let files;\n\texport let chatId;\n\texport let modelId;\n\n\tlet wakeLock = null;\n\n\tlet model = null;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioStream = null;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(\n\t\t\tlocalStorage.token,\n\t\t\tfile,\n\t\t\t$settings?.audio?.stt?.language\n\t\t).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (audioStream) {\n\t\t\t\tconst tracks = audioStream.getTracks();\n\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t}\n\t\t\taudioStream = null;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tif ($showCallOverlay) {\n\t\t\tif (!audioStream) {\n\t\t\t\taudioStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: {\n\t\t\t\t\t\techoCancellation: true,\n\t\t\t\t\t\tnoiseSuppression: true,\n\t\t\t\t\t\tautoGainControl: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tmediaRecorder = new MediaRecorder(audioStream);\n\n\t\t\tmediaRecorder.onstart = () => {\n\t\t\t\tconsole.log('Recording started');\n\t\t\t\taudioChunks = [];\n\t\t\t};\n\n\t\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\taudioChunks.push(event.data);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tmediaRecorder.onstop = (e) => {\n\t\t\t\tconsole.log('Recording stopped', audioStream, e);\n\t\t\t\tstopRecordingCallback();\n\t\t\t};\n\n\t\t\tanalyseAudio(audioStream);\n\t\t}\n\t};\n\n\tconst stopAudioStream = async () => {\n\t\ttry {\n\t\t\tif (mediaRecorder) {\n\t\t\t\tmediaRecorder.stop();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('Error stopping audio stream:', error);\n\t\t}\n\n\t\tif (!audioStream) return;\n\n\t\taudioStream.getAudioTracks().forEach(function (track) {\n\t\t\ttrack.stop();\n\t\t});\n\n\t\taudioStream = null;\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking && !($settings?.voiceInterruption ?? false)) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\n\t\t\t\t\tif (mediaRecorder && mediaRecorder.state !== 'recording') {\n\t\t\t\t\t\tmediaRecorder.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\t// Get voice: model-specific > user settings > config default\n\tconst getVoiceId = () => {\n\t\t// Check for model-specific TTS voice first\n\t\tif (model?.info?.meta?.tts?.voice) {\n\t\t\treturn model.info.meta.tts.voice;\n\t\t}\n\t\t// Fall back to user settings or config default\n\t\tif ($settings?.audio?.tts?.defaultVoice === $config.audio.tts.voice) {\n\t\t\treturn $settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice;\n\t\t}\n\t\treturn $config?.audio?.tts?.voice;\n\t};\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voiceId = getVoiceId();\n\t\t\t\t\t\tconst voice = voices?.filter((v) => v.voiceURI === voiceId)?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\t\t\t\t\t\tcurrentUtterance.rate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement') as HTMLAudioElement;\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\t\t\t\t\taudioElement.playbackRate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\t\tconst url = await $TTSWorker\n\t\t\t\t\t\t.generate({\n\t\t\t\t\t\t\ttext: content,\n\t\t\t\t\t\t\tvoice: getVoiceId()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (url) {\n\t\t\t\t\t\taudioCache.set(content, new Audio(url));\n\t\t\t\t\t}\n\t\t\t\t} else if ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(localStorage.token, getVoiceId(), content).catch(\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tconst chatStartHandler = async (e) => {\n\t\tconst { id } = e.detail;\n\n\t\tchatStreaming = true;\n\n\t\tif (currentMessageId !== id) {\n\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\tcurrentMessageId = id;\n\t\t\tif (audioAbortController) {\n\t\t\t\taudioAbortController.abort();\n\t\t\t}\n\t\t\taudioAbortController = new AbortController();\n\n\t\t\tassistantSpeaking = true;\n\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t}\n\t};\n\n\tconst chatEventHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"id\" here is message id\n\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t// \"content\" here is a sentence from the assistant,\n\t\t// there will be many sentences for the same \"id\"\n\n\t\tif (currentMessageId === id) {\n\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\ttry {\n\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t} else {\n\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t}\n\n\t\t\t\tconsole.log(content);\n\n\t\t\t\tfetchAudio(content);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst chatFinishHandler = async (e) => {\n\t\tconst { id, content } = e.detail;\n\t\t// \"content\" here is the entire message from the assistant\n\t\tfinishedMessages[id] = true;\n\n\t\tchatStreaming = false;\n\t};\n\n\tonMount(async () => {\n\t\tconst setWakeLock = async () => {\n\t\t\ttry {\n\t\t\t\twakeLock = await navigator.wakeLock.request('screen');\n\t\t\t} catch (err) {\n\t\t\t\t// The Wake Lock request has failed - usually system related, such as battery.\n\t\t\t\tconsole.log(err);\n\t\t\t}\n\n\t\t\tif (wakeLock) {\n\t\t\t\t// Add a listener to release the wake lock when the page is unloaded\n\t\t\t\twakeLock.addEventListener('release', () => {\n\t\t\t\t\t// the wake lock has been released\n\t\t\t\t\tconsole.log('Wake Lock released');\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\tif ('wakeLock' in navigator) {\n\t\t\tawait setWakeLock();\n\n\t\t\tdocument.addEventListener('visibilitychange', async () => {\n\t\t\t\t// Re-request the wake lock if the document becomes visible\n\t\t\t\tif (wakeLock !== null && document.visibilityState === 'visible') {\n\t\t\t\t\tawait setWakeLock();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tmodel = $models.find((m) => m.id === modelId);\n\n\t\tstartRecording();\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\tawait stopAllAudio();\n\n\t\t\tstopAudioStream();\n\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n\n\tonDestroy(async () => {\n\t\tawait stopAllAudio();\n\t\tawait stopRecordingCallback(false);\n\t\tawait stopCamera();\n\n\t\tawait stopAudioStream();\n\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\t\taudioAbortController.abort();\n\n\t\tawait tick();\n\n\t\tawait stopAllAudio();\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\"max-w-lg w-full h-full max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t{#if camera}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{#if emoji}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{emoji}\n\t\t\t\t\t</div>\n\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t>\n\t\t\t\t{:else}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all rounded-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\t\tstyle={`background-image: url('${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}&voice=true');`}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t\t<!-- navbar -->\n\t\t\t</button>\n\t\t{/if}\n\n\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t{#if !camera}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-44'\n\t\t\t\t\t\t\t\t\t\t: 'size-40'} transition-all rounded-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\t\t\tstyle={`background-image: url('${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}&voice=true');`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t{:else}\n\t\t\t\t<div class=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\">\n\t\t\t\t\t<!-- svelte-ignore a11y-media-has-caption -->\n\t\t\t\t\t<video\n\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t/>\n\n\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\n\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t<div>\n\t\t\t\t{#if camera}\n\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t{:else}\n\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait stopAudioStream();\n\t\t\t\t\t\tawait stopVideoStream();\n\n\t\t\t\t\t\tconsole.log(audioStream);\n\t\t\t\t\t\tconsole.log(cameraStream);\n\n\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t}}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, getContext, createEventDispatcher } from 'svelte';\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport {\n\t\tartifactCode,\n\t\tchatId,\n\t\tsettings,\n\t\tshowArtifacts,\n\t\tshowControls,\n\t\tartifactContents\n\t} from '$lib/stores';\n\timport { copyToClipboard, createMessagesList } from '$lib/utils';\n\n\timport XMark from '../icons/XMark.svelte';\n\timport ArrowsPointingOut from '../icons/ArrowsPointingOut.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport SvgPanZoom from '../common/SVGPanZoom.svelte';\n\timport ArrowLeft from '../icons/ArrowLeft.svelte';\n\timport Download from '../icons/Download.svelte';\n\n\texport let overlay = false;\n\n\tlet contents: Array<{ type: string; content: string }> = [];\n\tlet selectedContentIdx = 0;\n\n\tlet copied = false;\n\tlet iframeElement: HTMLIFrameElement;\n\n\tfunction navigateContent(direction: 'prev' | 'next') {\n\t\tselectedContentIdx =\n\t\t\tdirection === 'prev'\n\t\t\t\t? Math.max(selectedContentIdx - 1, 0)\n\t\t\t\t: Math.min(selectedContentIdx + 1, contents.length - 1);\n\t}\n\n\tconst iframeLoadHandler = () => {\n\t\tiframeElement.contentWindow.addEventListener(\n\t\t\t'click',\n\t\t\tfunction (e) {\n\t\t\t\tconst target = e.target.closest('a');\n\t\t\t\tif (target && target.href) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst url = new URL(target.href, iframeElement.baseURI);\n\t\t\t\t\tif (url.origin === window.location.origin) {\n\t\t\t\t\t\tiframeElement.contentWindow.history.pushState(\n\t\t\t\t\t\t\tnull,\n\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\turl.pathname + url.search + url.hash\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.info('External navigation blocked:', url.href);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\t// Cancel drag when hovering over iframe\n\t\tiframeElement.contentWindow.addEventListener('mouseenter', function (e) {\n\t\t\te.preventDefault();\n\t\t\tiframeElement.contentWindow.addEventListener('dragstart', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\t\t});\n\t};\n\n\tconst showFullScreen = () => {\n\t\tif (iframeElement.requestFullscreen) {\n\t\t\tiframeElement.requestFullscreen();\n\t\t} else if (iframeElement.webkitRequestFullscreen) {\n\t\t\tiframeElement.webkitRequestFullscreen();\n\t\t} else if (iframeElement.msRequestFullscreen) {\n\t\t\tiframeElement.msRequestFullscreen();\n\t\t}\n\t};\n\n\tconst downloadArtifact = () => {\n\t\tconst blob = new Blob([contents[selectedContentIdx].content], { type: 'text/html' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `artifact-${$chatId}-${selectedContentIdx}.html`;\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tdocument.body.removeChild(a);\n\t\tURL.revokeObjectURL(url);\n\t};\n\n\tonMount(() => {\n\t\tartifactCode.subscribe((value) => {\n\t\t\tif (contents) {\n\t\t\t\tconst codeIdx = contents.findIndex((content) => content.content.includes(value));\n\t\t\t\tselectedContentIdx = codeIdx !== -1 ? codeIdx : 0;\n\t\t\t}\n\t\t});\n\n\t\tartifactContents.subscribe((value) => {\n\t\t\tcontents = value;\n\t\t\tconsole.log('Artifact contents updated:', contents);\n\n\t\t\tif (contents.length === 0) {\n\t\t\t\tshowControls.set(false);\n\t\t\t\tshowArtifacts.set(false);\n\t\t\t}\n\n\t\t\tselectedContentIdx = contents ? contents.length - 1 : 0;\n\t\t});\n\t});\n</script>\n\n<div\n\tclass=\" w-full h-full relative flex flex-col bg-white dark:bg-gray-850\"\n\tid=\"artifacts-container\"\n>\n\t<div class=\"w-full h-full flex flex-col flex-1 relative\">\n\t\t{#if contents.length > 0}\n\t\t\t<div\n\t\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center p-2.5 font-primar text-gray-900 dark:text-white\"\n\t\t\t>\n\t\t\t\t<div class=\"flex-1 flex items-center justify-between pr-1\">\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('prev')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<div class=\"text-xs self-center dark:text-gray-100 min-w-fit\">\n\t\t\t\t\t\t\t\t{$i18n.t('Version {{selectedVersion}} of {{totalVersions}}', {\n\t\t\t\t\t\t\t\t\tselectedVersion: selectedContentIdx + 1,\n\t\t\t\t\t\t\t\t\ttotalVersions: contents.length\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\ton:click={() => navigateContent('next')}\n\t\t\t\t\t\t\t\tdisabled={contents.length <= 1}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"copy-code-button bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md px-1.5 py-0.5\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tcopyToClipboard(contents[selectedContentIdx].content);\n\t\t\t\t\t\t\t\tcopied = true;\n\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tcopied = false;\n\t\t\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t\t\t}}>{copied ? $i18n.t('Copied') : $i18n.t('Copy')}</button\n\t\t\t\t\t\t>\n\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Download')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\ton:click={downloadArtifact}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Download className=\"size-3.5\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Open in full screen')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" bg-none border-none text-xs bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-md p-0.5\"\n\t\t\t\t\t\t\t\t\ton:click={showFullScreen}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ArrowsPointingOut className=\"size-3.5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<button\n\t\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('close');\n\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\tshowArtifacts.set(false);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#if overlay}\n\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t{/if}\n\n\t\t<div class=\"flex-1 w-full h-full\">\n\t\t\t<div class=\" h-full flex flex-col\">\n\t\t\t\t{#if contents.length > 0}\n\t\t\t\t\t<div class=\"max-w-full w-full h-full\">\n\t\t\t\t\t\t{#if contents[selectedContentIdx].type === 'iframe'}\n\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\tbind:this={iframeElement}\n\t\t\t\t\t\t\t\ttitle=\"Content\"\n\t\t\t\t\t\t\t\tsrcdoc={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t\tclass=\"w-full border-0 h-full rounded-none\"\n\t\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-downloads{($settings?.iframeSandboxAllowForms ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-forms'\n\t\t\t\t\t\t\t\t\t: ''}{($settings?.iframeSandboxAllowSameOrigin ?? false)\n\t\t\t\t\t\t\t\t\t? ' allow-same-origin'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ton:load={iframeLoadHandler}\n\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t{:else if contents[selectedContentIdx].type === 'svg'}\n\t\t\t\t\t\t\t<SvgPanZoom\n\t\t\t\t\t\t\t\tclassName=\" w-full h-full max-h-full overflow-hidden\"\n\t\t\t\t\t\t\t\tsvg={contents[selectedContentIdx].content}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t<div class=\"m-auto font-medium text-xs text-gray-900 dark:text-white\">\n\t\t\t\t\t\t{$i18n.t('No HTML, CSS, or JavaScript content found.')}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { embed, showControls, showEmbeds } from '$lib/stores';\n\n\timport FullHeightIframe from '$lib/components/common/FullHeightIframe.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\texport let overlay = false;\n\n\tconst getSrcUrl = (url: string, chatId?: string, messageId?: string, sourceId: string) => {\n\t\ttry {\n\t\t\tconst parsed = new URL(url);\n\n\t\t\tif (chatId) {\n\t\t\t\tparsed.searchParams.set('chat_id', chatId);\n\t\t\t}\n\n\t\t\tif (messageId) {\n\t\t\t\tparsed.searchParams.set('message_id', messageId);\n\t\t\t}\n\n\t\t\tif (sourceId) {\n\t\t\t\tparsed.searchParams.set('source_id', sourceId);\n\t\t\t}\n\n\t\t\treturn parsed.toString();\n\t\t} catch {\n\t\t\t// Fallback for relative URLs or invalid input\n\t\t\tconst hasQuery = url.includes('?');\n\t\t\tconst parts = [];\n\n\t\t\tif (chatId) parts.push(`chat_id=${encodeURIComponent(chatId)}`);\n\t\t\tif (messageId) parts.push(`message_id=${encodeURIComponent(messageId)}`);\n\t\t\tif (sourceId) parts.push(`source_id=${encodeURIComponent(sourceId)}`);\n\n\t\t\tif (parts.length === 0) return url;\n\n\t\t\treturn url + (hasQuery ? '&' : '?') + parts.join('&');\n\t\t}\n\t};\n</script>\n\n{#if $embed}\n\t<div class=\"h-full w-full\">\n\t\t<div\n\t\t\tclass=\"pointer-events-auto z-20 flex justify-between items-center py-3 px-2 font-primar text-gray-900 dark:text-white\"\n\t\t>\n\t\t\t<div class=\"flex-1 flex items-center justify-between pl-2\">\n\t\t\t\t<a\n\t\t\t\t\tclass=\"flex items-center space-x-2 hover:underline\"\n\t\t\t\t\thref={$embed?.url}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t>\n\t\t\t\t\t{$embed?.title ?? 'Embedded Content'}\n\t\t\t\t</a>\n\t\t\t</div>\n\n\t\t\t<button\n\t\t\t\tclass=\"self-center pointer-events-auto p-1 rounded-full bg-white dark:bg-gray-850\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\tshowEmbeds.set(false);\n\t\t\t\t\tembed.set(null);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className=\"size-3.5 text-gray-900 dark:text-white\" />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\" w-full h-full relative\">\n\t\t\t{#if overlay}\n\t\t\t\t<div class=\" absolute top-0 left-0 right-0 bottom-0 z-10\"></div>\n\t\t\t{/if}\n\n\t\t\t<FullHeightIframe\n\t\t\t\tsrc={getSrcUrl($embed?.url ?? '', $embed?.chatId, $embed?.messageId, $embed?.sourceId)}\n\t\t\t\tpayload={$embed?.source ?? null}\n\t\t\t\tiframeClassName=\"w-full h-full\"\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { SvelteFlowProvider } from '@xyflow/svelte';\n\timport { slide } from 'svelte/transition';\n\timport { Pane, PaneResizer } from 'paneforge';\n\n\timport { onDestroy, onMount, tick } from 'svelte';\n\timport {\n\t\tmobile,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tshowOverview,\n\t\tshowArtifacts,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\n\timport Controls from './Controls/Controls.svelte';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport Drawer from '../common/Drawer.svelte';\n\timport Artifacts from './Artifacts.svelte';\n\timport Embeds from './ChatControls/Embeds.svelte';\n\n\texport let history;\n\texport let models = [];\n\n\texport let chatId = null;\n\n\texport let chatFiles = [];\n\texport let params = {};\n\n\texport let eventTarget: EventTarget;\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\texport let showMessage: Function;\n\texport let files;\n\texport let modelId;\n\n\texport let pane;\n\n\tlet mediaQuery;\n\tlet largeScreen = false;\n\tlet dragged = false;\n\n\tlet minSize = 0;\n\n\texport const openPane = () => {\n\t\tif (parseInt(localStorage?.chatControlsSize)) {\n\t\t\tconst container = document.getElementById('chat-container');\n\t\t\tlet size = Math.floor(\n\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t);\n\t\t\tpane.resize(size);\n\t\t} else {\n\t\t\tpane.resize(minSize);\n\t\t}\n\t};\n\n\tconst handleMediaQuery = async (e) => {\n\t\tif (e.matches) {\n\t\t\tlargeScreen = true;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t} else {\n\t\t\tlargeScreen = false;\n\n\t\t\tif ($showCallOverlay) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tawait tick();\n\t\t\t\tshowCallOverlay.set(true);\n\t\t\t}\n\t\t\tpane = null;\n\t\t}\n\t};\n\n\tconst onMouseDown = (event) => {\n\t\tdragged = true;\n\t};\n\n\tconst onMouseUp = (event) => {\n\t\tdragged = false;\n\t};\n\n\tonMount(() => {\n\t\t// listen to resize 1024px\n\t\tmediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\t\thandleMediaQuery(mediaQuery);\n\n\t\t// Select the container element you want to observe\n\t\tconst container = document.getElementById('chat-container');\n\n\t\t// initialize the minSize based on the container width\n\t\tminSize = Math.floor((350 / container.clientWidth) * 100);\n\n\t\t// Create a new ResizeObserver instance\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (let entry of entries) {\n\t\t\t\tconst width = entry.contentRect.width;\n\t\t\t\t// calculate the percentage of 350px\n\t\t\t\tconst percentage = (350 / width) * 100;\n\t\t\t\t// set the minSize to the percentage, must be an integer\n\t\t\t\tminSize = Math.floor(percentage);\n\n\t\t\t\tif ($showControls) {\n\t\t\t\t\tif (pane && pane.isExpanded() && pane.getSize() < minSize) {\n\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet size = Math.floor(\n\t\t\t\t\t\t\t(parseInt(localStorage?.chatControlsSize) / container.clientWidth) * 100\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (size < minSize) {\n\t\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Start observing the container's size changes\n\t\tresizeObserver.observe(container);\n\n\t\tdocument.addEventListener('mousedown', onMouseDown);\n\t\tdocument.addEventListener('mouseup', onMouseUp);\n\t});\n\n\tonDestroy(() => {\n\t\tshowControls.set(false);\n\n\t\tmediaQuery.removeEventListener('change', handleMediaQuery);\n\t\tdocument.removeEventListener('mousedown', onMouseDown);\n\t\tdocument.removeEventListener('mouseup', onMouseUp);\n\t});\n\n\tconst closeHandler = () => {\n\t\tshowControls.set(false);\n\t\tshowOverview.set(false);\n\t\tshowArtifacts.set(false);\n\t\tshowEmbeds.set(false);\n\n\t\tif ($showCallOverlay) {\n\t\t\tshowCallOverlay.set(false);\n\t\t}\n\t};\n\n\t$: if (!chatId) {\n\t\tcloseHandler();\n\t}\n</script>\n\n{#if !largeScreen}\n\t{#if $showControls}\n\t\t<Drawer\n\t\t\tshow={$showControls}\n\t\t\tonClose={() => {\n\t\t\t\tshowControls.set(false);\n\t\t\t}}\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" {$showCallOverlay || $showOverview || $showArtifacts || $showEmbeds\n\t\t\t\t\t? ' h-screen  w-full'\n\t\t\t\t\t: 'px-4 py-3'} h-full\"\n\t\t\t>\n\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" h-full max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t<Embeds />\n\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t<Artifacts {history} />\n\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/await}\n\t\t\t\t{:else}\n\t\t\t\t\t<Controls\n\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{models}\n\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\tbind:params\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</Drawer>\n\t{/if}\n{:else}\n\t<!-- if $showControls -->\n\n\t{#if $showControls}\n\t\t<PaneResizer\n\t\t\tclass=\"relative flex items-center justify-center group border-l border-gray-50 dark:border-gray-850/30 hover:border-gray-200 dark:hover:border-gray-800  transition z-20\"\n\t\t\tid=\"controls-resizer\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\" absolute -left-1.5 -right-1.5 -top-0 -bottom-0 z-20 cursor-col-resize bg-transparent\"\n\t\t\t/>\n\t\t</PaneResizer>\n\t{/if}\n\n\t<Pane\n\t\tbind:pane\n\t\tdefaultSize={0}\n\t\tonResize={(size) => {\n\t\t\tif ($showControls && pane.isExpanded()) {\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t}\n\n\t\t\t\tif (size < minSize) {\n\t\t\t\t\tlocalStorage.chatControlsSize = 0;\n\t\t\t\t} else {\n\t\t\t\t\t// save the size in  pixels to localStorage\n\t\t\t\t\tconst container = document.getElementById('chat-container');\n\t\t\t\t\tlocalStorage.chatControlsSize = Math.floor((size / 100) * container.clientWidth);\n\t\t\t\t}\n\t\t\t}\n\t\t}}\n\t\tonCollapse={() => {\n\t\t\tshowControls.set(false);\n\t\t}}\n\t\tcollapsible={true}\n\t\tclass=\" z-10 bg-white dark:bg-gray-850\"\n\t>\n\t\t{#if $showControls}\n\t\t\t<div class=\"flex max-h-full min-h-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full {($showOverview || $showArtifacts || $showEmbeds) && !$showCallOverlay\n\t\t\t\t\t\t? ' '\n\t\t\t\t\t\t: 'px-4 py-3 bg-white dark:shadow-lg dark:bg-gray-850 '} z-40 pointer-events-auto overflow-y-auto scrollbar-hidden\"\n\t\t\t\t\tid=\"controls-container\"\n\t\t\t\t>\n\t\t\t\t\t{#if $showCallOverlay}\n\t\t\t\t\t\t<div class=\"w-full h-full flex justify-center\">\n\t\t\t\t\t\t\t<CallOverlay\n\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t{modelId}\n\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t{eventTarget}\n\t\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if $showEmbeds}\n\t\t\t\t\t\t<Embeds overlay={dragged} />\n\t\t\t\t\t{:else if $showArtifacts}\n\t\t\t\t\t\t<Artifacts {history} overlay={dragged} />\n\t\t\t\t\t{:else if $showOverview}\n\t\t\t\t\t\t{#await import('./Overview.svelte') then { default: Overview }}\n\t\t\t\t\t\t\t<Overview\n\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\tonNodeClick={(e) => {\n\t\t\t\t\t\t\t\t\tconst node = e.node;\n\t\t\t\t\t\t\t\t\tif (node?.data?.message?.favorite) {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\thistory.messages[node.data.message.id].favorite = null;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tshowMessage(node.data.message, true);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/await}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Controls\n\t\t\t\t\t\t\ton:close={() => {\n\t\t\t\t\t\t\t\tshowControls.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t{models}\n\t\t\t\t\t\t\tbind:chatFiles\n\t\t\t\t\t\t\tbind:params\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</Pane>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport dayjs from 'dayjs';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\timport { getTimeRange } from '$lib/utils';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport Loader from '$lib/components/common/Loader.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\n\tdayjs.extend(localizedFormat);\n\n\texport let chats = [];\n\n\texport let chatListLoading = false;\n\texport let allChatsLoaded = false;\n\n\texport let loadHandler: Function = null;\n\n\tlet chatList = null;\n\n\tconst init = async () => {\n\t\tif (chats.length === 0) {\n\t\t\tchatList = [];\n\t\t} else {\n\t\t\tchatList = chats.map((chat) => ({\n\t\t\t\t...chat,\n\t\t\t\ttime_range: getTimeRange(chat.updated_at)\n\t\t\t}));\n\n\t\t\tchatList.sort((a, b) => {\n\t\t\t\tif (direction === 'asc') {\n\t\t\t\t\treturn a[orderBy] > b[orderBy] ? 1 : -1;\n\t\t\t\t} else {\n\t\t\t\t\treturn a[orderBy] < b[orderBy] ? 1 : -1;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\tconst setSortKey = (key) => {\n\t\tif (orderBy === key) {\n\t\t\tdirection = direction === 'asc' ? 'desc' : 'asc';\n\t\t} else {\n\t\t\torderBy = key;\n\t\t\tdirection = 'asc';\n\t\t}\n\n\t\tinit();\n\t};\n\n\tlet orderBy = 'updated_at';\n\tlet direction = 'desc'; // 'asc' or 'desc'\n\n\t$: if (chats) {\n\t\tinit();\n\t}\n</script>\n\n{#if chatList}\n\t{#if chatList.length > 0}\n\t\t<div class=\"flex text-xs font-medium mb-1 items-center -mr-0.5\">\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none basis-3/5\"\n\t\t\t\ton:click={() => setSortKey('title')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Title')}\n\n\t\t\t\t\t{#if orderBy === 'title'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<button\n\t\t\t\tclass=\"px-1.5 py-1 cursor-pointer select-none hidden sm:flex sm:basis-2/5 justify-end\"\n\t\t\t\ton:click={() => setSortKey('updated_at')}\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-1.5 items-center\">\n\t\t\t\t\t{$i18n.t('Updated at')}\n\n\t\t\t\t\t{#if orderBy === 'updated_at'}\n\t\t\t\t\t\t<span class=\"font-normal\"\n\t\t\t\t\t\t\t>{#if direction === 'asc'}\n\t\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<ChevronDown className=\"size-2\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<span class=\"invisible\">\n\t\t\t\t\t\t\t<ChevronUp className=\"size-2\" />\n\t\t\t\t\t\t</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t</div>\n\t{/if}\n\n\t<div class=\"text-left text-sm w-full mb-3\">\n\t\t{#if chatList.length === 0}\n\t\t\t<div\n\t\t\t\tclass=\"text-xs text-gray-500 dark:text-gray-400 text-center px-5 min-h-20 w-full h-full flex justify-center items-center\"\n\t\t\t>\n\t\t\t\t{$i18n.t('No chats found')}\n\t\t\t</div>\n\t\t{/if}\n\n\t\t{#each chatList as chat, idx (chat.id)}\n\t\t\t{#if (idx === 0 || (idx > 0 && chat.time_range !== chatList[idx - 1].time_range)) && chat?.time_range}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-full text-xs text-gray-500 dark:text-gray-500 font-medium {idx === 0\n\t\t\t\t\t\t? ''\n\t\t\t\t\t\t: 'pt-5'} pb-2 px-2\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(chat.time_range)}\n\t\t\t\t\t<!-- localisation keys for time_range to be recognized from the i18next parser (so they don't get automatically removed):\n\t\t\t\t\t\t\t{$i18n.t('Today')}\n\t\t\t\t\t\t\t{$i18n.t('Yesterday')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 7 days')}\n\t\t\t\t\t\t\t{$i18n.t('Previous 30 days')}\n\t\t\t\t\t\t\t{$i18n.t('January')}\n\t\t\t\t\t\t\t{$i18n.t('February')}\n\t\t\t\t\t\t\t{$i18n.t('March')}\n\t\t\t\t\t\t\t{$i18n.t('April')}\n\t\t\t\t\t\t\t{$i18n.t('May')}\n\t\t\t\t\t\t\t{$i18n.t('June')}\n\t\t\t\t\t\t\t{$i18n.t('July')}\n\t\t\t\t\t\t\t{$i18n.t('August')}\n\t\t\t\t\t\t\t{$i18n.t('September')}\n\t\t\t\t\t\t\t{$i18n.t('October')}\n\t\t\t\t\t\t\t{$i18n.t('November')}\n\t\t\t\t\t\t\t{$i18n.t('December')}\n\t\t\t\t\t\t\t-->\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<a\n\t\t\t\tclass=\" w-full flex justify-between items-center rounded-lg text-sm py-2 px-3 hover:bg-gray-50 dark:hover:bg-gray-850\"\n\t\t\t\tdraggable=\"false\"\n\t\t\t\thref={`/c/${chat.id}`}\n\t\t\t\ton:click={() => (show = false)}\n\t\t\t>\n\t\t\t\t<div class=\"text-ellipsis line-clamp-1 w-full sm:basis-3/5\">\n\t\t\t\t\t{chat?.title}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"hidden sm:flex sm:basis-2/5 items-center justify-end\">\n\t\t\t\t\t<div class=\" text-gray-500 dark:text-gray-400 text-xs\">\n\t\t\t\t\t\t{dayjs(chat?.updated_at * 1000).calendar()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/each}\n\n\t\t{#if !allChatsLoaded && loadHandler}\n\t\t\t<Loader\n\t\t\t\ton:visible={(e) => {\n\t\t\t\t\tif (!chatListLoading) {\n\t\t\t\t\t\tloadHandler();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\"w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t<div class=\" \">Loading...</div>\n\t\t\t\t</div>\n\t\t\t</Loader>\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport type { Writable } from 'svelte/store';\n\n\tconst i18n: Writable<any> = getContext('i18n');\n\n\timport { fade } from 'svelte/transition';\n\n\timport ChatList from './ChatList.svelte';\n\timport FolderKnowledge from './FolderKnowledge.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport { getChatListByFolderId } from '$lib/apis/chats';\n\n\texport let folder: any = null;\n\n\tlet selectedTab = 'chats';\n\n\tlet page = 1;\n\n\tlet chats: any[] | null = null;\n\tlet chatListLoading = false;\n\tlet allChatsLoaded = false;\n\n\tconst loadChats = async () => {\n\t\tchatListLoading = true;\n\n\t\tpage += 1;\n\n\t\tlet newChatList: any[] = [];\n\n\t\tnewChatList = await getChatListByFolderId(localStorage.token, folder.id, page).catch(\n\t\t\t(error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn [];\n\t\t\t}\n\t\t);\n\n\t\t// once the bottom of the list has been reached (no results) there is no need to continue querying\n\t\tallChatsLoaded = newChatList.length === 0;\n\t\tchats = [...(chats || []), ...(newChatList || [])];\n\n\t\tchatListLoading = false;\n\t};\n\n\tconst setChatList = async () => {\n\t\tchats = null;\n\t\tpage = 1;\n\t\tallChatsLoaded = false;\n\t\tchatListLoading = false;\n\n\t\tif (folder && folder.id) {\n\t\t\tconst res = await getChatListByFolderId(localStorage.token, folder.id, page);\n\n\t\t\tif (res) {\n\t\t\t\tchats = res;\n\t\t\t} else {\n\t\t\t\tchats = [];\n\t\t\t}\n\t\t} else {\n\t\t\tchats = [];\n\t\t}\n\t};\n\n\t$: if (folder) {\n\t\tsetChatList();\n\t}\n</script>\n\n<div>\n\t<!-- <div class=\"mb-1\">\n\t\t<div\n\t\t\tclass=\"flex gap-1 scrollbar-none overflow-x-auto w-fit text-center text-sm font-medium rounded-full bg-transparent py-1 touch-auto pointer-events-auto\"\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'knowledge'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'knowledge';\n\t\t\t\t}}>{$i18n.t('Knowledge')}</button\n\t\t\t>\n\n\t\t\t<button\n\t\t\t\tclass=\"min-w-fit p-1.5 {selectedTab === 'chats'\n\t\t\t\t\t? ''\n\t\t\t\t\t: 'text-gray-300 dark:text-gray-600 hover:text-gray-700 dark:hover:text-white'} transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tselectedTab = 'chats';\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{$i18n.t('Chats')}\n\t\t\t</button>\n\t\t</div>\n\t</div> -->\n\n\t<div class=\"\">\n\t\t{#if selectedTab === 'knowledge'}\n\t\t\t<FolderKnowledge />\n\t\t{:else if selectedTab === 'chats'}\n\t\t\t{#if chats !== null}\n\t\t\t\t<ChatList {chats} {chatListLoading} {allChatsLoaded} loadHandler={loadChats} />\n\t\t\t{:else}\n\t\t\t\t<div class=\"py-10\">\n\t\t\t\t\t<Spinner />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport DOMPurify from 'dompurify';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { toast } from 'svelte-sonner';\n\n\timport { selectedFolder } from '$lib/stores';\n\n\timport { deleteFolderById, getFolderById, updateFolderById } from '$lib/apis/folders';\n\timport { getChatsByFolderId } from '$lib/apis/chats';\n\n\timport FolderModal from '$lib/components/layout/Sidebar/Folders/FolderModal.svelte';\n\n\timport Folder from '$lib/components/icons/Folder.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport FolderMenu from '$lib/components/layout/Sidebar/Folders/FolderMenu.svelte';\n\timport EllipsisHorizontal from '$lib/components/icons/EllipsisHorizontal.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\timport Emoji from '$lib/components/common/Emoji.svelte';\n\timport EmojiPicker from '$lib/components/common/EmojiPicker.svelte';\n\n\texport let folder = null;\n\n\texport let onUpdate: Function = (folderId) => {};\n\texport let onDelete: Function = (folderId) => {};\n\n\tlet showFolderModal = false;\n\tlet showDeleteConfirm = false;\n\tlet deleteFolderContents = true;\n\n\tconst updateHandler = async ({ name, meta, data }) => {\n\t\tif (name === '') {\n\t\t\ttoast.error($i18n.t('Folder name cannot be empty.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentName = folder.name;\n\n\t\tname = name.trim();\n\t\tfolder.name = name;\n\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tname,\n\t\t\t...(meta ? { meta } : {}),\n\t\t\t...(data ? { data } : {})\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\n\t\t\tfolder.name = currentName;\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.name = name;\n\t\t\tif (data) {\n\t\t\t\tfolder.data = data;\n\t\t\t}\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst updateIconHandler = async (iconName) => {\n\t\tconst res = await updateFolderById(localStorage.token, folder.id, {\n\t\t\tmeta: {\n\t\t\t\ticon: iconName\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfolder.meta = { ...folder.meta, icon: iconName };\n\n\t\t\ttoast.success($i18n.t('Folder updated successfully'));\n\n\t\t\tconst _folder = await getFolderById(localStorage.token, folder.id).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tawait selectedFolder.set(_folder);\n\t\t\tonUpdate(_folder);\n\t\t}\n\t};\n\n\tconst deleteHandler = async () => {\n\t\tconst res = await deleteFolderById(localStorage.token, folder.id, deleteFolderContents).catch(\n\t\t\t(error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t}\n\t\t);\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Folder deleted successfully'));\n\t\t\tonDelete(folder);\n\t\t}\n\t};\n\n\tconst exportHandler = async () => {\n\t\tconst chats = await getChatsByFolderId(localStorage.token, folder.id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\t\tif (!chats) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst blob = new Blob([JSON.stringify(chats)], {\n\t\t\ttype: 'application/json'\n\t\t});\n\n\t\tsaveAs(blob, `folder-${folder.name}-export-${Date.now()}.json`);\n\t};\n</script>\n\n{#if folder}\n\t<FolderModal\n\t\tbind:show={showFolderModal}\n\t\tedit={true}\n\t\tfolderId={folder.id}\n\t\tonSubmit={updateHandler}\n\t/>\n\n\t<DeleteConfirmDialog\n\t\tbind:show={showDeleteConfirm}\n\t\ttitle={$i18n.t('Delete folder?')}\n\t\ton:confirm={() => {\n\t\t\tdeleteHandler();\n\t\t}}\n\t>\n\t\t<div class=\" text-sm text-gray-700 dark:text-gray-300 flex-1 line-clamp-3 mb-2\">\n\t\t\t<!-- {$i18n.t('This will delete <strong>{{NAME}}</strong> and <strong>all its contents</strong>.', {\n\t\t\t\tNAME: folders[folderId].name\n\t\t\t})} -->\n\n\t\t\t{$i18n.t(`Are you sure you want to delete \"{{NAME}}\"?`, {\n\t\t\t\tNAME: folders[folderId].name\n\t\t\t})}\n\t\t</div>\n\n\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t<input type=\"checkbox\" bind:checked={deleteFolderContents} />\n\n\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t{$i18n.t('Delete all contents inside this folder')}\n\t\t\t</div>\n\t\t</div>\n\t</DeleteConfirmDialog>\n\n\t<div class=\"mb-3 px-6 @md:max-w-3xl justify-between w-full flex relative group items-center\">\n\t\t<div class=\"text-center flex gap-3.5 items-center\">\n\t\t\t<EmojiPicker\n\t\t\t\tonClose={() => {}}\n\t\t\t\tonSubmit={(name) => {\n\t\t\t\t\tconsole.log(name);\n\t\t\t\t\tupdateIconHandler(name);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" rounded-full bg-gray-50 dark:bg-gray-800 size-11 flex justify-center items-center\"\n\t\t\t\t>\n\t\t\t\t\t{#if folder?.meta?.icon}\n\t\t\t\t\t\t<Emoji className=\"size-6\" shortCode={folder.meta.icon} />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Folder className=\"size-4.5\" strokeWidth=\"2\" />\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</EmojiPicker>\n\n\t\t\t<div class=\"text-3xl line-clamp-1\">\n\t\t\t\t{folder.name}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex items-center translate-x-2.5\">\n\t\t\t<FolderMenu\n\t\t\t\talign=\"end\"\n\t\t\t\tonEdit={() => {\n\t\t\t\t\tshowFolderModal = true;\n\t\t\t\t}}\n\t\t\t\tonDelete={() => {\n\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t}}\n\t\t\t\tonExport={() => {\n\t\t\t\t\texportHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<button class=\"p-1.5 dark:hover:bg-gray-850 rounded-full touch-auto\" on:click={(e) => {}}>\n\t\t\t\t\t<EllipsisHorizontal className=\"size-4\" strokeWidth=\"2.5\" />\n\t\t\t\t</button>\n\t\t\t</FolderMenu>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { marked } from 'marked';\n\n\timport { onMount, getContext, tick, createEventDispatcher } from 'svelte';\n\timport { blur, fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { getChatList } from '$lib/apis/chats';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\timport {\n\t\tconfig,\n\t\tuser,\n\t\tmodels as _models,\n\t\ttemporaryChatEnabled,\n\t\tselectedFolder,\n\t\tchats,\n\t\tcurrentChatPage\n\t} from '$lib/stores';\n\timport { sanitizeResponseContent, extractCurlyBraceWords } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Suggestions from './Suggestions.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport EyeSlash from '$lib/components/icons/EyeSlash.svelte';\n\timport MessageInput from './MessageInput.svelte';\n\timport FolderPlaceholder from './Placeholder/FolderPlaceholder.svelte';\n\timport FolderTitle from './Placeholder/FolderTitle.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let createMessagePair: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = false;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\texport let history;\n\n\texport let prompt = '';\n\texport let files = [];\n\texport let messageInput = null;\n\n\texport let selectedToolIds = [];\n\texport let selectedFilterIds = [];\n\n\texport let showCommands = false;\n\n\texport let imageGenerationEnabled = false;\n\texport let codeInterpreterEnabled = false;\n\texport let webSearchEnabled = false;\n\n\texport let onUpload: Function = (e) => {};\n\texport let onSelect = (e) => {};\n\texport let onChange = (e) => {};\n\n\texport let toolServers = [];\n\n\tlet models = [];\n\tlet selectedModelIdx = 0;\n\n\t$: if (selectedModels.length > 0) {\n\t\tselectedModelIdx = models.length - 1;\n\t}\n\n\t$: models = selectedModels.map((id) => $_models.find((m) => m.id === id));\n</script>\n\n<div class=\"m-auto w-full max-w-6xl px-2 @2xl:px-20 translate-y-6 py-24 text-center\">\n\t{#if $temporaryChatEnabled}\n\t\t<Tooltip\n\t\t\tcontent={$i18n.t(\"This chat won't appear in history and your messages will not be saved.\")}\n\t\t\tclassName=\"w-full flex justify-center mb-0.5\"\n\t\t\tplacement=\"top\"\n\t\t>\n\t\t\t<div class=\"flex items-center gap-2 text-gray-500 text-base my-2 w-fit\">\n\t\t\t\t<EyeSlash strokeWidth=\"2.5\" className=\"size-4\" />{$i18n.t('Temporary Chat')}\n\t\t\t</div>\n\t\t</Tooltip>\n\t{/if}\n\n\t<div\n\t\tclass=\"w-full text-3xl text-gray-800 dark:text-gray-100 text-center flex items-center gap-4 font-primary\"\n\t>\n\t\t<div class=\"w-full flex flex-col justify-center items-center\">\n\t\t\t{#if $selectedFolder}\n\t\t\t\t<FolderTitle\n\t\t\t\t\tfolder={$selectedFolder}\n\t\t\t\t\tonUpdate={async (folder) => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\t}}\n\t\t\t\t\tonDelete={async () => {\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t\t\tcurrentChatPage.set(1);\n\n\t\t\t\t\t\tselectedFolder.set(null);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t{:else}\n\t\t\t\t<div class=\"flex flex-row justify-center gap-3 @sm:gap-3.5 w-fit px-5 max-w-xl\">\n\t\t\t\t\t<div class=\"flex shrink-0 justify-center\">\n\t\t\t\t\t\t<div class=\"flex -space-x-4 mb-0.5\" in:fade={{ duration: 100 }}>\n\t\t\t\t\t\t\t{#each models as model, modelIdx}\n\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\tcontent={(models[modelIdx]?.info?.meta?.tags ?? [])\n\t\t\t\t\t\t\t\t\t\t.map((tag) => tag.name.toUpperCase())\n\t\t\t\t\t\t\t\t\t\t.join(', ')}\n\t\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\taria-hidden={models.length <= 1}\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Get information on {{name}} in the UI', {\n\t\t\t\t\t\t\t\t\t\t\tname: models[modelIdx]?.name\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}`}\n\t\t\t\t\t\t\t\t\t\t\tclass=\" size-9 @sm:size-10 rounded-full border-[1px] border-gray-100 dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-3xl @sm:text-3xl line-clamp-1 flex items-center\"\n\t\t\t\t\t\tin:fade={{ duration: 100 }}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tcontent={models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t\tclassName=\" flex items-center \"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.name}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Hello, {{name}}', { name: $user?.name })}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex mt-1 mb-2\">\n\t\t\t\t\t<div in:fade={{ duration: 100, delay: 50 }}>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.description ?? null}\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tclassName=\" w-fit\"\n\t\t\t\t\t\t\t\tcontent={marked.parse(\n\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\tplacement=\"top\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"mt-0.5 px-2 text-sm font-normal text-gray-500 dark:text-gray-400 line-clamp-2 max-w-xl markdown\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{@html marked.parse(\n\t\t\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user}\n\t\t\t\t\t\t\t\t<div class=\"mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\tBy\n\t\t\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user.community}\n\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\thref=\"https://openwebui.com/m/{models[selectedModelIdx]?.info?.meta?.user\n\t\t\t\t\t\t\t\t\t\t\t\t.username}\"\n\t\t\t\t\t\t\t\t\t\t\t>{models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t? models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t\t: `@${models[selectedModelIdx]?.info?.meta?.user.username}`}</a\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.info?.meta?.user.name}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t<div class=\"text-base font-normal @md:max-w-3xl w-full py-3 {atSelectedModel ? 'mt-2' : ''}\">\n\t\t\t\t<MessageInput\n\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t{history}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:autoScroll\n\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\tbind:showCommands\n\t\t\t\t\t{toolServers}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{createMessagePair}\n\t\t\t\t\tplaceholder={$i18n.t('How can I help you today?')}\n\t\t\t\t\t{onChange}\n\t\t\t\t\t{onUpload}\n\t\t\t\t\ton:submit={(e) => {\n\t\t\t\t\t\tdispatch('submit', e.detail);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t{#if $selectedFolder}\n\t\t<div\n\t\t\tclass=\"mx-auto px-4 md:max-w-3xl md:px-6 font-primary min-h-62\"\n\t\t\tin:fade={{ duration: 200, delay: 200 }}\n\t\t>\n\t\t\t<FolderPlaceholder folder={$selectedFolder} />\n\t\t</div>\n\t{:else}\n\t\t<div class=\"mx-auto max-w-2xl font-primary mt-2\" in:fade={{ duration: 200, delay: 200 }}>\n\t\t\t<div class=\"mx-5\">\n\t\t\t\t<Suggestions\n\t\t\t\t\tsuggestionPrompts={atSelectedModel?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t\t$config?.default_prompt_suggestions ??\n\t\t\t\t\t\t[]}\n\t\t\t\t\tinputValue={prompt}\n\t\t\t\t\t{onSelect}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport { PaneGroup, Pane, PaneResizer } from 'paneforge';\n\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport { get, type Unsubscriber, type Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\ttags as allTags,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\taudioQueue,\n\t\tshowControls,\n\t\tshowCallOverlay,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled,\n\t\tmobile,\n\t\tshowOverview,\n\t\tchatTitle,\n\t\tshowArtifacts,\n\t\tartifactContents,\n\t\ttools,\n\t\ttoolServers,\n\t\tfunctions,\n\t\tselectedFolder,\n\t\tpinnedChats,\n\t\tshowEmbeds\n\t} from '$lib/stores';\n\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\tgetMessageContentParts,\n\t\tcreateMessagesList,\n\t\tgetPromptVariables,\n\t\tprocessDetails,\n\t\tremoveAllDetails,\n\t\tgetCodeBlockContents,\n\t\tisYoutubeUrl\n\t} from '$lib/utils';\n\timport { AudioQueue } from '$lib/utils/audio';\n\n\timport {\n\t\tcreateNewChat,\n\t\tgetAllTags,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetPinnedChatList,\n\t\tgetTagsById,\n\t\tupdateChatById,\n\t\tupdateChatFolderIdById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\n\timport { processWeb, processWebSearch, processYoutubeVideo } from '$lib/apis/retrieval';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport {\n\t\tchatCompleted,\n\t\tgenerateQueries,\n\t\tchatAction,\n\t\tgenerateMoACompletion,\n\t\tstopTask,\n\t\tgetTaskIdsByChatId\n\t} from '$lib/apis';\n\timport { getTools } from '$lib/apis/tools';\n\timport { uploadFile } from '$lib/apis/files';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\timport { getFunctions } from '$lib/apis/functions';\n\timport { updateFolderById } from '$lib/apis/folders';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/chat/Navbar.svelte';\n\timport ChatControls from './ChatControls.svelte';\n\timport EventConfirmDialog from '../common/ConfirmDialog.svelte';\n\timport Placeholder from './Placeholder.svelte';\n\timport NotificationToast from '../NotificationToast.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Sidebar from '../icons/Sidebar.svelte';\n\timport Image from '../common/Image.svelte';\n\n\texport let chatIdProp = '';\n\n\tlet loading = true;\n\n\tconst eventTarget = new EventTarget();\n\tlet controlPane;\n\tlet controlPaneComponent;\n\n\tlet messageInput;\n\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet navbarElement;\n\n\tlet showEventConfirmation = false;\n\tlet eventConfirmationTitle = '';\n\tlet eventConfirmationMessage = '';\n\tlet eventConfirmationInput = false;\n\tlet eventConfirmationInputPlaceholder = '';\n\tlet eventConfirmationInputValue = '';\n\tlet eventCallback = null;\n\n\tlet chatIdUnsubscriber: Unsubscriber | undefined;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\tlet selectedModelIds = [];\n\t$: if (atSelectedModel !== undefined) {\n\t\tselectedModelIds = [atSelectedModel.id];\n\t} else {\n\t\tselectedModelIds = selectedModels;\n\t}\n\n\tlet selectedToolIds = [];\n\tlet selectedFilterIds = [];\n\tlet imageGenerationEnabled = false;\n\tlet webSearchEnabled = false;\n\tlet codeInterpreterEnabled = false;\n\n\tlet showCommands = false;\n\n\tlet generating = false;\n\tlet generationController = null;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet taskIds = null;\n\n\t// Chat Input\n\tlet prompt = '';\n\tlet chatFiles = [];\n\tlet files = [];\n\tlet params = {};\n\n\t$: if (chatIdProp) {\n\t\tnavigateHandler();\n\t}\n\n\tconst navigateHandler = async () => {\n\t\tloading = true;\n\n\t\tprompt = '';\n\t\tmessageInput?.setText('');\n\n\t\tfiles = [];\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (chatIdProp && (await loadChat())) {\n\t\t\tawait tick();\n\t\t\tloading = false;\n\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\n\t\t\tawait tick();\n\n\t\t\tif (storageChatInput) {\n\t\t\t\ttry {\n\t\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\t\tfiles = input.files;\n\t\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t} else {\n\t\t\t\tawait setDefaults();\n\t\t\t}\n\n\t\t\tconst chatInput = document.getElementById('chat-input');\n\t\t\tchatInput?.focus();\n\t\t} else {\n\t\t\tawait goto('/');\n\t\t}\n\t};\n\n\tconst onSelect = async (e) => {\n\t\tconst { type, data } = e;\n\n\t\tif (type === 'prompt') {\n\t\t\t// Handle prompt selection\n\t\t\tmessageInput?.setText(data, async () => {\n\t\t\t\tif (!($settings?.insertSuggestionPrompt ?? false)) {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels && chatIdProp !== '') {\n\t\tsaveSessionSelectedModels();\n\t}\n\n\tconst saveSessionSelectedModels = () => {\n\t\tconst selectedModelsString = JSON.stringify(selectedModels);\n\t\tif (\n\t\t\tselectedModels.length === 0 ||\n\t\t\t(selectedModels.length === 1 && selectedModels[0] === '') ||\n\t\t\tsessionStorage.selectedModels === selectedModelsString\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tsessionStorage.selectedModels = selectedModelsString;\n\t\tconsole.log('saveSessionSelectedModels', selectedModels, sessionStorage.selectedModels);\n\t};\n\n\tlet oldSelectedModelIds = [''];\n\t$: if (JSON.stringify(selectedModelIds) !== JSON.stringify(oldSelectedModelIds)) {\n\t\tonSelectedModelIdsChange();\n\t}\n\n\tconst onSelectedModelIdsChange = () => {\n\t\tresetInput();\n\t\toldSelectedModelIds = JSON.parse(JSON.stringify(selectedModelIds));\n\t};\n\n\tconst resetInput = () => {\n\t\tselectedToolIds = [];\n\t\tselectedFilterIds = [];\n\t\twebSearchEnabled = false;\n\t\timageGenerationEnabled = false;\n\t\tcodeInterpreterEnabled = false;\n\n\t\tif (selectedModelIds.filter((id) => id).length > 0) {\n\t\t\tsetDefaults();\n\t\t}\n\t};\n\n\tconst setDefaults = async () => {\n\t\tif (!$tools) {\n\t\t\ttools.set(await getTools(localStorage.token));\n\t\t}\n\t\tif (!$functions) {\n\t\t\tfunctions.set(await getFunctions(localStorage.token));\n\t\t}\n\t\tif (selectedModels.length !== 1 && !atSelectedModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = atSelectedModel ?? $models.find((m) => m.id === selectedModels[0]);\n\t\tif (model) {\n\t\t\t// Set Default Tools\n\t\t\tif (model?.info?.meta?.toolIds) {\n\t\t\t\tselectedToolIds = [\n\t\t\t\t\t...new Set(\n\t\t\t\t\t\t[...(model?.info?.meta?.toolIds ?? [])].filter((id) => $tools.find((t) => t.id === id))\n\t\t\t\t\t)\n\t\t\t\t];\n\t\t\t}\n\n\t\t\t// Set Default Filters (Toggleable only)\n\t\t\tif (model?.info?.meta?.defaultFilterIds) {\n\t\t\t\tselectedFilterIds = model.info.meta.defaultFilterIds.filter((id) =>\n\t\t\t\t\tmodel?.filters?.find((f) => f.id === id)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Set Default Features\n\t\t\tif (model?.info?.meta?.defaultFeatureIds) {\n\t\t\t\tif (model.info?.meta?.capabilities?.['image_generation']) {\n\t\t\t\t\timageGenerationEnabled = model.info.meta.defaultFeatureIds.includes('image_generation');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['web_search']) {\n\t\t\t\t\twebSearchEnabled = model.info.meta.defaultFeatureIds.includes('web_search');\n\t\t\t\t}\n\n\t\t\t\tif (model.info?.meta?.capabilities?.['code_interpreter']) {\n\t\t\t\t\tcodeInterpreterEnabled = model.info.meta.defaultFeatureIds.includes('code_interpreter');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst showMessage = async (message, ignoreSettings = false) => {\n\t\tawait tick();\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\t\tlet _messageId = JSON.parse(JSON.stringify(message.id));\n\n\t\tlet messageChildrenIds = [];\n\t\tif (_messageId === null) {\n\t\t\tmessageChildrenIds = Object.keys(history.messages).filter(\n\t\t\t\t(id) => history.messages[id].parentId === null\n\t\t\t);\n\t\t} else {\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t_messageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[_messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = _messageId;\n\n\t\tawait tick();\n\t\tawait tick();\n\t\tawait tick();\n\n\t\tif (($settings?.scrollOnBranchChange ?? true) || ignoreSettings) {\n\t\t\tconst messageElement = document.getElementById(`message-${message.id}`);\n\t\t\tif (messageElement) {\n\t\t\t\tmessageElement.scrollIntoView({ behavior: 'smooth' });\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tsaveChatHandler(_chatId, history);\n\t};\n\n\tconst chatEventHandler = async (event, cb) => {\n\t\tconsole.log(event);\n\n\t\tif (event.chat_id === $chatId) {\n\t\t\tawait tick();\n\t\t\tlet message = history.messages[event.message_id];\n\n\t\t\tif (message) {\n\t\t\t\tconst type = event?.data?.type ?? null;\n\t\t\t\tconst data = event?.data?.data ?? null;\n\n\t\t\t\tif (type === 'status') {\n\t\t\t\t\tif (message?.statusHistory) {\n\t\t\t\t\t\tmessage.statusHistory.push(data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessage.statusHistory = [data];\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:completion') {\n\t\t\t\t\tchatCompletionEventHandler(data, message, event.chat_id);\n\t\t\t\t} else if (type === 'chat:tasks:cancel') {\n\t\t\t\t\ttaskIds = null;\n\t\t\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t\t\t// Set all response messages to done\n\t\t\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:message:delta' || type === 'message') {\n\t\t\t\t\tmessage.content += data.content;\n\t\t\t\t} else if (type === 'chat:message' || type === 'replace') {\n\t\t\t\t\tmessage.content = data.content;\n\t\t\t\t} else if (type === 'chat:message:files' || type === 'files') {\n\t\t\t\t\tmessage.files = data.files;\n\t\t\t\t} else if (type === 'chat:message:embeds' || type === 'embeds') {\n\t\t\t\t\tmessage.embeds = data.embeds;\n\t\t\t\t} else if (type === 'chat:message:error') {\n\t\t\t\t\tmessage.error = data.error;\n\t\t\t\t} else if (type === 'chat:message:follow_ups') {\n\t\t\t\t\tmessage.followUps = data.follow_ups;\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom('smooth');\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'chat:message:favorite') {\n\t\t\t\t\t// Update message favorite status\n\t\t\t\t\tmessage.favorite = data.favorite;\n\t\t\t\t} else if (type === 'chat:title') {\n\t\t\t\t\tchatTitle.set(data);\n\t\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\t} else if (type === 'chat:tags') {\n\t\t\t\t\tchat = await getChatById(localStorage.token, $chatId);\n\t\t\t\t\tallTags.set(await getAllTags(localStorage.token));\n\t\t\t\t} else if (type === 'source' || type === 'citation') {\n\t\t\t\t\tif (data?.type === 'code_execution') {\n\t\t\t\t\t\t// Code execution; update existing code execution by ID, or add new one.\n\t\t\t\t\t\tif (!message?.code_executions) {\n\t\t\t\t\t\t\tmessage.code_executions = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst existingCodeExecutionIndex = message.code_executions.findIndex(\n\t\t\t\t\t\t\t(execution) => execution.id === data.id\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (existingCodeExecutionIndex !== -1) {\n\t\t\t\t\t\t\tmessage.code_executions[existingCodeExecutionIndex] = data;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.code_executions.push(data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.code_executions = message.code_executions;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Regular source.\n\t\t\t\t\t\tif (message?.sources) {\n\t\t\t\t\t\t\tmessage.sources.push(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmessage.sources = [data];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'notification') {\n\t\t\t\t\tconst toastType = data?.type ?? 'info';\n\t\t\t\t\tconst toastContent = data?.content ?? '';\n\n\t\t\t\t\tif (toastType === 'success') {\n\t\t\t\t\t\ttoast.success(toastContent);\n\t\t\t\t\t} else if (toastType === 'error') {\n\t\t\t\t\t\ttoast.error(toastContent);\n\t\t\t\t\t} else if (toastType === 'warning') {\n\t\t\t\t\t\ttoast.warning(toastContent);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.info(toastContent);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'confirmation') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = false;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t} else if (type === 'execute') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Use Function constructor to evaluate code in a safer way\n\t\t\t\t\t\tconst asyncFunction = new Function(`return (async () => { ${data.code} })()`);\n\t\t\t\t\t\tconst result = await asyncFunction(); // Await the result of the async function\n\n\t\t\t\t\t\tif (cb) {\n\t\t\t\t\t\t\tcb(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error executing code:', error);\n\t\t\t\t\t}\n\t\t\t\t} else if (type === 'input') {\n\t\t\t\t\teventCallback = cb;\n\n\t\t\t\t\teventConfirmationInput = true;\n\t\t\t\t\tshowEventConfirmation = true;\n\n\t\t\t\t\teventConfirmationTitle = data.title;\n\t\t\t\t\teventConfirmationMessage = data.message;\n\t\t\t\t\teventConfirmationInputPlaceholder = data.placeholder;\n\t\t\t\t\teventConfirmationInputValue = data?.value ?? '';\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Unknown message type', data);\n\t\t\t\t}\n\n\t\t\t\thistory.messages[event.message_id] = message;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onMessageHandler = async (event: {\n\t\torigin: string;\n\t\tdata: { type: string; text: string };\n\t}) => {\n\t\tif (event.origin !== window.origin) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.data.type === 'action:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (prompt !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\t// Replace with your iframe's origin\n\t\tif (event.data.type === 'input:prompt') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tconst inputElement = document.getElementById('chat-input');\n\n\t\t\tif (inputElement) {\n\t\t\t\tmessageInput?.setText(event.data.text);\n\t\t\t\tinputElement.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (event.data.type === 'input:prompt:submit') {\n\t\t\tconsole.debug(event.data.text);\n\n\t\t\tif (event.data.text !== '') {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(event.data.text);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst savedModelIds = async () => {\n\t\tif (\n\t\t\t$selectedFolder &&\n\t\t\tselectedModels.filter((modelId) => modelId !== '').length > 0 &&\n\t\t\tJSON.stringify($selectedFolder?.data?.model_ids) !== JSON.stringify(selectedModels)\n\t\t) {\n\t\t\tconst res = await updateFolderById(localStorage.token, $selectedFolder.id, {\n\t\t\t\tdata: {\n\t\t\t\t\tmodel_ids: selectedModels\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t$: if (selectedModels !== null) {\n\t\tsavedModelIds();\n\t}\n\n\tlet pageSubscribe = null;\n\tlet showControlsSubscribe = null;\n\tlet selectedFolderSubscribe = null;\n\n\tconst stopAudio = () => {\n\t\ttry {\n\t\t\tspeechSynthesis.cancel();\n\t\t\t$audioQueue.stop();\n\t\t} catch {}\n\t};\n\n\tonMount(async () => {\n\t\tloading = true;\n\t\tconsole.log('mounted');\n\t\twindow.addEventListener('message', onMessageHandler);\n\t\t$socket?.on('events', chatEventHandler);\n\n\t\taudioQueue.set(new AudioQueue(document.getElementById('audioElement')));\n\n\t\tpageSubscribe = page.subscribe(async (p) => {\n\t\t\tif (p.url.pathname === '/') {\n\t\t\t\tawait tick();\n\t\t\t\tinitNewChat();\n\t\t\t}\n\n\t\t\tstopAudio();\n\t\t});\n\n\t\tconst storageChatInput = sessionStorage.getItem(\n\t\t\t`chat-input${chatIdProp ? `-${chatIdProp}` : ''}`\n\t\t);\n\n\t\tif (!chatIdProp) {\n\t\t\tloading = false;\n\t\t\tawait tick();\n\t\t}\n\n\t\tif (storageChatInput) {\n\t\t\tprompt = '';\n\t\t\tmessageInput?.setText('');\n\n\t\t\tfiles = [];\n\t\t\tselectedToolIds = [];\n\t\t\tselectedFilterIds = [];\n\t\t\twebSearchEnabled = false;\n\t\t\timageGenerationEnabled = false;\n\t\t\tcodeInterpreterEnabled = false;\n\n\t\t\ttry {\n\t\t\t\tconst input = JSON.parse(storageChatInput);\n\n\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\tmessageInput?.setText(input.prompt);\n\t\t\t\t\tfiles = input.files;\n\t\t\t\t\tselectedToolIds = input.selectedToolIds;\n\t\t\t\t\tselectedFilterIds = input.selectedFilterIds;\n\t\t\t\t\twebSearchEnabled = input.webSearchEnabled;\n\t\t\t\t\timageGenerationEnabled = input.imageGenerationEnabled;\n\t\t\t\t\tcodeInterpreterEnabled = input.codeInterpreterEnabled;\n\t\t\t\t}\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\tshowControlsSubscribe = showControls.subscribe(async (value) => {\n\t\t\tif (controlPane && !$mobile) {\n\t\t\t\ttry {\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tcontrolPaneComponent.openPane();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcontrolPane.collapse();\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// ignore\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!value) {\n\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\tshowOverview.set(false);\n\t\t\t\tshowArtifacts.set(false);\n\t\t\t\tshowEmbeds.set(false);\n\t\t\t}\n\t\t});\n\n\t\tselectedFolderSubscribe = selectedFolder.subscribe(async (folder) => {\n\t\t\tif (\n\t\t\t\tfolder?.data?.model_ids &&\n\t\t\t\tJSON.stringify(selectedModels) !== JSON.stringify(folder.data.model_ids)\n\t\t\t) {\n\t\t\t\tselectedModels = folder.data.model_ids;\n\n\t\t\t\tconsole.log('Set selectedModels from folder data:', selectedModels);\n\t\t\t}\n\t\t});\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\t});\n\n\tonDestroy(() => {\n\t\ttry {\n\t\t\tpageSubscribe();\n\t\t\tshowControlsSubscribe();\n\t\t\tselectedFolderSubscribe();\n\t\t\tchatIdUnsubscriber?.();\n\t\t\twindow.removeEventListener('message', onMessageHandler);\n\t\t\t$socket?.off('events', chatEventHandler);\n\t\t\t$audioQueue?.destroy();\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t});\n\n\t// File upload functions\n\n\tconst uploadGoogleDriveFile = async (fileData) => {\n\t\tconsole.log('Starting uploadGoogleDriveFile with:', {\n\t\t\tid: fileData.id,\n\t\t\tname: fileData.name,\n\t\t\turl: fileData.url,\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${token}`\n\t\t\t}\n\t\t});\n\n\t\t// Validate input\n\t\tif (!fileData?.id || !fileData?.name || !fileData?.url || !fileData?.headers?.Authorization) {\n\t\t\tthrow new Error('Invalid file data provided');\n\t\t}\n\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: fileData.url,\n\t\t\tname: fileData.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\terror: '',\n\t\t\titemId: tempItemId,\n\t\t\tsize: 0\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, fileItem];\n\t\t\tconsole.log('Processing web file with URL:', fileData.url);\n\n\t\t\t// Configure fetch options with proper headers\n\t\t\tconst fetchOptions = {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: fileData.headers.Authorization,\n\t\t\t\t\tAccept: '*/*'\n\t\t\t\t},\n\t\t\t\tmethod: 'GET'\n\t\t\t};\n\n\t\t\t// Attempt to fetch the file\n\t\t\tconsole.log('Fetching file content from Google Drive...');\n\t\t\tconst fileResponse = await fetch(fileData.url, fetchOptions);\n\n\t\t\tif (!fileResponse.ok) {\n\t\t\t\tconst errorText = await fileResponse.text();\n\t\t\t\tthrow new Error(`Failed to fetch file (${fileResponse.status}): ${errorText}`);\n\t\t\t}\n\n\t\t\t// Get content type from response\n\t\t\tconst contentType = fileResponse.headers.get('content-type') || 'application/octet-stream';\n\t\t\tconsole.log('Response received with content-type:', contentType);\n\n\t\t\t// Convert response to blob\n\t\t\tconsole.log('Converting response to blob...');\n\t\t\tconst fileBlob = await fileResponse.blob();\n\n\t\t\tif (fileBlob.size === 0) {\n\t\t\t\tthrow new Error('Retrieved file is empty');\n\t\t\t}\n\n\t\t\tconsole.log('Blob created:', {\n\t\t\t\tsize: fileBlob.size,\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\t// Create File object with proper MIME type\n\t\t\tconst file = new File([fileBlob], fileData.name, {\n\t\t\t\ttype: fileBlob.type || contentType\n\t\t\t});\n\n\t\t\tconsole.log('File object created:', {\n\t\t\t\tname: file.name,\n\t\t\t\tsize: file.size,\n\t\t\t\ttype: file.type\n\t\t\t});\n\n\t\t\tif (file.size === 0) {\n\t\t\t\tthrow new Error('Created file is empty');\n\t\t\t}\n\n\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\tlet metadata = null;\n\t\t\tif (\n\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t) {\n\t\t\t\tmetadata = {\n\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Upload file to server\n\t\t\tconsole.log('Uploading file to server...');\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\tif (!uploadedFile) {\n\t\t\t\tthrow new Error('Server returned null response for file upload');\n\t\t\t}\n\n\t\t\tconsole.log('File uploaded successfully:', uploadedFile);\n\n\t\t\t// Update file item with upload results\n\t\t\tfileItem.status = 'uploaded';\n\t\t\tfileItem.file = uploadedFile;\n\t\t\tfileItem.id = uploadedFile.id;\n\t\t\tfileItem.size = file.size;\n\t\t\tfileItem.collection_name = uploadedFile?.meta?.collection_name;\n\t\t\tfileItem.url = `${uploadedFile.id}`;\n\n\t\t\tfiles = files;\n\t\t\ttoast.success($i18n.t('File uploaded successfully'));\n\t\t} catch (e) {\n\t\t\tconsole.error('Error uploading file:', e);\n\t\t\tfiles = files.filter((f) => f.itemId !== tempItemId);\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t('Error uploading file: {{error}}', {\n\t\t\t\t\terror: e.message || 'Unknown error'\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t};\n\n\tconst uploadWeb = async (urls) => {\n\t\tif (!Array.isArray(urls)) {\n\t\t\turls = [urls];\n\t\t}\n\n\t\t// Create file items first\n\t\tconst fileItems = urls.map((url) => ({\n\t\t\ttype: 'text',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tcontext: 'full',\n\t\t\turl,\n\t\t\terror: ''\n\t\t}));\n\n\t\t// Display all items at once\n\t\tfiles = [...files, ...fileItems];\n\n\t\tfor (const fileItem of fileItems) {\n\t\t\ttry {\n\t\t\t\tconst res = isYoutubeUrl(fileItem.url)\n\t\t\t\t\t? await processYoutubeVideo(localStorage.token, fileItem.url)\n\t\t\t\t\t: await processWeb(localStorage.token, '', fileItem.url);\n\n\t\t\t\tif (res) {\n\t\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\t\tfileItem.collection_name = res.collection_name;\n\t\t\t\t\tfileItem.file = {\n\t\t\t\t\t\t...res.file,\n\t\t\t\t\t\t...fileItem.file\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tfiles = [...files];\n\t\t\t} catch (e) {\n\t\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onUpload = async (event) => {\n\t\tconst { type, data } = event;\n\n\t\tif (type === 'google-drive') {\n\t\t\tawait uploadGoogleDriveFile(data);\n\t\t} else if (type === 'web') {\n\t\t\tawait uploadWeb(data);\n\t\t}\n\t};\n\n\t$: if (history) {\n\t\tgetContents();\n\t} else {\n\t\tartifactContents.set([]);\n\t}\n\n\tconst getContents = () => {\n\t\tconst messages = history ? createMessagesList(history, history.currentId) : [];\n\t\tlet contents = [];\n\t\tmessages.forEach((message) => {\n\t\t\tif (message?.role !== 'user' && message?.content) {\n\t\t\t\tconst {\n\t\t\t\t\tcodeBlocks: codeBlocks,\n\t\t\t\t\thtml: htmlContent,\n\t\t\t\t\tcss: cssContent,\n\t\t\t\t\tjs: jsContent\n\t\t\t\t} = getCodeBlockContents(message.content);\n\n\t\t\t\tif (htmlContent || cssContent || jsContent) {\n\t\t\t\t\tconst renderedContent = `\n                        <!DOCTYPE html>\n                        <html lang=\"en\">\n                        <head>\n                            <meta charset=\"UTF-8\">\n                            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n\t\t\t\t\t\t\t<${''}style>\n\t\t\t\t\t\t\t\tbody {\n\t\t\t\t\t\t\t\t\tbackground-color: white; /* Ensure the iframe has a white background */\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t${cssContent}\n\t\t\t\t\t\t\t</${''}style>\n                        </head>\n                        <body>\n                            ${htmlContent}\n\n\t\t\t\t\t\t\t<${''}script>\n                            \t${jsContent}\n\t\t\t\t\t\t\t</${''}script>\n                        </body>\n                        </html>\n                    `;\n\t\t\t\t\tcontents = [...contents, { type: 'iframe', content: renderedContent }];\n\t\t\t\t} else {\n\t\t\t\t\t// Check for SVG content\n\t\t\t\t\tfor (const block of codeBlocks) {\n\t\t\t\t\t\tif (block.lang === 'svg' || (block.lang === 'xml' && block.code.includes('<svg'))) {\n\t\t\t\t\t\t\tcontents = [...contents, { type: 'svg', content: block.code }];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tartifactContents.set(contents);\n\t};\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\tconsole.log('initNewChat');\n\t\tif ($user?.role !== 'admin' && $user?.permissions?.chat?.temporary_enforced) {\n\t\t\tawait temporaryChatEnabled.set(true);\n\t\t}\n\n\t\tif ($settings?.temporaryChatByDefault ?? false) {\n\t\t\tif ($temporaryChatEnabled === false) {\n\t\t\t\tawait temporaryChatEnabled.set(true);\n\t\t\t} else if ($temporaryChatEnabled === null) {\n\t\t\t\t// if set to null set to false; refer to temp chat toggle click handler\n\t\t\t\tawait temporaryChatEnabled.set(false);\n\t\t\t}\n\t\t}\n\n\t\tif ($user?.role !== 'admin' && !$user?.permissions?.chat?.temporary) {\n\t\t\tawait temporaryChatEnabled.set(false);\n\t\t}\n\n\t\tconst availableModels = $models\n\t\t\t.filter((m) => !(m?.info?.meta?.hidden ?? false))\n\t\t\t.map((m) => m.id);\n\n\t\tconst defaultModels = $config?.default_models ? $config?.default_models.split(',') : [];\n\n\t\tif ($page.url.searchParams.get('models') || $page.url.searchParams.get('model')) {\n\t\t\tconst urlModels = (\n\t\t\t\t$page.url.searchParams.get('models') ||\n\t\t\t\t$page.url.searchParams.get('model') ||\n\t\t\t\t''\n\t\t\t)?.split(',');\n\n\t\t\tif (urlModels.length === 1) {\n\t\t\t\tif (!$models.find((m) => m.id === urlModels[0])) {\n\t\t\t\t\t// Model not found; open model selector and prefill\n\t\t\t\t\tconst modelSelectorButton = document.getElementById('model-selector-0-button');\n\t\t\t\t\tif (modelSelectorButton) {\n\t\t\t\t\t\tmodelSelectorButton.click();\n\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\tconst modelSelectorInput = document.getElementById('model-search-input');\n\t\t\t\t\t\tif (modelSelectorInput) {\n\t\t\t\t\t\t\tmodelSelectorInput.focus();\n\t\t\t\t\t\t\tmodelSelectorInput.value = urlModels[0];\n\t\t\t\t\t\t\tmodelSelectorInput.dispatchEvent(new Event('input'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Model found; set it as selected\n\t\t\t\t\tselectedModels = urlModels;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Multiple models; set as selected\n\t\t\t\tselectedModels = urlModels;\n\t\t\t}\n\n\t\t\t// Unavailable models filtering\n\t\t\tselectedModels = selectedModels.filter((modelId) =>\n\t\t\t\t$models.map((m) => m.id).includes(modelId)\n\t\t\t);\n\t\t} else {\n\t\t\tif ($selectedFolder?.data?.model_ids) {\n\t\t\t\t// Set from folder model IDs\n\t\t\t\tselectedModels = $selectedFolder?.data?.model_ids;\n\t\t\t} else {\n\t\t\t\tif (sessionStorage.selectedModels) {\n\t\t\t\t\t// Set from session storage (temporary selection)\n\t\t\t\t\tselectedModels = JSON.parse(sessionStorage.selectedModels);\n\t\t\t\t\tsessionStorage.removeItem('selectedModels');\n\t\t\t\t} else {\n\t\t\t\t\tif ($settings?.models) {\n\t\t\t\t\t\t// Set from user settings\n\t\t\t\t\t\tselectedModels = $settings?.models;\n\t\t\t\t\t} else if (defaultModels && defaultModels.length > 0) {\n\t\t\t\t\t\t// Set from default models\n\t\t\t\t\t\tselectedModels = defaultModels;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Unavailable & hidden models filtering\n\t\t\tselectedModels = selectedModels.filter((modelId) => availableModels.includes(modelId));\n\t\t}\n\n\t\t// Ensure at least one model is selected\n\t\tif (selectedModels.length === 0 || (selectedModels.length === 1 && selectedModels[0] === '')) {\n\t\t\tif (availableModels.length > 0) {\n\t\t\t\tif (defaultModels && defaultModels.length > 0) {\n\t\t\t\t\t// Set from default models\n\t\t\t\t\tselectedModels = defaultModels.filter((modelId) => availableModels.includes(modelId));\n\t\t\t\t}\n\n\t\t\t\t// Set to first available model\n\t\t\t\tselectedModels = [availableModels?.at(0) ?? ''];\n\t\t\t} else {\n\t\t\t\tselectedModels = [''];\n\t\t\t}\n\t\t}\n\n\t\tawait showControls.set(false);\n\t\tawait showCallOverlay.set(false);\n\t\tawait showOverview.set(false);\n\t\tawait showArtifacts.set(false);\n\n\t\tif ($page.url.pathname.includes('/c/')) {\n\t\t\twindow.history.replaceState(history.state, '', `/`);\n\t\t}\n\n\t\tautoScroll = true;\n\n\t\tresetInput();\n\t\tawait chatId.set('');\n\t\tawait chatTitle.set('');\n\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tchatFiles = [];\n\t\tparams = {};\n\n\t\tif ($page.url.searchParams.get('youtube')) {\n\t\t\tawait uploadWeb(`https://www.youtube.com/watch?v=${$page.url.searchParams.get('youtube')}`);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('load-url')) {\n\t\t\tawait uploadWeb($page.url.searchParams.get('load-url'));\n\t\t}\n\n\t\tif ($page.url.searchParams.get('web-search') === 'true') {\n\t\t\twebSearchEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('image-generation') === 'true') {\n\t\t\timageGenerationEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('code-interpreter') === 'true') {\n\t\t\tcodeInterpreterEnabled = true;\n\t\t}\n\n\t\tif ($page.url.searchParams.get('tools')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tools')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t} else if ($page.url.searchParams.get('tool-ids')) {\n\t\t\tselectedToolIds = $page.url.searchParams\n\t\t\t\t.get('tool-ids')\n\t\t\t\t?.split(',')\n\t\t\t\t.map((id) => id.trim())\n\t\t\t\t.filter((id) => id);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('call') === 'true') {\n\t\t\tshowCallOverlay.set(true);\n\t\t\tshowControls.set(true);\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tconst q = $page.url.searchParams.get('q') ?? '';\n\t\t\tmessageInput?.setText(q);\n\n\t\t\tif (q) {\n\t\t\t\tif (($page.url.searchParams.get('submit') ?? 'true') === 'true') {\n\t\t\t\t\tawait tick();\n\t\t\t\t\tsubmitPrompt(q);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\n\t\tif ($temporaryChatEnabled) {\n\t\t\ttemporaryChatEnabled.set(false);\n\t\t}\n\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\t\treturn [];\n\t\t\t});\n\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\n\t\t\t\tif (!($user?.role === 'admin' || ($user?.permissions?.chat?.multiple_models ?? true))) {\n\t\t\t\t\tselectedModels = selectedModels.length > 0 ? [selectedModels[0]] : [''];\n\t\t\t\t}\n\n\t\t\t\toldSelectedModelIds = JSON.parse(JSON.stringify(selectedModels));\n\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\n\t\t\t\tchatTitle.set(chatContent.title);\n\n\t\t\t\tparams = chatContent?.params ?? {};\n\t\t\t\tchatFiles = chatContent?.files ?? [];\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (history.currentId) {\n\t\t\t\t\tfor (const message of Object.values(history.messages)) {\n\t\t\t\t\t\tif (message && message.role === 'assistant') {\n\t\t\t\t\t\t\tmessage.done = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst taskRes = await getTaskIdsByChatId(localStorage.token, $chatId).catch((error) => {\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (taskRes) {\n\t\t\t\t\ttaskIds = taskRes.task_ids;\n\t\t\t\t}\n\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async (behavior = 'auto') => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTo({\n\t\t\t\ttop: messagesContainerElement.scrollHeight,\n\t\t\t\tbehavior\n\t\t\t});\n\t\t}\n\t};\n\tconst chatCompletedHandler = async (_chatId, modelId, responseMessageId, messages) => {\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.usage ? { usage: m.usage } : {}),\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: _chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\tif (message?.id) {\n\t\t\t\t\t// Add null check for message and message.id\n\t\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t...message\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\n\t\ttaskIds = null;\n\t};\n\n\tconst chatActionHandler = async (_chatId, actionId, modelId, responseMessageId, event = null) => {\n\t\tconst messages = createMessagesList(history, responseMessageId);\n\n\t\tconst res = await chatAction(localStorage.token, actionId, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\tinfo: m.info ? m.info : undefined,\n\t\t\t\ttimestamp: m.timestamp,\n\t\t\t\t...(m.sources ? { sources: m.sources } : {})\n\t\t\t})),\n\t\t\t...(event ? { event: event } : {}),\n\t\t\tmodel_item: $models.find((m) => m.id === modelId),\n\t\t\tchat_id: _chatId,\n\t\t\tsession_id: $socket?.id,\n\t\t\tid: responseMessageId\n\t\t}).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\tmessages.at(-1).error = { content: error };\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null && res.messages) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\tconst createMessagePair = async (userPrompt) => {\n\t\tmessageInput?.setText('');\n\t\tif (selectedModels.length === 0) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else {\n\t\t\tconst modelId = selectedModels[0];\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\tconst parentMessage = messages.length !== 0 ? messages.at(-1) : null;\n\n\t\t\tconst userMessageId = uuidv4();\n\t\t\tconst responseMessageId = uuidv4();\n\n\t\t\tconst userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: parentMessage ? parentMessage.id : null,\n\t\t\t\tchildrenIds: [responseMessageId],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt ? userPrompt : `[PROMPT] ${userMessageId}`,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tconst responseMessage = {\n\t\t\t\tid: responseMessageId,\n\t\t\t\tparentId: userMessageId,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: `[RESPONSE] ${responseMessageId}`,\n\t\t\t\tdone: true,\n\n\t\t\t\tmodel: modelId,\n\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\tmodelIdx: 0,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t};\n\n\t\t\tif (parentMessage) {\n\t\t\t\tparentMessage.childrenIds.push(userMessageId);\n\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t}\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\tawait tick();\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tif (messages.length === 0) {\n\t\t\t\tawait initChatHandler(history);\n\t\t\t} else {\n\t\t\t\tawait saveChatHandler($chatId, history);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst addMessages = async ({ modelId, parentId, messages }) => {\n\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\tlet parentMessage = history.messages[parentId];\n\t\tlet currentParentId = parentMessage ? parentMessage.id : null;\n\t\tfor (const message of messages) {\n\t\t\tlet messageId = uuidv4();\n\n\t\t\tif (message.role === 'user') {\n\t\t\t\tconst userMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = userMessage;\n\t\t\t\tparentMessage = userMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t} else {\n\t\t\t\tconst responseMessage = {\n\t\t\t\t\tid: messageId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\tdone: true,\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: 0,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000),\n\t\t\t\t\t...message\n\t\t\t\t};\n\n\t\t\t\tif (parentMessage) {\n\t\t\t\t\tparentMessage.childrenIds.push(messageId);\n\t\t\t\t\thistory.messages[parentMessage.id] = parentMessage;\n\t\t\t\t}\n\n\t\t\t\thistory.messages[messageId] = responseMessage;\n\t\t\t\tparentMessage = responseMessage;\n\t\t\t\tcurrentParentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\thistory.currentId = currentParentId;\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length === 0) {\n\t\t\tawait initChatHandler(history);\n\t\t} else {\n\t\t\tawait saveChatHandler($chatId, history);\n\t\t}\n\t};\n\n\tconst chatCompletionEventHandler = async (data, message, chatId) => {\n\t\tconst { id, done, choices, content, sources, selected_model_id, error, usage } = data;\n\n\t\tif (error) {\n\t\t\tawait handleOpenAIError(error, message);\n\t\t}\n\n\t\tif (sources && !message?.sources) {\n\t\t\tmessage.sources = sources;\n\t\t}\n\n\t\tif (choices) {\n\t\t\tif (choices[0]?.message?.content) {\n\t\t\t\t// Non-stream response\n\t\t\t\tmessage.content += choices[0]?.message?.content;\n\t\t\t} else {\n\t\t\t\t// Stream response\n\t\t\t\tlet value = choices[0]?.delta?.content ?? '';\n\t\t\t\tif (message.content == '' && value == '\\n') {\n\t\t\t\t\tconsole.log('Empty response');\n\t\t\t\t} else {\n\t\t\t\t\tmessage.content += value;\n\n\t\t\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\t\t\tnavigator.vibrate(5);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Emit chat event for TTS\n\t\t\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t\t);\n\t\t\t\t\tmessageContentParts.pop();\n\n\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\tif (\n\t\t\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t\t\t) {\n\t\t\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (content) {\n\t\t\t// REALTIME_CHAT_SAVE is disabled\n\t\t\tmessage.content = content;\n\n\t\t\tif (navigator.vibrate && ($settings?.hapticFeedback ?? false)) {\n\t\t\t\tnavigator.vibrate(5);\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tconst messageContentParts = getMessageContentParts(\n\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t);\n\t\t\tmessageContentParts.pop();\n\n\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\tif (\n\t\t\t\tmessageContentParts.length > 0 &&\n\t\t\t\tmessageContentParts[messageContentParts.length - 1] !== message.lastSentence\n\t\t\t) {\n\t\t\t\tmessage.lastSentence = messageContentParts[messageContentParts.length - 1];\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\t\tcontent: messageContentParts[messageContentParts.length - 1]\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (selected_model_id) {\n\t\t\tmessage.selectedModelId = selected_model_id;\n\t\t\tmessage.arena = true;\n\t\t}\n\n\t\tif (usage) {\n\t\t\tmessage.usage = usage;\n\t\t}\n\n\t\thistory.messages[message.id] = message;\n\n\t\tif (done) {\n\t\t\tmessage.done = true;\n\n\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\tcopyToClipboard(message.content);\n\t\t\t}\n\n\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\tawait tick();\n\t\t\t\tdocument.getElementById(`speak-button-${message.id}`)?.click();\n\t\t\t}\n\n\t\t\t// Emit chat event for TTS\n\t\t\tlet lastMessageContentPart =\n\t\t\t\tgetMessageContentParts(\n\t\t\t\t\tremoveAllDetails(message.content),\n\t\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t\t)?.at(-1) ?? '';\n\t\t\tif (lastMessageContentPart) {\n\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\tdetail: { id: message.id, content: lastMessageContentPart }\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\tid: message.id,\n\t\t\t\t\t\tcontent: message.content\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\n\t\t\thistory.messages[message.id] = message;\n\n\t\t\tawait tick();\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait chatCompletedHandler(\n\t\t\t\tchatId,\n\t\t\t\tmessage.model,\n\t\t\t\tmessage.id,\n\t\t\t\tcreateMessagesList(history, message.id)\n\t\t\t);\n\t\t}\n\n\t\tconsole.log(data);\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tconsole.log('submitPrompt', userPrompt, $chatId);\n\n\t\tconst _selectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (JSON.stringify(selectedModels) !== JSON.stringify(_selectedModels)) {\n\t\t\tselectedModels = _selectedModels;\n\t\t}\n\n\t\tif (userPrompt === '' && files.length === 0) {\n\t\t\ttoast.error($i18n.t('Please enter a prompt'));\n\t\t\treturn;\n\t\t}\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.type !== 'image' && file.status === 'uploading').length > 0\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`Oops! There are files still uploading. Please wait for the upload to complete.`)\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t($config?.file?.max_count ?? null) !== null &&\n\t\t\tfiles.length + chatFiles.length > $config?.file?.max_count\n\t\t) {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`You can only chat with a maximum of {{maxCount}} file(s) at a time.`, {\n\t\t\t\t\tmaxCount: $config?.file?.max_count\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tif (history?.currentId) {\n\t\t\tconst lastMessage = history.messages[history.currentId];\n\t\t\tif (lastMessage.done != true) {\n\t\t\t\t// Response not done\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (lastMessage.error && !lastMessage.content) {\n\t\t\t\t// Error in response\n\t\t\t\ttoast.error($i18n.t(`Oops! There was an error in the previous response.`));\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tmessageInput?.setText('');\n\t\tprompt = '';\n\n\t\tconst messages = createMessagesList(history, history.currentId);\n\t\tconst _files = JSON.parse(JSON.stringify(files));\n\n\t\tchatFiles.push(\n\t\t\t..._files.filter(\n\t\t\t\t(item) =>\n\t\t\t\t\t['doc', 'text', 'note', 'chat', 'folder', 'collection'].includes(item.type) ||\n\t\t\t\t\t(item.type === 'file' && !(item?.content_type ?? '').startsWith('image/'))\n\t\t\t)\n\t\t);\n\t\tchatFiles = chatFiles.filter(\n\t\t\t// Remove duplicates\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tfiles = [];\n\t\tmessageInput?.setText('');\n\n\t\t// Create user message\n\t\tlet userMessageId = uuidv4();\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\tmodels: selectedModels\n\t\t};\n\n\t\t// Add message to history and Set currentId to messageId\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\t// Append messageId to childrenIds of parent message\n\t\tif (messages.length !== 0) {\n\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t}\n\n\t\t// focus on chat input\n\t\tconst chatInput = document.getElementById('chat-input');\n\t\tchatInput?.focus();\n\n\t\tsaveSessionSelectedModels();\n\n\t\tawait sendMessage(history, userMessageId, { newChat: true });\n\t};\n\n\tconst sendMessage = async (\n\t\t_history,\n\t\tparentId: string,\n\t\t{\n\t\t\tmessages = null,\n\t\t\tmodelId = null,\n\t\t\tmodelIdx = null,\n\t\t\tnewChat = false\n\t\t}: {\n\t\t\tmessages?: any[] | null;\n\t\t\tmodelId?: string | null;\n\t\t\tmodelIdx?: number | null;\n\t\t\tnewChat?: boolean;\n\t\t} = {}\n\t) => {\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tlet _chatId = JSON.parse(JSON.stringify($chatId));\n\t\t_history = JSON.parse(JSON.stringify(_history));\n\n\t\tconst responseMessageIds: Record<PropertyKey, string> = {};\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t\t? [atSelectedModel.id]\n\t\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tfor (const [_modelIdx, modelId] of selectedModelIds.entries()) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tmodelIdx: modelIdx ? modelIdx : _modelIdx,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null && history.messages[parentId]) {\n\t\t\t\t\t// Add null check before accessing childrenIds\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\thistory = history;\n\n\t\t// Create new chat if newChat is true and first user message\n\t\tif (newChat && _history.messages[_history.currentId].parentId === null) {\n\t\t\t_chatId = await initChatHandler(_history);\n\t\t}\n\n\t\tawait tick();\n\n\t\t_history = JSON.parse(JSON.stringify(history));\n\t\t// Save chat after all messages have been created\n\t\tawait saveChatHandler(_chatId, _history);\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId, _modelIdx) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\t// Skip this check if image generation is enabled, as images may be for editing or are generated outputs in the history\n\t\t\t\t\tconst hasImages = createMessagesList(_history, parentId).some((message) =>\n\t\t\t\t\t\tmessage.files?.some(\n\t\t\t\t\t\t\t(file) => file.type === 'image' || (file?.content_type ?? '').startsWith('image/')\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\thasImages &&\n\t\t\t\t\t\t!(model.info?.meta?.capabilities?.vision ?? true) &&\n\t\t\t\t\t\t!imageGenerationEnabled\n\t\t\t\t\t) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId =\n\t\t\t\t\t\tresponseMessageIds[`${modelId}-${modelIdx ? modelIdx : _modelIdx}`];\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tmessages && messages.length > 0\n\t\t\t\t\t\t\t? messages\n\t\t\t\t\t\t\t: createMessagesList(_history, responseMessageId),\n\t\t\t\t\t\t_history,\n\t\t\t\t\t\tresponseMessageId,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tcurrentChatPage.set(1);\n\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\t};\n\n\tconst getFeatures = () => {\n\t\tlet features = {};\n\n\t\tif ($config?.features)\n\t\t\tfeatures = {\n\t\t\t\tvoice: $showCallOverlay,\n\t\t\t\timage_generation:\n\t\t\t\t\t$config?.features?.enable_image_generation &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.image_generation)\n\t\t\t\t\t\t? imageGenerationEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tcode_interpreter:\n\t\t\t\t\t$config?.features?.enable_code_interpreter &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.code_interpreter)\n\t\t\t\t\t\t? codeInterpreterEnabled\n\t\t\t\t\t\t: false,\n\t\t\t\tweb_search:\n\t\t\t\t\t$config?.features?.enable_web_search &&\n\t\t\t\t\t($user?.role === 'admin' || $user?.permissions?.features?.web_search)\n\t\t\t\t\t\t? webSearchEnabled\n\t\t\t\t\t\t: false\n\t\t\t};\n\n\t\tconst currentModels = atSelectedModel?.id ? [atSelectedModel.id] : selectedModels;\n\t\tif (\n\t\t\tcurrentModels.filter(\n\t\t\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.web_search ?? true\n\t\t\t).length === currentModels.length\n\t\t) {\n\t\t\tif ($config?.features?.enable_web_search && ($settings?.webSearch ?? false) === 'always') {\n\t\t\t\tfeatures = { ...features, web_search: true };\n\t\t\t}\n\t\t}\n\n\t\tif ($settings?.memory ?? false) {\n\t\t\tfeatures = { ...features, memory: true };\n\t\t}\n\n\t\treturn features;\n\t};\n\n\tconst sendMessageSocket = async (model, _messages, _history, responseMessageId, _chatId) => {\n\t\tconst responseMessage = _history.messages[responseMessageId];\n\t\tconst userMessage = _history.messages[responseMessage.parentId];\n\n\t\tconst chatMessageFiles = _messages\n\t\t\t.filter((message) => message.files)\n\t\t\t.flatMap((message) => message.files);\n\n\t\t// Filter chatFiles to only include files that are in the chatMessageFiles\n\t\tchatFiles = chatFiles.filter((item) => {\n\t\t\tconst fileExists = chatMessageFiles.some((messageFile) => messageFile.id === item.id);\n\t\t\treturn fileExists;\n\t\t});\n\n\t\tlet files = JSON.parse(JSON.stringify(chatFiles));\n\t\tfiles.push(\n\t\t\t...(userMessage?.files ?? []).filter(\n\t\t\t\t(item) =>\n\t\t\t\t\t['doc', 'text', 'note', 'chat', 'collection'].includes(item.type) ||\n\t\t\t\t\t(item.type === 'file' && !(item?.content_type ?? '').startsWith('image/'))\n\t\t\t)\n\t\t);\n\t\t// Remove duplicates\n\t\tfiles = files.filter(\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tscrollToBottom();\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\tlet userLocation;\n\t\tif ($settings?.userLocation) {\n\t\t\tuserLocation = await getAndUpdateUserLocation(localStorage.token).catch((err) => {\n\t\t\t\tconsole.error(err);\n\t\t\t\treturn undefined;\n\t\t\t});\n\t\t}\n\n\t\tconst stream =\n\t\t\tmodel?.info?.params?.stream_response ??\n\t\t\t$settings?.params?.stream_response ??\n\t\t\tparams?.stream_response ??\n\t\t\ttrue;\n\n\t\tlet messages = [\n\t\t\tparams?.system || $settings.system\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${params?.system ?? $settings?.system ?? ''}`\n\t\t\t\t\t}\n\t\t\t\t: undefined,\n\t\t\t..._messages.map((message) => ({\n\t\t\t\t...message,\n\t\t\t\tcontent: processDetails(message.content)\n\t\t\t}))\n\t\t].filter((message) => message);\n\n\t\tmessages = messages\n\t\t\t.map((message, idx, arr) => {\n\t\t\t\tconst imageFiles = (message?.files ?? []).filter(\n\t\t\t\t\t(file) => file.type === 'image' || (file?.content_type ?? '').startsWith('image/')\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\trole: message.role,\n\t\t\t\t\t...(message.role === 'user' && imageFiles.length > 0\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\ttext: message?.merged?.content ?? message.content\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t...imageFiles.map((file) => ({\n\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\tcontent: message?.merged?.content ?? message.content\n\t\t\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((message) => message?.role === 'user' || message?.content?.trim());\n\n\t\tconst toolIds = [];\n\t\tconst toolServerIds = [];\n\n\t\tfor (const toolId of selectedToolIds) {\n\t\t\tif (toolId.startsWith('direct_server:')) {\n\t\t\t\tlet serverId = toolId.replace('direct_server:', '');\n\t\t\t\t// Check if serverId is a number\n\t\t\t\tif (!isNaN(parseInt(serverId))) {\n\t\t\t\t\ttoolServerIds.push(parseInt(serverId));\n\t\t\t\t} else {\n\t\t\t\t\ttoolServerIds.push(serverId);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoolIds.push(toolId);\n\t\t\t}\n\t\t}\n\n\t\tconst res = await generateOpenAIChatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tstream: stream,\n\t\t\t\tmodel: model.id,\n\t\t\t\tmessages: messages,\n\t\t\t\tparams: {\n\t\t\t\t\t...$settings?.params,\n\t\t\t\t\t...params,\n\t\t\t\t\tstop:\n\t\t\t\t\t\t(params?.stop ?? $settings?.params?.stop ?? undefined)\n\t\t\t\t\t\t\t? (params?.stop.split(',').map((token) => token.trim()) ?? $settings.params.stop).map(\n\t\t\t\t\t\t\t\t\t(str) => decodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t},\n\n\t\t\t\tfiles: (files?.length ?? 0) > 0 ? files : undefined,\n\n\t\t\t\tfilter_ids: selectedFilterIds.length > 0 ? selectedFilterIds : undefined,\n\t\t\t\ttool_ids: toolIds.length > 0 ? toolIds : undefined,\n\t\t\t\ttool_servers: ($toolServers ?? []).filter(\n\t\t\t\t\t(server, idx) => toolServerIds.includes(idx) || toolServerIds.includes(server?.id)\n\t\t\t\t),\n\t\t\t\tfeatures: getFeatures(),\n\t\t\t\tvariables: {\n\t\t\t\t\t...getPromptVariables($user?.name, $settings?.userLocation ? userLocation : undefined)\n\t\t\t\t},\n\t\t\t\tmodel_item: $models.find((m) => m.id === model.id),\n\n\t\t\t\tsession_id: $socket?.id,\n\t\t\t\tchat_id: $chatId,\n\n\t\t\t\tid: responseMessageId,\n\t\t\t\tparent_id: userMessage?.id ?? null,\n\t\t\t\tparent_message: userMessage,\n\n\t\t\t\tbackground_tasks: {\n\t\t\t\t\t...(!$temporaryChatEnabled &&\n\t\t\t\t\t(messages.length == 1 ||\n\t\t\t\t\t\t(messages.length == 2 &&\n\t\t\t\t\t\t\tmessages.at(0)?.role === 'system' &&\n\t\t\t\t\t\t\tmessages.at(1)?.role === 'user')) &&\n\t\t\t\t\t(selectedModels[0] === model.id || atSelectedModel !== undefined)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\ttitle_generation: $settings?.title?.auto ?? true,\n\t\t\t\t\t\t\t\ttags_generation: $settings?.autoTags ?? true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}),\n\t\t\t\t\tfollow_up_generation: $settings?.autoFollowUps ?? true\n\t\t\t\t},\n\n\t\t\t\t...(stream && (model.info?.meta?.capabilities?.usage ?? false)\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tstream_options: {\n\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t).catch(async (error) => {\n\t\t\tconsole.log(error);\n\n\t\t\tlet errorMessage = error;\n\t\t\tif (error?.error?.message) {\n\t\t\t\terrorMessage = error.error.message;\n\t\t\t} else if (error?.message) {\n\t\t\t\terrorMessage = error.message;\n\t\t\t}\n\n\t\t\tif (typeof errorMessage === 'object') {\n\t\t\t\terrorMessage = $i18n.t(`Uh-oh! There was an issue with the response.`);\n\t\t\t}\n\n\t\t\ttoast.error(`${errorMessage}`);\n\t\t\tresponseMessage.error = {\n\t\t\t\tcontent: error\n\t\t\t};\n\n\t\t\tresponseMessage.done = true;\n\n\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\thistory.currentId = responseMessageId;\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tif (res.error) {\n\t\t\t\tawait handleOpenAIError(res.error, responseMessage);\n\t\t\t} else {\n\t\t\t\tif (taskIds) {\n\t\t\t\t\ttaskIds.push(res.task_id);\n\t\t\t\t} else {\n\t\t\t\t\ttaskIds = [res.task_id];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\t\tscrollToBottom();\n\t};\n\n\tconst handleOpenAIError = async (error, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t}\n\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\t// FastAPI error\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\t// OpenAI error\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\t// OpenAI error\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue with the response.`) + '\\n' + errorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tif (responseMessage.statusHistory) {\n\t\t\tresponseMessage.statusHistory = responseMessage.statusHistory.filter(\n\t\t\t\t(status) => status.action !== 'knowledge_search'\n\t\t\t);\n\t\t}\n\n\t\thistory.messages[responseMessage.id] = responseMessage;\n\t};\n\n\tconst stopResponse = async () => {\n\t\tif (taskIds) {\n\t\t\tfor (const taskId of taskIds) {\n\t\t\t\tconst res = await stopTask(localStorage.token, taskId).catch((error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttaskIds = null;\n\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\t// Set all response messages to done\n\t\t\tif (responseMessage.parentId && history.messages[responseMessage.parentId]) {\n\t\t\t\tfor (const messageId of history.messages[responseMessage.parentId].childrenIds) {\n\t\t\t\t\thistory.messages[messageId].done = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thistory.messages[history.currentId] = responseMessage;\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\t\t}\n\n\t\tif (generating) {\n\t\t\tgenerating = false;\n\t\t\tgenerationController?.abort();\n\t\t\tgenerationController = null;\n\t\t}\n\t};\n\n\tconst submitMessage = async (parentId, prompt) => {\n\t\tlet userPrompt = prompt;\n\t\tlet userMessageId = uuidv4();\n\n\t\tlet userMessage = {\n\t\t\tid: userMessageId,\n\t\t\tparentId: parentId,\n\t\t\tchildrenIds: [],\n\t\t\trole: 'user',\n\t\t\tcontent: userPrompt,\n\t\t\tmodels: selectedModels,\n\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t};\n\n\t\tif (parentId !== null) {\n\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\tuserMessageId\n\t\t\t];\n\t\t}\n\n\t\thistory.messages[userMessageId] = userMessage;\n\t\thistory.currentId = userMessageId;\n\n\t\tawait tick();\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tawait sendMessage(history, userMessageId);\n\t};\n\n\tconst regenerateResponse = async (message, suggestionPrompt = null) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (history.currentId) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\n\t\t\tif (!userMessage) {\n\t\t\t\ttoast.error($i18n.t('Parent message not found'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (autoScroll) {\n\t\t\t\tscrollToBottom();\n\t\t\t}\n\n\t\t\tawait sendMessage(history, userMessage.id, {\n\t\t\t\t...(suggestionPrompt\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tmessages: [\n\t\t\t\t\t\t\t\t...createMessagesList(history, message.id),\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\t\t\t\tcontent: suggestionPrompt\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}),\n\t\t\t\t...((userMessage?.models ?? [...selectedModels]).length > 1\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t// If multiple models are selected, use the model from the message\n\t\t\t\t\t\t\tmodelId: message.model,\n\t\t\t\t\t\t\tmodelIdx: message.modelIdx\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t});\n\t\t}\n\t};\n\n\tconst continueResponse = async () => {\n\t\tconsole.log('continueResponse');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (history.currentId && history.messages[history.currentId].done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models\n\t\t\t\t.filter((m) => m.id === (responseMessage?.selectedModelId ?? responseMessage.model))\n\t\t\t\t.at(0);\n\n\t\t\tif (model) {\n\t\t\t\tawait sendMessageSocket(\n\t\t\t\t\tmodel,\n\t\t\t\t\tcreateMessagesList(history, responseMessage.id),\n\t\t\t\t\thistory,\n\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t_chatId\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst mergeResponses = async (messageId, responses, _chatId) => {\n\t\tconsole.log('mergeResponses', messageId, responses);\n\t\tconst message = history.messages[messageId];\n\t\tconst mergedResponse = {\n\t\t\tstatus: true,\n\t\t\tcontent: ''\n\t\t};\n\t\tmessage.merged = mergedResponse;\n\t\thistory.messages[messageId] = message;\n\n\t\ttry {\n\t\t\tgenerating = true;\n\t\t\tconst [res, controller] = await generateMoACompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.model ?? '',\n\t\t\t\tmessage.parentId ? history.messages[message.parentId].content : '',\n\t\t\t\tresponses\n\t\t\t);\n\n\t\t\tif (res && res.ok && res.body && generating) {\n\t\t\t\tgenerationController = controller as AbortController;\n\t\t\t\tconst textStream = await createOpenAITextStream(\n\t\t\t\t\tres.body,\n\t\t\t\t\tBoolean($settings?.splitLargeChunks ?? false)\n\t\t\t\t);\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, sources, error, usage } = update;\n\t\t\t\t\tif (error || done) {\n\t\t\t\t\t\tgenerating = false;\n\t\t\t\t\t\tgenerationController = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (mergedResponse.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmergedResponse.content += value;\n\t\t\t\t\t\thistory.messages[messageId] = message;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait saveChatHandler(_chatId, history);\n\t\t\t} else {\n\t\t\t\tconsole.error(res);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n\n\tconst initChatHandler = async (history) => {\n\t\tlet _chatId = $chatId;\n\n\t\tif (!$temporaryChatEnabled) {\n\t\t\tchat = await createNewChat(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tid: _chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\tparams: params,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t},\n\t\t\t\t$selectedFolder?.id\n\t\t\t);\n\n\t\t\t_chatId = chat.id;\n\t\t\tawait chatId.set(_chatId);\n\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tawait tick();\n\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\tcurrentChatPage.set(1);\n\n\t\t\tselectedFolder.set(null);\n\t\t} else {\n\t\t\t_chatId = `local:${$socket?.id}`; // Use socket id for temporary chat\n\t\t\tawait chatId.set(_chatId);\n\t\t}\n\t\tawait tick();\n\n\t\treturn _chatId;\n\t};\n\n\tconst saveChatHandler = async (_chatId, history) => {\n\t\tif ($chatId == _chatId) {\n\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\thistory: history,\n\t\t\t\t\tmessages: createMessagesList(history, history.currentId),\n\t\t\t\t\tparams: params,\n\t\t\t\t\tfiles: chatFiles\n\t\t\t\t});\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t}\n\t\t}\n\t};\n\n\tconst MAX_DRAFT_LENGTH = 5000;\n\tlet saveDraftTimeout: ReturnType<typeof setTimeout> | null = null;\n\n\tconst saveDraft = async (draft, chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\n\t\tif (draft.prompt !== null && draft.prompt.length < MAX_DRAFT_LENGTH) {\n\t\t\tsaveDraftTimeout = setTimeout(async () => {\n\t\t\t\tawait sessionStorage.setItem(\n\t\t\t\t\t`chat-input${chatId ? `-${chatId}` : ''}`,\n\t\t\t\t\tJSON.stringify(draft)\n\t\t\t\t);\n\t\t\t}, 500);\n\t\t} else {\n\t\t\tsessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t\t}\n\t};\n\n\tconst clearDraft = async (chatId = null) => {\n\t\tif (saveDraftTimeout) {\n\t\t\tclearTimeout(saveDraftTimeout);\n\t\t}\n\t\tawait sessionStorage.removeItem(`chat-input${chatId ? `-${chatId}` : ''}`);\n\t};\n\n\tconst moveChatHandler = async (chatId, folderId) => {\n\t\tif (chatId && folderId) {\n\t\t\tconst res = await updateChatFolderIdById(localStorage.token, chatId, folderId).catch(\n\t\t\t\t(error) => {\n\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tif (res) {\n\t\t\t\tcurrentChatPage.set(1);\n\t\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t\t\tawait pinnedChats.set(await getPinnedChatList(localStorage.token));\n\n\t\t\t\ttoast.success($i18n.t('Chat moved successfully'));\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to move chat'));\n\t\t}\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{$settings.showChatTitleInTab !== false && $chatTitle\n\t\t\t? `${$chatTitle.length > 30 ? `${$chatTitle.slice(0, 30)}...` : $chatTitle}  ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\"></audio>\n\n<EventConfirmDialog\n\tbind:show={showEventConfirmation}\n\ttitle={eventConfirmationTitle}\n\tmessage={eventConfirmationMessage}\n\tinput={eventConfirmationInput}\n\tinputPlaceholder={eventConfirmationInputPlaceholder}\n\tinputValue={eventConfirmationInputValue}\n\ton:confirm={(e) => {\n\t\tif (e.detail) {\n\t\t\teventCallback(e.detail);\n\t\t} else {\n\t\t\teventCallback(true);\n\t\t}\n\t}}\n\ton:cancel={() => {\n\t\teventCallback(false);\n\t}}\n/>\n\n<div\n\tclass=\"h-screen max-h-[100dvh] transition-width duration-200 ease-in-out {$showSidebar\n\t\t? '  md:max-w-[calc(100%-var(--sidebar-width))]'\n\t\t: ' '} w-full max-w-full flex flex-col\"\n\tid=\"chat-container\"\n>\n\t{#if !loading}\n\t\t<div in:fade={{ duration: 50 }} class=\"w-full h-full flex flex-col\">\n\t\t\t{#if $selectedFolder && $selectedFolder?.meta?.background_image_url}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$selectedFolder?.meta?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{:else if $settings?.backgroundImageUrl ?? $config?.license_metadata?.background_image_url ?? null}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat\"\n\t\t\t\t\tstyle=\"background-image: url({$settings?.backgroundImageUrl ??\n\t\t\t\t\t\t$config?.license_metadata?.background_image_url})  \"\n\t\t\t\t/>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"absolute top-0 left-0 w-full h-full bg-linear-to-t from-white to-white/85 dark:from-gray-900 dark:to-gray-900/90 z-0\"\n\t\t\t\t/>\n\t\t\t{/if}\n\n\t\t\t<PaneGroup direction=\"horizontal\" class=\"w-full h-full\">\n\t\t\t\t<Pane defaultSize={50} minSize={30} class=\"h-full flex relative max-w-full flex-col\">\n\t\t\t\t\t<Navbar\n\t\t\t\t\t\tbind:this={navbarElement}\n\t\t\t\t\t\tchat={{\n\t\t\t\t\t\t\tid: $chatId,\n\t\t\t\t\t\t\tchat: {\n\t\t\t\t\t\t\t\ttitle: $chatTitle,\n\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\t\t\t\tparams: params,\n\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t\t{history}\n\t\t\t\t\t\ttitle={$chatTitle}\n\t\t\t\t\t\tbind:selectedModels\n\t\t\t\t\t\tshareEnabled={!!history.currentId}\n\t\t\t\t\t\t{initNewChat}\n\t\t\t\t\t\tarchiveChatHandler={() => {}}\n\t\t\t\t\t\t{moveChatHandler}\n\t\t\t\t\t\tonSaveTempChat={async () => {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tif (!history?.currentId || !Object.keys(history.messages).length) {\n\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('No conversation to save'));\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst messages = createMessagesList(history, history.currentId);\n\t\t\t\t\t\t\t\tconst title =\n\t\t\t\t\t\t\t\t\tmessages.find((m) => m.role === 'user')?.content ?? $i18n.t('New Chat');\n\n\t\t\t\t\t\t\t\tconst savedChat = await createNewChat(\n\t\t\t\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: uuidv4(),\n\t\t\t\t\t\t\t\t\t\ttitle: title.length > 50 ? `${title.slice(0, 50)}...` : title,\n\t\t\t\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tnull\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (savedChat) {\n\t\t\t\t\t\t\t\t\ttemporaryChatEnabled.set(false);\n\t\t\t\t\t\t\t\t\tchatId.set(savedChat.id);\n\t\t\t\t\t\t\t\t\tchats.set(await getChatList(localStorage.token, $currentChatPage));\n\n\t\t\t\t\t\t\t\t\tawait goto(`/c/${savedChat.id}`);\n\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Conversation saved successfully'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tconsole.error('Error saving conversation:', error);\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Failed to save conversation'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class=\"flex flex-col flex-auto z-10 w-full @container overflow-auto\">\n\t\t\t\t\t\t{#if ($settings?.landingPageMode === 'chat' && !$selectedFolder) || createMessagesList(history, history.currentId).length > 0}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full z-10 scrollbar-hidden\"\n\t\t\t\t\t\t\t\tid=\"messages-container\"\n\t\t\t\t\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\t\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\t\t\t\t\tautoScroll =\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" h-full w-full flex flex-col\">\n\t\t\t\t\t\t\t\t\t<Messages\n\t\t\t\t\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\t\tsetInputText={(text) => {\n\t\t\t\t\t\t\t\t\t\t\tmessageInput?.setText(text);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\t\t{atSelectedModel}\n\t\t\t\t\t\t\t\t\t\t{sendMessage}\n\t\t\t\t\t\t\t\t\t\t{showMessage}\n\t\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t\t\t\t\t{chatActionHandler}\n\t\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t\ttopPadding={true}\n\t\t\t\t\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" pb-2 z-10\">\n\t\t\t\t\t\t\t\t<MessageInput\n\t\t\t\t\t\t\t\t\tbind:this={messageInput}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{taskIds}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{generating}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data, $chatId);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"absolute bottom-1 text-xs text-gray-500 text-center line-clamp-1 right-0 left-0\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('LLMs can make mistakes. Verify important information.')} -->\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"flex items-center h-full\">\n\t\t\t\t\t\t\t\t<Placeholder\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tbind:messageInput\n\t\t\t\t\t\t\t\t\tbind:files\n\t\t\t\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\tbind:selectedFilterIds\n\t\t\t\t\t\t\t\t\tbind:imageGenerationEnabled\n\t\t\t\t\t\t\t\t\tbind:codeInterpreterEnabled\n\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\tbind:atSelectedModel\n\t\t\t\t\t\t\t\t\tbind:showCommands\n\t\t\t\t\t\t\t\t\ttoolServers={$toolServers}\n\t\t\t\t\t\t\t\t\t{stopResponse}\n\t\t\t\t\t\t\t\t\t{createMessagePair}\n\t\t\t\t\t\t\t\t\t{onSelect}\n\t\t\t\t\t\t\t\t\t{onUpload}\n\t\t\t\t\t\t\t\t\tonChange={(data) => {\n\t\t\t\t\t\t\t\t\t\tif (!$temporaryChatEnabled) {\n\t\t\t\t\t\t\t\t\t\t\tsaveDraft(data);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:submit={async (e) => {\n\t\t\t\t\t\t\t\t\t\tclearDraft();\n\t\t\t\t\t\t\t\t\t\tif (e.detail || files.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(e.detail.replaceAll('\\n\\n', '\\n'));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</Pane>\n\n\t\t\t\t<ChatControls\n\t\t\t\t\tbind:this={controlPaneComponent}\n\t\t\t\t\tbind:history\n\t\t\t\t\tbind:chatFiles\n\t\t\t\t\tbind:params\n\t\t\t\t\tbind:files\n\t\t\t\t\tbind:pane={controlPane}\n\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\tmodelId={selectedModelIds?.at(0) ?? null}\n\t\t\t\t\tmodels={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\t\tif (model) {\n\t\t\t\t\t\t\treturn [...a, model];\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn a;\n\t\t\t\t\t}, [])}\n\t\t\t\t\t{submitPrompt}\n\t\t\t\t\t{stopResponse}\n\t\t\t\t\t{showMessage}\n\t\t\t\t\t{eventTarget}\n\t\t\t\t/>\n\t\t\t</PaneGroup>\n\t\t</div>\n\t{:else if loading}\n\t\t<div class=\" flex items-center justify-center h-full w-full\">\n\t\t\t<div class=\"m-auto\">\n\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t::-webkit-scrollbar {\n\t\theight: 0.5rem;\n\t\twidth: 0.5rem;\n\t}\n</style>\n"],"file":"_app/immutable/chunks/Bc8mGS8z.js"}