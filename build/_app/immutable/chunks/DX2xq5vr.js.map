{"version":3,"file":"DX2xq5vr.js","sources":["../../../../../../src/lib/components/chat/Messages/RateComment.svelte","../../../../../../src/lib/components/chat/Messages/ResponseMessage/WebSearchResults.svelte","../../../../../../src/lib/components/chat/Messages/Error.svelte","../../../../../../src/lib/components/chat/Messages/Citations/CitationModal.svelte","../../../../../../src/lib/components/chat/Messages/Citations.svelte","../../../../../../src/lib/components/chat/Messages/CodeExecutionModal.svelte","../../../../../../src/lib/components/chat/Messages/CodeExecutions.svelte","../../../../../../src/lib/components/chat/ContentRenderer/FloatingButtons.svelte","../../../../../../src/lib/components/chat/Messages/ContentRenderer.svelte","../../../../../../src/lib/workers/KokoroWorker.ts","../../../../../../src/lib/components/chat/Messages/ResponseMessage/FollowUps.svelte","../../../../../../src/lib/components/icons/LineSpace.svelte","../../../../../../src/lib/components/icons/LineSpaceSmaller.svelte","../../../../../../src/lib/components/chat/Messages/ResponseMessage/RegenerateMenu.svelte","../../../../../../src/lib/components/chat/Messages/ResponseMessage/StatusHistory/StatusItem.svelte","../../../../../../src/lib/components/chat/Messages/ResponseMessage/StatusHistory.svelte","../../../../../../src/lib/components/chat/Messages/ResponseMessage.svelte","../../../../../../src/lib/components/icons/Merge.svelte","../../../../../../src/lib/components/chat/Messages/MultiResponseMessages.svelte","../../../../../../src/lib/components/chat/Messages/UserMessage.svelte","../../../../../../src/lib/components/chat/Messages/Message.svelte","../../../../../../src/lib/components/chat/Suggestions.svelte","../../../../../../src/lib/components/chat/ChatPlaceholder.svelte","../../../../../../src/lib/components/chat/Messages.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { createEventDispatcher, onMount, getContext } from 'svelte';\n\timport { config, models, tags as _tags } from '$lib/stores';\n\timport Tags from '$lib/components/common/Tags.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let message;\n\texport let show = false;\n\n\tlet LIKE_REASONS = [\n\t\t'accurate_information',\n\t\t'followed_instructions_perfectly',\n\t\t'showcased_creativity',\n\t\t'positive_attitude',\n\t\t'attention_to_detail',\n\t\t'thorough_explanation',\n\t\t'other'\n\t];\n\tlet DISLIKE_REASONS = [\n\t\t'dont_like_the_style',\n\t\t'too_verbose',\n\t\t'not_helpful',\n\t\t'not_factually_correct',\n\t\t'didnt_fully_follow_instructions',\n\t\t'refused_when_it_shouldnt_have',\n\t\t'being_lazy',\n\t\t'other'\n\t];\n\n\tlet tags = [];\n\n\tlet reasons = [];\n\tlet selectedReason = null;\n\tlet comment = '';\n\n\tlet detailedRating = null;\n\tlet selectedModel = null;\n\n\t$: if (message?.annotation?.rating === 1) {\n\t\treasons = LIKE_REASONS;\n\t} else if (message?.annotation?.rating === -1) {\n\t\treasons = DISLIKE_REASONS;\n\t}\n\n\t$: if (message) {\n\t\tinit();\n\t}\n\n\tconst init = () => {\n\t\tif (!selectedReason) {\n\t\t\tselectedReason = message?.annotation?.reason ?? '';\n\t\t}\n\n\t\tif (!comment) {\n\t\t\tcomment = message?.annotation?.comment ?? '';\n\t\t}\n\n\t\ttags = (message?.annotation?.tags ?? []).map((tag) => ({\n\t\t\tname: tag\n\t\t}));\n\n\t\tif (!detailedRating) {\n\t\t\tdetailedRating = message?.annotation?.details?.rating ?? null;\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\tif (message?.arena) {\n\t\t\tselectedModel = $models.find((m) => m.id === message.selectedModelId);\n\t\t\ttoast.success(\n\t\t\t\t$i18n.t('This response was generated by \"{{model}}\"', {\n\t\t\t\t\tmodel: selectedModel ? (selectedModel?.name ?? selectedModel.id) : message.selectedModelId\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t});\n\n\tconst saveHandler = () => {\n\t\tconsole.log('saveHandler');\n\t\t// if (!selectedReason) {\n\t\t// \ttoast.error($i18n.t('Please select a reason'));\n\t\t// \treturn;\n\t\t// }\n\n\t\tdispatch('save', {\n\t\t\treason: selectedReason,\n\t\t\tcomment: comment,\n\t\t\ttags: tags.map((tag) => tag.name),\n\t\t\tdetails: {\n\t\t\t\trating: detailedRating\n\t\t\t}\n\t\t});\n\n\t\ttoast.success($i18n.t('Thanks for your feedback!'));\n\t\tshow = false;\n\t};\n</script>\n\n{#if message?.arena}\n\t<div class=\"text-xs font-medium pt-1.5 -mb-0.5\">\n\t\t{$i18n.t('This response was generated by \"{{model}}\"', {\n\t\t\tmodel: selectedModel ? (selectedModel?.name ?? selectedModel.id) : message.selectedModelId\n\t\t})}\n\t</div>\n{/if}\n\n<div\n\tclass=\" my-2.5 rounded-xl px-4 py-3 border border-gray-100/30 dark:border-gray-850/30\"\n\tid=\"message-feedback-{message.id}\"\n>\n\t<div class=\"flex justify-between items-center\">\n\t\t<div class=\"text-sm font-medium\">{$i18n.t('How would you rate this response?')}</div>\n\n\t\t<!-- <div class=\" text-sm\">{$i18n.t('Tell us more:')}</div> -->\n\n\t\t<button\n\t\t\ton:click={() => {\n\t\t\t\tshow = false;\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className={'size-4'} />\n\t\t</button>\n\t</div>\n\n\t<div class=\"w-full flex justify-center\">\n\t\t<div class=\" relative w-fit overflow-x-auto scrollbar-none\">\n\t\t\t<div class=\"mt-1.5 w-fit flex gap-1 pb-2\">\n\t\t\t\t<!-- 1-10 scale -->\n\t\t\t\t{#each Array.from({ length: 10 }).map((_, i) => i + 1) as rating}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"size-7 text-sm border border-gray-100/30 dark:border-gray-850/30 hover:bg-gray-50 dark:hover:bg-gray-850 {detailedRating ===\n\t\t\t\t\t\trating\n\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t: ''} transition rounded-full disabled:cursor-not-allowed disabled:text-gray-500 disabled:bg-white dark:disabled:bg-gray-900\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdetailedRating = rating;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={message?.annotation?.rating === -1 ? rating > 5 : rating < 6}\n\t\t\t\t\t>\n\t\t\t\t\t\t{rating}\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\n\t\t\t<div class=\"sticky top-0 bottom-0 left-0 right-0 flex justify-between text-xs\">\n\t\t\t\t<div>\n\t\t\t\t\t1 - {$i18n.t('Awful')}\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t10 - {$i18n.t('Amazing')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\t{#if reasons.length > 0}\n\t\t\t<div class=\"text-sm mt-1.5 font-medium\">{$i18n.t('Why?')}</div>\n\n\t\t\t<div class=\"flex flex-wrap gap-1.5 text-sm mt-1.5\">\n\t\t\t\t{#each reasons as reason}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3 py-0.5 border border-gray-100/30 dark:border-gray-850/30 hover:bg-gray-50 dark:hover:bg-gray-850 {selectedReason ===\n\t\t\t\t\t\treason\n\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t: ''} transition rounded-xl\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tselectedReason = reason;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if reason === 'accurate_information'}\n\t\t\t\t\t\t\t{$i18n.t('Accurate information')}\n\t\t\t\t\t\t{:else if reason === 'followed_instructions_perfectly'}\n\t\t\t\t\t\t\t{$i18n.t('Followed instructions perfectly')}\n\t\t\t\t\t\t{:else if reason === 'showcased_creativity'}\n\t\t\t\t\t\t\t{$i18n.t('Showcased creativity')}\n\t\t\t\t\t\t{:else if reason === 'positive_attitude'}\n\t\t\t\t\t\t\t{$i18n.t('Positive attitude')}\n\t\t\t\t\t\t{:else if reason === 'attention_to_detail'}\n\t\t\t\t\t\t\t{$i18n.t('Attention to detail')}\n\t\t\t\t\t\t{:else if reason === 'thorough_explanation'}\n\t\t\t\t\t\t\t{$i18n.t('Thorough explanation')}\n\t\t\t\t\t\t{:else if reason === 'dont_like_the_style'}\n\t\t\t\t\t\t\t{$i18n.t(\"Don't like the style\")}\n\t\t\t\t\t\t{:else if reason === 'too_verbose'}\n\t\t\t\t\t\t\t{$i18n.t('Too verbose')}\n\t\t\t\t\t\t{:else if reason === 'not_helpful'}\n\t\t\t\t\t\t\t{$i18n.t('Not helpful')}\n\t\t\t\t\t\t{:else if reason === 'not_factually_correct'}\n\t\t\t\t\t\t\t{$i18n.t('Not factually correct')}\n\t\t\t\t\t\t{:else if reason === 'didnt_fully_follow_instructions'}\n\t\t\t\t\t\t\t{$i18n.t(\"Didn't fully follow instructions\")}\n\t\t\t\t\t\t{:else if reason === 'refused_when_it_shouldnt_have'}\n\t\t\t\t\t\t\t{$i18n.t(\"Refused when it shouldn't have\")}\n\t\t\t\t\t\t{:else if reason === 'being_lazy'}\n\t\t\t\t\t\t\t{$i18n.t('Being lazy')}\n\t\t\t\t\t\t{:else if reason === 'other'}\n\t\t\t\t\t\t\t{$i18n.t('Other')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{reason}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\n\t<div class=\"mt-2\">\n\t\t<textarea\n\t\t\tbind:value={comment}\n\t\t\tclass=\"w-full text-sm px-1 py-2 bg-transparent outline-hidden resize-none rounded-xl\"\n\t\t\tplaceholder={$i18n.t('Feel free to add specific details')}\n\t\t\trows=\"3\"\n\t\t/>\n\t</div>\n\n\t<div class=\"mt-2 gap-1.5 flex justify-between\">\n\t\t<div class=\"flex items-end group\">\n\t\t\t<Tags\n\t\t\t\t{tags}\n\t\t\t\tsuggestionTags={$_tags ?? []}\n\t\t\t\ton:delete={(e) => {\n\t\t\t\t\ttags = tags.filter(\n\t\t\t\t\t\t(tag) =>\n\t\t\t\t\t\t\ttag.name.replaceAll(' ', '_').toLowerCase() !==\n\t\t\t\t\t\t\te.detail.replaceAll(' ', '_').toLowerCase()\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\ton:add={(e) => {\n\t\t\t\t\ttags = [...tags, { name: e.detail }];\n\t\t\t\t}}\n\t\t\t/>\n\t\t</div>\n\n\t\t<button\n\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\ton:click={() => {\n\t\t\t\tsaveHandler();\n\t\t\t}}\n\t\t>\n\t\t\t{$i18n.t('Save')}\n\t\t</button>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport ChevronDown from '$lib/components/icons/ChevronDown.svelte';\n\timport ChevronUp from '$lib/components/icons/ChevronUp.svelte';\n\timport Search from '$lib/components/icons/Search.svelte';\n\timport Collapsible from '$lib/components/common/Collapsible.svelte';\n\n\texport let status = { urls: [], query: '' };\n\tlet state = false;\n</script>\n\n<Collapsible grow={true} className=\"w-full\" buttonClassName=\"w-full\" bind:open={state}>\n\t<div class=\"flex items-center gap-2 text-gray-500 transition\">\n\t\t<slot />\n\t\t{#if state}\n\t\t\t<ChevronUp strokeWidth=\"2.5\" className=\"size-3.5 \" />\n\t\t{:else}\n\t\t\t<ChevronDown strokeWidth=\"2.5\" className=\"size-3.5 \" />\n\t\t{/if}\n\t</div>\n\n\t<div\n\t\tclass=\"text-sm border border-gray-50 dark:border-gray-850/30 rounded-xl my-1.5 p-2 w-full\"\n\t\tslot=\"content\"\n\t>\n\t\t{#if status?.query}\n\t\t\t<a\n\t\t\t\thref=\"https://www.google.com/search?q={status.query}\"\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\tclass=\"flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 font-normal! no-underline!\"\n\t\t\t>\n\t\t\t\t<div class=\"flex gap-2 items-center\">\n\t\t\t\t\t<Search />\n\n\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t{status.query}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition\"\n\t\t\t\t>\n\t\t\t\t\t<!--  -->\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t{/if}\n\n\t\t{#if status?.items}\n\t\t\t{#each status.items as item, itemIdx}\n\t\t\t\t<a\n\t\t\t\t\thref={item.link}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 rounded-lg font-normal! no-underline! mb-1\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\" flex justify-center items-center gap-3\">\n\t\t\t\t\t\t<div class=\"w-fit\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"https://www.google.com/s2/favicons?sz=32&domain={item.link}\"\n\t\t\t\t\t\t\t\talt=\"favicon\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"w-full text-sm line-clamp-1\">\n\t\t\t\t\t\t\t{item?.title ?? item.link}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t{/each}\n\t\t{:else if status?.urls}\n\t\t\t{#each status.urls as url, urlIdx}\n\t\t\t\t<a\n\t\t\t\t\thref={url}\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"flex w-full items-center p-1 px-3 group/item justify-between text-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 rounded-lg no-underline mb-1\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\" flex justify-center items-center gap-3\">\n\t\t\t\t\t\t<div class=\"w-fit\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc=\"https://www.google.com/s2/favicons?sz=32&domain={url}\"\n\t\t\t\t\t\t\t\talt=\"favicon\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"w-full text-sm line-clamp-1\">\n\t\t\t\t\t\t\t{url}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" ml-1 text-white dark:text-gray-900 group-hover/item:text-gray-600 dark:group-hover/item:text-white transition\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</a>\n\t\t\t{/each}\n\t\t{/if}\n\t</div>\n</Collapsible>\n","<script lang=\"ts\">\n\timport Info from '$lib/components/icons/Info.svelte';\n\n\texport let content = '';\n</script>\n\n<div class=\"flex my-2 gap-2.5 border px-4 py-3 border-red-600/10 bg-red-600/10 rounded-lg\">\n\t<div class=\" self-start mt-0.5\">\n\t\t<Info className=\"size-5 text-red-700 dark:text-red-400\" />\n\t</div>\n\n\t<div class=\" self-center text-sm\">\n\t\t{#if typeof content === 'string'}\n\t\t\t{content}\n\t\t{:else if typeof content === 'object' && content !== null}\n\t\t\t{#if content?.error && content?.error?.message}\n\t\t\t\t{content.error.message}\n\t\t\t{:else if content?.detail}\n\t\t\t\t{content.detail}\n\t\t\t{:else if content?.message}\n\t\t\t\t{content.message}\n\t\t\t{:else}\n\t\t\t\t{JSON.stringify(content)}\n\t\t\t{/if}\n\t\t{:else}\n\t\t\t{JSON.stringify(content)}\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { getContext, onMount, tick } from 'svelte';\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\timport { settings } from '$lib/stores';\n\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport Textarea from '$lib/components/common/Textarea.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let citation;\n\texport let showPercentage = false;\n\texport let showRelevance = true;\n\n\tlet mergedDocuments = [];\n\n\tfunction calculatePercentage(distance: number) {\n\t\tif (typeof distance !== 'number') return null;\n\t\tif (distance < 0) return 0;\n\t\tif (distance > 1) return 100;\n\t\treturn Math.round(distance * 10000) / 100;\n\t}\n\n\tfunction getRelevanceColor(percentage: number) {\n\t\tif (percentage >= 80)\n\t\t\treturn 'bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200';\n\t\tif (percentage >= 60)\n\t\t\treturn 'bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200';\n\t\tif (percentage >= 40)\n\t\t\treturn 'bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200';\n\t\treturn 'bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200';\n\t}\n\n\t$: if (citation) {\n\t\tmergedDocuments = citation.document?.map((c, i) => {\n\t\t\treturn {\n\t\t\t\tsource: citation.source,\n\t\t\t\tdocument: c,\n\t\t\t\tmetadata: citation.metadata?.[i],\n\t\t\t\tdistance: citation.distances?.[i]\n\t\t\t};\n\t\t});\n\t\tif (mergedDocuments.every((doc) => doc.distance !== undefined)) {\n\t\t\tmergedDocuments = mergedDocuments.sort(\n\t\t\t\t(a, b) => (b.distance ?? Infinity) - (a.distance ?? Infinity)\n\t\t\t);\n\t\t}\n\t}\n\n\tconst decodeString = (str: string) => {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str);\n\t\t} catch {\n\t\t\treturn str;\n\t\t}\n\t};\n\n\tconst getTextFragmentUrl = (doc: any): string | null => {\n\t\tconst { metadata, source, document: content } = doc ?? {};\n\t\tconst { file_id, page } = metadata ?? {};\n\t\tconst sourceUrl = source?.url;\n\n\t\tconst baseUrl = file_id\n\t\t\t? `${WEBUI_API_BASE_URL}/files/${file_id}/content${page !== undefined ? `#page=${page + 1}` : ''}`\n\t\t\t: sourceUrl?.includes('http')\n\t\t\t\t? sourceUrl\n\t\t\t\t: null;\n\n\t\tif (!baseUrl || !content) return baseUrl;\n\n\t\t// Extract first and last words for text fragment, filtering out URLs and emojis\n\t\tconst words = content\n\t\t\t.trim()\n\t\t\t.replace(/\\s+/g, ' ')\n\t\t\t.split(' ')\n\t\t\t.filter((w: string) => w.length > 0 && !/https?:\\/\\/|[\\u{1F300}-\\u{1F9FF}]/u.test(w));\n\n\t\tif (words.length === 0) return baseUrl;\n\n\t\tconst clean = (w: string) => w.replace(/[^\\w]/g, '');\n\t\tconst first = clean(words[0]);\n\t\tconst last = clean(words.at(-1));\n\t\tconst fragment = words.length === 1 ? first : `${first},${last}`;\n\n\t\treturn fragment ? `${baseUrl}#:~:text=${fragment}` : baseUrl;\n\t};\n</script>\n\n<Modal size=\"lg\" bind:show>\n\t<div>\n\t\t<div class=\" flex justify-between dark:text-gray-300 px-4.5 pt-3 pb-2\">\n\t\t\t<div class=\" text-lg font-medium self-center flex items-center\">\n\t\t\t\t{#if citation?.source?.name}\n\t\t\t\t\t{@const document = mergedDocuments?.[0]}\n\t\t\t\t\t{#if document?.metadata?.file_id || document.source?.url?.includes('http')}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tclassName=\"w-fit\"\n\t\t\t\t\t\t\tcontent={document.source?.url?.includes('http')\n\t\t\t\t\t\t\t\t? $i18n.t('Open link')\n\t\t\t\t\t\t\t\t: $i18n.t('Open file')}\n\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t\ttippyOptions={{ duration: [500, 0] }}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tclass=\"hover:text-gray-500 dark:hover:text-gray-100 underline grow line-clamp-1\"\n\t\t\t\t\t\t\t\thref={document?.metadata?.file_id\n\t\t\t\t\t\t\t\t\t? `${WEBUI_API_BASE_URL}/files/${document?.metadata?.file_id}/content${document?.metadata?.page !== undefined ? `#page=${document.metadata.page + 1}` : ''}`\n\t\t\t\t\t\t\t\t\t: document.source?.url?.includes('http')\n\t\t\t\t\t\t\t\t\t\t? document.source.url\n\t\t\t\t\t\t\t\t\t\t: `#`}\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{decodeString(citation?.source?.name)}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{decodeString(citation?.source?.name)}\n\t\t\t\t\t{/if}\n\t\t\t\t{:else}\n\t\t\t\t\t{$i18n.t('Citation')}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className={'size-5'} />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full px-5 pb-5 md:space-x-4\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-thin gap-1\"\n\t\t\t>\n\t\t\t\t{#each mergedDocuments as document, documentIdx}\n\t\t\t\t\t<div class=\"flex flex-col w-full gap-2\">\n\t\t\t\t\t\t{#if document.metadata?.parameters}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium dark:text-gray-300 mb-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Parameters')}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<Textarea readonly value={JSON.stringify(document.metadata.parameters, null, 2)}\n\t\t\t\t\t\t\t\t></Textarea>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" text-sm font-medium dark:text-gray-300 flex items-center gap-2 w-fit mb-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#if document.source?.url?.includes('http')}\n\t\t\t\t\t\t\t\t\t{@const snippetUrl = getTextFragmentUrl(document)}\n\t\t\t\t\t\t\t\t\t{#if snippetUrl}\n\t\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\thref={snippetUrl}\n\t\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"underline hover:text-gray-500 dark:hover:text-gray-100\"\n\t\t\t\t\t\t\t\t\t\t\t>{$i18n.t('Content')}</a\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Content')}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Content')}\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if showRelevance && document.distance !== undefined}\n\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-fit\"\n\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('Relevance')}\n\t\t\t\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t\t\t\t\ttippyOptions={{ duration: [500, 0] }}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm my-1 dark:text-gray-400 flex items-center gap-2 w-fit\">\n\t\t\t\t\t\t\t\t\t\t\t{#if showPercentage}\n\t\t\t\t\t\t\t\t\t\t\t\t{@const percentage = calculatePercentage(document.distance)}\n\n\t\t\t\t\t\t\t\t\t\t\t\t{#if typeof percentage === 'number'}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass={`px-1 rounded-sm font-medium ${getRelevanceColor(percentage)}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{percentage.toFixed(2)}%\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t{:else if typeof document?.distance === 'number'}\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"text-gray-500 dark:text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t({(document?.distance ?? 0).toFixed(4)})\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if Number.isInteger(document?.metadata?.page)}\n\t\t\t\t\t\t\t\t\t<span class=\"text-sm text-gray-500 dark:text-gray-400\">\n\t\t\t\t\t\t\t\t\t\t({$i18n.t('page')}\n\t\t\t\t\t\t\t\t\t\t{document.metadata.page + 1})\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{#if document.metadata?.html}\n\t\t\t\t\t\t\t\t<iframe\n\t\t\t\t\t\t\t\t\tclass=\"w-full border-0 h-auto rounded-none\"\n\t\t\t\t\t\t\t\t\tsandbox=\"allow-scripts allow-forms{($settings?.iframeSandboxAllowSameOrigin ??\n\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t? ' allow-same-origin'\n\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\tsrcdoc={document.document}\n\t\t\t\t\t\t\t\t\ttitle={$i18n.t('Content')}\n\t\t\t\t\t\t\t\t></iframe>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<pre class=\"text-sm dark:text-gray-400 whitespace-pre-line\">{document.document\n\t\t\t\t\t\t\t\t\t\t.trim()\n\t\t\t\t\t\t\t\t\t\t.replace(/\\n\\n+/g, '\\n\\n')}</pre>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { embed, showControls, showEmbeds } from '$lib/stores';\n\n\timport CitationModal from './Citations/CitationModal.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let id = '';\n\texport let chatId = '';\n\n\texport let sources = [];\n\texport let readOnly = false;\n\n\tlet citations = [];\n\tlet showPercentage = false;\n\tlet showRelevance = true;\n\n\tlet citationModal = null;\n\n\tlet showCitations = false;\n\tlet showCitationModal = false;\n\n\tlet selectedCitation: any = null;\n\n\texport const showSourceModal = (sourceId) => {\n\t\tlet index;\n\t\tlet suffix = null;\n\n\t\tif (typeof sourceId === 'string') {\n\t\t\tconst output = sourceId.split('#');\n\t\t\tindex = parseInt(output[0]) - 1;\n\n\t\t\tif (output.length > 1) {\n\t\t\t\tsuffix = output[1];\n\t\t\t}\n\t\t} else {\n\t\t\tindex = sourceId - 1;\n\t\t}\n\n\t\tif (citations[index]) {\n\t\t\tconsole.log('Showing citation modal for:', citations[index]);\n\n\t\t\tif (citations[index]?.source?.embed_url) {\n\t\t\t\tconst embedUrl = citations[index].source.embed_url;\n\t\t\t\tif (embedUrl) {\n\t\t\t\t\tif (readOnly) {\n\t\t\t\t\t\t// Open in new tab if readOnly\n\t\t\t\t\t\twindow.open(embedUrl, '_blank');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowControls.set(true);\n\t\t\t\t\t\tshowEmbeds.set(true);\n\t\t\t\t\t\tembed.set({\n\t\t\t\t\t\t\turl: embedUrl,\n\t\t\t\t\t\t\ttitle: citations[index]?.source?.name || 'Embedded Content',\n\t\t\t\t\t\t\tsource: citations[index],\n\t\t\t\t\t\t\tchatId: chatId,\n\t\t\t\t\t\t\tmessageId: id,\n\t\t\t\t\t\t\tsourceId: sourceId\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tselectedCitation = citations[index];\n\t\t\t\t\tshowCitationModal = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tselectedCitation = citations[index];\n\t\t\t\tshowCitationModal = true;\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction calculateShowRelevance(sources: any[]) {\n\t\tconst distances = sources.flatMap((citation) => citation.distances ?? []);\n\t\tconst inRange = distances.filter((d) => d !== undefined && d >= -1 && d <= 1).length;\n\t\tconst outOfRange = distances.filter((d) => d !== undefined && (d < -1 || d > 1)).length;\n\n\t\tif (distances.length === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\t(inRange === distances.length - 1 && outOfRange === 1) ||\n\t\t\t(outOfRange === distances.length - 1 && inRange === 1)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tfunction shouldShowPercentage(sources: any[]) {\n\t\tconst distances = sources.flatMap((citation) => citation.distances ?? []);\n\t\treturn distances.every((d) => d !== undefined && d >= -1 && d <= 1);\n\t}\n\n\t$: {\n\t\tcitations = sources.reduce((acc, source) => {\n\t\t\tif (Object.keys(source).length === 0) {\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tsource?.document?.forEach((document, index) => {\n\t\t\t\tconst metadata = source?.metadata?.[index];\n\t\t\t\tconst distance = source?.distances?.[index];\n\n\t\t\t\t// Within the same citation there could be multiple documents\n\t\t\t\tconst id = metadata?.source ?? source?.source?.id ?? 'N/A';\n\t\t\t\tlet _source = source?.source;\n\n\t\t\t\tif (metadata?.name) {\n\t\t\t\t\t_source = { ..._source, name: metadata.name };\n\t\t\t\t}\n\n\t\t\t\tif (id.startsWith('http://') || id.startsWith('https://')) {\n\t\t\t\t\t_source = { ..._source, name: id, url: id };\n\t\t\t\t}\n\n\t\t\t\tconst existingSource = acc.find((item) => item.id === id);\n\n\t\t\t\tif (existingSource) {\n\t\t\t\t\texistingSource.document.push(document);\n\t\t\t\t\texistingSource.metadata.push(metadata);\n\t\t\t\t\tif (distance !== undefined) existingSource.distances.push(distance);\n\t\t\t\t} else {\n\t\t\t\t\tacc.push({\n\t\t\t\t\t\tid: id,\n\t\t\t\t\t\tsource: _source,\n\t\t\t\t\t\tdocument: [document],\n\t\t\t\t\t\tmetadata: metadata ? [metadata] : [],\n\t\t\t\t\t\tdistances: distance !== undefined ? [distance] : []\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn acc;\n\t\t}, []);\n\t\tconsole.log('citations', citations);\n\n\t\tshowRelevance = calculateShowRelevance(citations);\n\t\tshowPercentage = shouldShowPercentage(citations);\n\t}\n\n\tconst decodeString = (str: string) => {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str);\n\t\t} catch (e) {\n\t\t\treturn str;\n\t\t}\n\t};\n</script>\n\n<CitationModal\n\tbind:show={showCitationModal}\n\tcitation={selectedCitation}\n\t{showPercentage}\n\t{showRelevance}\n/>\n\n{#if citations.length > 0}\n\t{@const urlCitations = citations.filter((c) => c?.source?.name?.startsWith('http'))}\n\t<div class=\" py-1 -mx-0.5 w-full flex gap-1 items-center flex-wrap\">\n\t\t<button\n\t\t\tclass=\"text-xs font-medium text-gray-600 dark:text-gray-300 px-3.5 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition flex items-center gap-1 border border-gray-50 dark:border-gray-850/30\"\n\t\t\ton:click={() => {\n\t\t\t\tshowCitations = !showCitations;\n\t\t\t}}\n\t\t>\n\t\t\t{#if urlCitations.length > 0}\n\t\t\t\t<div class=\"flex -space-x-1 items-center\">\n\t\t\t\t\t{#each urlCitations.slice(0, 3) as citation, idx}\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tsrc=\"https://www.google.com/s2/favicons?sz=32&domain={citation.source.name}\"\n\t\t\t\t\t\t\talt=\"favicon\"\n\t\t\t\t\t\t\tclass=\"size-4 rounded-full shrink-0 border border-white dark:border-gray-850 bg-white dark:bg-gray-900\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div>\n\t\t\t\t{#if citations.length === 1}\n\t\t\t\t\t{$i18n.t('1 Source')}\n\t\t\t\t{:else}\n\t\t\t\t\t{$i18n.t('{{COUNT}} Sources', {\n\t\t\t\t\t\tCOUNT: citations.length\n\t\t\t\t\t})}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</button>\n\t</div>\n{/if}\n\n{#if showCitations}\n\t<div class=\"py-1.5\">\n\t\t<div class=\"text-xs gap-2 flex flex-col\">\n\t\t\t{#each citations as citation, idx}\n\t\t\t\t<button\n\t\t\t\t\tid={`source-${id}-${idx + 1}`}\n\t\t\t\t\tclass=\"no-toggle outline-hidden flex dark:text-gray-300 bg-transparent text-gray-600 rounded-xl gap-1.5 items-center\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowCitationModal = true;\n\t\t\t\t\t\tselectedCitation = citation;\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" font-medium bg-gray-50 dark:bg-gray-850 rounded-md px-1\">\n\t\t\t\t\t\t{idx + 1}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex-1 truncate hover:text-black dark:text-white/60 dark:hover:text-white transition text-left\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{decodeString(citation.source.name)}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport CodeBlock from './CodeBlock.svelte';\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Badge from '$lib/components/common/Badge.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let codeExecution = null;\n</script>\n\n<Modal size=\"lg\" bind:show>\n\t<div>\n\t\t<div class=\"flex justify-between dark:text-gray-300 px-5 pt-4 pb-2\">\n\t\t\t<div class=\"text-lg font-medium self-center flex flex-col gap-0.5 capitalize\">\n\t\t\t\t{#if codeExecution?.result}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if codeExecution.result?.error}\n\t\t\t\t\t\t\t<Badge type=\"error\" content=\"error\" />\n\t\t\t\t\t\t{:else if codeExecution.result?.output}\n\t\t\t\t\t\t\t<Badge type=\"success\" content=\"success\" />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Badge type=\"warning\" content=\"incomplete\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"flex gap-2 items-center\">\n\t\t\t\t\t{#if !codeExecution?.result}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if codeExecution?.name}\n\t\t\t\t\t\t\t{$i18n.t('Code execution')}: {codeExecution?.name}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{$i18n.t('Code execution')}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass=\"self-center\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshow = false;\n\t\t\t\t\tcodeExecution = null;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<XMark className={'size-5'} />\n\t\t\t</button>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col md:flex-row w-full px-4 pb-5\">\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col w-full dark:text-gray-200 overflow-y-scroll max-h-[22rem] scrollbar-hidden\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t<CodeBlock\n\t\t\t\t\t\tid=\"code-exec-{codeExecution?.id}-code\"\n\t\t\t\t\t\tlang={codeExecution?.language ?? ''}\n\t\t\t\t\t\tcode={codeExecution?.code ?? ''}\n\t\t\t\t\t\tclassName=\"\"\n\t\t\t\t\t\teditorClassName={codeExecution?.result &&\n\t\t\t\t\t\t(codeExecution?.result?.error || codeExecution?.result?.output)\n\t\t\t\t\t\t\t? 'rounded-b-none'\n\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\trun={false}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t{#if codeExecution?.result && (codeExecution?.result?.error || codeExecution?.result?.output)}\n\t\t\t\t\t<div class=\"dark:bg-[#202123] dark:text-white px-4 py-4 rounded-b-lg flex flex-col gap-3\">\n\t\t\t\t\t\t{#if codeExecution?.result?.error}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-xs mb-1\">{$i18n.t('ERROR')}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm\">{codeExecution?.result?.error}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{#if codeExecution?.result?.output}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-xs mb-1\">{$i18n.t('OUTPUT')}</div>\n\t\t\t\t\t\t\t\t<div class=\"text-sm\">{codeExecution?.result?.output}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t\t{#if codeExecution?.result?.files && codeExecution?.result?.files.length > 0}\n\t\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t\t<hr class=\"border-gray-100/30 dark:border-gray-850/30 my-2\" />\n\t\t\t\t\t\t<div class=\" text-sm font-medium dark:text-gray-300\">\n\t\t\t\t\t\t\t{$i18n.t('Files')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<ul class=\"mt-1 list-disc pl-4 text-xs\">\n\t\t\t\t\t\t\t{#each codeExecution?.result?.files as file}\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t<a href={file.url} target=\"_blank\">{file.name}</a>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport CodeExecutionModal from './CodeExecutionModal.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Check from '$lib/components/icons/Check.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport EllipsisHorizontal from '$lib/components/icons/EllipsisHorizontal.svelte';\n\n\texport let codeExecutions = [];\n\n\tlet selectedCodeExecution = null;\n\tlet showCodeExecutionModal = false;\n\n\t$: if (codeExecutions) {\n\t\tupdateSelectedCodeExecution();\n\t}\n\n\tconst updateSelectedCodeExecution = () => {\n\t\tif (selectedCodeExecution) {\n\t\t\tselectedCodeExecution = codeExecutions.find(\n\t\t\t\t(execution) => execution.id === selectedCodeExecution.id\n\t\t\t);\n\t\t}\n\t};\n</script>\n\n<CodeExecutionModal bind:show={showCodeExecutionModal} codeExecution={selectedCodeExecution} />\n\n{#if codeExecutions.length > 0}\n\t<div class=\"mt-1 mb-2 w-full flex gap-1 items-center flex-wrap\">\n\t\t{#each codeExecutions as execution (execution.id)}\n\t\t\t<div class=\"flex gap-1 text-xs font-semibold\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"flex dark:text-gray-300 py-1 px-1 bg-gray-50 hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition rounded-xl max-w-96\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tselectedCodeExecution = execution;\n\t\t\t\t\t\tshowCodeExecutionModal = true;\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"bg-white dark:bg-gray-700 rounded-full size-4 flex items-center justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if execution?.result}\n\t\t\t\t\t\t\t{#if execution.result?.error}\n\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t{:else if execution.result?.output}\n\t\t\t\t\t\t\t\t<Check strokeWidth=\"3\" className=\"size-3\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<EllipsisHorizontal />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex-1 mx-2 line-clamp-1 code-execution-name {execution?.result ? '' : 'pulse'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{execution.name}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t{/each}\n\t</div>\n{/if}\n\n<style>\n\t@keyframes pulse {\n\t\t0%,\n\t\t100% {\n\t\t\topacity: 1;\n\t\t}\n\t\t50% {\n\t\t\topacity: 0.6;\n\t\t}\n\t}\n\n\t.pulse {\n\t\topacity: 1;\n\t\tanimation: pulse 1.5s ease;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport DOMPurify from 'dompurify';\n\timport { marked } from 'marked';\n\n\timport { getContext, tick, onDestroy } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { chatCompletion } from '$lib/apis/openai';\n\n\timport ChatBubble from '$lib/components/icons/ChatBubble.svelte';\n\timport LightBulb from '$lib/components/icons/LightBulb.svelte';\n\timport Markdown from '../Messages/Markdown.svelte';\n\timport Skeleton from '../Messages/Skeleton.svelte';\n\timport { chatId, models, socket } from '$lib/stores';\n\n\texport let id = '';\n\texport let messageId = '';\n\n\texport let model = null;\n\texport let messages = [];\n\texport let actions = [];\n\texport let onAdd = (e) => {};\n\n\tlet floatingInput = false;\n\tlet selectedAction = null;\n\n\tlet selectedText = '';\n\tlet floatingInputValue = '';\n\n\tlet content = '';\n\tlet responseContent = null;\n\tlet responseDone = false;\n\tlet controller = null;\n\n\t$: if (actions.length === 0) {\n\t\tactions = DEFAULT_ACTIONS;\n\t}\n\n\tconst DEFAULT_ACTIONS = [\n\t\t{\n\t\t\tid: 'ask',\n\t\t\tlabel: $i18n.t('Ask'),\n\t\t\ticon: ChatBubble,\n\t\t\tinput: true,\n\t\t\tprompt: `{{SELECTED_CONTENT}}\\n\\n\\n{{INPUT_CONTENT}}`\n\t\t},\n\t\t{\n\t\t\tid: 'explain',\n\t\t\tlabel: $i18n.t('Explain'),\n\t\t\ticon: LightBulb,\n\t\t\tprompt: `{{SELECTED_CONTENT}}\\n\\n\\n${$i18n.t('Explain')}`\n\t\t}\n\t];\n\n\tconst autoScroll = async () => {\n\t\tconst responseContainer = document.getElementById('response-container');\n\t\tif (responseContainer) {\n\t\t\t// Scroll to bottom only if the scroll is at the bottom give 50px buffer\n\t\t\tif (\n\t\t\t\tresponseContainer.scrollHeight - responseContainer.clientHeight <=\n\t\t\t\tresponseContainer.scrollTop + 50\n\t\t\t) {\n\t\t\t\tresponseContainer.scrollTop = responseContainer.scrollHeight;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst actionHandler = async (actionId) => {\n\t\tif (!model) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\n\t\tlet selectedContent = selectedText\n\t\t\t.split('\\n')\n\t\t\t.map((line) => `> ${line}`)\n\t\t\t.join('\\n');\n\n\t\tlet selectedAction = actions.find((action) => action.id === actionId);\n\t\tif (!selectedAction) {\n\t\t\ttoast.error($i18n.t('Action not found'));\n\t\t\treturn;\n\t\t}\n\n\t\tlet prompt = selectedAction?.prompt ?? '';\n\t\tlet toolIds = [];\n\n\t\t// Handle: {{variableId|tool:id=\"toolId\"}} pattern\n\t\t// This regex captures variableId and toolId from {{variableId|tool:id=\"toolId\"}}\n\t\tconst varToolPattern = /\\{\\{(.*?)\\|tool:id=\"([^\"]+)\"\\}\\}/g;\n\t\tprompt = prompt.replace(varToolPattern, (match, variableId, toolId) => {\n\t\t\ttoolIds.push(toolId);\n\t\t\treturn variableId; // Replace with just variableId\n\t\t});\n\n\t\t// legacy {{TOOL:toolId}} pattern (for backward compatibility)\n\t\tlet toolIdPattern = /\\{\\{TOOL:([^\\}]+)\\}\\}/g;\n\t\tlet match;\n\t\twhile ((match = toolIdPattern.exec(prompt)) !== null) {\n\t\t\ttoolIds.push(match[1]);\n\t\t}\n\n\t\t// Remove all TOOL placeholders from the prompt\n\t\tprompt = prompt.replace(toolIdPattern, '');\n\n\t\tif (prompt.includes('{{INPUT_CONTENT}}') && floatingInput) {\n\t\t\tprompt = prompt.replace('{{INPUT_CONTENT}}', floatingInputValue);\n\t\t\tfloatingInputValue = '';\n\t\t}\n\n\t\tprompt = prompt.replace('{{CONTENT}}', selectedText);\n\t\tprompt = prompt.replace('{{SELECTED_CONTENT}}', selectedContent);\n\n\t\tcontent = prompt;\n\t\tresponseContent = '';\n\n\t\tlet res;\n\t\t[res, controller] = await chatCompletion(localStorage.token, {\n\t\t\tmodel: model,\n\t\t\tmodel_item: $models.find((m) => m.id === model),\n\t\t\tsession_id: $socket?.id,\n\t\t\tchat_id: $chatId,\n\t\t\tmessages: [\n\t\t\t\t...messages,\n\t\t\t\t{\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: content\n\t\t\t\t}\n\t\t\t].map((message) => ({\n\t\t\t\trole: message.role,\n\t\t\t\tcontent: message.content\n\t\t\t})),\n\t\t\t...(toolIds.length > 0\n\t\t\t\t? {\n\t\t\t\t\t\ttool_ids: toolIds\n\t\t\t\t\t\t// params: {\n\t\t\t\t\t\t// \tfunction_calling: 'native'\n\t\t\t\t\t\t// }\n\t\t\t\t\t}\n\t\t\t\t: {}),\n\n\t\t\tstream: true // Enable streaming\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body.getReader();\n\t\t\tconst decoder = new TextDecoder();\n\n\t\t\tconst processStream = async () => {\n\t\t\t\twhile (true) {\n\t\t\t\t\t// Read data chunks from the response stream\n\t\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\t\tif (done) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Decode the received chunk\n\t\t\t\t\tconst chunk = decoder.decode(value, { stream: true });\n\n\t\t\t\t\t// Process lines within the chunk\n\t\t\t\t\tconst lines = chunk.split('\\n').filter((line) => line.trim() !== '');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line.startsWith('data: ')) {\n\t\t\t\t\t\t\tif (line.startsWith('data: [DONE]')) {\n\t\t\t\t\t\t\t\tresponseDone = true;\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Parse the JSON chunk\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst data = JSON.parse(line.slice(6));\n\n\t\t\t\t\t\t\t\t\t// Append the `content` field from the \"choices\" object\n\t\t\t\t\t\t\t\t\tif (data.choices && data.choices[0]?.delta?.content) {\n\t\t\t\t\t\t\t\t\t\tresponseContent += data.choices[0].delta.content;\n\n\t\t\t\t\t\t\t\t\t\tautoScroll();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Process the stream in the background\n\t\t\ttry {\n\t\t\t\tawait processStream();\n\t\t\t} catch (e) {\n\t\t\t\tif (e.name !== 'AbortError') {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t('An error occurred while fetching the explanation'));\n\t\t}\n\t};\n\n\tconst addHandler = async () => {\n\t\tconst messages = [\n\t\t\t{\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: content\n\t\t\t},\n\t\t\t{\n\t\t\t\trole: 'assistant',\n\t\t\t\tcontent: responseContent\n\t\t\t}\n\t\t];\n\n\t\tonAdd({\n\t\t\tmodelId: model,\n\t\t\tparentId: messageId,\n\t\t\tmessages: messages\n\t\t});\n\t};\n\n\texport const closeHandler = () => {\n\t\tif (controller) {\n\t\t\tcontroller.abort();\n\t\t}\n\n\t\tselectedAction = null;\n\t\tselectedText = '';\n\t\tresponseContent = null;\n\t\tresponseDone = false;\n\t\tfloatingInput = false;\n\t\tfloatingInputValue = '';\n\t};\n\n\tonDestroy(() => {\n\t\tif (controller) {\n\t\t\tcontroller.abort();\n\t\t}\n\t});\n</script>\n\n<div\n\tid={`floating-buttons-${id}`}\n\tclass=\"absolute rounded-lg mt-1 text-xs z-9999\"\n\tstyle=\"display: none\"\n>\n\t{#if responseContent === null}\n\t\t{#if !floatingInput}\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-row shrink-0 p-0.5 bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-xl shadow-xl border border-gray-100 dark:border-gray-800\"\n\t\t\t>\n\t\t\t\t{#each actions as action}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-1.5 py-[1px] hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl flex items-center gap-1 min-w-fit transition\"\n\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\tselectedText = window.getSelection().toString();\n\t\t\t\t\t\t\tselectedAction = action;\n\n\t\t\t\t\t\t\tif (action.prompt.includes('{{INPUT_CONTENT}}')) {\n\t\t\t\t\t\t\t\tfloatingInput = true;\n\t\t\t\t\t\t\t\tfloatingInputValue = '';\n\n\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\tconst input = document.getElementById('floating-message-input');\n\t\t\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tactionHandler(action.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if action.icon}\n\t\t\t\t\t\t\t<svelte:component this={action.icon} className=\"size-3 shrink-0\" />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<div class=\"shrink-0\">{action.label}</div>\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div\n\t\t\t\tclass=\"py-1 flex dark:text-gray-100 bg-white dark:bg-gray-850 border border-gray-100 dark:border-gray-800 w-72 rounded-full shadow-xl\"\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tid=\"floating-message-input\"\n\t\t\t\t\tclass=\"ml-5 bg-transparent outline-hidden w-full flex-1 text-sm\"\n\t\t\t\t\tplaceholder={$i18n.t('Ask a question')}\n\t\t\t\t\tbind:value={floatingInputValue}\n\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\tactionHandler(selectedAction?.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t<div class=\"ml-1 mr-1\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"{floatingInputValue !== ''\n\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tactionHandler(selectedAction?.id);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t{:else}\n\t\t<div\n\t\t\tclass=\"bg-white dark:bg-gray-850 dark:text-gray-100 rounded-3xl shadow-xl w-80 max-w-full border border-gray-100 dark:border-gray-800\"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-3xl px-3.5 pt-3 w-full\"\n\t\t\t>\n\t\t\t\t<div class=\"font-medium\">\n\t\t\t\t\t<Markdown id={`${id}-float-prompt`} {content} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"bg-white dark:bg-gray-850 dark:text-gray-100 text-medium rounded-4xl w-full\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\" max-h-80 overflow-y-auto w-full markdown-prose-xs px-3.5 py-3\"\n\t\t\t\t\tid=\"response-container\"\n\t\t\t\t>\n\t\t\t\t\t{#if !responseContent || responseContent?.trim() === ''}\n\t\t\t\t\t\t<Skeleton size=\"sm\" />\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Markdown id={`${id}-float-response`} content={responseContent} />\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if responseDone}\n\t\t\t\t\t\t<div class=\"flex justify-end pt-3 text-sm font-medium\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\t\t\ton:click={addHandler}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{$i18n.t('Add')}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n","<script>\n\timport { onDestroy, onMount, tick, getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport Markdown from './Markdown.svelte';\n\timport {\n\t\tartifactCode,\n\t\tchatId,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArtifacts,\n\t\tshowControls,\n\t\tshowEmbeds,\n\t\tshowOverview\n\t} from '$lib/stores';\n\timport FloatingButtons from '../ContentRenderer/FloatingButtons.svelte';\n\timport { createMessagesList } from '$lib/utils';\n\n\texport let id;\n\texport let content;\n\n\texport let history;\n\texport let messageId;\n\n\texport let selectedModels = [];\n\n\texport let done = true;\n\texport let model = null;\n\texport let sources = null;\n\n\texport let save = false;\n\texport let preview = false;\n\texport let floatingButtons = true;\n\n\texport let editCodeBlock = true;\n\texport let topPadding = false;\n\n\texport let onSave = (e) => {};\n\texport let onSourceClick = (e) => {};\n\texport let onTaskClick = (e) => {};\n\texport let onAddMessages = (e) => {};\n\n\tlet contentContainerElement;\n\tlet floatingButtonsElement;\n\n\tconst updateButtonPosition = (event) => {\n\t\tconst buttonsContainerElement = document.getElementById(`floating-buttons-${id}`);\n\t\tif (\n\t\t\t!contentContainerElement?.contains(event.target) &&\n\t\t\t!buttonsContainerElement?.contains(event.target)\n\t\t) {\n\t\t\tcloseFloatingButtons();\n\t\t\treturn;\n\t\t}\n\n\t\tsetTimeout(async () => {\n\t\t\tawait tick();\n\n\t\t\tif (!contentContainerElement?.contains(event.target)) return;\n\n\t\t\tlet selection = window.getSelection();\n\n\t\t\tif (selection.toString().trim().length > 0) {\n\t\t\t\tconst range = selection.getRangeAt(0);\n\t\t\t\tconst rect = range.getBoundingClientRect();\n\n\t\t\t\tconst parentRect = contentContainerElement.getBoundingClientRect();\n\n\t\t\t\t// Adjust based on parent rect\n\t\t\t\tconst top = rect.bottom - parentRect.top;\n\t\t\t\tconst left = rect.left - parentRect.left;\n\n\t\t\t\tif (buttonsContainerElement) {\n\t\t\t\t\tbuttonsContainerElement.style.display = 'block';\n\n\t\t\t\t\t// Calculate space available on the right\n\t\t\t\t\tconst spaceOnRight = parentRect.width - left;\n\t\t\t\t\tlet halfScreenWidth = $mobile ? window.innerWidth / 2 : window.innerWidth / 3;\n\n\t\t\t\t\tif (spaceOnRight < halfScreenWidth) {\n\t\t\t\t\t\tconst right = parentRect.right - rect.right;\n\t\t\t\t\t\tbuttonsContainerElement.style.right = `${right}px`;\n\t\t\t\t\t\tbuttonsContainerElement.style.left = 'auto'; // Reset left\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Enough space, position using 'left'\n\t\t\t\t\t\tbuttonsContainerElement.style.left = `${left}px`;\n\t\t\t\t\t\tbuttonsContainerElement.style.right = 'auto'; // Reset right\n\t\t\t\t\t}\n\t\t\t\t\tbuttonsContainerElement.style.top = `${top + 5}px`; // +5 to add some spacing\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcloseFloatingButtons();\n\t\t\t}\n\t\t}, 0);\n\t};\n\n\tconst closeFloatingButtons = () => {\n\t\tconst buttonsContainerElement = document.getElementById(`floating-buttons-${id}`);\n\t\tif (buttonsContainerElement) {\n\t\t\tbuttonsContainerElement.style.display = 'none';\n\t\t}\n\n\t\tif (floatingButtonsElement) {\n\t\t\t// check if closeHandler is defined\n\n\t\t\tif (typeof floatingButtonsElement?.closeHandler === 'function') {\n\t\t\t\t// call the closeHandler function\n\t\t\t\tfloatingButtonsElement?.closeHandler();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst keydownHandler = (e) => {\n\t\tif (e.key === 'Escape') {\n\t\t\tcloseFloatingButtons();\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\tif (floatingButtons) {\n\t\t\tcontentContainerElement?.addEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.addEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.addEventListener('keydown', keydownHandler);\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\tif (floatingButtons) {\n\t\t\tcontentContainerElement?.removeEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.removeEventListener('mouseup', updateButtonPosition);\n\t\t\tdocument.removeEventListener('keydown', keydownHandler);\n\t\t}\n\t});\n</script>\n\n<div bind:this={contentContainerElement}>\n\t<Markdown\n\t\t{id}\n\t\t{content}\n\t\t{model}\n\t\t{save}\n\t\t{preview}\n\t\t{done}\n\t\t{editCodeBlock}\n\t\t{topPadding}\n\t\tsourceIds={(sources ?? []).reduce((acc, source) => {\n\t\t\tlet ids = [];\n\t\t\tsource.document.forEach((document, index) => {\n\t\t\t\tif (model?.info?.meta?.capabilities?.citations == false) {\n\t\t\t\t\tids.push('N/A');\n\t\t\t\t\treturn ids;\n\t\t\t\t}\n\n\t\t\t\tconst metadata = source.metadata?.[index];\n\t\t\t\tconst id = metadata?.source ?? 'N/A';\n\n\t\t\t\tif (metadata?.name) {\n\t\t\t\t\tids.push(metadata.name);\n\t\t\t\t\treturn ids;\n\t\t\t\t}\n\n\t\t\t\tif (id.startsWith('http://') || id.startsWith('https://')) {\n\t\t\t\t\tids.push(id);\n\t\t\t\t} else {\n\t\t\t\t\tids.push(source?.source?.name ?? id);\n\t\t\t\t}\n\n\t\t\t\treturn ids;\n\t\t\t});\n\n\t\t\tacc = [...acc, ...ids];\n\n\t\t\t// remove duplicates\n\t\t\treturn acc.filter((item, index) => acc.indexOf(item) === index);\n\t\t}, [])}\n\t\t{onSourceClick}\n\t\t{onTaskClick}\n\t\t{onSave}\n\t\tonUpdate={async (token) => {\n\t\t\tconst { lang, text: code } = token;\n\n\t\t\tif (\n\t\t\t\t($settings?.detectArtifacts ?? true) &&\n\t\t\t\t(['html', 'svg'].includes(lang) || (lang === 'xml' && code.includes('svg'))) &&\n\t\t\t\t!$mobile &&\n\t\t\t\t$chatId\n\t\t\t) {\n\t\t\t\tawait tick();\n\t\t\t\tshowArtifacts.set(true);\n\t\t\t\tshowControls.set(true);\n\t\t\t}\n\t\t}}\n\t\tonPreview={async (value) => {\n\t\t\tconsole.log('Preview', value);\n\t\t\tawait artifactCode.set(value);\n\t\t\tawait showControls.set(true);\n\t\t\tawait showArtifacts.set(true);\n\t\t\tawait showOverview.set(false);\n\t\t\tawait showEmbeds.set(false);\n\t\t}}\n\t/>\n</div>\n\n{#if floatingButtons && model}\n\t<FloatingButtons\n\t\tbind:this={floatingButtonsElement}\n\t\t{id}\n\t\t{messageId}\n\t\tactions={$settings?.floatingActionButtons ?? []}\n\t\tmodel={(selectedModels ?? []).includes(model?.id)\n\t\t\t? model?.id\n\t\t\t: (selectedModels ?? []).length > 0\n\t\t\t\t? selectedModels.at(0)\n\t\t\t\t: model?.id}\n\t\tmessages={createMessagesList(history, messageId)}\n\t\tonAdd={({ modelId, parentId, messages }) => {\n\t\t\tconsole.log(modelId, parentId, messages);\n\t\t\tonAddMessages({ modelId, parentId, messages });\n\t\t\tcloseFloatingButtons();\n\t\t}}\n\t/>\n{/if}\n","import WorkerInstance from '$lib/workers/kokoro.worker?worker';\n\nexport class KokoroWorker {\n\tprivate worker: Worker | null = null;\n\tprivate initialized: boolean = false;\n\tprivate dtype: string;\n\tprivate requestQueue: Array<{\n\t\ttext: string;\n\t\tvoice: string;\n\t\tresolve: (value: string) => void;\n\t\treject: (reason: any) => void;\n\t}> = [];\n\tprivate processing = false; // To track if a request is being processed\n\n\tconstructor(dtype: string = 'fp32') {\n\t\tthis.dtype = dtype;\n\t}\n\n\tpublic async init() {\n\t\tif (this.worker) {\n\t\t\tconsole.warn('KokoroWorker is already initialized.');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.worker = new WorkerInstance();\n\n\t\t// Handle worker messages\n\t\tthis.worker.onmessage = (event) => {\n\t\t\tconst { status, error, audioUrl } = event.data;\n\n\t\t\tif (status === 'init:complete') {\n\t\t\t\tthis.initialized = true;\n\t\t\t} else if (status === 'init:error') {\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.initialized = false;\n\t\t\t} else if (status === 'generate:complete') {\n\t\t\t\t// Resolve promise from queue\n\t\t\t\tconst request = this.requestQueue.shift();\n\t\t\t\tif (request) {\n\t\t\t\t\trequest.resolve(audioUrl);\n\t\t\t\t\tthis.processNextRequest(); // Process next request in queue\n\t\t\t\t}\n\t\t\t} else if (status === 'generate:error') {\n\t\t\t\tconst request = this.requestQueue.shift();\n\t\t\t\tif (request) {\n\t\t\t\t\trequest.reject(new Error(error));\n\t\t\t\t\tthis.processNextRequest(); // Continue processing next in queue\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tthis.worker!.postMessage({\n\t\t\t\ttype: 'init',\n\t\t\t\tpayload: { dtype: this.dtype }\n\t\t\t});\n\n\t\t\tconst handleMessage = (event: MessageEvent) => {\n\t\t\t\tif (event.data.status === 'init:complete') {\n\t\t\t\t\tthis.worker!.removeEventListener('message', handleMessage);\n\t\t\t\t\tthis.initialized = true;\n\t\t\t\t\tresolve();\n\t\t\t\t} else if (event.data.status === 'init:error') {\n\t\t\t\t\tthis.worker!.removeEventListener('message', handleMessage);\n\t\t\t\t\treject(new Error(event.data.error));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.worker!.addEventListener('message', handleMessage);\n\t\t});\n\t}\n\n\tpublic async generate({ text, voice }: { text: string; voice: string }): Promise<string> {\n\t\tif (!this.initialized || !this.worker) {\n\t\t\tthrow new Error('KokoroTTS Worker is not initialized yet.');\n\t\t}\n\n\t\treturn new Promise<string>((resolve, reject) => {\n\t\t\tthis.requestQueue.push({ text, voice, resolve, reject });\n\t\t\tif (!this.processing) {\n\t\t\t\tthis.processNextRequest();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate processNextRequest() {\n\t\tif (this.requestQueue.length === 0) {\n\t\t\tthis.processing = false;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.processing = true;\n\t\tconst { text, voice } = this.requestQueue[0]; // Get first request but don't remove yet\n\t\tthis.worker!.postMessage({ type: 'generate', payload: { text, voice } });\n\t}\n\n\tpublic terminate() {\n\t\tif (this.worker) {\n\t\t\tthis.worker.terminate();\n\t\t\tthis.worker = null;\n\t\t\tthis.initialized = false;\n\t\t\tthis.requestQueue = [];\n\t\t\tthis.processing = false;\n\t\t}\n\t}\n}\n","<script lang=\"ts\">\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let followUps: string[] = [];\n\texport let onClick: (followUp: string) => void = () => {};\n</script>\n\n<div class=\"mt-4\">\n\t<div class=\"text-sm font-medium\">\n\t\t{$i18n.t('Follow up')}\n\t</div>\n\n\t<div class=\"flex flex-col text-left gap-1 mt-1.5\">\n\t\t{#each followUps as followUp, idx (idx)}\n\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\n\t\t\t<Tooltip content={followUp} placement=\"top-start\" className=\"line-clamp-1\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\" py-1.5 bg-transparent text-left text-sm flex items-center gap-2 text-gray-500 dark:text-gray-400 hover:text-black dark:hover:text-white transition cursor-pointer\"\n\t\t\t\t\ton:click={() => onClick(followUp)}\n\t\t\t\t\taria-label={followUp}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t{followUp}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Tooltip>\n\n\t\t\t{#if idx < followUps.length - 1}\n\t\t\t\t<hr class=\"border-gray-50 dark:border-gray-850/30\" />\n\t\t\t{/if}\n\t\t{/each}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n\t><path d=\"M11 6H21\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M11 12H21\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path><path d=\"M11 18H21\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M5 19V5M5 19L3 16.5M5 19L7 16.5M5 5L3 7M5 5L7 7\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path></svg\n>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path d=\"M11 6H21\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M11 12H21\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path>\n\t<path d=\"M11 18H21\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path><path\n\t\td=\"M5 19V5M5 10L3 8M5 10L7 8M5 14L3 16M5 14L7 16\"\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t></path>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext } from 'svelte';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport LineSpace from '$lib/components/icons/LineSpace.svelte';\n\timport LineSpaceSmaller from '$lib/components/icons/LineSpaceSmaller.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onRegenerate: Function = (prompt = null) => {};\n\texport let onClose: Function = () => {};\n\n\tlet show = false;\n\tlet inputValue = '';\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n\talign=\"end\"\n>\n\t<slot></slot>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-2xl px-1 py-1 border border-gray-100 dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition\"\n\t\t\tsideOffset={-2}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<div class=\"py-1.5 px-2.5 flex dark:text-gray-100\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tid=\"floating-message-input\"\n\t\t\t\t\tclass=\"bg-transparent outline-hidden w-full flex-1 text-sm\"\n\t\t\t\t\tplaceholder={$i18n.t('Suggest a change')}\n\t\t\t\t\tbind:value={inputValue}\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\tonRegenerate(inputValue);\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t<div class=\"ml-2 self-center flex items-center\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"{inputValue !== ''\n\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1 self-center\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonRegenerate(inputValue);\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<hr class=\"border-gray-50/30 dark:border-gray-800/30 my-1 mx-2\" />\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonRegenerate();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Try Again')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonRegenerate($i18n.t('Add Details'));\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<LineSpace strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Add Details')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonRegenerate($i18n.t('More Concise'));\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<LineSpaceSmaller strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('More Concise')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script>\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\timport WebSearchResults from '../WebSearchResults.svelte';\n\timport Search from '$lib/components/icons/Search.svelte';\n\timport { t } from 'i18next';\n\n\texport let status = null;\n\texport let done = false;\n</script>\n\n{#if !status?.hidden}\n\t<div class=\"status-description flex items-center gap-2 py-0.5 w-full text-left\">\n\t\t{#if status?.action === 'web_search' && (status?.urls || status?.items)}\n\t\t\t<WebSearchResults {status}>\n\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t\t: ''} text-base line-clamp-1 text-wrap\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<!-- $i18n.t(\"Generating search query\") -->\n\t\t\t\t\t\t<!-- $i18n.t(\"No search query generated\") -->\n\t\t\t\t\t\t<!-- $i18n.t('Searched {{count}} sites') -->\n\t\t\t\t\t\t{#if status?.description?.includes('{{count}}')}\n\t\t\t\t\t\t\t{$i18n.t(status?.description, {\n\t\t\t\t\t\t\t\tcount: (status?.urls || status?.items).length\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t{:else if status?.description === 'No search query generated'}\n\t\t\t\t\t\t\t{$i18n.t('No search query generated')}\n\t\t\t\t\t\t{:else if status?.description === 'Generating search query'}\n\t\t\t\t\t\t\t{$i18n.t('Generating search query')}\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t{status?.description}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</WebSearchResults>\n\t\t{:else if status?.action === 'knowledge_search'}\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(`Searching Knowledge for \"{{searchQuery}}\"`, {\n\t\t\t\t\t\tsearchQuery: status.query\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if status?.action === 'web_search_queries_generated' && status?.queries}\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(`Searching`)}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" flex gap-1 flex-wrap mt-2\">\n\t\t\t\t\t{#each status.queries as query, idx (query)}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"bg-gray-50 dark:bg-gray-850 flex rounded-lg py-1 px-2 items-center gap-1 text-xs\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Search className=\"size-3\" />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t{query}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if status?.action === 'queries_generated' && status?.queries}\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t>\n\t\t\t\t\t{$i18n.t(`Querying`)}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" flex gap-1 flex-wrap mt-2\">\n\t\t\t\t\t{#each status.queries as query, idx (query)}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"bg-gray-50 dark:bg-gray-850 flex rounded-lg py-1 px-2 items-center gap-1 text-xs\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<Search className=\"size-3\" />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<span class=\"line-clamp-1\">\n\t\t\t\t\t\t\t\t{query}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else if status?.action === 'sources_retrieved' && status?.count !== undefined}\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t>\n\t\t\t\t\t{#if status.count === 0}\n\t\t\t\t\t\t{$i18n.t('No sources found')}\n\t\t\t\t\t{:else if status.count === 1}\n\t\t\t\t\t\t{$i18n.t('Retrieved 1 source')}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<!-- {$i18n.t('Source')} -->\n\t\t\t\t\t\t<!-- {$i18n.t('No source available')} -->\n\t\t\t\t\t\t<!-- {$i18n.t('No distance available')} -->\n\t\t\t\t\t\t<!-- {$i18n.t('Retrieved {{count}} sources')} -->\n\t\t\t\t\t\t{$i18n.t('Retrieved {{count}} sources', {\n\t\t\t\t\t\t\tcount: status.count\n\t\t\t\t\t\t})}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"{(done || status?.done) === false\n\t\t\t\t\t\t? 'shimmer'\n\t\t\t\t\t\t: ''} text-gray-500 dark:text-gray-500 text-base line-clamp-1 text-wrap\"\n\t\t\t\t>\n\t\t\t\t\t<!-- $i18n.t(`Searching \"{{searchQuery}}\"`) -->\n\t\t\t\t\t{#if status?.description?.includes('{{searchQuery}}')}\n\t\t\t\t\t\t{$i18n.t(status?.description, {\n\t\t\t\t\t\t\tsearchQuery: status?.query\n\t\t\t\t\t\t})}\n\t\t\t\t\t{:else if status?.description === 'No search query generated'}\n\t\t\t\t\t\t{$i18n.t('No search query generated')}\n\t\t\t\t\t{:else if status?.description === 'Generating search query'}\n\t\t\t\t\t\t{$i18n.t('Generating search query')}\n\t\t\t\t\t{:else if status?.description === 'Searching the web'}\n\t\t\t\t\t\t{$i18n.t('Searching the web')}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{status?.description}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/if}\n","<script>\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport StatusItem from './StatusHistory/StatusItem.svelte';\n\texport let statusHistory = [];\n\texport let expand = false;\n\n\tlet showHistory = true;\n\n\t$: if (expand) {\n\t\tshowHistory = true;\n\t} else {\n\t\tshowHistory = false;\n\t}\n\n\tlet history = [];\n\tlet status = null;\n\n\t$: if (history && history.length > 0) {\n\t\tstatus = history.at(-1);\n\t}\n\n\t$: if (JSON.stringify(statusHistory) !== JSON.stringify(history)) {\n\t\thistory = statusHistory;\n\t}\n</script>\n\n{#if history && history.length > 0}\n\t{#if status?.hidden !== true}\n\t\t<div class=\"text-sm flex flex-col w-full\">\n\t\t\t<button\n\t\t\t\tclass=\"w-full\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshowHistory = !showHistory;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\"flex items-start gap-2\">\n\t\t\t\t\t<StatusItem {status} />\n\t\t\t\t</div>\n\t\t\t</button>\n\n\t\t\t{#if showHistory}\n\t\t\t\t<div class=\"flex flex-row\">\n\t\t\t\t\t{#if history.length > 1}\n\t\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t\t{#each history as status, idx}\n\t\t\t\t\t\t\t\t<div class=\"flex items-stretch gap-2 mb-1\">\n\t\t\t\t\t\t\t\t\t<div class=\" \">\n\t\t\t\t\t\t\t\t\t\t<div class=\"pt-3 px-1 mb-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<span class=\"relative flex size-1.5 rounded-full justify-center items-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"relative inline-flex size-1.5 rounded-full bg-gray-500 dark:bg-gray-400\"\n\t\t\t\t\t\t\t\t\t\t\t\t></span>\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#if idx !== history.length - 1}\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-[0.5px] ml-[6.5px] h-[calc(100%-14px)] bg-gray-300 dark:bg-gray-700\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<StatusItem {status} done={true} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport dayjs from 'dayjs';\n\n\timport { createEventDispatcher, onDestroy } from 'svelte';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport type { Writable } from 'svelte/store';\n\timport type { i18n as i18nType, t } from 'i18next';\n\n\tconst i18n = getContext<Writable<i18nType>>('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\timport { createNewFeedback, getFeedbackById, updateFeedbackById } from '$lib/apis/evaluations';\n\timport { getChatById } from '$lib/apis/chats';\n\timport { generateTags } from '$lib/apis';\n\n\timport {\n\t\taudioQueue,\n\t\tconfig,\n\t\tmodels,\n\t\tsettings,\n\t\ttemporaryChatEnabled,\n\t\tTTSWorker,\n\t\tuser\n\t} from '$lib/stores';\n\timport { synthesizeOpenAISpeech } from '$lib/apis/audio';\n\timport { imageGenerations } from '$lib/apis/images';\n\timport {\n\t\tcopyToClipboard as _copyToClipboard,\n\t\tapproximateToHumanReadable,\n\t\tgetMessageContentParts,\n\t\tsanitizeResponseContent,\n\t\tcreateMessagesList,\n\t\tformatDate,\n\t\tremoveDetails,\n\t\tremoveAllDetails\n\t} from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Name from './Name.svelte';\n\timport ProfileImage from './ProfileImage.svelte';\n\timport Skeleton from './Skeleton.svelte';\n\timport Image from '$lib/components/common/Image.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport RateComment from './RateComment.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport WebSearchResults from './ResponseMessage/WebSearchResults.svelte';\n\timport Sparkles from '$lib/components/icons/Sparkles.svelte';\n\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport Error from './Error.svelte';\n\timport Citations from './Citations.svelte';\n\timport CodeExecutions from './CodeExecutions.svelte';\n\timport ContentRenderer from './ContentRenderer.svelte';\n\timport { KokoroWorker } from '$lib/workers/KokoroWorker';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport FollowUps from './ResponseMessage/FollowUps.svelte';\n\timport { fade } from 'svelte/transition';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport RegenerateMenu from './ResponseMessage/RegenerateMenu.svelte';\n\timport StatusHistory from './ResponseMessage/StatusHistory.svelte';\n\timport FullHeightIframe from '$lib/components/common/FullHeightIframe.svelte';\n\n\tinterface MessageType {\n\t\tid: string;\n\t\tmodel: string;\n\t\tcontent: string;\n\t\tfiles?: { type: string; url: string }[];\n\t\ttimestamp: number;\n\t\trole: string;\n\t\tstatusHistory?: {\n\t\t\tdone: boolean;\n\t\t\taction: string;\n\t\t\tdescription: string;\n\t\t\turls?: string[];\n\t\t\tquery?: string;\n\t\t}[];\n\t\tstatus?: {\n\t\t\tdone: boolean;\n\t\t\taction: string;\n\t\t\tdescription: string;\n\t\t\turls?: string[];\n\t\t\tquery?: string;\n\t\t};\n\t\tdone: boolean;\n\t\terror?: boolean | { content: string };\n\t\tsources?: string[];\n\t\tcode_executions?: {\n\t\t\tuuid: string;\n\t\t\tname: string;\n\t\t\tcode: string;\n\t\t\tlanguage?: string;\n\t\t\tresult?: {\n\t\t\t\terror?: string;\n\t\t\t\toutput?: string;\n\t\t\t\tfiles?: { name: string; url: string }[];\n\t\t\t};\n\t\t}[];\n\t\tinfo?: {\n\t\t\topenai?: boolean;\n\t\t\tprompt_tokens?: number;\n\t\t\tcompletion_tokens?: number;\n\t\t\ttotal_tokens?: number;\n\t\t\teval_count?: number;\n\t\t\teval_duration?: number;\n\t\t\tprompt_eval_count?: number;\n\t\t\tprompt_eval_duration?: number;\n\t\t\ttotal_duration?: number;\n\t\t\tload_duration?: number;\n\t\t\tusage?: unknown;\n\t\t};\n\t\tannotation?: { type: string; rating: number };\n\t}\n\n\texport let chatId = '';\n\texport let history;\n\texport let messageId;\n\texport let selectedModels = [];\n\n\tlet message: MessageType = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\texport let siblings;\n\n\texport let setInputText: Function = () => {};\n\texport let gotoMessage: Function = () => {};\n\texport let showPreviousMessage: Function;\n\texport let showNextMessage: Function;\n\n\texport let updateChat: Function;\n\texport let editMessage: Function;\n\texport let saveMessage: Function;\n\texport let rateMessage: Function;\n\texport let actionMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let submitMessage: Function;\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\n\texport let addMessages: Function;\n\n\texport let isLastMessage = true;\n\texport let readOnly = false;\n\texport let editCodeBlock = true;\n\texport let topPadding = false;\n\n\tlet citationsElement: HTMLDivElement;\n\n\tlet contentContainerElement: HTMLDivElement;\n\tlet buttonsContainerElement: HTMLDivElement;\n\tlet showDeleteConfirm = false;\n\n\tlet model = null;\n\t$: model = $models.find((m) => m.id === message.model);\n\n\tlet edit = false;\n\tlet editedContent = '';\n\tlet editTextAreaElement: HTMLTextAreaElement;\n\n\tlet messageIndexEdit = false;\n\n\tlet speaking = false;\n\tlet speakingIdx: number | undefined;\n\n\tlet loadingSpeech = false;\n\n\tlet showRateComment = false;\n\n\tconst copyToClipboard = async (text) => {\n\t\ttext = removeAllDetails(text);\n\n\t\tif (($config?.ui?.response_watermark ?? '').trim() !== '') {\n\t\t\ttext = `${text}\\n\\n${$config?.ui?.response_watermark}`;\n\t\t}\n\n\t\tconst res = await _copyToClipboard(text, null, $settings?.copyFormatted ?? false);\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Copying to clipboard was successful!'));\n\t\t}\n\t};\n\n\tconst stopAudio = () => {\n\t\ttry {\n\t\t\tspeechSynthesis.cancel();\n\t\t\t$audioQueue.stop();\n\t\t} catch {}\n\n\t\tif (speaking) {\n\t\t\tspeaking = false;\n\t\t\tspeakingIdx = undefined;\n\t\t}\n\t};\n\n\tconst speak = async () => {\n\t\tif (!(message?.content ?? '').trim().length) {\n\t\t\ttoast.info($i18n.t('No content to speak'));\n\t\t\treturn;\n\t\t}\n\n\t\tspeaking = true;\n\t\tconst content = removeAllDetails(message.content);\n\n\t\t// Get voice: model-specific > user settings > config default\n\t\tconst getVoiceId = () => {\n\t\t\t// Check for model-specific TTS voice first\n\t\t\tif (model?.info?.meta?.tts?.voice) {\n\t\t\t\treturn model.info.meta.tts.voice;\n\t\t\t}\n\t\t\t// Fall back to user settings or config default\n\t\t\tif ($settings?.audio?.tts?.defaultVoice === $config.audio.tts.voice) {\n\t\t\t\treturn $settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice;\n\t\t\t}\n\t\t\treturn $config?.audio?.tts?.voice;\n\t\t};\n\n\t\tif ($config.audio.tts.engine === '') {\n\t\t\tlet voices = [];\n\t\t\tconst getVoicesLoop = setInterval(() => {\n\t\t\t\tvoices = speechSynthesis.getVoices();\n\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\tconst voiceId = getVoiceId();\n\t\t\t\t\tconst voice = voices?.filter((v) => v.voiceURI === voiceId)?.at(0) ?? undefined;\n\n\t\t\t\t\tconsole.log(voice);\n\n\t\t\t\t\tconst speech = new SpeechSynthesisUtterance(content);\n\t\t\t\t\tspeech.rate = $settings.audio?.tts?.playbackRate ?? 1;\n\n\t\t\t\t\tconsole.log(speech);\n\n\t\t\t\t\tspeech.onend = () => {\n\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\tif ($settings.conversationMode) {\n\t\t\t\t\t\t\tdocument.getElementById('voice-input-button')?.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (voice) {\n\t\t\t\t\t\tspeech.voice = voice;\n\t\t\t\t\t}\n\n\t\t\t\t\tspeechSynthesis.speak(speech);\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t} else {\n\t\t\t$audioQueue.setId(`${message.id}`);\n\t\t\t$audioQueue.setPlaybackRate($settings.audio?.tts?.playbackRate ?? 1);\n\t\t\t$audioQueue.onStopped = () => {\n\t\t\t\tspeaking = false;\n\t\t\t\tspeakingIdx = undefined;\n\t\t\t};\n\n\t\t\tloadingSpeech = true;\n\t\t\tconst messageContentParts: string[] = getMessageContentParts(\n\t\t\t\tcontent,\n\t\t\t\t$config?.audio?.tts?.split_on ?? 'punctuation'\n\t\t\t);\n\n\t\t\tif (!messageContentParts.length) {\n\t\t\t\tconsole.log('No content to speak');\n\t\t\t\ttoast.info($i18n.t('No content to speak'));\n\n\t\t\t\tspeaking = false;\n\t\t\t\tloadingSpeech = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst voiceId = getVoiceId();\n\t\t\tconsole.debug('Prepared message content for TTS', messageContentParts, 'voice:', voiceId);\n\n\t\t\tif ($settings.audio?.tts?.engine === 'browser-kokoro') {\n\t\t\t\tif (!$TTSWorker) {\n\t\t\t\t\tawait TTSWorker.set(\n\t\t\t\t\t\tnew KokoroWorker({\n\t\t\t\t\t\t\tdtype: $settings.audio?.tts?.engineConfig?.dtype ?? 'fp32'\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\n\t\t\t\t\tawait $TTSWorker.init();\n\t\t\t\t}\n\n\t\t\t\tfor (const [idx, sentence] of messageContentParts.entries()) {\n\t\t\t\t\tconst url = await $TTSWorker\n\t\t\t\t\t\t.generate({\n\t\t\t\t\t\t\ttext: sentence,\n\t\t\t\t\t\t\tvoice: voiceId\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\n\t\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (url && speaking) {\n\t\t\t\t\t\t$audioQueue.enqueue(url);\n\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (const [idx, sentence] of messageContentParts.entries()) {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(localStorage.token, voiceId, sentence).catch(\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t\ttoast.error(`${error}`);\n\n\t\t\t\t\t\t\tspeaking = false;\n\t\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tif (res && speaking) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst url = URL.createObjectURL(blob);\n\n\t\t\t\t\t\t$audioQueue.enqueue(url);\n\t\t\t\t\t\tloadingSpeech = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tlet preprocessedDetailsCache = [];\n\n\tfunction preprocessForEditing(content: string): string {\n\t\t// Replace <details>...</details> with unique ID placeholder\n\t\tconst detailsBlocks = [];\n\t\tlet i = 0;\n\n\t\tcontent = content.replace(/<details[\\s\\S]*?<\\/details>/gi, (match) => {\n\t\t\tdetailsBlocks.push(match);\n\t\t\treturn `<details id=\"__DETAIL_${i++}__\"/>`;\n\t\t});\n\n\t\t// Store original blocks in the editedContent or globally (see merging later)\n\t\tpreprocessedDetailsCache = detailsBlocks;\n\n\t\treturn content;\n\t}\n\n\tfunction postprocessAfterEditing(content: string): string {\n\t\tconst restoredContent = content.replace(\n\t\t\t/<details id=\"__DETAIL_(\\d+)__\"\\/>/g,\n\t\t\t(_, index) => preprocessedDetailsCache[parseInt(index)] || ''\n\t\t);\n\n\t\treturn restoredContent;\n\t}\n\n\tconst editMessageHandler = async () => {\n\t\tedit = true;\n\n\t\teditedContent = preprocessForEditing(message.content);\n\n\t\tawait tick();\n\n\t\teditTextAreaElement.style.height = '';\n\t\teditTextAreaElement.style.height = `${editTextAreaElement.scrollHeight}px`;\n\t};\n\n\tconst editMessageConfirmHandler = async () => {\n\t\tconst messageContent = postprocessAfterEditing(editedContent ? editedContent : '');\n\t\teditMessage(message.id, { content: messageContent }, false);\n\n\t\tedit = false;\n\t\teditedContent = '';\n\n\t\tawait tick();\n\t};\n\n\tconst saveAsCopyHandler = async () => {\n\t\tconst messageContent = postprocessAfterEditing(editedContent ? editedContent : '');\n\n\t\teditMessage(message.id, { content: messageContent });\n\n\t\tedit = false;\n\t\teditedContent = '';\n\n\t\tawait tick();\n\t};\n\n\tconst cancelEditMessage = async () => {\n\t\tedit = false;\n\t\teditedContent = '';\n\t\tawait tick();\n\t};\n\n\tlet feedbackLoading = false;\n\n\tconst feedbackHandler = async (rating: number | null = null, details: object | null = null) => {\n\t\tfeedbackLoading = true;\n\t\tconsole.log('Feedback', rating, details);\n\n\t\tconst updatedMessage = {\n\t\t\t...message,\n\t\t\tannotation: {\n\t\t\t\t...(message?.annotation ?? {}),\n\t\t\t\t...(rating !== null ? { rating: rating } : {}),\n\t\t\t\t...(details ? details : {})\n\t\t\t}\n\t\t};\n\n\t\tconst chat = await getChatById(localStorage.token, chatId).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t});\n\t\tif (!chat) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst messages = createMessagesList(history, message.id);\n\n\t\tlet feedbackItem = {\n\t\t\ttype: 'rating',\n\t\t\tdata: {\n\t\t\t\t...(updatedMessage?.annotation ? updatedMessage.annotation : {}),\n\t\t\t\tmodel_id: message?.selectedModelId ?? message.model,\n\t\t\t\t...(history.messages[message.parentId].childrenIds.length > 1\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tsibling_model_ids: history.messages[message.parentId].childrenIds\n\t\t\t\t\t\t\t\t.filter((id) => id !== message.id)\n\t\t\t\t\t\t\t\t.map((id) => history.messages[id]?.selectedModelId ?? history.messages[id].model)\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t},\n\t\t\tmeta: {\n\t\t\t\tarena: message ? message.arena : false,\n\t\t\t\tmodel_id: message.model,\n\t\t\t\tmessage_id: message.id,\n\t\t\t\tmessage_index: messages.length,\n\t\t\t\tchat_id: chatId\n\t\t\t},\n\t\t\tsnapshot: {\n\t\t\t\tchat: chat\n\t\t\t}\n\t\t};\n\n\t\tconst baseModels = [\n\t\t\tfeedbackItem.data.model_id,\n\t\t\t...(feedbackItem.data.sibling_model_ids ?? [])\n\t\t].reduce((acc, modelId) => {\n\t\t\tconst model = $models.find((m) => m.id === modelId);\n\t\t\tif (model) {\n\t\t\t\tacc[model.id] = model?.info?.base_model_id ?? null;\n\t\t\t} else {\n\t\t\t\t// Log or handle cases where corresponding model is not found\n\t\t\t\tconsole.warn(`Model with ID ${modelId} not found`);\n\t\t\t}\n\t\t\treturn acc;\n\t\t}, {});\n\t\tfeedbackItem.meta.base_models = baseModels;\n\n\t\tlet feedback = null;\n\t\tif (message?.feedbackId) {\n\t\t\tfeedback = await updateFeedbackById(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tmessage.feedbackId,\n\t\t\t\tfeedbackItem\n\t\t\t).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t});\n\t\t} else {\n\t\t\tfeedback = await createNewFeedback(localStorage.token, feedbackItem).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t});\n\n\t\t\tif (feedback) {\n\t\t\t\tupdatedMessage.feedbackId = feedback.id;\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(updatedMessage);\n\t\tsaveMessage(message.id, updatedMessage);\n\n\t\tawait tick();\n\n\t\tif (!details) {\n\t\t\tshowRateComment = true;\n\n\t\t\tif (!updatedMessage.annotation?.tags && (message?.content ?? '') !== '') {\n\t\t\t\t// attempt to generate tags\n\t\t\t\tconst tags = await generateTags(localStorage.token, message.model, messages, chatId).catch(\n\t\t\t\t\t(error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tconsole.log(tags);\n\n\t\t\t\tif (tags) {\n\t\t\t\t\tupdatedMessage.annotation.tags = tags;\n\t\t\t\t\tfeedbackItem.data.tags = tags;\n\n\t\t\t\t\tsaveMessage(message.id, updatedMessage);\n\t\t\t\t\tawait updateFeedbackById(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\tupdatedMessage.feedbackId,\n\t\t\t\t\t\tfeedbackItem\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfeedbackLoading = false;\n\t};\n\n\tconst deleteMessageHandler = async () => {\n\t\tdeleteMessage(message.id);\n\t};\n\n\t$: if (!edit) {\n\t\t(async () => {\n\t\t\tawait tick();\n\t\t})();\n\t}\n\n\tconst buttonsWheelHandler = (event: WheelEvent) => {\n\t\tif (buttonsContainerElement) {\n\t\t\tif (buttonsContainerElement.scrollWidth <= buttonsContainerElement.clientWidth) {\n\t\t\t\t// If the container is not scrollable, horizontal scroll\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tif (event.deltaY !== 0) {\n\t\t\t\t\t// Adjust horizontal scroll position based on vertical scroll\n\t\t\t\t\tbuttonsContainerElement.scrollLeft += event.deltaY;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst contentCopyHandler = (e) => {\n\t\tif (contentContainerElement) {\n\t\t\te.preventDefault();\n\t\t\t// Get the selected HTML\n\t\t\tconst selection = window.getSelection();\n\t\t\tconst range = selection.getRangeAt(0);\n\t\t\tconst tempDiv = document.createElement('div');\n\n\t\t\t// Remove background, color, and font styles\n\t\t\ttempDiv.appendChild(range.cloneContents());\n\n\t\t\ttempDiv.querySelectorAll('table').forEach((table) => {\n\t\t\t\ttable.style.borderCollapse = 'collapse';\n\t\t\t\ttable.style.width = 'auto';\n\t\t\t\ttable.style.tableLayout = 'auto';\n\t\t\t});\n\n\t\t\ttempDiv.querySelectorAll('th').forEach((th) => {\n\t\t\t\tth.style.whiteSpace = 'nowrap';\n\t\t\t\tth.style.padding = '4px 8px';\n\t\t\t});\n\n\t\t\t// Put cleaned HTML + plain text into clipboard\n\t\t\te.clipboardData.setData('text/html', tempDiv.innerHTML);\n\t\t\te.clipboardData.setData('text/plain', selection.toString());\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\t// console.log('ResponseMessage mounted');\n\n\t\tawait tick();\n\t\tif (buttonsContainerElement) {\n\t\t\tbuttonsContainerElement.addEventListener('wheel', buttonsWheelHandler);\n\t\t}\n\n\t\tif (contentContainerElement) {\n\t\t\tcontentContainerElement.addEventListener('copy', contentCopyHandler);\n\t\t}\n\t});\n\n\tonDestroy(() => {\n\t\tif (buttonsContainerElement) {\n\t\t\tbuttonsContainerElement.removeEventListener('wheel', buttonsWheelHandler);\n\t\t}\n\n\t\tif (contentContainerElement) {\n\t\t\tcontentContainerElement.removeEventListener('copy', contentCopyHandler);\n\t\t}\n\t});\n</script>\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete message?')}\n\ton:confirm={() => {\n\t\tdeleteMessageHandler();\n\t}}\n/>\n\n{#key message.id}\n\t<div\n\t\tclass=\" flex w-full message-{message.id}\"\n\t\tid=\"message-{message.id}\"\n\t\tdir={$settings.chatDirection}\n\t>\n\t\t<div class={`shrink-0 ltr:mr-3 rtl:ml-3 hidden @lg:flex mt-1 `}>\n\t\t\t<ProfileImage\n\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}`}\n\t\t\t\tclassName={'size-8 assistant-message-profile-image'}\n\t\t\t/>\n\t\t</div>\n\n\t\t<div class=\"flex-auto w-0 pl-1 relative\">\n\t\t\t<Name>\n\t\t\t\t<Tooltip content={model?.name ?? message.model} placement=\"top-start\">\n\t\t\t\t\t<span id=\"response-message-model-name\" class=\"line-clamp-1 text-black dark:text-white\">\n\t\t\t\t\t\t{model?.name ?? message.model}\n\t\t\t\t\t</span>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"self-center text-xs font-medium first-letter:capitalize ml-0.5 translate-y-[1px] {($settings?.highContrastMode ??\n\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t? 'dark:text-gray-100 text-gray-900'\n\t\t\t\t\t\t\t: 'invisible group-hover:visible transition text-gray-400'}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip content={dayjs(message.timestamp * 1000).format('LLLL')}>\n\t\t\t\t\t\t\t<span class=\"line-clamp-1\"\n\t\t\t\t\t\t\t\t>{$i18n.t(formatDate(message.timestamp * 1000), {\n\t\t\t\t\t\t\t\t\tLOCALIZED_TIME: dayjs(message.timestamp * 1000).format('LT'),\n\t\t\t\t\t\t\t\t\tLOCALIZED_DATE: dayjs(message.timestamp * 1000).format('L')\n\t\t\t\t\t\t\t\t})}</span\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</Name>\n\n\t\t\t<div>\n\t\t\t\t<div class=\"chat-{message.role} w-full min-w-full markdown-prose\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if model?.info?.meta?.capabilities?.status_updates ?? true}\n\t\t\t\t\t\t\t<StatusHistory statusHistory={message?.statusHistory} />\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if message?.files && message.files?.filter((f) => f.type === 'image').length > 0}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"my-1 w-full flex overflow-x-auto gap-2 flex-wrap\"\n\t\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{#each message.files as file}\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image' || (file?.content_type ?? '').startsWith('image/')}\n\t\t\t\t\t\t\t\t\t\t\t<Image src={file.url} alt={message.content} />\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\t\t\turl={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if message?.embeds && message.embeds.length > 0}\n\t\t\t\t\t\t\t<div class=\"my-1 w-full flex overflow-x-auto gap-2 flex-wrap\">\n\t\t\t\t\t\t\t\t{#each message.embeds as embed, idx}\n\t\t\t\t\t\t\t\t\t<div class=\"my-2 w-full\" id={`${message.id}-embeds-${idx}`}>\n\t\t\t\t\t\t\t\t\t\t<FullHeightIframe\n\t\t\t\t\t\t\t\t\t\t\tsrc={embed}\n\t\t\t\t\t\t\t\t\t\t\tallowScripts={true}\n\t\t\t\t\t\t\t\t\t\t\tallowForms={true}\n\t\t\t\t\t\t\t\t\t\t\tallowSameOrigin={$settings?.iframeSandboxAllowSameOrigin ?? false}\n\t\t\t\t\t\t\t\t\t\t\tallowPopups={true}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if edit === true}\n\t\t\t\t\t\t\t<div class=\"w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 my-2\">\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"message-edit-{message.id}\"\n\t\t\t\t\t\t\t\t\tbind:this={editTextAreaElement}\n\t\t\t\t\t\t\t\t\tclass=\" bg-transparent outline-hidden w-full resize-none\"\n\t\t\t\t\t\t\t\t\tbind:value={editedContent}\n\t\t\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = `${e.target.scrollHeight}px`;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('close-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconst isCmdOrCtrlPressed = e.metaKey || e.ctrlKey;\n\t\t\t\t\t\t\t\t\t\tconst isEnterPressed = e.key === 'Enter';\n\n\t\t\t\t\t\t\t\t\t\tif (isCmdOrCtrlPressed && isEnterPressed) {\n\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('confirm-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\" mt-2 mb-1 flex justify-between text-sm font-medium\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"save-new-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border border-gray-100 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tsaveAsCopyHandler();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Save As Copy')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div class=\"flex space-x-1.5\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"close-edit-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tcancelEditMessage();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Cancel')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tid=\"confirm-edit-message-button\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\teditMessageConfirmHandler();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tbind:this={contentContainerElement}\n\t\t\t\t\t\t\tclass=\"w-full flex flex-col relative {edit ? 'hidden' : ''}\"\n\t\t\t\t\t\t\tid=\"response-content-container\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if message.content === '' && !message.error && ((model?.info?.meta?.capabilities?.status_updates ?? true) ? (message?.statusHistory ?? [...(message?.status ? [message?.status] : [])]).length === 0 || (message?.statusHistory?.at(-1)?.hidden ?? false) : true)}\n\t\t\t\t\t\t\t\t<Skeleton />\n\t\t\t\t\t\t\t{:else if message.content && message.error !== true}\n\t\t\t\t\t\t\t\t<!-- always show message contents even if there's an error -->\n\t\t\t\t\t\t\t\t<!-- unless message.error === true which is legacy error handling, where the error message is stored in message.content -->\n\t\t\t\t\t\t\t\t<ContentRenderer\n\t\t\t\t\t\t\t\t\tid={`${chatId}-${message.id}`}\n\t\t\t\t\t\t\t\t\tmessageId={message.id}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tcontent={message.content}\n\t\t\t\t\t\t\t\t\tsources={message.sources}\n\t\t\t\t\t\t\t\t\tfloatingButtons={message?.done &&\n\t\t\t\t\t\t\t\t\t\t!readOnly &&\n\t\t\t\t\t\t\t\t\t\t($settings?.showFloatingActionButtons ?? true)}\n\t\t\t\t\t\t\t\t\tsave={!readOnly}\n\t\t\t\t\t\t\t\t\tpreview={!readOnly}\n\t\t\t\t\t\t\t\t\t{editCodeBlock}\n\t\t\t\t\t\t\t\t\t{topPadding}\n\t\t\t\t\t\t\t\t\tdone={($settings?.chatFadeStreamingText ?? true)\n\t\t\t\t\t\t\t\t\t\t? (message?.done ?? false)\n\t\t\t\t\t\t\t\t\t\t: true}\n\t\t\t\t\t\t\t\t\t{model}\n\t\t\t\t\t\t\t\t\tonTaskClick={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonSourceClick={async (id) => {\n\t\t\t\t\t\t\t\t\t\tconsole.log(id);\n\n\t\t\t\t\t\t\t\t\t\tif (citationsElement) {\n\t\t\t\t\t\t\t\t\t\t\tcitationsElement?.showSourceModal(id);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonAddMessages={({ modelId, parentId, messages }) => {\n\t\t\t\t\t\t\t\t\t\taddMessages({ modelId, parentId, messages });\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\tonSave={({ raw, oldContent, newContent }) => {\n\t\t\t\t\t\t\t\t\t\thistory.messages[message.id].content = history.messages[\n\t\t\t\t\t\t\t\t\t\t\tmessage.id\n\t\t\t\t\t\t\t\t\t\t].content.replace(raw, raw.replace(oldContent, newContent));\n\n\t\t\t\t\t\t\t\t\t\tupdateChat();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if message?.error}\n\t\t\t\t\t\t\t\t<Error content={message?.error?.content ?? message.content} />\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if (message?.sources || message?.citations) && (model?.info?.meta?.capabilities?.citations ?? true)}\n\t\t\t\t\t\t\t\t<Citations\n\t\t\t\t\t\t\t\t\tbind:this={citationsElement}\n\t\t\t\t\t\t\t\t\tid={message?.id}\n\t\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t\tsources={message?.sources ?? message?.citations}\n\t\t\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if message.code_executions}\n\t\t\t\t\t\t\t\t<CodeExecutions codeExecutions={message.code_executions} />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t{#if !edit}\n\t\t\t\t\t<div\n\t\t\t\t\t\tbind:this={buttonsContainerElement}\n\t\t\t\t\t\tclass=\"flex justify-start overflow-x-auto buttons text-gray-600 dark:text-gray-500 mt-0.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if message.done || siblings.length > 1}\n\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t<div class=\"flex self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Previous message')}\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t{#if messageIndexEdit}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"message-index-input-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={siblings.indexOf(message.id) + 1}\n\t\t\t\t\t\t\t\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t\t\t\t\t\t\t\tmax={siblings.length}\n\t\t\t\t\t\t\t\t\t\t\t\ton:focus={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\te.target.select();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\ton:blur={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t\t/>/{siblings.length}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t\t\ton:dblclick={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\t\tconst input = document.getElementById(`message-index-input-${message.id}`);\n\t\t\t\t\t\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\t\t\t\t\t\tinput.select();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Next message')}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t{#if message.done}\n\t\t\t\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t\t\t\t{#if $user?.role === 'user' ? ($user?.permissions?.chat?.edit ?? true) : true}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Edit')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Edit')}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditMessageHandler();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Copy')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Copy')}\n\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition copy-response-button\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tcopyToClipboard(message.content);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.tts ?? true)}\n\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Read Aloud')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Read Aloud')}\n\t\t\t\t\t\t\t\t\t\t\tid=\"speak-button-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!loadingSpeech) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (speaking) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstopAudio();\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tspeak();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{#if loadingSpeech}\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_S1WN {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_MGfb 0.8s linear infinite;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.8s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_Km9P {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.65s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_JApP {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: -0.5s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_MGfb {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t93.75%,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topacity: 0.2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN\" cx=\"4\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_Km9P\" cx=\"12\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<circle class=\"spinner_S1WN spinner_JApP\" cx=\"20\" cy=\"12\" r=\"3\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{:else if speaking}\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if message.usage}\n\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\tcontent={message.usage\n\t\t\t\t\t\t\t\t\t\t\t? `<pre>${sanitizeResponseContent(\n\t\t\t\t\t\t\t\t\t\t\t\t\tJSON.stringify(message.usage, null, 2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.replace(/\"([^(\")\"]+)\":/g, '$1:')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.slice(1, -1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split('\\n')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((line) => line.slice(2))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((line) => (line.endsWith(',') ? line.slice(0, -1) : line))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join('\\n')\n\t\t\t\t\t\t\t\t\t\t\t\t)}</pre>`\n\t\t\t\t\t\t\t\t\t\t\t: ''}\n\t\t\t\t\t\t\t\t\t\tplacement=\"bottom\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\" {isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition whitespace-pre-wrap\"\n\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(message);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tid=\"info-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t\t\t\t{#if !$temporaryChatEnabled && ($config?.features.enable_message_rating ?? true) && ($user?.role === 'admin' || ($user?.permissions?.chat?.rate_response ?? true))}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Good Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Good Response')}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg {(\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage?.annotation?.rating ?? ''\n\t\t\t\t\t\t\t\t\t\t\t\t).toString() === '1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={feedbackLoading}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait feedbackHandler(1);\n\t\t\t\t\t\t\t\t\t\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementById(`message-feedback-${message.id}`)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.scrollIntoView();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Bad Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Bad Response')}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg {(\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage?.annotation?.rating ?? ''\n\t\t\t\t\t\t\t\t\t\t\t\t).toString() === '-1'\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: ''} dark:hover:text-white hover:text-black transition disabled:cursor-progress disabled:hover:bg-transparent\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={feedbackLoading}\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tawait feedbackHandler(-1);\n\t\t\t\t\t\t\t\t\t\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdocument\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getElementById(`message-feedback-${message.id}`)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t?.scrollIntoView();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if isLastMessage && ($user?.role === 'admin' || ($user?.permissions?.chat?.continue_response ?? true))}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Continue Response')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Continue Response')}\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"continue-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontinueResponse();\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15.91 11.672a.375.375 0 0 1 0 .656l-5.603 3.113a.375.375 0 0 1-.557-.328V8.887c0-.286.307-.466.557-.327l5.603 3.112Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.regenerate_response ?? true)}\n\t\t\t\t\t\t\t\t\t\t{#if $settings?.regenerateMenu ?? true}\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"hidden regenerate-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowRateComment = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\tregenerateResponse(message);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t(model?.actions ?? []).forEach((action) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('action', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: action.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'regenerate-response',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageId: message.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t\t\t\t<RegenerateMenu\n\t\t\t\t\t\t\t\t\t\t\t\tonRegenerate={(prompt = null) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowRateComment = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\tregenerateResponse(message, prompt);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t(model?.actions ?? []).forEach((action) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('action', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: action.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'regenerate-response',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageId: message.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Regenerate')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Regenerate')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t</RegenerateMenu>\n\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Regenerate')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Regenerate')}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition regenerate-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowRateComment = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tregenerateResponse(message);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t(model?.actions ?? []).forEach((action) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdispatch('action', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: action.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tevent: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: 'regenerate-response',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessageId: message.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#if $user?.role === 'admin' || ($user?.permissions?.chat?.delete_message ?? true)}\n\t\t\t\t\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Delete')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\taria-label={$i18n.t('Delete')}\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"delete-response-button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t{#each model?.actions ?? [] as action}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={action.name} placement=\"bottom\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\taria-label={action.name}\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{isLastMessage || ($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tactionMessage(action.id, message);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{#if action?.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"size-4\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={action.icon}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4 {action.icon.includes('svg')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'dark:invert-[80%]'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle=\"fill: currentColor;\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={action.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Sparkles strokeWidth=\"2.1\" className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if message.done && showRateComment}\n\t\t\t\t\t\t<RateComment\n\t\t\t\t\t\t\tbind:message\n\t\t\t\t\t\t\tbind:show={showRateComment}\n\t\t\t\t\t\t\ton:save={async (e) => {\n\t\t\t\t\t\t\t\tawait feedbackHandler(null, {\n\t\t\t\t\t\t\t\t\t...e.detail\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if (isLastMessage || ($settings?.keepFollowUpPrompts ?? false)) && message.done && !readOnly && (message?.followUps ?? []).length > 0}\n\t\t\t\t\t\t<div class=\"mt-2.5\" in:fade={{ duration: 100 }}>\n\t\t\t\t\t\t\t<FollowUps\n\t\t\t\t\t\t\t\tfollowUps={message?.followUps}\n\t\t\t\t\t\t\t\tonClick={(prompt) => {\n\t\t\t\t\t\t\t\t\tif ($settings?.insertFollowUpPrompt ?? false) {\n\t\t\t\t\t\t\t\t\t\t// Insert the follow-up prompt into the input box\n\t\t\t\t\t\t\t\t\t\tsetInputText(prompt);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// Submit the follow-up prompt directly\n\t\t\t\t\t\t\t\t\t\tsubmitMessage(message?.id, prompt);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/key}\n\n<style>\n\t.buttons::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.buttons {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M8 8v8m0-8a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm0 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4Zm6-2a2 2 0 1 1 4 0 2 2 0 0 1-4 0Zm0 0h-1a5 5 0 0 1-5-5v-.5\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { mobile, models, settings } from '$lib/stores';\n\n\timport { generateMoACompletion } from '$lib/apis';\n\timport { updateChatById } from '$lib/apis/chats';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\n\timport ResponseMessage from './ResponseMessage.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport Merge from '$lib/components/icons/Merge.svelte';\n\n\timport Markdown from './Markdown.svelte';\n\timport Name from './Name.svelte';\n\timport Skeleton from './Skeleton.svelte';\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\timport ProfileImage from './ProfileImage.svelte';\n\timport { WEBUI_BASE_URL } from '$lib/constants';\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\texport let chatId;\n\texport let history;\n\texport let messageId;\n\texport let selectedModels = [];\n\n\texport let isLastMessage;\n\texport let readOnly = false;\n\texport let editCodeBlock = true;\n\n\texport let setInputText: Function = () => {};\n\texport let updateChat: Function;\n\texport let editMessage: Function;\n\texport let saveMessage: Function;\n\texport let rateMessage: Function;\n\texport let actionMessage: Function;\n\n\texport let submitMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\texport let mergeResponses: Function;\n\n\texport let addMessages: Function;\n\n\texport let triggerScroll: Function;\n\n\texport let topPadding = false;\n\n\tconst dispatch = createEventDispatcher();\n\n\tlet currentMessageId;\n\tlet parentMessage;\n\tlet groupedMessageIds = {};\n\tlet groupedMessageIdsIdx = {};\n\n\tlet selectedModelIdx = null;\n\n\tlet message = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\tconst gotoMessage = async (modelIdx, messageIdx) => {\n\t\t// Clamp messageIdx to ensure it's within valid range\n\t\tgroupedMessageIdsIdx[modelIdx] = Math.max(\n\t\t\t0,\n\t\t\tMath.min(messageIdx, groupedMessageIds[modelIdx].messageIds.length - 1)\n\t\t);\n\n\t\t// Get the messageId at the specified index\n\t\tlet messageId = groupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\tconsole.log(messageId);\n\n\t\t// Traverse the branch to find the deepest child message\n\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t}\n\n\t\t// Update the current message ID in history\n\t\thistory.currentId = messageId;\n\n\t\t// Await UI updates\n\t\tawait tick();\n\t\tawait updateChat();\n\n\t\t// Trigger scrolling after navigation\n\t\ttriggerScroll();\n\t};\n\n\tconst showPreviousMessage = async (modelIdx) => {\n\t\tgroupedMessageIdsIdx[modelIdx] = Math.max(0, groupedMessageIdsIdx[modelIdx] - 1);\n\n\t\tlet messageId = groupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\tconsole.log(messageId);\n\n\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = messageId;\n\n\t\tawait tick();\n\t\tawait updateChat();\n\t\ttriggerScroll();\n\t};\n\n\tconst showNextMessage = async (modelIdx) => {\n\t\tgroupedMessageIdsIdx[modelIdx] = Math.min(\n\t\t\tgroupedMessageIds[modelIdx].messageIds.length - 1,\n\t\t\tgroupedMessageIdsIdx[modelIdx] + 1\n\t\t);\n\n\t\tlet messageId = groupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\tconsole.log(messageId);\n\n\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t}\n\n\t\thistory.currentId = messageId;\n\n\t\tawait tick();\n\t\tawait updateChat();\n\t\ttriggerScroll();\n\t};\n\n\tconst initHandler = async () => {\n\t\tconsole.log('multiresponse:initHandler');\n\t\tawait tick();\n\n\t\tcurrentMessageId = messageId;\n\t\tparentMessage = history.messages[messageId].parentId\n\t\t\t? history.messages[history.messages[messageId].parentId]\n\t\t\t: null;\n\n\t\tgroupedMessageIds = parentMessage?.models.reduce((a, model, modelIdx) => {\n\t\t\t// Find all messages that are children of the parent message and have the same model\n\t\t\tlet modelMessageIds = parentMessage?.childrenIds\n\t\t\t\t.map((id) => history.messages[id])\n\t\t\t\t.filter((m) => m?.modelIdx === modelIdx)\n\t\t\t\t.map((m) => m.id);\n\n\t\t\t// Legacy support for messages that don't have a modelIdx\n\t\t\t// Find all messages that are children of the parent message and have the same model\n\t\t\tif (modelMessageIds.length === 0) {\n\t\t\t\tlet modelMessages = parentMessage?.childrenIds\n\t\t\t\t\t.map((id) => history.messages[id])\n\t\t\t\t\t.filter((m) => m?.model === model);\n\n\t\t\t\tmodelMessages.forEach((m) => {\n\t\t\t\t\tm.modelIdx = modelIdx;\n\t\t\t\t});\n\n\t\t\t\tmodelMessageIds = modelMessages.map((m) => m.id);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...a,\n\t\t\t\t[modelIdx]: { messageIds: modelMessageIds }\n\t\t\t};\n\t\t}, {});\n\n\t\tgroupedMessageIdsIdx = parentMessage?.models.reduce((a, model, modelIdx) => {\n\t\t\tconst idx = groupedMessageIds[modelIdx].messageIds.findIndex((id) => id === messageId);\n\t\t\tif (idx !== -1) {\n\t\t\t\treturn {\n\t\t\t\t\t...a,\n\t\t\t\t\t[modelIdx]: idx\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\t...a,\n\t\t\t\t\t[modelIdx]: groupedMessageIds[modelIdx].messageIds.length - 1\n\t\t\t\t};\n\t\t\t}\n\t\t}, {});\n\n\t\tselectedModelIdx = history.messages[messageId]?.modelIdx;\n\n\t\tconsole.log(groupedMessageIds, groupedMessageIdsIdx);\n\n\t\tawait tick();\n\t};\n\n\tconst onGroupClick = async (_messageId, modelIdx) => {\n\t\tif (messageId != _messageId) {\n\t\t\tlet currentMessageId = _messageId;\n\t\t\tlet messageChildrenIds = history.messages[currentMessageId].childrenIds;\n\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\tcurrentMessageId = messageChildrenIds.at(-1);\n\t\t\t\tmessageChildrenIds = history.messages[currentMessageId].childrenIds;\n\t\t\t}\n\t\t\thistory.currentId = currentMessageId;\n\t\t\tselectedModelIdx = modelIdx;\n\n\t\t\t// await tick();\n\t\t\t// await updateChat();\n\t\t\t// triggerScroll();\n\t\t}\n\t};\n\n\tconst mergeResponsesHandler = async () => {\n\t\tconst responses = Object.keys(groupedMessageIds).map((modelIdx) => {\n\t\t\tconst { messageIds } = groupedMessageIds[modelIdx];\n\t\t\tconst messageId = messageIds[groupedMessageIdsIdx[modelIdx]];\n\n\t\t\treturn history.messages[messageId].content;\n\t\t});\n\t\tmergeResponses(messageId, responses, chatId);\n\t};\n\n\tonMount(async () => {\n\t\tawait initHandler();\n\t\tawait tick();\n\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst messageElement = document.getElementById(`message-${messageId}`);\n\t\t\tif (messageElement) {\n\t\t\t\tmessageElement.scrollIntoView({ block: 'start' });\n\t\t\t}\n\t\t}\n\t});\n</script>\n\n{#if parentMessage}\n\t<div>\n\t\t<div\n\t\t\tclass=\"flex snap-x snap-mandatory overflow-x-auto scrollbar-hidden\"\n\t\t\tid=\"responses-container-{chatId}-{parentMessage.id}\"\n\t\t>\n\t\t\t{#if $settings?.displayMultiModelResponsesInTabs ?? false}\n\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t<div class=\" flex w-full mb-4.5 border-b border-gray-200 dark:border-gray-850\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex gap-2 scrollbar-none overflow-x-auto w-fit text-center font-medium bg-transparent pt-1 text-sm\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#each Object.keys(groupedMessageIds) as modelIdx}\n\t\t\t\t\t\t\t\t{#if groupedMessageIdsIdx[modelIdx] !== undefined && (groupedMessageIds[modelIdx]?.messageIds ?? []).length > 0}\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\n\n\t\t\t\t\t\t\t\t\t{@const _messageId =\n\t\t\t\t\t\t\t\t\t\tgroupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]]}\n\n\t\t\t\t\t\t\t\t\t{@const model = $models.find((m) => m.id === history.messages[_messageId]?.model)}\n\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"min-w-fit {selectedModelIdx == modelIdx\n\t\t\t\t\t\t\t\t\t\t\t? ' dark:border-gray-300 '\n\t\t\t\t\t\t\t\t\t\t\t: ' opacity-35 border-transparent'} pb-1.5 px-2.5 transition border-b-2\"\n\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\tif (selectedModelIdx != modelIdx) {\n\t\t\t\t\t\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tonGroupClick(_messageId, modelIdx);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"-translate-y-[1px]\">\n\t\t\t\t\t\t\t\t\t\t\t\t{model ? `${model.name}` : history.messages[_messageId]?.model}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if selectedModelIdx !== null}\n\t\t\t\t\t\t{#key history.currentId}\n\t\t\t\t\t\t\t{#if message}\n\t\t\t\t\t\t\t\t<ResponseMessage\n\t\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\tmessageId={message?.id}\n\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\tisLastMessage={true}\n\t\t\t\t\t\t\t\t\tsiblings={groupedMessageIds[selectedModelIdx].messageIds}\n\t\t\t\t\t\t\t\t\tgotoMessage={(message, messageIdx) => gotoMessage(selectedModelIdx, messageIdx)}\n\t\t\t\t\t\t\t\t\tshowPreviousMessage={() => showPreviousMessage(selectedModelIdx)}\n\t\t\t\t\t\t\t\t\tshowNextMessage={() => showNextMessage(selectedModelIdx)}\n\t\t\t\t\t\t\t\t\t{setInputText}\n\t\t\t\t\t\t\t\t\t{updateChat}\n\t\t\t\t\t\t\t\t\t{editMessage}\n\t\t\t\t\t\t\t\t\t{saveMessage}\n\t\t\t\t\t\t\t\t\t{rateMessage}\n\t\t\t\t\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t\t\t\t\t{actionMessage}\n\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\tregenerateResponse={async (message, prompt = null) => {\n\t\t\t\t\t\t\t\t\t\tregenerateResponse(message, prompt);\n\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\tgroupedMessageIdsIdx[selectedModelIdx] =\n\t\t\t\t\t\t\t\t\t\t\tgroupedMessageIds[selectedModelIdx].messageIds.length - 1;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t\t\t\t{topPadding}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t{/key}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t{#each Object.keys(groupedMessageIds) as modelIdx}\n\t\t\t\t\t{#if groupedMessageIdsIdx[modelIdx] !== undefined && groupedMessageIds[modelIdx].messageIds.length > 0}\n\t\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t\t<!-- svelte-ignore a11y-click-events-have-key-events -->\n\t\t\t\t\t\t{@const _messageId =\n\t\t\t\t\t\t\tgroupedMessageIds[modelIdx].messageIds[groupedMessageIdsIdx[modelIdx]]}\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\" snap-center w-full max-w-full m-1 border {history.messages[messageId]\n\t\t\t\t\t\t\t\t?.modelIdx == modelIdx\n\t\t\t\t\t\t\t\t? `bg-gray-50 dark:bg-gray-850 border-gray-100 dark:border-gray-800 border-2 ${\n\t\t\t\t\t\t\t\t\t\t$mobile ? 'min-w-full' : 'min-w-80'\n\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t\t: `border-gray-100/30 dark:border-gray-850/30 border-dashed ${\n\t\t\t\t\t\t\t\t\t\t$mobile ? 'min-w-full' : 'min-w-80'\n\t\t\t\t\t\t\t\t\t}`} transition-all p-5 rounded-2xl\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tonGroupClick(_messageId, modelIdx);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#key history.currentId}\n\t\t\t\t\t\t\t\t{#if message}\n\t\t\t\t\t\t\t\t\t<ResponseMessage\n\t\t\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\t\t\t{history}\n\t\t\t\t\t\t\t\t\t\tmessageId={_messageId}\n\t\t\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\t\t\tisLastMessage={true}\n\t\t\t\t\t\t\t\t\t\tsiblings={groupedMessageIds[modelIdx].messageIds}\n\t\t\t\t\t\t\t\t\t\tgotoMessage={(message, messageIdx) => gotoMessage(modelIdx, messageIdx)}\n\t\t\t\t\t\t\t\t\t\tshowPreviousMessage={() => showPreviousMessage(modelIdx)}\n\t\t\t\t\t\t\t\t\t\tshowNextMessage={() => showNextMessage(modelIdx)}\n\t\t\t\t\t\t\t\t\t\t{setInputText}\n\t\t\t\t\t\t\t\t\t\t{updateChat}\n\t\t\t\t\t\t\t\t\t\t{editMessage}\n\t\t\t\t\t\t\t\t\t\t{saveMessage}\n\t\t\t\t\t\t\t\t\t\t{rateMessage}\n\t\t\t\t\t\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t\t\t\t\t\t{actionMessage}\n\t\t\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t\t\tregenerateResponse={async (message, prompt = null) => {\n\t\t\t\t\t\t\t\t\t\t\tregenerateResponse(message, prompt);\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tgroupedMessageIdsIdx[modelIdx] =\n\t\t\t\t\t\t\t\t\t\t\t\tgroupedMessageIds[modelIdx].messageIds.length - 1;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t\t\t\t\t{editCodeBlock}\n\t\t\t\t\t\t\t\t\t\t{topPadding}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t{/each}\n\t\t\t{/if}\n\t\t</div>\n\n\t\t{#if !readOnly}\n\t\t\t{#if !Object.keys(groupedMessageIds).find((modelIdx) => {\n\t\t\t\tconst { messageIds } = groupedMessageIds[modelIdx];\n\t\t\t\tconst _messageId = messageIds[groupedMessageIdsIdx[modelIdx]];\n\t\t\t\treturn !history.messages[_messageId]?.done ?? false;\n\t\t\t})}\n\t\t\t\t<div class=\"flex justify-end\">\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t{#if history.messages[messageId]?.merged?.status}\n\t\t\t\t\t\t\t{@const message = history.messages[messageId]?.merged}\n\n\t\t\t\t\t\t\t<div class=\"w-full rounded-xl pl-5 pr-2 py-2 mt-2\">\n\t\t\t\t\t\t\t\t<Name>\n\t\t\t\t\t\t\t\t\t{$i18n.t('Merged Response')}\n\n\t\t\t\t\t\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t\t\tclass=\" self-center invisible group-hover:visible text-gray-400 text-xs font-medium uppercase ml-0.5 -mt-0.5\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{dayjs(message.timestamp * 1000).format('LT')}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</Name>\n\n\t\t\t\t\t\t\t\t<div class=\"mt-1 markdown-prose w-full min-w-full\">\n\t\t\t\t\t\t\t\t\t{#if (message?.content ?? '') === ''}\n\t\t\t\t\t\t\t\t\t\t<Skeleton />\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t<Markdown id={`merged`} content={message.content ?? ''} />\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if isLastMessage}\n\t\t\t\t\t\t<div class=\" shrink-0 text-gray-600 dark:text-gray-500 mt-1\">\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Merge Responses')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tid=\"merge-response-button\"\n\t\t\t\t\t\t\t\t\tclass=\"{true\n\t\t\t\t\t\t\t\t\t\t? 'visible'\n\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tmergeResponsesHandler();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Merge className=\" size-5 \" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t{/if}\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport dayjs from 'dayjs';\n\timport { toast } from 'svelte-sonner';\n\timport { tick, getContext, onMount } from 'svelte';\n\n\timport { models, settings } from '$lib/stores';\n\timport { user as _user } from '$lib/stores';\n\timport { copyToClipboard as _copyToClipboard, formatDate } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Name from './Name.svelte';\n\timport ProfileImage from './ProfileImage.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport FileItem from '$lib/components/common/FileItem.svelte';\n\timport Markdown from './Markdown.svelte';\n\timport Image from '$lib/components/common/Image.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport localizedFormat from 'dayjs/plugin/localizedFormat';\n\n\tconst i18n = getContext('i18n');\n\tdayjs.extend(localizedFormat);\n\n\texport let user;\n\n\texport let chatId;\n\texport let history;\n\texport let messageId;\n\n\texport let siblings;\n\n\texport let gotoMessage: Function;\n\texport let showPreviousMessage: Function;\n\texport let showNextMessage: Function;\n\n\texport let editMessage: Function;\n\texport let deleteMessage: Function;\n\n\texport let isFirstMessage: boolean;\n\texport let readOnly: boolean;\n\texport let editCodeBlock = true;\n\texport let topPadding = false;\n\n\tlet showDeleteConfirm = false;\n\n\tlet messageIndexEdit = false;\n\n\tlet edit = false;\n\tlet editedContent = '';\n\tlet editedFiles = [];\n\n\tlet messageEditTextAreaElement: HTMLTextAreaElement;\n\n\tlet message = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t$: if (history.messages) {\n\t\tif (JSON.stringify(message) !== JSON.stringify(history.messages[messageId])) {\n\t\t\tmessage = JSON.parse(JSON.stringify(history.messages[messageId]));\n\t\t}\n\t}\n\n\tconst copyToClipboard = async (text) => {\n\t\tconst res = await _copyToClipboard(text);\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Copying to clipboard was successful!'));\n\t\t}\n\t};\n\n\tconst editMessageHandler = async () => {\n\t\tedit = true;\n\t\teditedContent = message?.content ?? '';\n\t\teditedFiles = message.files;\n\n\t\tawait tick();\n\n\t\tif (messageEditTextAreaElement) {\n\t\t\tmessageEditTextAreaElement.style.height = '';\n\t\t\tmessageEditTextAreaElement.style.height = `${messageEditTextAreaElement.scrollHeight}px`;\n\n\t\t\tmessageEditTextAreaElement?.focus();\n\t\t}\n\t};\n\n\tconst editMessageConfirmHandler = async (submit = true) => {\n\t\tif (!editedContent && (editedFiles ?? []).length === 0) {\n\t\t\ttoast.error($i18n.t('Please enter a message or attach a file.'));\n\t\t\treturn;\n\t\t}\n\n\t\teditMessage(message.id, { content: editedContent, files: editedFiles }, submit);\n\n\t\tedit = false;\n\t\teditedContent = '';\n\t\teditedFiles = [];\n\t};\n\n\tconst cancelEditMessage = () => {\n\t\tedit = false;\n\t\teditedContent = '';\n\t\teditedFiles = [];\n\t};\n\n\tconst deleteMessageHandler = async () => {\n\t\tdeleteMessage(message.id);\n\t};\n\n\tonMount(() => {\n\t\t// console.log('UserMessage mounted');\n\t});\n</script>\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete message?')}\n\ton:confirm={() => {\n\t\tdeleteMessageHandler();\n\t}}\n/>\n\n<div\n\tclass=\" flex w-full user-message group\"\n\tdir={$settings.chatDirection}\n\tid=\"message-{message.id}\"\n>\n\t{#if !($settings?.chatBubble ?? true)}\n\t\t<div class={`shrink-0 ltr:mr-3 rtl:ml-3 mt-1`}>\n\t\t\t<ProfileImage\n\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/users/${user.id}/profile/image`}\n\t\t\t\tclassName={'size-8 user-message-profile-image'}\n\t\t\t/>\n\t\t</div>\n\t{/if}\n\t<div class=\"flex-auto w-0 max-w-full pl-1\">\n\t\t{#if !($settings?.chatBubble ?? true)}\n\t\t\t<div>\n\t\t\t\t<Name>\n\t\t\t\t\t{#if message.user}\n\t\t\t\t\t\t{$i18n.t('You')}\n\t\t\t\t\t\t<span class=\" text-gray-500 text-sm font-medium\">{message?.user ?? ''}</span>\n\t\t\t\t\t{:else if $settings.showUsername || $_user.name !== user.name}\n\t\t\t\t\t\t{user.name}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{$i18n.t('You')}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if message.timestamp}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"self-center text-xs font-medium first-letter:capitalize ml-0.5 translate-y-[1px] {($settings?.highContrastMode ??\n\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t? 'dark:text-gray-900 text-gray-100'\n\t\t\t\t\t\t\t\t: 'invisible group-hover:visible transition'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Tooltip content={dayjs(message.timestamp * 1000).format('LLLL')}>\n\t\t\t\t\t\t\t\t<!-- $i18n.t('Today at {{LOCALIZED_TIME}}') -->\n\t\t\t\t\t\t\t\t<!-- $i18n.t('Yesterday at {{LOCALIZED_TIME}}') -->\n\t\t\t\t\t\t\t\t<!-- $i18n.t('{{LOCALIZED_DATE}} at {{LOCALIZED_TIME}}') -->\n\n\t\t\t\t\t\t\t\t<span class=\"line-clamp-1\"\n\t\t\t\t\t\t\t\t\t>{$i18n.t(formatDate(message.timestamp * 1000), {\n\t\t\t\t\t\t\t\t\t\tLOCALIZED_TIME: dayjs(message.timestamp * 1000).format('LT'),\n\t\t\t\t\t\t\t\t\t\tLOCALIZED_DATE: dayjs(message.timestamp * 1000).format('L')\n\t\t\t\t\t\t\t\t\t})}</span\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</Name>\n\t\t\t</div>\n\t\t{:else if message.timestamp}\n\t\t\t<div class=\"flex justify-end pr-2 text-xs\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"text-[0.65rem] font-medium first-letter:capitalize mb-0.5 {($settings?.highContrastMode ??\n\t\t\t\t\tfalse)\n\t\t\t\t\t\t? 'dark:text-gray-100 text-gray-900'\n\t\t\t\t\t\t: 'invisible group-hover:visible transition text-gray-400'}\"\n\t\t\t\t>\n\t\t\t\t\t<Tooltip content={dayjs(message.timestamp * 1000).format('LLLL')}>\n\t\t\t\t\t\t<span class=\"line-clamp-1\"\n\t\t\t\t\t\t\t>{$i18n.t(formatDate(message.timestamp * 1000), {\n\t\t\t\t\t\t\t\tLOCALIZED_TIME: dayjs(message.timestamp * 1000).format('LT'),\n\t\t\t\t\t\t\t\tLOCALIZED_DATE: dayjs(message.timestamp * 1000).format('L')\n\t\t\t\t\t\t\t})}</span\n\t\t\t\t\t\t>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"chat-{message.role} w-full min-w-full markdown-prose\">\n\t\t\t{#if edit !== true}\n\t\t\t\t{#if message.files}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"mb-1 w-full flex flex-col justify-end overflow-x-auto gap-1 flex-wrap\"\n\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'auto'}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#each message.files as file}\n\t\t\t\t\t\t\t{@const fileUrl =\n\t\t\t\t\t\t\t\tfile.url?.startsWith('data') || file.url?.startsWith('http')\n\t\t\t\t\t\t\t\t\t? file.url\n\t\t\t\t\t\t\t\t\t: `${WEBUI_API_BASE_URL}/files/${file.url}${file?.content_type ? '/content' : ''}`}\n\t\t\t\t\t\t\t<div class={($settings?.chatBubble ?? true) ? 'self-end' : ''}>\n\t\t\t\t\t\t\t\t{#if file.type === 'image' || (file?.content_type ?? '').startsWith('image/')}\n\t\t\t\t\t\t\t\t\t<Image src={fileUrl} imageClassName=\" max-h-96 rounded-lg\" />\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\turl={file.url}\n\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\tsmall={true}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t{/if}\n\n\t\t\t{#if edit === true}\n\t\t\t\t<div class=\" w-full bg-gray-50 dark:bg-gray-800 rounded-3xl px-5 py-3 mb-2\">\n\t\t\t\t\t{#if (editedFiles ?? []).length > 0}\n\t\t\t\t\t\t<div class=\"flex items-center flex-wrap gap-2 -mx-2 mb-1\">\n\t\t\t\t\t\t\t{#each editedFiles as file, fileIdx}\n\t\t\t\t\t\t\t\t{#if file.type === 'image' || (file?.content_type ?? '').startsWith('image/')}\n\t\t\t\t\t\t\t\t\t{@const fileUrl =\n\t\t\t\t\t\t\t\t\t\tfile.url?.startsWith('data') || file.url?.startsWith('http')\n\t\t\t\t\t\t\t\t\t\t\t? file.url\n\t\t\t\t\t\t\t\t\t\t\t: `${WEBUI_API_BASE_URL}/files/${file.url}${file?.content_type ? '/content' : ''}`}\n\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"relative flex items-center\">\n\t\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={fileUrl}\n\t\t\t\t\t\t\t\t\t\t\t\talt=\"input\"\n\t\t\t\t\t\t\t\t\t\t\t\timageClassName=\" size-14 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-white text-black border border-white rounded-full {($settings?.highContrastMode ??\n\t\t\t\t\t\t\t\t\t\t\t\tfalse)\n\t\t\t\t\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'group-hover:visible invisible transition'}\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\teditedFiles.splice(fileIdx, 1);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\teditedFiles = editedFiles;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\tedit={true}\n\t\t\t\t\t\t\t\t\t\ton:dismiss={async () => {\n\t\t\t\t\t\t\t\t\t\t\teditedFiles.splice(fileIdx, 1);\n\n\t\t\t\t\t\t\t\t\t\t\teditedFiles = editedFiles;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(file);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t<div class=\"max-h-96 overflow-auto\">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tid=\"message-edit-{message.id}\"\n\t\t\t\t\t\t\tbind:this={messageEditTextAreaElement}\n\t\t\t\t\t\t\tclass=\" bg-transparent outline-hidden w-full resize-none\"\n\t\t\t\t\t\t\tbind:value={editedContent}\n\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\te.target.style.height = `${e.target.scrollHeight}px`;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\tdocument.getElementById('close-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst isCmdOrCtrlPressed = e.metaKey || e.ctrlKey;\n\t\t\t\t\t\t\t\tconst isEnterPressed = e.key === 'Enter';\n\n\t\t\t\t\t\t\t\tif (isCmdOrCtrlPressed && isEnterPressed) {\n\t\t\t\t\t\t\t\t\tdocument.getElementById('confirm-edit-message-button')?.click();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\" mt-2 mb-1 flex justify-between text-sm font-medium\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"save-edit-message-button\"\n\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700 border border-gray-100 dark:border-gray-700 text-gray-700 dark:text-gray-200 transition rounded-3xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\teditMessageConfirmHandler(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex space-x-1.5\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"close-edit-message-button\"\n\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-white dark:bg-gray-900 hover:bg-gray-100 text-gray-800 dark:text-gray-100 transition rounded-3xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tcancelEditMessage();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{$i18n.t('Cancel')}\n\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tid=\"confirm-edit-message-button\"\n\t\t\t\t\t\t\t\tclass=\"px-3.5 py-1.5 bg-gray-900 dark:bg-white hover:bg-gray-850 text-gray-100 dark:text-gray-800 transition rounded-3xl\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\teditMessageConfirmHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{$i18n.t('Send')}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{:else if message.content !== ''}\n\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t<div class=\"flex {($settings?.chatBubble ?? true) ? 'justify-end pb-1' : 'w-full'}\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"rounded-3xl {($settings?.chatBubble ?? true)\n\t\t\t\t\t\t\t\t? `max-w-[90%] px-4 py-1.5  bg-gray-50 dark:bg-gray-850 ${\n\t\t\t\t\t\t\t\t\t\tmessage.files ? 'rounded-tr-lg' : ''\n\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t\t: ' w-full'}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if message.content}\n\t\t\t\t\t\t\t\t<Markdown\n\t\t\t\t\t\t\t\t\tid={`${chatId}-${message.id}`}\n\t\t\t\t\t\t\t\t\tcontent={message.content}\n\t\t\t\t\t\t\t\t\t{editCodeBlock}\n\t\t\t\t\t\t\t\t\t{topPadding}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\n\t\t\t{#if edit !== true}\n\t\t\t\t<div\n\t\t\t\t\tclass=\" flex {($settings?.chatBubble ?? true)\n\t\t\t\t\t\t? 'justify-end'\n\t\t\t\t\t\t: ''}  text-gray-600 dark:text-gray-500\"\n\t\t\t\t>\n\t\t\t\t\t{#if !($settings?.chatBubble ?? true)}\n\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t<div class=\"flex self-center\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t{#if messageIndexEdit}\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tid=\"message-index-input-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={siblings.indexOf(message.id) + 1}\n\t\t\t\t\t\t\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t\t\t\t\t\t\tmax={siblings.length}\n\t\t\t\t\t\t\t\t\t\t\ton:focus={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.target.select();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\ton:blur={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t/>/{siblings.length}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t\ton:dblclick={async () => {\n\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = true;\n\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tconst input = document.getElementById(`message-index-input-${message.id}`);\n\t\t\t\t\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\t\t\t\t\tinput.select();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\t\t\t\t\t{#if !readOnly}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Edit')} placement=\"bottom\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"{($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition edit-user-message-button\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\teditMessageHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if message?.content}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Copy')} placement=\"bottom\">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"{($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1.5 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tcopyToClipboard(message.content);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"2.3\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $_user?.role === 'admin' || ($_user?.permissions?.chat?.delete_message ?? false)}\n\t\t\t\t\t\t{#if !readOnly && (!isFirstMessage || siblings.length > 1)}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Delete')} placement=\"bottom\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"{($settings?.highContrastMode ?? false)\n\t\t\t\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t\t\t\t: 'invisible group-hover:visible'} p-1 rounded-sm dark:hover:text-white hover:text-black transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if $settings?.chatBubble ?? true}\n\t\t\t\t\t\t{#if siblings.length > 1}\n\t\t\t\t\t\t\t<div class=\"flex self-center\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowPreviousMessage(message);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M15.75 19.5 8.25 12l7.5-7.5\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t{#if messageIndexEdit}\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm flex justify-center font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\tid=\"message-index-input-{message.id}\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\tvalue={siblings.indexOf(message.id) + 1}\n\t\t\t\t\t\t\t\t\t\t\tmin=\"1\"\n\t\t\t\t\t\t\t\t\t\t\tmax={siblings.length}\n\t\t\t\t\t\t\t\t\t\t\ton:focus={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\te.target.select();\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\ton:blur={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\ton:keydown={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tgotoMessage(message, e.target.value - 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-transparent font-semibold self-center dark:text-gray-100 min-w-fit outline-hidden\"\n\t\t\t\t\t\t\t\t\t\t/>/{siblings.length}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<!-- svelte-ignore a11y-no-static-element-interactions -->\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass=\"text-sm tracking-widest font-semibold self-center dark:text-gray-100 min-w-fit\"\n\t\t\t\t\t\t\t\t\t\ton:dblclick={async () => {\n\t\t\t\t\t\t\t\t\t\t\tmessageIndexEdit = true;\n\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tconst input = document.getElementById(`message-index-input-${message.id}`);\n\t\t\t\t\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\t\t\t\t\tinput.select();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{siblings.indexOf(message.id) + 1}/{siblings.length}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:bg-black/5 dark:hover:bg-white/5 dark:hover:text-white hover:text-black rounded-md transition\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowNextMessage(message);\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"m8.25 4.5 7.5 7.5-7.5 7.5\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\n\timport { tick, getContext, onMount, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\tconst i18n = getContext('i18n');\n\n\timport { settings } from '$lib/stores';\n\timport { copyToClipboard } from '$lib/utils';\n\n\timport MultiResponseMessages from './MultiResponseMessages.svelte';\n\timport ResponseMessage from './ResponseMessage.svelte';\n\timport UserMessage from './UserMessage.svelte';\n\n\texport let chatId;\n\texport let selectedModels = [];\n\texport let idx = 0;\n\n\texport let history;\n\texport let messageId;\n\n\texport let user;\n\n\texport let setInputText: Function = () => {};\n\texport let gotoMessage;\n\texport let showPreviousMessage;\n\texport let showNextMessage;\n\texport let updateChat;\n\n\texport let editMessage;\n\texport let saveMessage;\n\texport let deleteMessage;\n\texport let rateMessage;\n\texport let actionMessage;\n\texport let submitMessage;\n\n\texport let regenerateResponse;\n\texport let continueResponse;\n\texport let mergeResponses;\n\n\texport let addMessages;\n\texport let triggerScroll;\n\texport let readOnly = false;\n\texport let editCodeBlock = true;\n\texport let topPadding = false;\n</script>\n\n<div\n\trole=\"listitem\"\n\tclass=\"flex flex-col justify-between px-5 mb-3 w-full {($settings?.widescreenMode ?? null)\n\t\t? 'max-w-full'\n\t\t: 'max-w-5xl'} mx-auto rounded-lg group\"\n>\n\t{#if history.messages[messageId]}\n\t\t{#if history.messages[messageId].role === 'user'}\n\t\t\t<UserMessage\n\t\t\t\t{user}\n\t\t\t\t{chatId}\n\t\t\t\t{history}\n\t\t\t\t{messageId}\n\t\t\t\tisFirstMessage={idx === 0}\n\t\t\t\tsiblings={history.messages[messageId].parentId !== null\n\t\t\t\t\t? (history.messages[history.messages[messageId].parentId]?.childrenIds ?? [])\n\t\t\t\t\t: (Object.values(history.messages)\n\t\t\t\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t\t\t\t.map((message) => message.id) ?? [])}\n\t\t\t\t{gotoMessage}\n\t\t\t\t{showPreviousMessage}\n\t\t\t\t{showNextMessage}\n\t\t\t\t{editMessage}\n\t\t\t\t{deleteMessage}\n\t\t\t\t{readOnly}\n\t\t\t\t{editCodeBlock}\n\t\t\t\t{topPadding}\n\t\t\t/>\n\t\t{:else if (history.messages[history.messages[messageId].parentId]?.models?.length ?? 1) === 1}\n\t\t\t<ResponseMessage\n\t\t\t\t{chatId}\n\t\t\t\t{history}\n\t\t\t\t{messageId}\n\t\t\t\t{selectedModels}\n\t\t\t\tisLastMessage={messageId === history.currentId}\n\t\t\t\tsiblings={history.messages[history.messages[messageId].parentId]?.childrenIds ?? []}\n\t\t\t\t{setInputText}\n\t\t\t\t{gotoMessage}\n\t\t\t\t{showPreviousMessage}\n\t\t\t\t{showNextMessage}\n\t\t\t\t{updateChat}\n\t\t\t\t{editMessage}\n\t\t\t\t{saveMessage}\n\t\t\t\t{rateMessage}\n\t\t\t\t{actionMessage}\n\t\t\t\t{submitMessage}\n\t\t\t\t{deleteMessage}\n\t\t\t\t{continueResponse}\n\t\t\t\t{regenerateResponse}\n\t\t\t\t{addMessages}\n\t\t\t\t{readOnly}\n\t\t\t\t{editCodeBlock}\n\t\t\t\t{topPadding}\n\t\t\t/>\n\t\t{:else}\n\t\t\t{#key messageId}\n\t\t\t\t<MultiResponseMessages\n\t\t\t\t\tbind:history\n\t\t\t\t\t{chatId}\n\t\t\t\t\t{messageId}\n\t\t\t\t\t{selectedModels}\n\t\t\t\t\tisLastMessage={messageId === history?.currentId}\n\t\t\t\t\t{setInputText}\n\t\t\t\t\t{updateChat}\n\t\t\t\t\t{editMessage}\n\t\t\t\t\t{saveMessage}\n\t\t\t\t\t{rateMessage}\n\t\t\t\t\t{actionMessage}\n\t\t\t\t\t{submitMessage}\n\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t{continueResponse}\n\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t{triggerScroll}\n\t\t\t\t\t{addMessages}\n\t\t\t\t\t{readOnly}\n\t\t\t\t\t{editCodeBlock}\n\t\t\t\t\t{topPadding}\n\t\t\t\t/>\n\t\t\t{/key}\n\t\t{/if}\n\t{/if}\n</div>\n","<script lang=\"ts\">\n\timport Fuse from 'fuse.js';\n\timport Bolt from '$lib/components/icons/Bolt.svelte';\n\timport { onMount, getContext } from 'svelte';\n\timport { settings, WEBUI_NAME } from '$lib/stores';\n\timport { WEBUI_VERSION } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\texport let suggestionPrompts = [];\n\texport let className = '';\n\texport let inputValue = '';\n\texport let onSelect = (e) => {};\n\n\tlet sortedPrompts = [];\n\n\tconst fuseOptions = {\n\t\tkeys: ['content', 'title'],\n\t\tthreshold: 0.5\n\t};\n\n\tlet fuse;\n\tlet filteredPrompts = [];\n\n\t// Initialize Fuse\n\t$: fuse = new Fuse(sortedPrompts, fuseOptions);\n\n\t// Update the filteredPrompts if inputValue changes\n\t// Only increase version if something wirklich gendert hat\n\t$: getFilteredPrompts(inputValue);\n\n\t// Helper function to check if arrays are the same\n\t// (based on unique IDs oder content)\n\tfunction arraysEqual(a, b) {\n\t\tif (a.length !== b.length) return false;\n\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\tif ((a[i].id ?? a[i].content) !== (b[i].id ?? b[i].content)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\n\tconst getFilteredPrompts = (inputValue) => {\n\t\tif (inputValue.length > 500) {\n\t\t\tfilteredPrompts = [];\n\t\t} else {\n\t\t\tconst newFilteredPrompts =\n\t\t\t\tinputValue.trim() && fuse\n\t\t\t\t\t? fuse.search(inputValue.trim()).map((result) => result.item)\n\t\t\t\t\t: sortedPrompts;\n\n\t\t\t// Compare with the oldFilteredPrompts\n\t\t\t// If there's a difference, update array + version\n\t\t\tif (!arraysEqual(filteredPrompts, newFilteredPrompts)) {\n\t\t\t\tfilteredPrompts = newFilteredPrompts;\n\t\t\t}\n\t\t}\n\t};\n\n\t$: if (suggestionPrompts) {\n\t\tsortedPrompts = [...(suggestionPrompts ?? [])].sort(() => Math.random() - 0.5);\n\t\tgetFilteredPrompts(inputValue);\n\t}\n</script>\n\n<div class=\"mb-1 flex gap-1 text-xs font-medium items-center text-gray-600 dark:text-gray-400\">\n\t{#if filteredPrompts.length > 0}\n\t\t<Bolt />\n\t\t{$i18n.t('Suggested')}\n\t{:else}\n\t\t<!-- Keine Vorschlge -->\n\n\t\t<div\n\t\t\tclass=\"flex w-full {$settings?.landingPageMode === 'chat'\n\t\t\t\t? ' -mt-1'\n\t\t\t\t: 'text-center items-center justify-center'}  self-start text-gray-600 dark:text-gray-400\"\n\t\t>\n\t\t\t{$WEBUI_NAME}  v{WEBUI_VERSION}\n\t\t</div>\n\t{/if}\n</div>\n\n<div class=\"h-40 w-full\">\n\t{#if filteredPrompts.length > 0}\n\t\t<div role=\"list\" class=\"max-h-40 overflow-auto scrollbar-none items-start {className}\">\n\t\t\t{#each filteredPrompts as prompt, idx (prompt.id || `${prompt.content}-${idx}`)}\n\t\t\t\t<!-- svelte-ignore a11y-no-interactive-element-to-noninteractive-role -->\n\t\t\t\t<button\n\t\t\t\t\trole=\"listitem\"\n\t\t\t\t\tclass=\"waterfall flex flex-col flex-1 shrink-0 w-full justify-between\n\t\t\t\t       px-3 py-2 rounded-xl bg-transparent hover:bg-black/5\n\t\t\t\t       dark:hover:bg-white/5 transition group\"\n\t\t\t\t\tstyle=\"animation-delay: {idx * 60}ms\"\n\t\t\t\t\ton:click={() => onSelect({ type: 'prompt', data: prompt.content })}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex flex-col text-left\">\n\t\t\t\t\t\t{#if prompt.title && prompt.title[0] !== ''}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"font-medium dark:text-gray-300 dark:group-hover:text-gray-200 transition line-clamp-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{prompt.title[0]}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"text-xs text-gray-600 dark:text-gray-400 font-normal line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.title[1]}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"font-medium dark:text-gray-300 dark:group-hover:text-gray-200 transition line-clamp-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{prompt.content}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"text-xs text-gray-600 dark:text-gray-400 font-normal line-clamp-1\">\n\t\t\t\t\t\t\t\t{$i18n.t('Prompt')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t{/each}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t/* Waterfall animation for the suggestions */\n\t@keyframes fadeInUp {\n\t\t0% {\n\t\t\topacity: 0;\n\t\t\ttransform: translateY(20px);\n\t\t}\n\t\t100% {\n\t\t\topacity: 1;\n\t\t\ttransform: translateY(0);\n\t\t}\n\t}\n\n\t.waterfall {\n\t\topacity: 0;\n\t\tanimation-name: fadeInUp;\n\t\tanimation-duration: 200ms;\n\t\tanimation-fill-mode: forwards;\n\t\tanimation-timing-function: ease;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\timport { marked } from 'marked';\n\n\timport { config, user, models as _models, temporaryChatEnabled } from '$lib/stores';\n\timport { onMount, getContext } from 'svelte';\n\n\timport { blur, fade } from 'svelte/transition';\n\n\timport Suggestions from './Suggestions.svelte';\n\timport { sanitizeResponseContent } from '$lib/utils';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport EyeSlash from '$lib/components/icons/EyeSlash.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let modelIds = [];\n\texport let models = [];\n\texport let atSelectedModel;\n\n\texport let onSelect = (e) => {};\n\n\tlet mounted = false;\n\tlet selectedModelIdx = 0;\n\n\t$: if (modelIds.length > 0) {\n\t\tselectedModelIdx = models.length - 1;\n\t}\n\n\t$: models = modelIds.map((id) => $_models.find((m) => m.id === id));\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n</script>\n\n{#key mounted}\n\t<div class=\"m-auto w-full max-w-6xl px-8 lg:px-20\">\n\t\t<div class=\"flex justify-start\">\n\t\t\t<div class=\"flex -space-x-4 mb-0.5\" in:fade={{ duration: 200 }}>\n\t\t\t\t{#each models as model, modelIdx}\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tselectedModelIdx = modelIdx;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={marked.parse(\n\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description ?? ''\n\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tplacement=\"right\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/models/model/profile/image?id=${model?.id}&lang=${$i18n.language}`}\n\t\t\t\t\t\t\t\tclass=\" size-[2.7rem] rounded-full border-[1px] border-gray-100 dark:border-none\"\n\t\t\t\t\t\t\t\talt=\"logo\"\n\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t</button>\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t</div>\n\n\t\t{#if $temporaryChatEnabled}\n\t\t\t<Tooltip\n\t\t\t\tcontent={$i18n.t(\"This chat won't appear in history and your messages will not be saved.\")}\n\t\t\t\tclassName=\"w-full flex justify-start mb-0.5\"\n\t\t\t\tplacement=\"top\"\n\t\t\t>\n\t\t\t\t<div class=\"flex items-center gap-2 text-gray-500 text-lg mt-2 w-fit\">\n\t\t\t\t\t<EyeSlash strokeWidth=\"2.5\" className=\"size-5\" />{$i18n.t('Temporary Chat')}\n\t\t\t\t</div>\n\t\t\t</Tooltip>\n\t\t{/if}\n\n\t\t<div\n\t\t\tclass=\" mt-2 mb-4 text-3xl text-gray-800 dark:text-gray-100 text-left flex items-center gap-4 font-primary\"\n\t\t>\n\t\t\t<div>\n\t\t\t\t<div class=\" capitalize line-clamp-1\" in:fade={{ duration: 200 }}>\n\t\t\t\t\t{#if models[selectedModelIdx]?.name}\n\t\t\t\t\t\t{models[selectedModelIdx]?.name}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{$i18n.t('Hello, {{name}}', { name: $user?.name })}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div in:fade={{ duration: 200, delay: 200 }}>\n\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.description ?? null}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"mt-0.5 text-base font-normal text-gray-500 dark:text-gray-400 line-clamp-3 markdown\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{@html marked.parse(\n\t\t\t\t\t\t\t\tsanitizeResponseContent(\n\t\t\t\t\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.description\n\t\t\t\t\t\t\t\t).replaceAll('\\n', '<br>')\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user}\n\t\t\t\t\t\t\t<div class=\"mt-0.5 text-sm font-normal text-gray-400 dark:text-gray-500\">\n\t\t\t\t\t\t\t\tBy\n\t\t\t\t\t\t\t\t{#if models[selectedModelIdx]?.info?.meta?.user.community}\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref=\"https://openwebui.com/m/{models[selectedModelIdx]?.info?.meta?.user\n\t\t\t\t\t\t\t\t\t\t\t.username}\"\n\t\t\t\t\t\t\t\t\t\t>{models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t? models[selectedModelIdx]?.info?.meta?.user.name\n\t\t\t\t\t\t\t\t\t\t\t: `@${models[selectedModelIdx]?.info?.meta?.user.username}`}</a\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{models[selectedModelIdx]?.info?.meta?.user.name}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div class=\" text-gray-400 dark:text-gray-500 line-clamp-1 font-p\">\n\t\t\t\t\t\t\t{$i18n.t('How can I help you today?')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\" w-full font-primary\" in:fade={{ duration: 200, delay: 300 }}>\n\t\t\t<Suggestions\n\t\t\t\tclassName=\"grid grid-cols-2\"\n\t\t\t\tsuggestionPrompts={atSelectedModel?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\tmodels[selectedModelIdx]?.info?.meta?.suggestion_prompts ??\n\t\t\t\t\t$config?.default_prompt_suggestions ??\n\t\t\t\t\t[]}\n\t\t\t\t{onSelect}\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/key}\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport {\n\t\tchats,\n\t\tconfig,\n\t\tsettings,\n\t\tuser as _user,\n\t\tmobile,\n\t\tcurrentChatPage,\n\t\ttemporaryChatEnabled\n\t} from '$lib/stores';\n\timport { tick, getContext, onMount, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\timport { toast } from 'svelte-sonner';\n\timport { getChatList, updateChatById } from '$lib/apis/chats';\n\timport { copyToClipboard, extractCurlyBraceWords } from '$lib/utils';\n\n\timport Message from './Messages/Message.svelte';\n\timport Loader from '../common/Loader.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\n\timport ChatPlaceholder from './ChatPlaceholder.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let className = 'h-full flex pt-8';\n\n\texport let chatId = '';\n\texport let user = $_user;\n\n\texport let prompt;\n\texport let history = {};\n\texport let selectedModels;\n\texport let atSelectedModel;\n\n\tlet messages = [];\n\n\texport let setInputText: Function = () => {};\n\n\texport let sendMessage: Function;\n\texport let continueResponse: Function;\n\texport let regenerateResponse: Function;\n\texport let mergeResponses: Function;\n\n\texport let chatActionHandler: Function;\n\texport let showMessage: Function = () => {};\n\texport let submitMessage: Function = () => {};\n\texport let addMessages: Function = () => {};\n\n\texport let readOnly = false;\n\texport let editCodeBlock = true;\n\n\texport let topPadding = false;\n\texport let bottomPadding = false;\n\texport let autoScroll;\n\n\texport let onSelect = (e) => {};\n\n\texport let messagesCount: number | null = 20;\n\tlet messagesLoading = false;\n\n\tconst loadMoreMessages = async () => {\n\t\t// scroll slightly down to disable continuous loading\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollTop + 100;\n\n\t\tmessagesLoading = true;\n\t\tmessagesCount += 20;\n\n\t\tawait tick();\n\n\t\tmessagesLoading = false;\n\t};\n\n\t$: if (history.currentId) {\n\t\tlet _messages = [];\n\n\t\tlet message = history.messages[history.currentId];\n\t\tconst visitedMessageIds = new Set();\n\n\t\twhile (message && (messagesCount !== null ? _messages.length <= messagesCount : true)) {\n\t\t\tif (visitedMessageIds.has(message.id)) {\n\t\t\t\tconsole.warn('Circular dependency detected in message history', message.id);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvisitedMessageIds.add(message.id);\n\n\t\t\t_messages.unshift({ ...message });\n\t\t\tmessage = message.parentId !== null ? history.messages[message.parentId] : null;\n\t\t}\n\n\t\tmessages = _messages;\n\t} else {\n\t\tmessages = [];\n\t}\n\n\t$: if (autoScroll && bottomPadding) {\n\t\t(async () => {\n\t\t\tawait tick();\n\t\t\tscrollToBottom();\n\t\t})();\n\t}\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollHeight;\n\t};\n\n\tconst updateChat = async () => {\n\t\tif (!$temporaryChatEnabled) {\n\t\t\thistory = history;\n\t\t\tawait tick();\n\t\t\tawait updateChatById(localStorage.token, chatId, {\n\t\t\t\thistory: history,\n\t\t\t\tmessages: messages\n\t\t\t});\n\n\t\t\tcurrentChatPage.set(1);\n\t\t\tawait chats.set(await getChatList(localStorage.token, $currentChatPage));\n\t\t}\n\t};\n\n\tconst gotoMessage = async (message, idx) => {\n\t\t// Determine the correct sibling list (either parent's children or root messages)\n\t\tlet siblings;\n\t\tif (message.parentId !== null) {\n\t\t\tsiblings = history.messages[message.parentId].childrenIds;\n\t\t} else {\n\t\t\tsiblings = Object.values(history.messages)\n\t\t\t\t.filter((msg) => msg.parentId === null)\n\t\t\t\t.map((msg) => msg.id);\n\t\t}\n\n\t\t// Clamp index to a valid range\n\t\tidx = Math.max(0, Math.min(idx, siblings.length - 1));\n\n\t\tlet messageId = siblings[idx];\n\n\t\t// If we're navigating to a different message\n\t\tif (message.id !== messageId) {\n\t\t\t// Drill down to the deepest child of that branch\n\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t}\n\n\t\t\thistory.currentId = messageId;\n\t\t}\n\n\t\tawait tick();\n\n\t\t// Optional auto-scroll\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tconst showPreviousMessage = async (message) => {\n\t\tif (message.parentId !== null) {\n\t\t\tlet messageId =\n\t\t\t\thistory.messages[message.parentId].childrenIds[\n\t\t\t\t\tMath.max(history.messages[message.parentId].childrenIds.indexOf(message.id) - 1, 0)\n\t\t\t\t];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t} else {\n\t\t\tlet childrenIds = Object.values(history.messages)\n\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t.map((message) => message.id);\n\t\t\tlet messageId = childrenIds[Math.max(childrenIds.indexOf(message.id) - 1, 0)];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tconst showNextMessage = async (message) => {\n\t\tif (message.parentId !== null) {\n\t\t\tlet messageId =\n\t\t\t\thistory.messages[message.parentId].childrenIds[\n\t\t\t\t\tMath.min(\n\t\t\t\t\t\thistory.messages[message.parentId].childrenIds.indexOf(message.id) + 1,\n\t\t\t\t\t\thistory.messages[message.parentId].childrenIds.length - 1\n\t\t\t\t\t)\n\t\t\t\t];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t} else {\n\t\t\tlet childrenIds = Object.values(history.messages)\n\t\t\t\t.filter((message) => message.parentId === null)\n\t\t\t\t.map((message) => message.id);\n\t\t\tlet messageId =\n\t\t\t\tchildrenIds[Math.min(childrenIds.indexOf(message.id) + 1, childrenIds.length - 1)];\n\n\t\t\tif (message.id !== messageId) {\n\t\t\t\tlet messageChildrenIds = history.messages[messageId].childrenIds;\n\n\t\t\t\twhile (messageChildrenIds.length !== 0) {\n\t\t\t\t\tmessageId = messageChildrenIds.at(-1);\n\t\t\t\t\tmessageChildrenIds = history.messages[messageId].childrenIds;\n\t\t\t\t}\n\n\t\t\t\thistory.currentId = messageId;\n\t\t\t}\n\t\t}\n\n\t\tawait tick();\n\n\t\tif ($settings?.scrollOnBranchChange ?? true) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tconst rateMessage = async (messageId, rating) => {\n\t\thistory.messages[messageId].annotation = {\n\t\t\t...history.messages[messageId].annotation,\n\t\t\trating: rating\n\t\t};\n\n\t\tawait updateChat();\n\t};\n\n\tconst editMessage = async (messageId, { content, files }, submit = true) => {\n\t\tif ((selectedModels ?? []).filter((id) => id).length === 0) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t\treturn;\n\t\t}\n\t\tif (history.messages[messageId].role === 'user') {\n\t\t\tif (submit) {\n\t\t\t\t// New user message\n\t\t\t\tlet userPrompt = content;\n\t\t\t\tlet userMessageId = uuidv4();\n\n\t\t\t\tlet userMessage = {\n\t\t\t\t\tid: userMessageId,\n\t\t\t\t\tparentId: history.messages[messageId].parentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'user',\n\t\t\t\t\tcontent: userPrompt,\n\t\t\t\t\t...(files && { files: files }),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\tlet messageParentId = history.messages[messageId].parentId;\n\n\t\t\t\tif (messageParentId !== null) {\n\t\t\t\t\thistory.messages[messageParentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[messageParentId].childrenIds,\n\t\t\t\t\t\tuserMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\t\thistory.currentId = userMessageId;\n\n\t\t\t\tawait tick();\n\t\t\t\tawait sendMessage(history, userMessageId);\n\t\t\t} else {\n\t\t\t\t// Edit user message\n\t\t\t\thistory.messages[messageId].content = content;\n\t\t\t\thistory.messages[messageId].files = files;\n\t\t\t\tawait updateChat();\n\t\t\t}\n\t\t} else {\n\t\t\tif (submit) {\n\t\t\t\t// New response message\n\t\t\t\tconst responseMessageId = uuidv4();\n\t\t\t\tconst message = history.messages[messageId];\n\t\t\t\tconst parentId = message.parentId;\n\n\t\t\t\tconst responseMessage = {\n\t\t\t\t\t...message,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\tfiles: undefined,\n\t\t\t\t\tcontent: content,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null) {\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tawait updateChat();\n\t\t\t} else {\n\t\t\t\t// Edit response message\n\t\t\t\thistory.messages[messageId].originalContent = history.messages[messageId].content;\n\t\t\t\thistory.messages[messageId].content = content;\n\t\t\t\tawait updateChat();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst actionMessage = async (actionId, message, event = null) => {\n\t\tawait chatActionHandler(chatId, actionId, message.model, message.id, event);\n\t};\n\n\tconst saveMessage = async (messageId, message) => {\n\t\tif (!history.messages?.[messageId]) {\n\t\t\treturn;\n\t\t}\n\n\t\thistory.messages[messageId] = message;\n\t\tawait updateChat();\n\t};\n\n\tconst deleteMessage = async (messageId) => {\n\t\tconst messageToDelete = history.messages[messageId];\n\t\tconst parentMessageId = messageToDelete.parentId;\n\t\tconst childMessageIds = messageToDelete.childrenIds ?? [];\n\n\t\t// Collect all grandchildren\n\t\tconst grandchildrenIds = childMessageIds.flatMap(\n\t\t\t(childId) => history.messages[childId]?.childrenIds ?? []\n\t\t);\n\n\t\t// Update parent's children\n\t\tif (parentMessageId && history.messages[parentMessageId]) {\n\t\t\thistory.messages[parentMessageId].childrenIds = [\n\t\t\t\t...history.messages[parentMessageId].childrenIds.filter((id) => id !== messageId),\n\t\t\t\t...grandchildrenIds\n\t\t\t];\n\t\t}\n\n\t\t// Update grandchildren's parent\n\t\tgrandchildrenIds.forEach((grandchildId) => {\n\t\t\tif (history.messages[grandchildId]) {\n\t\t\t\thistory.messages[grandchildId].parentId = parentMessageId;\n\t\t\t}\n\t\t});\n\n\t\t// Delete the message and its children\n\t\t[messageId, ...childMessageIds].forEach((id) => {\n\t\t\tdelete history.messages[id];\n\t\t});\n\n\t\tawait tick();\n\n\t\tshowMessage({ id: parentMessageId });\n\n\t\t// Update the chat\n\t\tawait updateChat();\n\t};\n\n\tconst triggerScroll = () => {\n\t\tif (autoScroll) {\n\t\t\tconst element = document.getElementById('messages-container');\n\t\t\tautoScroll = element.scrollHeight - element.scrollTop <= element.clientHeight + 50;\n\t\t\tsetTimeout(() => {\n\t\t\t\tscrollToBottom();\n\t\t\t}, 100);\n\t\t}\n\t};\n</script>\n\n<div class={className}>\n\t{#if Object.keys(history?.messages ?? {}).length == 0}\n\t\t<ChatPlaceholder modelIds={selectedModels} {atSelectedModel} {onSelect} />\n\t{:else}\n\t\t<div class=\"w-full pt-2\">\n\t\t\t{#key chatId}\n\t\t\t\t<section class=\"w-full\" aria-labelledby=\"chat-conversation\">\n\t\t\t\t\t<h2 class=\"sr-only\" id=\"chat-conversation\">{$i18n.t('Chat Conversation')}</h2>\n\t\t\t\t\t{#if messages.at(0)?.parentId !== null}\n\t\t\t\t\t\t<Loader\n\t\t\t\t\t\t\ton:visible={(e) => {\n\t\t\t\t\t\t\t\tconsole.log('visible');\n\t\t\t\t\t\t\t\tif (!messagesLoading) {\n\t\t\t\t\t\t\t\t\tloadMoreMessages();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"w-full flex justify-center py-1 text-xs animate-pulse items-center gap-2\">\n\t\t\t\t\t\t\t\t<Spinner className=\" size-4\" />\n\t\t\t\t\t\t\t\t<div class=\" \">{$i18n.t('Loading...')}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Loader>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<ul role=\"log\" aria-live=\"polite\" aria-relevant=\"additions\" aria-atomic=\"false\">\n\t\t\t\t\t\t{#each messages as message, messageIdx (message.id)}\n\t\t\t\t\t\t\t<Message\n\t\t\t\t\t\t\t\t{chatId}\n\t\t\t\t\t\t\t\tbind:history\n\t\t\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t\t\tmessageId={message.id}\n\t\t\t\t\t\t\t\tidx={messageIdx}\n\t\t\t\t\t\t\t\t{user}\n\t\t\t\t\t\t\t\t{setInputText}\n\t\t\t\t\t\t\t\t{gotoMessage}\n\t\t\t\t\t\t\t\t{showPreviousMessage}\n\t\t\t\t\t\t\t\t{showNextMessage}\n\t\t\t\t\t\t\t\t{updateChat}\n\t\t\t\t\t\t\t\t{editMessage}\n\t\t\t\t\t\t\t\t{deleteMessage}\n\t\t\t\t\t\t\t\t{rateMessage}\n\t\t\t\t\t\t\t\t{actionMessage}\n\t\t\t\t\t\t\t\t{saveMessage}\n\t\t\t\t\t\t\t\t{submitMessage}\n\t\t\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t\t\t\t{continueResponse}\n\t\t\t\t\t\t\t\t{mergeResponses}\n\t\t\t\t\t\t\t\t{addMessages}\n\t\t\t\t\t\t\t\t{triggerScroll}\n\t\t\t\t\t\t\t\t{readOnly}\n\t\t\t\t\t\t\t\t{editCodeBlock}\n\t\t\t\t\t\t\t\t{topPadding}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</ul>\n\t\t\t\t</section>\n\t\t\t\t<div class=\"pb-18\" />\n\t\t\t\t{#if bottomPadding}\n\t\t\t\t\t<div class=\"  pb-6\" />\n\t\t\t\t{/if}\n\t\t\t{/key}\n\t\t</div>\n\t{/if}\n</div>\n"],"names":["i18n","getContext","dispatch","createEventDispatcher","message","$.prop","$$props","show","LIKE_REASONS","DISLIKE_REASONS","tags","$.mutable_source","reasons","selectedReason","comment","detailedRating","selectedModel","init","$.get","$.set","_b","_a","_d","_c","_f","_e","tag","_i","_h","_g","onMount","$models","m","toast","$i18n","saveHandler","$.untrack","_","i","rating","$.set_class","button_1","$.event","$.each","div_12","reason","$$render","consequent_14","alternate","consequent_13","alternate_1","consequent_12","alternate_2","consequent_11","alternate_3","consequent_10","alternate_4","consequent_9","alternate_5","consequent_8","alternate_6","consequent_7","alternate_7","consequent_6","alternate_8","consequent_5","alternate_9","consequent_4","alternate_10","consequent_3","alternate_11","consequent_2","alternate_12","consequent_1","alternate_13","$.template_effect","button_2","consequent_15","$_tags","e","button","$.bind_value","textarea","$$value","button_3","status","state","consequent","node_5","$.deep_read_state","item","node_7","url","content","citation","showPercentage","showRelevance","mergedDocuments","calculatePercentage","distance","getRelevanceColor","percentage","decodeString","str","getTextFragmentUrl","doc","metadata","source","file_id","page","sourceUrl","baseUrl","WEBUI_API_BASE_URL","words","w","clean","first","last","fragment","c","a","b","document","$.derived_safe_equal","div_4","snippetUrl","$settings","id","chatId","sources","readOnly","citations","showCitations","showCitationModal","selectedCitation","showSourceModal","sourceId","index","output","embedUrl","showControls","showEmbeds","embed","calculateShowRelevance","distances","inRange","d","outOfRange","shouldShowPercentage","acc","_source","existingSource","urlCitations","idx","div_5","codeExecution","file","codeExecutions","selectedCodeExecution","showCodeExecutionModal","updateSelectedCodeExecution","execution","div","messageId","model","messages","actions","onAdd","floatingInput","selectedAction","selectedText","floatingInputValue","responseContent","responseDone","controller","DEFAULT_ACTIONS","ChatBubble","LightBulb","autoScroll","responseContainer","actionHandler","actionId","selectedContent","line","action","prompt","toolIds","varToolPattern","match","variableId","toolId","toolIdPattern","res","chatCompletion","$socket","$chatId","reader","decoder","processStream","done","value","lines","tick","data","addHandler","closeHandler","onDestroy","div_1","$.component","node_3","$$anchor","$$component","input","input_1","history","selectedModels","save","preview","floatingButtons","editCodeBlock","topPadding","onSave","onSourceClick","onTaskClick","onAddMessages","contentContainerElement","floatingButtonsElement","updateButtonPosition","event","buttonsContainerElement","closeFloatingButtons","selection","rect","parentRect","top","left","spaceOnRight","halfScreenWidth","$mobile","right","keydownHandler","ids","token","lang","code","showArtifacts","artifactCode","showOverview","$.bind_this","createMessagesList","modelId","parentId","KokoroWorker","dtype","__publicField","WorkerInstance","error","audioUrl","request","resolve","reject","handleMessage","text","voice","followUps","onClick","div_2","followUp","div_3","className","strokeWidth","onRegenerate","onClose","inputValue","flyAndScale","query","statusHistory","expand","showHistory","$$array","siblings","setInputText","gotoMessage","showPreviousMessage","showNextMessage","updateChat","editMessage","saveMessage","actionMessage","deleteMessage","submitMessage","continueResponse","regenerateResponse","addMessages","isLastMessage","citationsElement","showDeleteConfirm","edit","editedContent","editTextAreaElement","messageIndexEdit","speaking","loadingSpeech","showRateComment","copyToClipboard","removeAllDetails","$config","_copyToClipboard","stopAudio","$audioQueue","speak","getVoiceId","_j","_m","_l","_k","_p","_o","_n","voices","getVoicesLoop","voiceId","v","speech","messageContentParts","getMessageContentParts","$TTSWorker","TTSWorker","sentence","synthesizeOpenAISpeech","blob","preprocessedDetailsCache","preprocessForEditing","detailsBlocks","postprocessAfterEditing","editMessageHandler","$.mutate","editMessageConfirmHandler","messageContent","saveAsCopyHandler","cancelEditMessage","feedbackLoading","feedbackHandler","details","updatedMessage","chat","getChatById","feedbackItem","baseModels","feedback","updateFeedbackById","createNewFeedback","generateTags","deleteMessageHandler","buttonsWheelHandler","contentCopyHandler","range","tempDiv","table","th","dayjs","formatDate","div_7","f","div_9","isCmdOrCtrlPressed","isEnterPressed","raw","oldContent","newContent","div_15","div_19","button_4","button_5","$user","button_6","consequent_16","button_7","sanitizeResponseContent","button_8","consequent_18","button_9","button_10","$temporaryChatEnabled","button_11","button_12","button_13","button_14","node_40","consequent_25","button_15","consequent_26","consequent_27","div_16","$.transition","div_22","fade","consequent_31","$.set_attribute","localizedFormat","rateMessage","mergeResponses","triggerScroll","parentMessage","groupedMessageIds","groupedMessageIdsIdx","selectedModelIdx","modelIdx","messageIdx","messageChildrenIds","initHandler","modelMessageIds","modelMessages","onGroupClick","_messageId","currentMessageId","mergeResponsesHandler","responses","messageIds","messageElement","user","isFirstMessage","editedFiles","messageEditTextAreaElement","submit","$.set_text","text_2","$_user","div_8","fileUrl","div_11","fileIdx","div_25","consequent_17","input_2","div_28","consequent_21","consequent_24","$0","suggestionPrompts","onSelect","sortedPrompts","fuseOptions","fuse","filteredPrompts","arraysEqual","getFilteredPrompts","newFilteredPrompts","result","Fuse","text_1","$WEBUI_NAME","WEBUI_VERSION","text_3","$.set_style","modelIds","models","atSelectedModel","mounted","$_models","marked","div_6","sendMessage","chatActionHandler","showMessage","bottomPadding","messagesCount","messagesLoading","loadMoreMessages","element","scrollToBottom","updateChatById","currentChatPage","chats","getChatList","$currentChatPage","msg","childrenIds","files","userPrompt","userMessageId","uuidv4","userMessage","messageParentId","responseMessageId","responseMessage","messageToDelete","parentMessageId","childMessageIds","grandchildrenIds","childId","grandchildId","_messages","visitedMessageIds","ul"],"mappings":"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"}