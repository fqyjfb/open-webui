{"version":3,"file":"33.Vv0Oee7w.js","sources":["../../../../../../src/lib/components/icons/ArrowUpCircle.svelte","../../../../../../src/lib/components/workspace/Knowledge/KnowledgeBase/Files.svelte","../../../../../../src/lib/components/icons/BarsArrowUp.svelte","../../../../../../src/lib/components/icons/ArrowPath.svelte","../../../../../../src/lib/components/workspace/Knowledge/KnowledgeBase/AddContentMenu.svelte","../../../../../../src/lib/components/workspace/Knowledge/KnowledgeBase/AddTextContentModal.svelte","../../../../../../src/lib/components/workspace/Knowledge/KnowledgeBase.svelte","../../../../../../src/routes/(app)/workspace/knowledge/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m15 11.25-3-3m0 0-3 3m3-3v7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport dayjs from '$lib/dayjs';\n\timport duration from 'dayjs/plugin/duration';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\n\tdayjs.extend(duration);\n\tdayjs.extend(relativeTime);\n\n\timport { getContext } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { capitalizeFirstLetter, formatFileSize } from '$lib/utils';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentPage from '$lib/components/icons/DocumentPage.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\n\texport let knowledge = null;\n\texport let selectedFileId = null;\n\texport let files = [];\n\n\texport let onClick = (fileId) => {};\n\texport let onDelete = (fileId) => {};\n</script>\n\n<div class=\" max-h-full flex flex-col w-full gap-[0.5px]\">\n\t{#each files as file (file?.id ?? file?.itemId ?? file?.tempId)}\n\t\t<div\n\t\t\tclass=\" flex cursor-pointer w-full px-1.5 py-0.5 bg-transparent dark:hover:bg-gray-850/50 hover:bg-white rounded-xl transition {selectedFileId\n\t\t\t\t? ''\n\t\t\t\t: 'hover:bg-gray-100 dark:hover:bg-gray-850'}\"\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"relative group flex items-center gap-1 rounded-xl p-2 text-left flex-1 justify-between\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tconsole.log(file);\n\t\t\t\t\tonClick(file?.id ?? file?.tempId);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t<div class=\"flex gap-2 items-center line-clamp-1\">\n\t\t\t\t\t\t<div class=\"shrink-0\">\n\t\t\t\t\t\t\t{#if file?.status !== 'uploading'}\n\t\t\t\t\t\t\t\t<DocumentPage className=\"size-3.5\" />\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<Spinner className=\"size-3.5\" />\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"line-clamp-1 text-sm\">\n\t\t\t\t\t\t\t{file?.name ?? file?.meta?.name}\n\t\t\t\t\t\t\t{#if file?.meta?.size}\n\t\t\t\t\t\t\t\t<span class=\"text-xs text-gray-500\">{formatFileSize(file?.meta?.size)}</span>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex items-center gap-2 shrink-0\">\n\t\t\t\t\t{#if file?.updated_at}\n\t\t\t\t\t\t<Tooltip content={dayjs(file.updated_at * 1000).format('LLLL')}>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t{dayjs(file.updated_at * 1000).fromNow()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\n\t\t\t\t\t{#if file?.user}\n\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\tcontent={file?.user?.email ?? $i18n.t('Deleted User')}\n\t\t\t\t\t\t\tclassName=\"flex shrink-0\"\n\t\t\t\t\t\t\tplacement=\"top-start\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"shrink-0 text-gray-500\">\n\t\t\t\t\t\t\t\t{$i18n.t('By {{name}}', {\n\t\t\t\t\t\t\t\t\tname: capitalizeFirstLetter(\n\t\t\t\t\t\t\t\t\t\tfile?.user?.name ?? file?.user?.email ?? $i18n.t('Deleted User')\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</button>\n\n\t\t\t{#if knowledge?.write_access}\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Delete')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tonDelete(file?.id ?? file?.tempId);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M3 4.5h14.25M3 9h9.75M3 13.5h5.25m5.25-.75L17.25 9m0 0L21 12.75M17.25 9v12\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport ArrowUpCircle from '$lib/components/icons/ArrowUpCircle.svelte';\n\timport BarsArrowUp from '$lib/components/icons/BarsArrowUp.svelte';\n\timport FolderOpen from '$lib/components/icons/FolderOpen.svelte';\n\timport ArrowPath from '$lib/components/icons/ArrowPath.svelte';\n\timport GlobeAlt from '$lib/components/icons/GlobeAlt.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let onClose: Function = () => {};\n\n\texport let onSync: Function = () => {};\n\texport let onUpload: Function = (data) => {};\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n\talign=\"end\"\n>\n\t<Tooltip content={$i18n.t('Add Content')}>\n\t\t<button\n\t\t\tclass=\" p-1.5 rounded-xl hover:bg-gray-100 dark:bg-gray-850 dark:hover:bg-gray-800 transition font-medium text-sm flex items-center space-x-1\"\n\t\t\ton:click={(e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tshow = true;\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\tfill=\"currentColor\"\n\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-2xl px-1 py-1  border border-gray-100  dark:border-gray-800 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg transition\"\n\t\t\tsideOffset={4}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload({ type: 'files' });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<ArrowUpCircle strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Upload files')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload({ type: 'directory' });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<FolderOpen strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Upload directory')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<Tooltip\n\t\t\t\tcontent={$i18n.t(\n\t\t\t\t\t'This option will delete all existing files in the collection and replace them with newly uploaded files.'\n\t\t\t\t)}\n\t\t\t\tclassName=\"w-full\"\n\t\t\t>\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tonSync();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<ArrowPath strokeWidth=\"2\" />\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Sync directory')}</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t</Tooltip>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload({ type: 'web' });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<GlobeAlt strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Add webpage')}</div>\n\t\t\t</DropdownMenu.Item>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload({ type: 'text' });\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<BarsArrowUp strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Add text content')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport dayjs from 'dayjs';\n\n\timport { onMount, getContext, createEventDispatcher } from 'svelte';\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Modal from '$lib/components/common/Modal.svelte';\n\timport RichTextInput from '$lib/components/common/RichTextInput.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport MicSolid from '$lib/components/icons/MicSolid.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VoiceRecording from '$lib/components/chat/MessageInput/VoiceRecording.svelte';\n\texport let show = false;\n\n\tlet name = $i18n.t('Untitled');\n\tlet content = '';\n\n\tlet voiceInput = false;\n</script>\n\n<Modal size=\"full\" containerClassName=\"\" className=\"h-full bg-white dark:bg-gray-900\" bind:show>\n\t<div class=\"absolute top-0 right-0 p-5\">\n\t\t<button\n\t\t\tclass=\"self-center dark:text-white\"\n\t\t\ttype=\"button\"\n\t\t\ton:click={() => {\n\t\t\t\tshow = false;\n\t\t\t}}\n\t\t>\n\t\t\t<XMark className=\"size-3.5\" />\n\t\t</button>\n\t</div>\n\t<div class=\"flex flex-col md:flex-row w-full h-full md:space-x-4 dark:text-gray-200\">\n\t\t<form\n\t\t\tclass=\"flex flex-col w-full h-full\"\n\t\t\ton:submit|preventDefault={() => {\n\t\t\t\tif (name.trim() === '' || content.trim() === '') {\n\t\t\t\t\ttoast.error($i18n.t('Please fill in all fields.'));\n\t\t\t\t\tname = name.trim();\n\t\t\t\t\tcontent = content.trim();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdispatch('submit', {\n\t\t\t\t\tname,\n\t\t\t\t\tcontent\n\t\t\t\t});\n\t\t\t\tshow = false;\n\t\t\t\tname = '';\n\t\t\t\tcontent = '';\n\t\t\t}}\n\t\t>\n\t\t\t<div class=\" flex-1 w-full h-full flex justify-center overflow-auto px-5 py-4\">\n\t\t\t\t<div class=\" max-w-3xl py-2 md:py-10 w-full flex flex-col gap-2\">\n\t\t\t\t\t<div class=\"shrink-0 w-full flex justify-between items-center\">\n\t\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"w-full text-3xl font-medium bg-transparent outline-hidden\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tbind:value={name}\n\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Title')}\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\" flex-1 w-full h-full\">\n\t\t\t\t\t\t<RichTextInput\n\t\t\t\t\t\t\tbind:value={content}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Write something...')}\n\t\t\t\t\t\t\tpreserveBreaks={true}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-row items-center justify-end text-sm font-medium shrink-0 mt-1 p-4 gap-1.5\"\n\t\t\t>\n\t\t\t\t<div class=\"\">\n\t\t\t\t\t{#if voiceInput}\n\t\t\t\t\t\t<div class=\" max-w-full w-full\">\n\t\t\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\t\t\tbind:recording={voiceInput}\n\t\t\t\t\t\t\t\tclassName=\"p-1\"\n\t\t\t\t\t\t\t\tonCancel={() => {\n\t\t\t\t\t\t\t\t\tvoiceInput = false;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonConfirm={(data) => {\n\t\t\t\t\t\t\t\t\tconst { text, filename } = data;\n\t\t\t\t\t\t\t\t\tcontent = `${content}${text} `;\n\n\t\t\t\t\t\t\t\t\tvoiceInput = false;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<Tooltip content={$i18n.t('Voice Input')}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" p-2 bg-gray-50 text-gray-700 dark:bg-gray-700 dark:text-white transition rounded-full\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(`Permission denied when accessing microphone: {{error}}`, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\t\t\t\t\tvoiceInput = true;\n\t\t\t\t\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tstream = null;\n\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MicSolid className=\"size-5\" />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\" shrink-0\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Save')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3.5 py-2 bg-black text-white dark:bg-white dark:text-black transition rounded-full\"\n\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n</Modal>\n\n<style>\n\tinput::-webkit-outer-spin-button,\n\tinput::-webkit-inner-spin-button {\n\t\t/* display: none; <- Crashes Chrome on hover */\n\t\t-webkit-appearance: none;\n\t\tmargin: 0; /* <-- Apparently some margin are still there even though it's hidden */\n\t}\n\n\t.tabs::-webkit-scrollbar {\n\t\tdisplay: none; /* for Chrome, Safari and Opera */\n\t}\n\n\t.tabs {\n\t\t-ms-overflow-style: none; /* IE and Edge */\n\t\tscrollbar-width: none; /* Firefox */\n\t}\n\n\tinput[type='number'] {\n\t\t-moz-appearance: textfield; /* Firefox */\n\t}\n</style>\n","<script lang=\"ts\">\n\timport Fuse from 'fuse.js';\n\timport { toast } from 'svelte-sonner';\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { PaneGroup, Pane, PaneResizer } from 'paneforge';\n\n\timport { onMount, getContext, onDestroy, tick } from 'svelte';\n\tconst i18n = getContext('i18n');\n\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\timport {\n\t\tmobile,\n\t\tshowSidebar,\n\t\tknowledge as _knowledge,\n\t\tconfig,\n\t\tuser,\n\t\tsettings\n\t} from '$lib/stores';\n\n\timport {\n\t\tupdateFileDataContentById,\n\t\tuploadFile,\n\t\tdeleteFileById,\n\t\tgetFileById\n\t} from '$lib/apis/files';\n\timport {\n\t\taddFileToKnowledgeById,\n\t\tgetKnowledgeById,\n\t\tremoveFileFromKnowledgeById,\n\t\tresetKnowledgeById,\n\t\tupdateFileFromKnowledgeById,\n\t\tupdateKnowledgeById,\n\t\tsearchKnowledgeFilesById\n\t} from '$lib/apis/knowledge';\n\timport { processWeb, processYoutubeVideo } from '$lib/apis/retrieval';\n\n\timport { blobToFile, isYoutubeUrl } from '$lib/utils';\n\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\timport Files from './KnowledgeBase/Files.svelte';\n\timport AddFilesPlaceholder from '$lib/components/AddFilesPlaceholder.svelte';\n\n\timport AddContentMenu from './KnowledgeBase/AddContentMenu.svelte';\n\timport AddTextContentModal from './KnowledgeBase/AddTextContentModal.svelte';\n\n\timport SyncConfirmDialog from '../../common/ConfirmDialog.svelte';\n\timport Drawer from '$lib/components/common/Drawer.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\timport LockClosed from '$lib/components/icons/LockClosed.svelte';\n\timport AccessControlModal from '../common/AccessControlModal.svelte';\n\timport Search from '$lib/components/icons/Search.svelte';\n\timport FilesOverlay from '$lib/components/chat/MessageInput/FilesOverlay.svelte';\n\timport DropdownOptions from '$lib/components/common/DropdownOptions.svelte';\n\timport Pagination from '$lib/components/common/Pagination.svelte';\n\timport AttachWebpageModal from '$lib/components/chat/MessageInput/AttachWebpageModal.svelte';\n\n\tlet largeScreen = true;\n\n\tlet pane;\n\tlet showSidepanel = true;\n\n\tlet showAddWebpageModal = false;\n\tlet showAddTextContentModal = false;\n\n\tlet showSyncConfirmModal = false;\n\tlet showAccessControlModal = false;\n\n\tlet minSize = 0;\n\ttype Knowledge = {\n\t\tid: string;\n\t\tname: string;\n\t\tdescription: string;\n\t\tdata: {\n\t\t\tfile_ids: string[];\n\t\t};\n\t\tfiles: any[];\n\t};\n\n\tlet id = null;\n\tlet knowledge: Knowledge | null = null;\n\tlet knowledgeId = null;\n\n\tlet selectedFileId = null;\n\tlet selectedFile = null;\n\tlet selectedFileContent = '';\n\n\tlet inputFiles = null;\n\n\tlet query = '';\n\tlet viewOption = null;\n\tlet sortKey = null;\n\tlet direction = null;\n\n\tlet currentPage = 1;\n\tlet fileItems = null;\n\tlet fileItemsTotal = null;\n\n\tconst reset = () => {\n\t\tcurrentPage = 1;\n\t};\n\n\tconst init = async () => {\n\t\treset();\n\t\tawait getItemsPage();\n\t};\n\n\t$: if (\n\t\tknowledgeId !== null &&\n\t\tquery !== undefined &&\n\t\tviewOption !== undefined &&\n\t\tsortKey !== undefined &&\n\t\tdirection !== undefined &&\n\t\tcurrentPage !== undefined\n\t) {\n\t\tgetItemsPage();\n\t}\n\n\t$: if (\n\t\tquery !== undefined &&\n\t\tviewOption !== undefined &&\n\t\tsortKey !== undefined &&\n\t\tdirection !== undefined\n\t) {\n\t\treset();\n\t}\n\n\tconst getItemsPage = async () => {\n\t\tif (knowledgeId === null) return;\n\n\t\tfileItems = null;\n\t\tfileItemsTotal = null;\n\n\t\tif (sortKey === null) {\n\t\t\tdirection = null;\n\t\t}\n\n\t\tconst res = await searchKnowledgeFilesById(\n\t\t\tlocalStorage.token,\n\t\t\tknowledge.id,\n\t\t\tquery,\n\t\t\tviewOption,\n\t\t\tsortKey,\n\t\t\tdirection,\n\t\t\tcurrentPage\n\t\t).catch(() => {\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tfileItems = res.items;\n\t\t\tfileItemsTotal = res.total;\n\t\t}\n\t\treturn res;\n\t};\n\n\tconst fileSelectHandler = async (file) => {\n\t\ttry {\n\t\t\tselectedFile = file;\n\t\t\tselectedFileContent = selectedFile?.data?.content || '';\n\t\t} catch (e) {\n\t\t\ttoast.error($i18n.t('Failed to load file content.'));\n\t\t}\n\t};\n\n\tconst createFileFromText = (name, content) => {\n\t\tconst blob = new Blob([content], { type: 'text/plain' });\n\t\tconst file = blobToFile(blob, `${name}.txt`);\n\n\t\tconsole.log(file);\n\t\treturn file;\n\t};\n\n\tconst uploadWeb = async (urls) => {\n\t\tif (!Array.isArray(urls)) {\n\t\t\turls = [urls];\n\t\t}\n\n\t\tconst newFileItems = urls.map((url) => ({\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: url,\n\t\t\tname: url,\n\t\t\tsize: null,\n\t\t\tstatus: 'uploading',\n\t\t\terror: '',\n\t\t\titemId: uuidv4()\n\t\t}));\n\n\t\t// Display all items at once\n\t\tfileItems = [...newFileItems, ...(fileItems ?? [])];\n\n\t\tfor (const fileItem of newFileItems) {\n\t\t\ttry {\n\t\t\t\tconsole.log(fileItem);\n\t\t\t\tconst res = await processWeb(localStorage.token, '', fileItem.url, false).catch((e) => {\n\t\t\t\t\tconsole.error('Error processing web URL:', e);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\tconst file = createFileFromText(\n\t\t\t\t\t\t// Use URL as filename, sanitized\n\t\t\t\t\t\tfileItem.url\n\t\t\t\t\t\t\t.replace(/[^a-z0-9]/gi, '_')\n\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t.slice(0, 50),\n\t\t\t\t\t\tres.content\n\t\t\t\t\t);\n\n\t\t\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file).catch((e) => {\n\t\t\t\t\t\ttoast.error(`${e}`);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (uploadedFile) {\n\t\t\t\t\t\tconsole.log(uploadedFile);\n\t\t\t\t\t\tfileItems = fileItems.map((item) => {\n\t\t\t\t\t\t\tif (item.itemId === fileItem.itemId) {\n\t\t\t\t\t\t\t\titem.id = uploadedFile.id;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t\t\t\tfileItems = fileItems.filter((file) => file.id !== uploadedFile.id);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait addFileHandler(uploadedFile.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttoast.error($i18n.t('Failed to upload file.'));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// remove the item from fileItems\n\t\t\t\t\tfileItems = fileItems.filter((item) => item.itemId !== fileItem.itemId);\n\t\t\t\t\ttoast.error($i18n.t('Failed to process URL: {{url}}', { url: fileItem.url }));\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// remove the item from fileItems\n\t\t\t\tfileItems = fileItems.filter((item) => item.itemId !== fileItem.itemId);\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst uploadFileHandler = async (file) => {\n\t\tconsole.log(file);\n\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tsize: file.size,\n\t\t\tstatus: 'uploading',\n\t\t\terror: '',\n\t\t\titemId: uuidv4()\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tif (\n\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t) {\n\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\tfileSize: file.size,\n\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t});\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t})\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tfileItems = [fileItem, ...(fileItems ?? [])];\n\t\ttry {\n\t\t\tlet metadata = {\n\t\t\t\tknowledge_id: knowledge.id,\n\t\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\t\t...((file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t\t\t}\n\t\t\t\t\t: {})\n\t\t\t};\n\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (uploadedFile) {\n\t\t\t\tconsole.log(uploadedFile);\n\t\t\t\tfileItems = fileItems.map((item) => {\n\t\t\t\t\tif (item.itemId === fileItem.itemId) {\n\t\t\t\t\t\titem.id = uploadedFile.id;\n\t\t\t\t\t}\n\t\t\t\t\treturn item;\n\t\t\t\t});\n\n\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t\tfileItems = fileItems.filter((file) => file.id !== uploadedFile.id);\n\t\t\t\t} else {\n\t\t\t\t\tawait addFileHandler(uploadedFile.id);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error($i18n.t('Failed to upload file.'));\n\t\t\t}\n\t\t} catch (e) {\n\t\t\ttoast.error(`${e}`);\n\t\t}\n\t};\n\n\tconst uploadDirectoryHandler = async () => {\n\t\t// Check if File System Access API is supported\n\t\tconst isFileSystemAccessSupported = 'showDirectoryPicker' in window;\n\n\t\ttry {\n\t\t\tif (isFileSystemAccessSupported) {\n\t\t\t\t// Modern browsers (Chrome, Edge) implementation\n\t\t\t\tawait handleModernBrowserUpload();\n\t\t\t} else {\n\t\t\t\t// Firefox fallback\n\t\t\t\tawait handleFirefoxUpload();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\thandleUploadError(error);\n\t\t}\n\t};\n\n\t// Helper function to check if a path contains hidden folders\n\tconst hasHiddenFolder = (path) => {\n\t\treturn path.split('/').some((part) => part.startsWith('.'));\n\t};\n\n\t// Modern browsers implementation using File System Access API\n\tconst handleModernBrowserUpload = async () => {\n\t\tconst dirHandle = await window.showDirectoryPicker();\n\t\tlet totalFiles = 0;\n\t\tlet uploadedFiles = 0;\n\n\t\t// Function to update the UI with the progress\n\t\tconst updateProgress = () => {\n\t\t\tconst percentage = (uploadedFiles / totalFiles) * 100;\n\t\t\ttoast.info(\n\t\t\t\t$i18n.t('Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)', {\n\t\t\t\t\tuploadedFiles: uploadedFiles,\n\t\t\t\t\ttotalFiles: totalFiles,\n\t\t\t\t\tpercentage: percentage.toFixed(2)\n\t\t\t\t})\n\t\t\t);\n\t\t};\n\n\t\t// Recursive function to count all files excluding hidden ones\n\t\tasync function countFiles(dirHandle) {\n\t\t\tfor await (const entry of dirHandle.values()) {\n\t\t\t\t// Skip hidden files and directories\n\t\t\t\tif (entry.name.startsWith('.')) continue;\n\n\t\t\t\tif (entry.kind === 'file') {\n\t\t\t\t\ttotalFiles++;\n\t\t\t\t} else if (entry.kind === 'directory') {\n\t\t\t\t\t// Only process non-hidden directories\n\t\t\t\t\tif (!entry.name.startsWith('.')) {\n\t\t\t\t\t\tawait countFiles(entry);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Recursive function to process directories excluding hidden files and folders\n\t\tasync function processDirectory(dirHandle, path = '') {\n\t\t\tfor await (const entry of dirHandle.values()) {\n\t\t\t\t// Skip hidden files and directories\n\t\t\t\tif (entry.name.startsWith('.')) continue;\n\n\t\t\t\tconst entryPath = path ? `${path}/${entry.name}` : entry.name;\n\n\t\t\t\t// Skip if the path contains any hidden folders\n\t\t\t\tif (hasHiddenFolder(entryPath)) continue;\n\n\t\t\t\tif (entry.kind === 'file') {\n\t\t\t\t\tconst file = await entry.getFile();\n\t\t\t\t\tconst fileWithPath = new File([file], entryPath, { type: file.type });\n\n\t\t\t\t\tawait uploadFileHandler(fileWithPath);\n\t\t\t\t\tuploadedFiles++;\n\t\t\t\t\tupdateProgress();\n\t\t\t\t} else if (entry.kind === 'directory') {\n\t\t\t\t\t// Only process non-hidden directories\n\t\t\t\t\tif (!entry.name.startsWith('.')) {\n\t\t\t\t\t\tawait processDirectory(entry, entryPath);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait countFiles(dirHandle);\n\t\tupdateProgress();\n\n\t\tif (totalFiles > 0) {\n\t\t\tawait processDirectory(dirHandle);\n\t\t} else {\n\t\t\tconsole.log('No files to upload.');\n\t\t}\n\t};\n\n\t// Firefox fallback implementation using traditional file input\n\tconst handleFirefoxUpload = async () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// Create hidden file input\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.type = 'file';\n\t\t\tinput.webkitdirectory = true;\n\t\t\tinput.directory = true;\n\t\t\tinput.multiple = true;\n\t\t\tinput.style.display = 'none';\n\n\t\t\t// Add input to DOM temporarily\n\t\t\tdocument.body.appendChild(input);\n\n\t\t\tinput.onchange = async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst files = Array.from(input.files)\n\t\t\t\t\t\t// Filter out files from hidden folders\n\t\t\t\t\t\t.filter((file) => !hasHiddenFolder(file.webkitRelativePath));\n\n\t\t\t\t\tlet totalFiles = files.length;\n\t\t\t\t\tlet uploadedFiles = 0;\n\n\t\t\t\t\t// Function to update the UI with the progress\n\t\t\t\t\tconst updateProgress = () => {\n\t\t\t\t\t\tconst percentage = (uploadedFiles / totalFiles) * 100;\n\t\t\t\t\t\ttoast.info(\n\t\t\t\t\t\t\t$i18n.t('Upload Progress: {{uploadedFiles}}/{{totalFiles}} ({{percentage}}%)', {\n\t\t\t\t\t\t\t\tuploadedFiles: uploadedFiles,\n\t\t\t\t\t\t\t\ttotalFiles: totalFiles,\n\t\t\t\t\t\t\t\tpercentage: percentage.toFixed(2)\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\n\t\t\t\t\tupdateProgress();\n\n\t\t\t\t\t// Process all files\n\t\t\t\t\tfor (const file of files) {\n\t\t\t\t\t\t// Skip hidden files (additional check)\n\t\t\t\t\t\tif (!file.name.startsWith('.')) {\n\t\t\t\t\t\t\tconst relativePath = file.webkitRelativePath || file.name;\n\t\t\t\t\t\t\tconst fileWithPath = new File([file], relativePath, { type: file.type });\n\n\t\t\t\t\t\t\tawait uploadFileHandler(fileWithPath);\n\t\t\t\t\t\t\tuploadedFiles++;\n\t\t\t\t\t\t\tupdateProgress();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clean up\n\t\t\t\t\tdocument.body.removeChild(input);\n\t\t\t\t\tresolve();\n\t\t\t\t} catch (error) {\n\t\t\t\t\treject(error);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tinput.onerror = (error) => {\n\t\t\t\tdocument.body.removeChild(input);\n\t\t\t\treject(error);\n\t\t\t};\n\n\t\t\t// Trigger file picker\n\t\t\tinput.click();\n\t\t});\n\t};\n\n\t// Error handler\n\tconst handleUploadError = (error) => {\n\t\tif (error.name === 'AbortError') {\n\t\t\ttoast.info($i18n.t('Directory selection was cancelled'));\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Error accessing directory'));\n\t\t\tconsole.error('Directory access error:', error);\n\t\t}\n\t};\n\n\t// Helper function to maintain file paths within zip\n\tconst syncDirectoryHandler = async () => {\n\t\tif (fileItems.length > 0) {\n\t\t\tconst res = await resetKnowledgeById(localStorage.token, id).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\tfileItems = [];\n\t\t\t\ttoast.success($i18n.t('Knowledge reset successfully.'));\n\n\t\t\t\t// Upload directory\n\t\t\t\tuploadDirectoryHandler();\n\t\t\t}\n\t\t} else {\n\t\t\tuploadDirectoryHandler();\n\t\t}\n\t};\n\n\tconst addFileHandler = async (fileId) => {\n\t\tconst res = await addFileToKnowledgeById(localStorage.token, id, fileId).catch((e) => {\n\t\t\ttoast.error(`${e}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('File added successfully.'));\n\t\t\tinit();\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to add file.'));\n\t\t\tfileItems = fileItems.filter((file) => file.id !== fileId);\n\t\t}\n\t};\n\n\tconst deleteFileHandler = async (fileId) => {\n\t\ttry {\n\t\t\tconsole.log('Starting file deletion process for:', fileId);\n\n\t\t\t// Remove from knowledge base only\n\t\t\tconst res = await removeFileFromKnowledgeById(localStorage.token, id, fileId);\n\t\t\tconsole.log('Knowledge base updated:', res);\n\n\t\t\tif (res) {\n\t\t\t\ttoast.success($i18n.t('File removed successfully.'));\n\t\t\t\tawait init();\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error in deleteFileHandler:', e);\n\t\t\ttoast.error(`${e}`);\n\t\t}\n\t};\n\n\tlet debounceTimeout = null;\n\tlet mediaQuery;\n\n\tlet dragged = false;\n\tlet isSaving = false;\n\n\tconst updateFileContentHandler = async () => {\n\t\tif (isSaving) {\n\t\t\tconsole.log('Save operation already in progress, skipping...');\n\t\t\treturn;\n\t\t}\n\n\t\tisSaving = true;\n\n\t\ttry {\n\t\t\tconst res = await updateFileDataContentById(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tselectedFile.id,\n\t\t\t\tselectedFileContent\n\t\t\t).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\ttoast.success($i18n.t('File content updated successfully.'));\n\n\t\t\t\tselectedFileId = null;\n\t\t\t\tselectedFile = null;\n\t\t\t\tselectedFileContent = '';\n\n\t\t\t\tawait init();\n\t\t\t}\n\t\t} finally {\n\t\t\tisSaving = false;\n\t\t}\n\t};\n\n\tconst changeDebounceHandler = () => {\n\t\tconsole.log('debounce');\n\t\tif (debounceTimeout) {\n\t\t\tclearTimeout(debounceTimeout);\n\t\t}\n\n\t\tdebounceTimeout = setTimeout(async () => {\n\t\t\tif (knowledge.name.trim() === '' || knowledge.description.trim() === '') {\n\t\t\t\ttoast.error($i18n.t('Please fill in all fields.'));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst res = await updateKnowledgeById(localStorage.token, id, {\n\t\t\t\t...knowledge,\n\t\t\t\tname: knowledge.name,\n\t\t\t\tdescription: knowledge.description,\n\t\t\t\taccess_control: knowledge.access_control\n\t\t\t}).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\ttoast.success($i18n.t('Knowledge updated successfully'));\n\t\t\t}\n\t\t}, 1000);\n\t};\n\n\tconst handleMediaQuery = async (e) => {\n\t\tif (e.matches) {\n\t\t\tlargeScreen = true;\n\t\t} else {\n\t\t\tlargeScreen = false;\n\t\t}\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being draggedOver.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tdragged = false;\n\n\t\tif (!knowledge?.write_access) {\n\t\t\ttoast.error($i18n.t('You do not have permission to upload files to this knowledge base.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst handleUploadingFileFolder = (items) => {\n\t\t\tfor (const item of items) {\n\t\t\t\tif (item.isFile) {\n\t\t\t\t\titem.file((file) => {\n\t\t\t\t\t\tuploadFileHandler(file);\n\t\t\t\t\t});\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Not sure why you have to call webkitGetAsEntry and isDirectory seperate, but it won't work if you try item.webkitGetAsEntry().isDirectory\n\t\t\t\tconst wkentry = item.webkitGetAsEntry();\n\t\t\t\tconst isDirectory = wkentry.isDirectory;\n\t\t\t\tif (isDirectory) {\n\t\t\t\t\t// Read the directory\n\t\t\t\t\twkentry.createReader().readEntries(\n\t\t\t\t\t\t(entries) => {\n\t\t\t\t\t\t\thandleUploadingFileFolder(entries);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t(error) => {\n\t\t\t\t\t\t\tconsole.error('Error reading directory entries:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.info($i18n.t('Uploading file...'));\n\t\t\t\t\tuploadFileHandler(item.getAsFile());\n\t\t\t\t\ttoast.success($i18n.t('File uploaded!'));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tif (e.dataTransfer?.files) {\n\t\t\t\tconst inputItems = e.dataTransfer?.items;\n\n\t\t\t\tif (inputItems && inputItems.length > 0) {\n\t\t\t\t\thandleUploadingFileFolder(inputItems);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonMount(async () => {\n\t\t// listen to resize 1024px\n\t\tmediaQuery = window.matchMedia('(min-width: 1024px)');\n\n\t\tmediaQuery.addEventListener('change', handleMediaQuery);\n\t\thandleMediaQuery(mediaQuery);\n\n\t\t// Select the container element you want to observe\n\t\tconst container = document.getElementById('collection-container');\n\n\t\t// initialize the minSize based on the container width\n\t\tminSize = !largeScreen ? 100 : Math.floor((300 / container.clientWidth) * 100);\n\n\t\t// Create a new ResizeObserver instance\n\t\tconst resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (let entry of entries) {\n\t\t\t\tconst width = entry.contentRect.width;\n\t\t\t\t// calculate the percentage of 300\n\t\t\t\tconst percentage = (300 / width) * 100;\n\t\t\t\t// set the minSize to the percentage, must be an integer\n\t\t\t\tminSize = !largeScreen ? 100 : Math.floor(percentage);\n\n\t\t\t\tif (showSidepanel) {\n\t\t\t\t\tif (pane && pane.isExpanded() && pane.getSize() < minSize) {\n\t\t\t\t\t\tpane.resize(minSize);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Start observing the container's size changes\n\t\tresizeObserver.observe(container);\n\n\t\tif (pane) {\n\t\t\tpane.expand();\n\t\t}\n\n\t\tid = $page.params.id;\n\t\tconst res = await getKnowledgeById(localStorage.token, id).catch((e) => {\n\t\t\ttoast.error(`${e}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tknowledge = res;\n\t\t\tknowledgeId = knowledge?.id;\n\t\t} else {\n\t\t\tgoto('/workspace/knowledge');\n\t\t}\n\n\t\tconst dropZone = document.querySelector('body');\n\t\tdropZone?.addEventListener('dragover', onDragOver);\n\t\tdropZone?.addEventListener('drop', onDrop);\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\n\t});\n\n\tonDestroy(() => {\n\t\tmediaQuery?.removeEventListener('change', handleMediaQuery);\n\t\tconst dropZone = document.querySelector('body');\n\t\tdropZone?.removeEventListener('dragover', onDragOver);\n\t\tdropZone?.removeEventListener('drop', onDrop);\n\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\n\t});\n\n\tconst decodeString = (str: string) => {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str);\n\t\t} catch (e) {\n\t\t\treturn str;\n\t\t}\n\t};\n</script>\n\n<FilesOverlay show={dragged} />\n<SyncConfirmDialog\n\tbind:show={showSyncConfirmModal}\n\tmessage={$i18n.t(\n\t\t'This will reset the knowledge base and sync all files. Do you wish to continue?'\n\t)}\n\ton:confirm={() => {\n\t\tsyncDirectoryHandler();\n\t}}\n/>\n\n<AttachWebpageModal\n\tbind:show={showAddWebpageModal}\n\tonSubmit={async (e) => {\n\t\tuploadWeb(e.data);\n\t}}\n/>\n\n<AddTextContentModal\n\tbind:show={showAddTextContentModal}\n\ton:submit={(e) => {\n\t\tconst file = createFileFromText(e.detail.name, e.detail.content);\n\t\tuploadFileHandler(file);\n\t}}\n/>\n\n<input\n\tid=\"files-input\"\n\tbind:files={inputFiles}\n\ttype=\"file\"\n\tmultiple\n\thidden\n\ton:change={async () => {\n\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\tfor (const file of inputFiles) {\n\t\t\t\tawait uploadFileHandler(file);\n\t\t\t}\n\n\t\t\tinputFiles = null;\n\t\t\tconst fileInputElement = document.getElementById('files-input');\n\n\t\t\tif (fileInputElement) {\n\t\t\t\tfileInputElement.value = '';\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t}\n\t}}\n/>\n\n<div class=\"flex flex-col w-full h-full min-h-full\" id=\"collection-container\">\n\t{#if id && knowledge}\n\t\t<AccessControlModal\n\t\t\tbind:show={showAccessControlModal}\n\t\t\tbind:accessControl={knowledge.access_control}\n\t\t\tshare={$user?.permissions?.sharing?.knowledge || $user?.role === 'admin'}\n\t\t\tsharePublic={$user?.permissions?.sharing?.public_knowledge || $user?.role === 'admin'}\n\t\t\tonChange={() => {\n\t\t\t\tchangeDebounceHandler();\n\t\t\t}}\n\t\t\taccessRoles={['read', 'write']}\n\t\t/>\n\t\t<div class=\"w-full px-2\">\n\t\t\t<div class=\" flex w-full\">\n\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t<div class=\"flex items-center justify-between w-full\">\n\t\t\t\t\t\t<div class=\"w-full flex justify-between items-center\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tclass=\"text-left w-full font-medium text-lg font-primary bg-transparent outline-hidden flex-1\"\n\t\t\t\t\t\t\t\tbind:value={knowledge.name}\n\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Knowledge Name')}\n\t\t\t\t\t\t\t\tdisabled={!knowledge?.write_access}\n\t\t\t\t\t\t\t\ton:input={() => {\n\t\t\t\t\t\t\t\t\tchangeDebounceHandler();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<div class=\"shrink-0 mr-2.5\">\n\t\t\t\t\t\t\t\t{#if fileItemsTotal}\n\t\t\t\t\t\t\t\t\t<div class=\"text-xs text-gray-500\">\n\t\t\t\t\t\t\t\t\t\t<!-- {$i18n.t('{{COUNT}} files')} -->\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('{{COUNT}} files', {\n\t\t\t\t\t\t\t\t\t\t\tCOUNT: fileItemsTotal\n\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t{#if knowledge?.write_access}\n\t\t\t\t\t\t\t<div class=\"self-center shrink-0\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-black dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-white transition px-2 py-1 rounded-full flex gap-1 items-center\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowAccessControlModal = true;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<LockClosed strokeWidth=\"2.5\" className=\"size-3.5\" />\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium shrink-0\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Access')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"text-xs shrink-0 text-gray-500\">\n\t\t\t\t\t\t\t\t{$i18n.t('Read Only')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex w-full\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tclass=\"text-left text-xs w-full text-gray-500 bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tbind:value={knowledge.description}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Knowledge Description')}\n\t\t\t\t\t\t\tdisabled={!knowledge?.write_access}\n\t\t\t\t\t\t\ton:input={() => {\n\t\t\t\t\t\t\t\tchangeDebounceHandler();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div\n\t\t\tclass=\"mt-2 mb-2.5 py-2 -mx-0 bg-white dark:bg-gray-900 rounded-3xl border border-gray-100/30 dark:border-gray-850/30 flex-1\"\n\t\t>\n\t\t\t<div class=\"px-3.5 flex flex-1 items-center w-full space-x-2 py-0.5 pb-2\">\n\t\t\t\t<div class=\"flex flex-1 items-center\">\n\t\t\t\t\t<div class=\" self-center ml-1 mr-3\">\n\t\t\t\t\t\t<Search className=\"size-3.5\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclass=\" w-full text-sm pr-4 py-1 rounded-r-xl outline-hidden bg-transparent\"\n\t\t\t\t\t\tbind:value={query}\n\t\t\t\t\t\tplaceholder={`${$i18n.t('Search Collection')}`}\n\t\t\t\t\t\ton:focus={() => {\n\t\t\t\t\t\t\tselectedFileId = null;\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t{#if knowledge?.write_access}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<AddContentMenu\n\t\t\t\t\t\t\t\tonUpload={(data) => {\n\t\t\t\t\t\t\t\t\tif (data.type === 'directory') {\n\t\t\t\t\t\t\t\t\t\tuploadDirectoryHandler();\n\t\t\t\t\t\t\t\t\t} else if (data.type === 'web') {\n\t\t\t\t\t\t\t\t\t\tshowAddWebpageModal = true;\n\t\t\t\t\t\t\t\t\t} else if (data.type === 'text') {\n\t\t\t\t\t\t\t\t\t\tshowAddTextContentModal = true;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdocument.getElementById('files-input').click();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonSync={() => {\n\t\t\t\t\t\t\t\t\tshowSyncConfirmModal = true;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"px-3 flex justify-between\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex w-full bg-transparent overflow-x-auto scrollbar-none\"\n\t\t\t\t\ton:wheel={(e) => {\n\t\t\t\t\t\tif (e.deltaY !== 0) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\te.currentTarget.scrollLeft += e.deltaY;\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"flex gap-3 w-fit text-center text-sm rounded-full bg-transparent px-0.5 whitespace-nowrap\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<DropdownOptions\n\t\t\t\t\t\t\talign=\"start\"\n\t\t\t\t\t\t\tclassName=\"flex w-full items-center gap-2 truncate px-3 py-1.5 text-sm bg-gray-50 dark:bg-gray-850 rounded-xl  placeholder-gray-400 outline-hidden focus:outline-hidden\"\n\t\t\t\t\t\t\tbind:value={viewOption}\n\t\t\t\t\t\t\titems={[\n\t\t\t\t\t\t\t\t{ value: null, label: $i18n.t('All') },\n\t\t\t\t\t\t\t\t{ value: 'created', label: $i18n.t('Created by you') },\n\t\t\t\t\t\t\t\t{ value: 'shared', label: $i18n.t('Shared with you') }\n\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\tonChange={(value) => {\n\t\t\t\t\t\t\t\tif (value) {\n\t\t\t\t\t\t\t\t\tlocalStorage.workspaceViewOption = value;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete localStorage.workspaceViewOption;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<DropdownOptions\n\t\t\t\t\t\t\talign=\"start\"\n\t\t\t\t\t\t\tbind:value={sortKey}\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Sort')}\n\t\t\t\t\t\t\titems={[\n\t\t\t\t\t\t\t\t{ value: 'name', label: $i18n.t('Name') },\n\t\t\t\t\t\t\t\t{ value: 'created_at', label: $i18n.t('Created At') },\n\t\t\t\t\t\t\t\t{ value: 'updated_at', label: $i18n.t('Updated At') }\n\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{#if sortKey}\n\t\t\t\t\t\t\t<DropdownOptions\n\t\t\t\t\t\t\t\talign=\"start\"\n\t\t\t\t\t\t\t\tbind:value={direction}\n\t\t\t\t\t\t\t\titems={[\n\t\t\t\t\t\t\t\t\t{ value: 'asc', label: $i18n.t('Asc') },\n\t\t\t\t\t\t\t\t\t{ value: null, label: $i18n.t('Desc') }\n\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if fileItems !== null && fileItemsTotal !== null}\n\t\t\t\t<div class=\"flex flex-row flex-1 gap-3 px-2.5 mt-2\">\n\t\t\t\t\t<div class=\"flex-1 flex\">\n\t\t\t\t\t\t<div class=\" flex flex-col w-full space-x-2 rounded-lg h-full\">\n\t\t\t\t\t\t\t<div class=\"w-full h-full flex flex-col min-h-full\">\n\t\t\t\t\t\t\t\t{#if fileItems.length > 0}\n\t\t\t\t\t\t\t\t\t<div class=\" flex overflow-y-auto h-full w-full scrollbar-hidden text-xs\">\n\t\t\t\t\t\t\t\t\t\t<Files\n\t\t\t\t\t\t\t\t\t\t\tfiles={fileItems}\n\t\t\t\t\t\t\t\t\t\t\t{knowledge}\n\t\t\t\t\t\t\t\t\t\t\t{selectedFileId}\n\t\t\t\t\t\t\t\t\t\t\tonClick={(fileId) => {\n\t\t\t\t\t\t\t\t\t\t\t\tselectedFileId = fileId;\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (fileItems) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst file = fileItems.find((file) => file.id === selectedFileId);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfileSelectHandler(file);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFile = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\tonDelete={(fileId) => {\n\t\t\t\t\t\t\t\t\t\t\t\tselectedFileId = null;\n\t\t\t\t\t\t\t\t\t\t\t\tselectedFile = null;\n\n\t\t\t\t\t\t\t\t\t\t\t\tdeleteFileHandler(fileId);\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#if fileItemsTotal > 30}\n\t\t\t\t\t\t\t\t\t\t<Pagination bind:page={currentPage} count={fileItemsTotal} perPage={30} />\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\"my-3 flex flex-col justify-center text-center text-gray-500 text-xs\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('No content found')}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if selectedFileId !== null}\n\t\t\t\t\t\t<Drawer\n\t\t\t\t\t\t\tclassName=\"h-full\"\n\t\t\t\t\t\t\tshow={selectedFileId !== null}\n\t\t\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\t\t\tselectedFileId = null;\n\t\t\t\t\t\t\t\tselectedFile = null;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex flex-col justify-start h-full max-h-full\">\n\t\t\t\t\t\t\t\t<div class=\" flex flex-col w-full h-full max-h-full\">\n\t\t\t\t\t\t\t\t\t<div class=\"shrink-0 flex items-center p-2\">\n\t\t\t\t\t\t\t\t\t\t<div class=\"mr-2\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full text-left text-sm p-1.5 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFileId = null;\n\t\t\t\t\t\t\t\t\t\t\t\t\tselectedFile = null;\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<ChevronLeft strokeWidth=\"2.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class=\" flex-1 text-lg line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t\t{selectedFile?.meta?.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t{#if knowledge?.write_access}\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"flex self-center w-fit text-sm py-1 px-2.5 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={isSaving}\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdateFileContentHandler();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if isSaving}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"ml-2 self-center\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t{#key selectedFile.id}\n\t\t\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full h-full text-sm outline-none resize-none px-3 py-2\"\n\t\t\t\t\t\t\t\t\t\t\tbind:value={selectedFileContent}\n\t\t\t\t\t\t\t\t\t\t\tdisabled={!knowledge?.write_access}\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Add content here')}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{/key}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</Drawer>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<div class=\"my-10\">\n\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{:else}\n\t\t<Spinner className=\"size-5\" />\n\t{/if}\n</div>\n","<script>\n\timport KnowledgeBase from '$lib/components/workspace/Knowledge/KnowledgeBase.svelte';\n</script>\n\n<KnowledgeBase />\n"],"names":["className","strokeWidth","dayjs","duration","relativeTime","i18n","getContext","knowledge","selectedFileId","files","$.prop","$$props","onClick","fileId","onDelete","$.each","div","file","formatFileSize","$.untrack","$.get","$$render","consequent_1","consequent_2","$i18n","capitalizeFirstLetter","consequent_3","$.event","button_1","_a","button","createEventDispatcher","onClose","onSync","onUpload","data","show","e","$.set","flyAndScale","dispatch","name","$.mutable_source","content","voiceInput","$$value","text","filename","stream","err","toast","track","consequent","alternate","$.bind_value","input","form","$.preventDefault","largeScreen","showAddWebpageModal","showAddTextContentModal","showSyncConfirmModal","showAccessControlModal","id","knowledgeId","selectedFile","selectedFileContent","inputFiles","query","viewOption","sortKey","direction","currentPage","fileItems","fileItemsTotal","reset","init","getItemsPage","res","searchKnowledgeFilesById","fileSelectHandler","createFileFromText","blob","blobToFile","uploadWeb","urls","newFileItems","url","uuidv4","fileItem","processWeb","uploadedFile","uploadFile","item","addFileHandler","uploadFileHandler","_b","$config","_d","_c","_f","_e","_h","_g","metadata","_k","_j","_i","$settings","_n","_m","_l","uploadDirectoryHandler","isFileSystemAccessSupported","handleModernBrowserUpload","handleFirefoxUpload","error","handleUploadError","hasHiddenFolder","path","part","dirHandle","totalFiles","uploadedFiles","updateProgress","percentage","countFiles","entry","processDirectory","entryPath","fileWithPath","resolve","reject","relativePath","syncDirectoryHandler","resetKnowledgeById","addFileToKnowledgeById","deleteFileHandler","removeFileFromKnowledgeById","debounceTimeout","mediaQuery","dragged","isSaving","updateFileContentHandler","updateFileDataContentById","changeDebounceHandler","updateKnowledgeById","handleMediaQuery","onDragOver","onDragLeave","onDrop","handleUploadingFileFolder","items","wkentry","entries","inputItems","onMount","container","$page","getKnowledgeById","goto","dropZone","onDestroy","$user","value","consequent_4","$0","$.derived_safe_equal","consequent_6","button_2","$$anchor","textarea","consequent_8","consequent_9","alternate_2","input_2","$.mutate","input_3","input_4","div_18","consequent_10","alternate_3","$.bind_files","input_1","fileInputElement"],"mappings":"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"}